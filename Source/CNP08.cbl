       IDENTIFICATION DIVISION.
       PROGRAM-ID.  CNP08.
      *****************************************************************
      *    THIS PROGRAM IS THE ASSIGNED/UNASSIGNED CALL PROGRAM       *
      *****************************************************************
      *  DATE   INITIAL  LOG#   DESCRIPTION
      *-------- ------- ------  ---------------------------------------
      *09/07/91   MOO           CICS CONVERSION.
      *12/20/93   LMB           UNAVAILABLE STATUS MODIFICATIONS.
      *04/15/94   GER           TIME ZONE UPGRADES.
      *03/21/95   FHK           DAILY SCHEDULE CHANGES
      *03/31/95   FHK           CATCHUP CHANGES
      *04/27/95   PLS           CHANGES FOR NEW SPAREBOARD TYPE -
      *                         FAST/SLOW.
      *06/19/95   FHK           ALT SOURCE SCHED   REJM FUNCTION
      *06/22/95   PLS           RETAIN FLAG FOR FASTSLOW BOARD SIDE
      *                         RETURNED FROM DECISION TABLE.
      *07/24/95   FHK           CHANGE SVC-FI AND SPCL-QUAL-FI TO SE
      *                         FIX NR LOGIC FOR LOCAL ON-DUTY.
      *09/20/95   MMM  CNC0009  NEW RESTRICTION CONTROL PROCESSING
      *                         ADDED.
      *11/07/95   PLS   C-225   DISALLOW 'DCAN' IF NOT WITHIN SPECIFIED
      *                         WINDOW.
      *11/20/95   FHK   C-232   CHANGE ODT TO ORDERED FOR TIE BREAKER
      *12/11/95   CK    C-134   MODS TO DCAN UPDATE.
      *12/15/95   PLS  CNC0108  ADD NEW REJECT FUNCTION - RJNW.
      *12/20/95   PLS  CNC0110  DISPLAY MTOD PREVIOUS DUTY.
      *01/08/95   PLS  CNC0106  ADD CLERICAL CRAFT CODE PROCESSING.
      *01/26/96   SRP  CNC0105  HANDLE ALTERNATE CREW SOURCE.
      *03/22/96   TGJ   C-261   ADDED MOVES OF PROFILE TERMINAL TO NEW
      *                         FILEDS ON P915COMM AND P916COMM
      *                         (P915-CALL-TERM & P916-FROM-TERM).
      *                         THIS IS TO POPULATE THE NEW
      *                         UFP-TRAIN-BASE-TERM FIELD FOR PROCESSING
      *                         THE SHIFT REPORT, CNP700.
      *05/14/96   FLW  CNC0006  DEFIFINTION OF WORK WEEK
      *06/17/96   RCW  BUG C297 PRIME P923 ASSIGNMENT WITH JS KEY
      *07/16/96   PLS   A-173   REQUIRE ECC CODE WITH 'N' STATUS CODE,
      *                         WHEN LAYING OFF ON CALL.
      *09/04/96   RCW  CNC0006  ADD CNTL-VERIFY-STARTS CHECK BEFORE
      *                         DISQUALIFYING AN EMPLOYEE FOR # STARTS.
      *09/24/96   FLW  BUGXXXX  FILL ASGNMNT W/TRAIN-SYMBOL IF "CALL"ED
      *09/25/96   FLW  CNC0077  NORTHERN QUEBEC SPAREBOARD - PHASE 1
      *10/10/96   FLW  CNC0077  NORTHERN QUEBEC SPAREBOARD - PHASE 2
      *11/15/96   RCW  C311     CREATE MU TURN IN LAST ALT, EVEN WHEN
      *                         THE LAST ALT HAS NO TURNS.
      *11/20/96   FLW  BUGC329  DCAN/REJT - HIST EMP-NO'S INCORRECT
      *02/07/97   FLW  BUGC342  REMOVE 6 HR WINDOW INTO THE PAST FOR JOB
      *                         SCHED.  PREVENTS USING EXPIRED SCHEDS.
      *03/24/97   FLW  BUGC353  FIX PROBLEM FOR LOCAL TRAINS
      *06/30/97   FLW  BUGC372  SPAREBOARD TV NOT PRESENTED
      *07/21/97   RCW  BUG      CALL WINDOW INCORRECT ON YARD JOBS
      *11/17/97   GER  CNC0134  QUICK TIE UP
      *03/10/98   LMB  CNC0134  NEW VERSION OF QUICK TIE UP.
      *                         ALLOW PERSON TO BE WORKING IF IN SDIST
      *                         THAT ALLOWS QUICK TIE, AND WORKING AN
      *                         ASSIGNED JOB.
      *03/12/98   LMB  CNC0134  ADD PHONE FUNCTION.
      *03/25/98   AMF  CNC0155  ENHANCED TRACKING CHANGES.
      *04/03/98   GBJ  Y2K      REMOVE HISTORY WRITE AND REPLACE WITH
      *                         CALL TO P943.
      *04/06/98   WLW           ADD HELP
      *05/14/98   AMF           BUG FIX IN VACATE PROCESS. DON'T READ
      *                         MASTER IF VACATING AN OPEN ASSIGNMENT.
      *06/02/98   AMF           FIX QTIE BUG SO THAT IF EMP HAS QTIE
      *                         AND 5 STARTS, BOTH ARE DISPLAYED.
      *06/03/98   LMB           CHECK FOR DECISION SERVICE CODE OVERRIDE
      *07/24/98   LMB           P1040: DON'T READ CNTL FILE IF MSTR REC
      *                         IS BLANK (DUE TO NOT READING MSTR IF
      *                         VACATE FUNCTION).
      *09/10/98   BLD  CNC0165  PASS TIMEKEEPING PROFILE FROM ALT CREW
      *                         PROFILE TO P915-PGM.
      *09/16/98   WLC  C-371    FIX FILL-VACANCY BUG
      *10/12/98   RRR  BUG      P1000: MOVED CHECK OF ANNUL STATUS TO
      *                         END OF PARA. ADDED CODE TO CHECK FOR A
      *                         VALID EMP-NO BEFORE GOING TO P2110.
      *12/02/98   GBJ  Y2K      YEAR 2000 SWEEP.
      *12/03/98   BLD  BUG      CHECK SUBSCRIPT BEFORE PERFORMING P1060.
      *01/05/99   KMW  BUG      SUB DIST CNTL READ NEEDED FOR TIME ZONE.
      *02/01/99   KMW  BUG      CORRECTLY POSITION CURSOR FOR 1ST ENTER.
      *02/24/99   NJB           UFP ZAP LOGIC
      *03/12/99   BLD  BUG      DO NOT SEND BYPASS-POINTER FLAG TO P915
      *                         ON A CALL FUNCTION.
      *03/18/99   LMB  CNC0208  INITIATE TRACKING FOR REGULAR EMPLOYEE.
      *                         TRACK FOR RJH.
      *04/07/99   NJB           FIX AV LIST
      *04/14/99   DCK  BUG      FIX C-380 BUG SETTING CALL DATE
      *                         INCORRECTLY
      *04/28/99   GBJ  Y2K      JSK1-EXP-DATE Y2K COMPARE.
      *05/06/99   LMB  BUG      ONLY SET TRACKING REASON IN COMMAREA FOR
      *                         THE OWNER.
      *05/20/99   NJB           ASGN SEN
      *05/21/99   DCK           CHANGE DH REASON EDIT
      *08/05/99   NJB           FIX FOR AVLIST VACANCY FILL
      *08/27/99   NJB  C484     FIX CARDED POOL PRESENTATION
      *09/14/99   NJB CCNC0190  ADD CODE FOR TRAIN PROFILE JOB TYPE
      *12/13/99   GER CNC0259   ADD IC CALL FUNCTIONS.
      *01/13/00   BLD  BUG      CHANGED CODE SO UFP/NR WILL NOT ALLOW
      *                         THE FILL FUNCTION.
      *01/17/00   MOO CNC0183   ADD CODE FOR HOURS OF SERVICE.
      *02/25/00   NJB CNC0270   CHANGE TRCN-DEC-SVC & TRCN-SPCL-QUAL
      *                         REMOVED INTERNAL ORDER, ADDED RUN NUMBER
      *                         FORCE ROUTE, AND BUSINESS AREA
      *03/21/00   AJK CNC0275   ADD SPREAD CALL FUNCTIONALITY, UNDIST
      *                         REST.
      *03/25/00   MOO CNC0183   ADD FROZEN CHANGES.
      *04/24/00   MOO CNC0183   DISPLAY FROZEN IN YELLOW.
      *04/28/00   GER CNC0283   DECISION DH-LEAD TIMES.
      *11/20/00   PLS           ALLOW RJNR, BEFORE FILL, WHEN EMPLOYEE
      *                         IS NOT RESTED.
      *03/01/01   TJR           SAVE THE USER VALUE PLACED IN ON-DUTY
      *                         DATE/TIME FIELD SO WHEN USER REJECTS
      *                         AN EMPLOYEE, OR SYSTEM ADJUSTS THE DATE/
      *                         TIME FOR DEADHEAD TIME, WE CAN SET THE
      *                         FIELD TO THE ORIG VALUE. TO DO THIS, TWO
      *                         FIELDS WERE ADDED TO COMMAREA, ONE TO
      *                         STORE THE VALUE. ANOTHER IS A SCREEN
      *                         SAVE FIELD, USED TO DETERMINE IF USER
      *                         CHANGED THE SCREEN. IF THIS PGM, CHANGES
      *                         THE SCREEN ON DUTY VALUE, IT ALSO CHG'S
      *                         THE COMMAREA SAVE AREA SO WE DON'T THINK
      *                         THE USER CHANGED THE SCREEN.
      *                         SEE TJR 03/01/2001 FOR THE CHG'S
      *03/07/01   PLS           ALLOW SPREAD TIME TO BE OVER 4 HOURS IN
      *                         THE FUTURE.
      *03/12/01   AJK CNC0252   POOL SCHEDULE ENHANCEMENT.
      *05/14/01   AJK CNC252B   POOL SCHEDULE ENHANCEMENT - ADDENDUM B.
      *09/13/01   MJW CNC0349   TRAIN SYMBOL EDITS - ADD EDIT ON TRAIN
      *                         SYMBOL TO CHECK AGAINST TRAIN ID FORMAT
      *                         ON THE TRAIN PROFILE.
      *09/28/01   AJK CNC0331   MANDATORY REST/HOS ENHANCEMENT.
      *10/24/01   AJK C512      'RJHS' BUG FIX.
      *11/06/01   AJK CNC0331A  MTOD/HOS ENHANCEMENT ADDENDUM A.
      *01/11/02   AJK BUG       RJHS FIX FOR NON-UFP CALLS.
      *08/30/02   MET CNC0366   OVERTIME FLAG ON ROAD JOBS
      *12/12/02   MET BUG       FILL ABEND
      *03/07/03   JAJ CNC0331B  MTOD/HOS ADDENDUM B.
      *03/07/18   BLD C560      WILD CARD THE CRAFT PORTION OF THE
      *                         ASSIGNMENT WHEN ACCESSING THE ASSIGNMENT
      *                         QUALIFICATION RECORD.
      *09/17/03   AJK CNC0378   EXTENDED SPAREBOARD SCHEDULE ENH.
      *09/25/03   GER C513      RELEASE TRACKING.
      *11/03/03   TJR CNC0374   PREVENT CALLING EMP IF US EMP AND ORDER
      *                         TIME PRIOR TO LAST TIEUP
      *01/02/04   AJK C564      RELIEF JOB TYPE BUG FIX
      *01/22/04   NRL C568      FIX TO SENR FUNCTION - IT WAS NOT
      *                         COMPARING SENIORITY ON THE SAME ASGN.
      *02/03/04   AJK C570      MTOD/TIMEZONE BUG.
      *02/25/04   AJK C574      POPULATE P921-ASGN-PARM WITH SCHEDULED
      *                         XB ASSIGNMENT, INSTEAD OF THE ASSIGNMENT
      *                         IT'S RELIEVING, WHEN APPLICABLE.
      *03/12/04   NRL  CNC0331F CALL 925 TO CALCULATE ACTUAL TIME.
      *04/05/04   AJK  CNC0331G MANDATORY REST/HOS ENH. - ADD CALLBACK
      *                         AND SETBACK LOGIC.
      *06/01/04   NRL  CNC0381  PROCESS TRAIN TYPE J LIKE TYPE R.
      *06/10/04   BFR  CNC0367C USE ON DUTY DATE/TIME FOR HIST EFF DATE/
      *                         TIME WHEN REJECTING AN EMP.
      *07/06/04   NRL  C591     SET P925 VACANCY FLAG IF THE EMPLOYEE
      *                         WAS PRESENTED VIA VACANCY FILL.
      *08/17/04   TRK  C519     ERROR WITH CREW PROFILE ASGN QUAL
      *10/04/04   KJS  CNC0386A ADD PERSONAL REST TIME/DAY TO REST
      *                         FUNCTION DISPLAY INFO
      *02/04/05   AJK           CORRECT DISPLAY BUG DEALING W/ PERS REST
      *04/21/05   AJK  CNC0386E RECOMPILE FOR COPYBOOK CHANGES.
      *06/03/05   AJK           SET P925-VACANCY-FILLED TO TRUE IN P2950
      *                         WHEN P08CA-DEC-KEY IS POPULATED, NOT
      *                         JUST WHEN P923-DEC-KEY IS POPULATED.
      *                         THIS WAS CAUSING 'REST' FUNCTION ISSUES
      *                         DUE TO THE LEAD TIME BEING IGNORED.
      *07/12/05   AJK  C626     HOS FIX FOR AFHT CREWS ON ID POOLS - IF
      *                         TRCN PROFILE INDICATES 'ALTERNATE CREW
      *                         SOURCE', AND TOPC ALSO INDICATES THAT
      *                         AN ALTERNATE STATION IS TO BE USED, LOOK
      *                         UP THE ALTERNATE POOL RECORD.  USE THE
      *                         NEW 'AWAY?' INDICATOR TO DETERMINE IF
      *                         THE EMPLOYEES ARE AT HOME OR NOT.
      *07/21/05   AJK           DO NOT FACTOR IN LEAD TIME FOR REGULAR
      *                         OWNERS OF GO-TRAINS (COMMUTERS)
      *08/04/05   AJK  C616     BIDPACK POOL TIE-BREAKER REWORK.
      *10/05/05   AJK  C634     CONSIDER THE 'HELP' FUNCTION AS A
      *                         VACANCY FILL FUNCTION FOR HOS CALC
      *                         PURPOSES (SET P925-VACANCY-FILL TO TRUE)
      *02/09/06   BLD  C632     CHECKING FOR 2ND SHIFT BEFORE SETTING
      *                         P925-ROUTE-DESGN.
      *02/17/06   AJK  C648     GO TRAIN LEAD TIME: CONSIDER AN EMPLOYEE
      *                         AS WORKING THEIR OWN ASSIGNMENT, FOR
      *                         LEAD TIME PROCESSING PURPOSES, AS LONG
      *                         AS HE'S BEING CALLED ON ANY CRAFT WITHIN
      *                         HIS ASSIGNMENT (I.E. EMP X OWNS THE AC
      *                         POSITION ON THE OGOC01, BUT IS BEING
      *                         CALLED ON THE CO POSITION FOR THAT SAME
      *                         JOB).
      *06/08/06   MET C661      LOST WORK TRACKING - JOBS WORKED BY
      *                         SCHEDULED SB TURNS.
      *06/24/06   BLD A354      ALWAYS SET TRACKING REASON TO 10-MISS
      *                         CALL WHEN EMPLOYEE IS IN LO STATUS "X".
      *08/09/06   BLD A341      ALWAYS SET TRACKING REASON TO 40-PERS
      *                         REST WHEN EMPLOYEE IS ON PERSONAL REST.
      *08/15/06   MET C662      GO TRAIN SPLIT SHIFTS AS ONE TOUR.
      *01/22/07   AJK A341      BACK OUT CHANGES - NO LONGER DESIRED.
      *01/23/07   JES C641      CHECK NEW HOME/AWAY FLAG (TRCN) FOR NON-
      *                         TOPC TRAINS TO POPULATE P925-TERM.
      *02/09/07   AJK C641      IF 'CALLBACK' IS REQUIRED, FIRST MAKE
      *                         SURE THE EMPLOYEE WILL BE "GREEN" FOR
      *                         THE CALL.  IF NOT, DON'T PROCEED WITH
      *                         CALLBACK PROCESSING.
      *05/01/07   AJK CNC0413   AFTER CALLING A UFP ASGN FROM THE AWAY
      *                         FROM HOME TERMINAL, RECALCULATE ANY
      *                         TRACKED EMPLOYEES' HOS REST STATUS,
      *                         BASED ON THE WORKING EMPLOYEE'S LEAD
      *                         TIME (SHORT OR REGULAR).
      *06/01/07   MET C718      US PERS VS. ON DUTY
      *06/01/07   MET C716      SHORT CALL VS REST.  REMOVE MASTER 3
      *                         LEAD TIME LOGIC.
      *06/19/07   RAL CNC0331E  IGNORE EMP-MTOD RESTRICTIONS FOR
      *                         YARDMASTERS WORKING YARDMASTER JOBS.
      *08/29/07   RAL CNC0331E  IMPOSED REST START AT > 6400
      *08/31/07   JLH CNC0331E  PASS ASGN TO P925
      *09/04/07   AJK CNC0331E  IF THE EMPLOYEE IS NOT 'GREEN' AND IS
      *                         INVOLVED IN A CALLBACK, DISPLAY 'CBCK'
      *                         IN THE FUNCTION COLUMN FIRST, THEN
      *                         SHOW 'HOUR' ONCE THE CALLBACK TASK HAS
      *                         BEEN WRITTEN.
      *09/18/07   AJK           FIXED ABEND THAT OCCURRED WHEN AN ON
      *                         DUTY EMPLOYEE ALREADY EXISTS FOR A
      *                         GO TRAIN AND WE ATTEMPT TO PRESENT THE
      *                         CREW UPON ENTRY TO THE CALL SCREEN.
      *10/16/07   AJK           CNC0331E ENH. INADVERTENTLY IMPACTED
      *                         DAILY SCHEDULE PROCESSING, BY REFRESHING
      *                         TRCN DATA & WIPING OUT THE DATA OF THE
      *                         ALTERNATE SCHEDULED POOL BEING PROCESSED
      *11/12/07   KAD  C749     CLEAR OUT P08CA-VCNY-AVLIST-FLAG SO IT
      *                         CAN BE SET CORRECTLY.
      *01/09/08   AJK CNC0426   MULTIPLE ALTERNATE BIDPACK POOLS.
      *02/05/08   AJK           COURTESY FIX: ALLOW 3RD CHARACTER OF
      *                         TYPE 4 TRAIN ID TO BE A '6'.
      *02/25/08   BLD  BUG      ALWAYS READ MASTER RECORD IN PARAGRAPH
      *                         P2950-GET-HRS-SVC-INFO.  CURRENTLY THE
      *                         DD/SD FROM THE PREVIOUS EMPLOYEE IS USED
      *                         TO ACCESS THE DD/SD RECORD ON THE CNTL
      *03/14/08   AJK  C774     IF THE CURRENT TV OWNER OF AN ASSIGNMENT
      *                         IS ALSO TV'D ONTO A SUBSEQUENT XB ASGN,
      *                         DON'T PRESENT THEM AS THE REGULAR OWNER
      *                         OF THE ASSIGNMENT.  PRESENT IT AS A
      *                         VACANCY
      *04/11/08   BLD  CNC0475  ACCEPT COMMENTS FROM TOPC.
      *05/15/08   AJK  C783     AFTER READING MASTER RECORD IN P2950,
      *                         WE NEED TO CONVERT THE EMPLOYEE'S MTOD,
      *                         US REST, AND PERS REST TO THE PROFILE'S
      *                         TIMEZONE.
      *12/23/08   JES  CNC0436B REMOVE PAGER-NO (ROOM-NO) - WILL BE
      *                         REPLACED WITH LVE TABLE SELECT.
      *01/20/09   AJK           COURTESY FIX: ALLOW '0' IN BYTE 3 OF
      *                         IC PASSENGER DEADHEAD TRAIN SYMBOL.
      *                         ALLOW '3' IN BYTE 3 OF IC FREIGHT DH
      *                         SYMBOL.
      *02/03/09   JES  CNC0436B REPLACE MSTR3-LEAD-TIME WITH TELE-REQ-
      *                         LEAD-TIME
      *04/14/09   AJK  CNC0482  REQUIRE DH REASON WHEN A DEADHEAD CREW
      *                         PROFILE IS USED.
      *04/30/09   RZP  CNC0484  CALL PS94 TO GET THE TOTAL HOS AND LIMBO
      *                         TIME
      *05/22/09   AJK  CNC0484  ADDED PS94-TIME-ZONE LOGIC
      *06/01/09   JES  CNC0436B ADD F11-COMMENTS PROCESSING
      *06/03/09   BLD  CNC0436B ADD IVR-CALL TO SERVICE PROCESSING
      *06/26/09   SXK  CNC0484  SHOW 'HOUR' IN THE FUNCTION FIELD WHEN
      *                         EMP EXCEEDS MONTHLY HOS OR LIMBO LIMITS
      *07/03/09   JES  CNC0436B CONTINUE MODS FOR IVR-CALL PROCESSING.
      *07/11/09   AJK  CNC0484  HR 2095 - US REST STATUS
      *07/13/09   JES  CNC0436B SHORT CALL DISPLAY.
      *07/27/09   RXS  CNC0484  PHASE II CHANGES.
      *09/08/09   JES  CNC0436E USE PAGER-NO FROM MSTR FOR DISPLAY.
      *09/21/09   JES  CNC0436B #779 ADD SHORT-CALL-FLAG PASS TO 0ES.
      *09/23/09   JES  CNC0436B ADD YARD-CALL FROM 04S LOGIC.
      *09/24/09   JES  CNC0436B COMMENT PS52-DISPLAY-ONLY
      *09/28/09   BLD  CNC0436B #801 PROCESS "CBCK" LOGIC ON YARD JOBS
      *09/30/09   RXS  CNC0484  INCLUDE SHORT LEAD FUNCTIONALITY FOR US
      *                         NEW FRA REPORTING. CHANGES IN P1015 PARA
      *09/29/09   JES  CNC0436B #779 CHANGE FLAG TO SHORT-CALL-REQ.
      *09/30/09   JES  CNC0436B #786 WHEN MISS CALL FOR IVR CALL, AUTO
      *                         PERFORM VACANCY FILL.
      *10/07/09   JES  CNC0436B #846 IVR-CALL ALLOWED WITH NOT-NOTIFIED
      *                         (LAYOFF-CODE-2 = '1')
      *10/14/09   JES  CNC0436B CODE FOR COMING FROM 03A AS ORDER-VX,
      *                         YARD, LOCAL, AND ROAD JOBS.
      *10/16/09   CXJ  CNC0484  POPULATE HST KEY WITH THE CURRENT ASGN.
      *10/19/09   JES  CNC0436B #892 ADDED P08CA-RESUB-FLAG AND SENT TO
      *                         CNP0ES THRU P0ESCOMM.
      *10/29/09   JES  CNC0436B RESYNC VRUINFO CREW ARRAY FOR YARD/LOCAL
      *                         WHEN COMMING FROM 03A ORDER VX.
      *11/02/09   BLD  CNC0436B #991 - DO NOT UPPROTECT CRAFT AFTER
      *                         REJECT OF VCLL EMPLOYEE
      *11/02/09   JES  CNC0436B #906 FULL-CREW-ACCPT NEW LOGIC.
      *11/03/09   BLD  CNC0436B #937 - INITIALIZE THE MISC MSGS IN THE
      *                         ORDER VX PROCESSING
      *11/03/09   JES  #957     CHANGE CALLBACK MSG WHEN BOTH QTIE AND
      *                         CBCK EXIST.
      *11/04/09   RXS  C841     POPULATE THE MASTER DIST/SUB DISTRICT
      *                         IF EMP IS TO-PLACE FOR HST KEY
      *11/09/09   JES  CNC0436B COMMENT EDIT FOR DUP EMPS ON SCREEN -
      *                         ASSURE VRUINFO WILL NOT RECORD DUPS.
      *11/15/09   BLD  CNC0436B #1016 - UPDATE THE CC ON THE CD TASK
      *                         WHEN SUBSEQUENT CC'S ARE CALLED ON A
      *                         TRAIN.
      *11/17/09   JES  CNC0436B FIX FOR SINGLE THREAD VCLL'S
      *11/18/09   BLD  CNC0436B #1033 - BUILD INITIAL DISPLAY FOR YARD
      *                         CALLS WHEN COMING FROM THE IVR TASK LIST
      *                         AND THE CD TASK LIST.
      *11/19/09   JES  CNC0436B WHEN BUILDING VRUINFO, ASSURE CRAFTS
      *                         ARE CODED FOR COMPLETE REQUIRED.
      *11/20/09   RXS  C844     RECHECK REST STATUS IF THE ONDUTY TIMES
      *                         ARE CHANGED FOR DECISION FILL EMPLOYEES
      *11/21/09   JES  CNC0436B STORE VRUINFO-KEY IN AHM3 FOR DELETE AT
      *                         TIEUP/CANCEL TIME.
      *12/03/09   JES  CNC0436B CHANGE SETTING OF VRUINFO REQ CRAFTS FOR
      *                         YARD/LOCALS.
      *12/04/09   JES  CNC0436B SENR FUNCTION WITH CBCK - NEED TO IGNORE
      *                         PREP TIME. ALSO NEED TO IGNORE PROCESING
      *                         LOWER SCREEN FUNC FOR SENR PASS.
      *12/17/09   JES  CNC0436B SET TASK TO "ORDER - VRU FINISHED" WHEN
      *                         VRU-CALL-UNSUCCESSFUL RESOLVED.
      *01/05/10   JES  C846     CHANGE READ OF TASK-VIA-STATION TO
      *                         BROWSE UNTIL SURE OF RECORD FOUND.
      *02/18/10   JES           #1142 DELETE TASK RECORD IN P5210 WHEN
      *                         ALL IVR (VRUINFO) CRAFTS ARE RESOLVED.
      *                         FIX 922-AJ-PARM MOVE CAUSING INCOMPLETE
      *                         IVR-CANCEL CLEANUP.
      *02/22/10   JES           WHEN CALL OR VACT FOR ORDER-VX CRAFT,
      *                         DO NOT ERASE VRUINFO EMP-NBR AND SET
      *                         CMA-CALL-SUCCESSFUL TO TRUE.
      *03/10/10   JES           DELETE TASK RECORD IN P5210 WHEN YARD OR
      *                         LOCAL CALL AND ALL CRAFTS HAVE NO IVR
      *                         FUNCTIONS.
      *03/11/10   JES           FIX SEARCH FOR EXTRA RELEIF ASSIGNMENTS
      *                         ON-DUTY EMPS (SEE P0240 - P8020)
      *03/12/10   AJK           COURTESY FIX: SET PS52-DISPLAY-ONLY TO
      *                         TRUE WHEN PROCESSING PHONE-FUNCTION.
      *                         CN WANTS TO SEE ALL AVAILABLE NUMBERS
      *                         FOR AN EMPLOYEE, NOT JUST HIS LODGING
      *                         NUMBER (FOR AWAY-FROM-HOME EMPLOYEES).
      *03/29/10   JES           #1205 SET P916-IVR-CMC-CALL IN P5210 SO
      *                         SCHEDULED POOLS DO NOT GET CYCLE POINTER
      *                         RESET.
      *03/30/10   JES           #1204 CHECK AJ-OPEN-DATE-TIME FOR SPACES
      *                         BEFORE DOING THE TIME-ZONE CONVERSION.
      *04/09/10   JES           #1207 DO NOT DELETE TASK RECORD FOR TOPC
      *                         TRAINS.
      *04/12/10   JES           #1246 FIX INCORRECT NAME2 OWNER UPON RE-
      *                         ENTRY INTO SCREEN.
      *03/31/10   JES  CNC0436I TAXI TIME ENHANCEMENT.
      *04/19/10   JES           #1254 FIX TOPC TASK-REC REBUILD WHEN
      *                         TRAIN ORDER DATE/TIME CHANGED.
      *04/21/10   JES  #938     CHANGE PROCESS TO 08C (PF11) FOR SAVING
      *                         SCREEN FOR RETURN FROM 08C.
      *04/22/10   JES  #1271    RESET TASK KEY TO PREVENT ABEND AFTER
      *                         MCNA
      *04/23/10   JES  #1277    COUNT NON-REQUIRED CRAFTS WHEN IN IVR-
      *                         UNSUCCESSFUL STATUS.
      *04/26/10   JES  #1283    TAXI TIME NO SHOW FIX WHEN COMING FROM
      *                         ORDER VX AND CRAFT HAS NOT BEEN CALLED.
      *04/27/10   JES  CNC0436H #1276 RESTORE HELP FUNCTION CODE.
      *04/30/10   JES  CNC0436H #1284 FOR REJT, SHOW NEXT TURN WHEN
      *                         ORDER VX PASS.
      *05/03/10   JES           LOCK ALL TAXI TIME ENTRY FIELDS.
      *05/05/10   RXS  CNC0496  US HOS ENHANCEMENT
      *05/14/10   JES           #1224 DO NOT CANCEL TRACKING UPON EXIT
      *                         WHEN IVR (SEE P8060).
      *05/19/10   BLD           UNLOCK ALL TAXI TIME ENTRY FIELDS.
      *05/20/10   JES           #1287 CHECK THE USE-PH-NBR-ON-FILE FLAG
      *                         WHEN BUILDING FULL-CREW MATRIX.
      *05/20/10   JES           #1294 SAVE DECISION KEY IN VRUINFO THEN
      *                         RESTORE COMMAREA DECISION KEY FROM
      *                         VRUINFO WHEN COMING FROM EXECUTE TASK.
      *05/20/10   JES           #1306 WHEN DEL AND ADD TASK DUE TO
      *                         CHANGE IN ORDER DATE/TIME, MOVE NEW TASK
      *                         KEY TO 08CA-TASK-KEY.
      *05/24/10   JES           #1298 POPULATE THE P08CCA-TASK-KEY WHEN
      *                         XFER TO P08C FOR PFKEY11.
      *06/01/10   JES  CNC0436M USE OF VCLL WILL NOT BE ALLOWED WHEN
      *                         EMPLOYEE UNDER UDR/MTOD.
      *06/07/10   JES  CNC0436L CHANGE SHORT CALL TO BE EARLIEST OF
      *                         TRAIN, ON-DUTY, OR TAXI TIME.
      *                         CHANGE CALLBACK TO BE SCHEDULED FROM
      *                         TRAIN, ON-DUTY, OR TAXI TIME.
      *06/09/10   AJK  CNC0436  #1310 - REFRESH VRUINFO-AHIST-KEY WHEN
      *                         TASK KEY HAS CHANGED DUE TO TOPC UPDATE.
      *06/11/10   JES  CNC0436  #1310 FIX TASK SYNC WHEN TOPC HAS VCLL'D
      *                         EMPS ALREADY DONE AND TASK DATE/TIME HAS
      *                         CHANGED.
      *06/14/10   JES  CNC0436  #1283 TAXI TIME NOT SHOWING ON NON-CALL
      *                         EMPS WHEN EXECUTING A TASK.
      *06/15/10   JES  CNC0436L NEED TO RE-EDIT/BUILD (P1040) WHEN
      *                         CHANGES MADE TO ONDUTY OR TAXI TIME.
      *06/21/10   JES  CNC0436K REDO REQUIRED CRAFTS BUILD. CALL P926
      *                         FOR CALL COMPLETE WHEN ONE/ALL VCLL FOR
      *                         SHORT CALL(S).
      *06/29/10   AJK           EMERGENCY FIX - INITIALIZE WS-REEDIT-FL
      *                         PRIOR TO PROCESSING EACH CRAFT (P2000),
      *                         NOT JUST AT THE BEGINNING OF THE PARA.
      *07/01/10   AJK  C870     EXPAND P08-TSQ-LGTH TO 5895 TO MATCH
      *                         NEW P08-TSQ-AREA LAYOUT.  WE HAD A
      *                         LENGTH MISMATCH THAT WAS CAUSING THE
      *                         HELP FUNCTION TO NOT WORK PROPERLY.
      *07/06/10   JES  C872     CORRECT ON-DUTY TIME EDIT NOT WORKING
      *07/06/10   JES  C873     CORRECT DOUBLE SUB OF DECISION DEADHEAD
      *                         TIMES.
      *07/09/10   JES  C871     FIX BKMAN NOT SHOWING ON POOL DAILY
      *                         SCHED.
      *07/12/10   JES  #1339    ALLOW ATNA, ATBU FOR IVR ORDER VX EMPS.
      *07/13/10   JES  #1311    CHECK FOR CRAFT BEING VCLLD OTHER THAN
      *                #1335    WHAT IS IN TOPC TASK CRAFT LIST - MAKE
      *                         REQUIRED CRAFT.
      *07/15/10   JES  #1347 1348 1349 1350
      *                         CODE FOR CHANGE IN DIST/SDIST AND/OR
      *                         CHANGE IN ORG STATION. BASICALLY, FROM
      *                         04X SCREEN.
      *08/15/10   JES  #1375    FIX ABEND WHEN BUILDING JSKEY1 ON ORDER
      *                         VX EXECUTION AND TRAIN HAS BEEN CANCELLD
      *                         PREVIOUSLY.
      *08/23/10   JES  #1377    FIX ORDER-VX EXECUTE AND MANUALLY CALL
      *                         PROBLEM FOR "MADEUP" ASSIGNMENTS.
      *09/02/10   JES #1372,#1380,#1383
      *                         ALL TOPC TASKS WILL WRITE A TOPC VRUINFO
      *                         UPON ENTRY AND DELETE ON EXIT; TO
      *                         PROTECT FROM TOPC UPDATES WHILE CALLING.
      *09/16/10   BLD  C882     WHEN FINDING JOB SCHEDULE KEY, COMPARE
      *                         THE JS EXP DATE AGAINST THE ORDER DATE
      *                         RATHER THAN THE LOCAL DATE TO DETERMINE
      *                         IF IT HAS EXPIRED.
      *09/22/10   JES  #1394    NEED TO POPULATE P08CA-ASGN-KEY WITH
      *                         P922-AJ-PARM WHEN CALL FUNC AND ORD-VX
      *                         AND AJ RECORD CREATED VIA MADEUP FUNC.
      *                #1424    WHEN VCLL EDIT ERROR DUE TO "NR" NOT-
      *                         RESTED, NEED TO UPDATE VRUINFO FLAGS
      *                         TO NOT "UNDER IVR CONTROL".
      *09/29/10   BLD  #1368    DISPLAY MSG WHEN IVR MASTER SWITCH OFF
      *09/29/10   JES  C878     ADD EDITS FOR ENTERED OD DATE/TIME BEING
      *                         WITHIN 12 HOURS OF THE ORDER DATE/TIME.
      *10/05/10   JES  #1440    WHEN TRYING CALL COMPLETE, IF ANY EMP
      *                         UNDER IVR-CONTROL, ITS OK TO CALL COMP
      *                         IF THEY ARE SHORT-CALLED.
      *10/20/10   JES  #1442    NEED TO SET REQUIRED CRAFTS EVERY TIME
      *                         VRUINFO IS UPDATED.
      *10/23/10   JES  #1411,#1460
      *                         UPON CHANGE IN TRCN, UPDATE THE NEW TRCN
      *                         INTO THE TASK RECORD RATHER THAN WRITING
      *                         A NEW TASK (SEE P5114).
      *10/26/10   JES  #1461,#1462,#1468
      *                         REEVALUATE DUPLICATE EMP LOGIC WITH
      *                         REGARDS TO VRUINFO REC AND FIX.
      *10/28/10   JES  #1466    ALLOW SPACE OUT OF TAXI TIME.
      *10/28/10   JES  #1469    STOP REJECTS OF VACANCIES WITH ERR MSG.
      *11/10/10   JES  #FIXES   VARIOUS FIXES - ERROR MSG AND PREVENT
      *                         VCLL WHEN NO PHONE # ON FILE.
      *                         REDO UPDATE OF TASK WHEN TRCN CHANGE.
      *                         DON'T OVERRIDE TASK ORDER-VX WITH
      *                         IVR-INIT.
      *11/12/10   JES  #        IF TOPC COMPLETE, THEN OPTION 1 FOR SAME
      *                         TRAIN TO ADD A CREW MEMBER, DO NOT ALLOW
      *                         VCLL.
      *11/16/10   JES  #1494    SET FLAG WHEN TASK CREATED DUE TO VCLL.
      *                         WHEN REJECT VCLL ORDER-VX (P5210) AND
      *                         NON-TOPC AND VRUINFO IS CLEAN AND TASK
      *                         CREATED DUE TO VCLL, DELETE THE TASK.
      *11/16/10   JES  #1495    READ TASK INTO BUFFER AFTER LINK TO 927.
      *11/19/10   JES  #1496    TAXI TIME NOW STORED IN EMPLOYEE/AHM
      *                         TIME ZONE, MAY NEED TO CONVERT FOR DSPLY
      *11/23/10   JES  #1498    DO NOT SPACE REQUIRED CRAFT IN THE VRU-
      *                         INFO REC WHEN REJECT VCLL (P5210).
      *11/24/10   JES  #1503    WHEN "HELP", PERFORM P1010 TO DETERMINE
      *                         "NR" (NOT-RESTED) IN STATUS DISPLAY.
      *11/24/10   JES  #1505    ADD P08CA COMMAREA FLAG FOR NO PHONE #.
      *11/30/10   JES  #1503    ADD P08CA COMMAREA FLAG FOR NOT-RESTED.
      *12/02/10   JES  #1490    SENT ON-DUTY DATE/TIME FOR CANCEL WHEN
      *                         REJECTING DUE TO AN ORDER-VX.
      *12/02/10   JES  #1513    MOVE SPACES TO P08CA-NOT-RESTED-FL WHEN
      *                         PRESENTING A NEW EMPLOYEE
      *12/03/10   JES  #1499    ADD CALL SHEET PRINT ROUTINE WHEN ALL
      *                         CREW ARE SHORT CALLED.
      *12/06/10   JES  #1503    FIX NOT RESTED EDIT FOR VCLL IN CONJUNC-
      *                         TION WITH SHORT CALL.
      *12/08/10   JES  #1311    EDIT FOR "CALL COMPLETED" WHILE STAYING
      *                         ON THE 08 SCREEN, THEN VCLL MORE CRAFTS.
      *12/08/10   JES  #1494    WHEN TASK CREATED DUE TO VCLL, SPACE THE
      *                         REQ CRAFT IN VRUINFO WHEN REJECT (P5210)
      *12/09/10   JES  #1510    ONLY DO SHORT LEAD/CALLS IF LAYOFF = A0.
      *12/29/10   JES           ALL TOPC TASKS WRITE A TOPC VRUINFO
      *                         UPON ENTRY AND DELETE ON EXIT;
      *                         ADDED "CALL COMPLETE" AS AN EXIT.
      *01/06/11   JES  #1510    CORRECTION TO ABOVE 1510 - DO NOT DO
      *                         SHORT LEAD/CALLS WHEN VACANCY.
      *01/24/11   JES  #1499    SAVE CBCK FLAG BEFORE/ RESTORE AFTER
      *                         CALL ROUTINE EXECUTED.
      *01/26/11   JES  #1529    ADD EMP-PERS-REST TO IVR/ SHORT CALL
      *                         EDITS.
      *02/07/11   JES           RE-WORKED 5169B-CHECK-CALL-COMPLETE.
      *02/14/11   JES  #1529S   RE-WORKED YARD-CALL WITH VCLL REST EDITS
      *                         AND WITH SHORT-CALL.
      *02/15/11   JES  #1526    AFTER CBCK FUNCTION, REDISPLAY TELEPHONE
      *                         INFO.
      *02/25/11   JES  C899     FIX ABEND WHEN ORDER-VX EXECUTION ON A
      *                         LOCAL JOB WITH A REJECT FUNCTION. NEED
      *                         TO ASSURE WE HAVE A GOOD JSKEY1.
      *03/10/11   JES  C899     WHEN LINK TO 927 TO BUILD NEW TASK FOR
      *                         IVR, ASSURE SET TO DELETE OLD TASK.
      *03/16/11   AXG  CNC0505  PASSED 2 NEW COMMAREA VARIABLES
      *                         P08CA-SAVE-CREW-RPT-LOCATION AND
      *                         P08CA-SAVE-ALLOW-VCLL-FL TO P915 AND
      *                         P921 PROGRAMS
      *03/22/11   AJK           FIX 'IGNORE LEAD TIME' ISSUE
      *03/23/11   JES           CHANGES TO VCLL EDIT+ (FIND ON 03/23/11)
      *04/18/11   JES           FIX TO NOT MOVE HOS VIOLATIONS TO NAMEB
      *                         LINE. SEARCH ON 04/18/11.
      *05/03/11   JES  C899     REVERSAL OF #1494 - NOW DO NOT SPACE THE
      *                         REQ CRAFT IN VRUINFO WHEN REJECT (P5210)
      *06/01/11   JES  C909     ASSURE WS-FUNCTION-CODE CONTAINS CURRENT
      *                         FUNCTION.
      *07/15/11   AXK  C916     FIX IS DONE FOR AJDEL DURING FILL
      *05/20/11   JES  CNC0509  MODIFY "PHON" FUNCTION.
      *05/24/11   XXX  C904     WHEN 'HOUR' IN FUNC IS OVERWRITTEN WITH
      *                         CALL/VCLL AND OD-DATE-TIME CHANGE, AFTER
      *                         REEDIT RESTORE THE CALL/VCLL FUNC.
      *07/14/11   AXK  CNC0507  EXPAND ROOM NBR TO 4 CHARACTERS.
      *12/27/11   AXK  C922     MADE THE FIX TO CREATE IVRINIT WITH
      *                         CORRECT CRAFTS
      *04/04/12   AXK  C922     MADE THE CORRECTION FOR TOPC TRAINS
      *04/12/12   AXK  C922     MADE THE FIX FOR CALL COMPLETE
      *04/26/12   AXK  C945     CORRECTED THE EMPLOYEE QUALIFICATION
      *                         DISPLAY ISSUE
      *06/15/12   BXS  C953   1.REST NOT CONVERTED IN TRAIN TZ SHOWING
      *                         U156 ERROR.
      *                       2.WHEN USING SHORT CALL ALLOW VCLL BEFORE
      *                         REST EXPIRY.
      *08/07/12   AXK  CNC0520  1.ADDED NEW PF6 KEY FOR ALTERNATE ROUTES
      *                         2.ADDED NEW ROUTE DSGN FIELD
      *                         3.ADDED TRANSFER TO NEW SCREEN FOR QUAL
      *                           FUNCTION
      *02/25/13   AXD C970      SYSTEM NOT CHECKING OD PAIR WHEN CALLING
      *                         SAME TRAIN SYMBOL FOR DIFFERENT OD PAIR
      *                         USING CREW FROM SAME POOL.
      *05/09/13   BXS C982      FIX FOR ABEND -811 FROM LVESEL01 ON
      *                         05/09/13
      *05/14/13   BXS C983      DELETE LVE RECORDS ONCE EMPLOYEE IS
      *                         CALLED ON JOB. THIS WILL BE HELPFUL TO
      *                         CLEAR HANGING LVE WHEN -
      *                         1. AFH EMPLOYEE IS HELPED AT HOME
      *                         2. TURN TRANSFERRED, MOVED
      *                         3. OR EMP BOKKED OFF AT AFH
      *                         USE HOMEAWAY COPYBOOK TO DETERMINE IF
      *                         EMP IS AT HOME/AWAY.
      *05/20/13   AXK  CNC0531  INCLUDED YARDMASTER CRAFT CODES TO
      *                         CONVERT TO THE MASTER CRAFT CODE.
      *01/22/14   BLD  C1009    REMOVE FUNCTION 'CSPR'
      *01/24/14   AXK  C1010    FIX FOR CALL SCREEN ABEND - FILE KEY =01
      *02/03/14   BLD  C947     US HOS REST ON CALL SCREEN
      *           BXS  C947-1   US HOS REST NOT POPULATED ON CALL SCREEN
      *                         FOR CON WITH 'EMPLOYEE NOT QUALIFIED'
      *                         ERROR, DUE TO EXPIRED QUALIFICATION.
      *02/26/14   BXS  C892     USE ALT POOL INFO WHEN CYCLE = SPACE FOR
      *                         ALTERNATE POOL ON POOL SETUP PSTS01E
      *03/07/14   BXS  CNC0544  USE EST-RUN-TM FROM ALT SOURCE SCREEN
      *                         WHEN ATL CREW SOURCE IS USED.
      *03/26/14   KXB  C1021    REJECT HISTORY FOR INTERDIVISIONAL POOL
      *                         NEED TO WRITTEN FOR ACTUAL EMP CALLED ON
      *                         JOB INSTEAD OF TEMP EMP (999999997).
      *03/31/14   KXB  C1020    WHEN TELE-REQ-LEAD-TIME IS PRESENT, ADD
      *                         IT WITH MTOD
      *04/07/14   KXB  C1022    DO NOT PRESENT THE OWNER OF THE
      *                         SCHEDULED XB IF HE IS TEMPORARILY
      *                         MOVED TO ANOTHER ASSIGNMENT.
      *05/02/14   BXS  C1023    FIX ABEND ON REJT FOR VACANT TURNS.
      *06/06/14   BXS  C1029    UPDATE NEW ALT INDEX ON TASK FILE (KEY5)
      *05/07/14   AXK  CNC0534  PASSED THE NEW CALLED FROM HOME VARIABLE
      *                         TO 915 AND 921 PROGRAMS
      *07/15/14   KXB  CNC0555  DO NOT INITIATE THE REPORT GENERATOR
      *                         CNP906 WHEN THE PRINTER STATUS ON THE
      *                         HOST MESSAGE ROUTING CONTROL IS SET TO
      *                         "ACTIVE" AND THE PRINTER ID IS INVALID.
      *08/19/14   AXK  C1047    FIXED THE ISSUE OF NOT FLAGGING EXPIRED
      *                         TERRITORIAL QUALIFICATION CODES
      *09/29/14   JES  CNC0499 1.WHEN MARRIED TURN PRIMARY IS PRESENTED
      *                         THRU FILL, PRESENT SUBORDINATE TURN.
      *                         WHEN MARRIED PRIMRY REJECTED, DITTO SUB.
      *                         SUBORDINATE MARRIED CANNOT BE CALLED IF
      *                         PRIMARY NOT CALLED FIRST.
      *                        2.ADDITIONAL EDIT - IF AWAY AND MARRIED,
      *                         BOTH PRIMARY AND OPTIONAL MUST BE CALLED
      *                         AT THE SAME TIME.
      *05/12/14   BXS  C1081    SET P08CA-ASGN-MU-XB WHEN TURN ID IS MU.
      *06/01/15   BXS  CNC0562  ALLOW ASSIGNMENT TO CROSS-SERVICE RELIEF
      *08/11/15   BXS  C1087    SHOW VACT WHEN RELIEVED BY SPAREBOARD
      *09/23/15   MFO  C1019    DO NOT DELETE MU TURN WHEN TURN IS AWAY.
      *09/29/15   MFO  CNC0572  ADDITIONAL SPCL QUALIFICATIONS
      *09/30/15   BLD  C1100    DO NOT DELETE TRACKING WHEN ON-DUTY
      *                         RECORD EXISTS.
      *04/26/16   RXB  CNC0499-5/6 ADD LOGIC TO REJECT AND PRESENT
      *                            CORRECT SUBORDIANTE MARRIED TURN.
      *05/09/16   MFO  CNC0499  WORKING...
      *07/26/16   MFO  CNC0533  RECOMPILE.
      *08/11/16   RXB  CNC0578  ADD LOGIC TO WRITE "NO" TYPE WORK HIST.
      *08/31/16   MFO  CNC0578-01  INCLUDE DECISION IN 'NO' RECORD
      *09/06/16   RXB  C1139    INITIALIZED EMP-LINE WHEN DH TIME EXIST
      *                         ON DECISION.
      *09/26/16   MFO  CNC0578  ABENDS WHEN YARD/LOCAL FIX
      *11/04/16   MFO  C1150    USE SCHEDULED START TIME FOR BIDPACK
      *                         POOL TIEBREAKER POSITIONING.
      *12/23/16   MFO  CNC0579  PASS REPORT STATION ON DECISION TABLE
      *                         TO IVR MESSAGING WHEN VACANCY FILLED
      *                         EMPLOYEE IS CALLED TO BE USED IN MSG#095
      *03/02/17   MFO  C1150.1  PASS ALT CREW SUPPLY FOR BDPK TIEBREAKER
      *03/22/17   MFO  C1150.2  MAINTAIN CREW SUPPLY AFTER ORDER-VX
      *05/02/17   MFO  C1160    ACTIVE TV NOT PRESENTED ON EXTENDED SB
      *06/27/17   MFO  C1166    CALLED TRAIN NOT DISPLAYED WHEN ALT CREW
      *07/11/17   MFO  C1167    USE JOB SCHEDULE WHEN DETERMINING WHAT
      *                         RELIEF ASGN IS RELIEVING, A BAD VIC REC
      *                         WAS BEING BUILT WHEN A YARD RELIEF ASGN
      *                         WAS RELIEVING A ROAD LOCAL.
      *07/27/17   MFO  C1170    WHEN ALTERANTE BIDPACK SCHEDULES ARE
      *                         USED AND A MADEUP TURN IS CREATED, APPLY
      *                         THE LAST ALTERNATE POOL (INSTEAD OF THAT
      *                         OFF THE CREW PROFILE).
      *08/18/17   MFO  C1170.1  FIX PROCESSING FOR BID VS NON-BIDPK
      *04/13/18   MFO  C1192    FIX TRACKING WHILE WORKING TV ISSUE
      *04/18/18   MFO  C1193    REMOVE 64/7 EDIT SETTING YELLOW STATUS
      *05/09/18   MFO  C1194    P2951-1 ABEND, CHECK JOB SCHEDULE EXISTS
      *05/15/18   MFO  C1195    PREFIX 'MU' TURN NON-TEMP BEING DELETED
      *06/05/18   MFO  C1196    DO NOT SUBTRACT SHORT CALL TIME IF IVR
      *                         HAS BEEN INITIATED AND ON-DUTY IS SET.
      *03/12/19   MFO  C1207    PASS LEAD TIME TO P925 FOR ALT CREW
      *04/01/19   MFO  C1150.3  HT INFO NOT STAMPING BIDPK PROT WINDOW
      *10/31/19   MFO  COURTESY NON-REQ'D CRAFT SET UNDER-VRU-CNTL WHEN
      *                         ALREADY SUCCESSFULLY CALLED.
      *01/31/20   MFO  C1210.2  IVR KICK BACK ISSUE - EMP ON ALT AHC
      *                         WHEN MIX CREW CALLED IS NOT BEING SHOWN
      *03/17/20   RKW  C1211    FIX USER ABEND WHEN STATUS IS "HOUR"
      *05/06/21   TWG  CNLD-71  FIX BLANK TRAIN SYMBOL IN CALL SCREEN
      *                         AFTER ANNULLING.
      *02/27/23   SXP  CNC0598  WRR PH-1: NO NEED OF MTOY AND MTOR
      *03/10/23   SXP  CNC0600  WRR PH-2: ADDED FUNC HOSO TO OVERRIDE
      *                         NEW HOS RULE.
      *04/10/23   RKW  CNC0600  ADD UNDISTURBED REST UNTIL MESSAGE
      *05/01/23   RKW  CNC0600  CNLD-208 REMOVE "HOUR" FUNCT WHEN WRR FL
      *05/05/23   DXC  CNLD-207 ADD EMP WILL RESET SHORLTY MSG AND
      *                         PROHIBIT CALL WHEN P925-LOCAL-LT-RESET.
      *05/12/23   SXP  CNLD-230 DISPLAY DIFFERENT ERROR MSG FOR 7DAY
      *                         EDITS IN P925
      *05/13/23   RJA  CNLD-230 ADD ERT CHECK AGAINST 60/192 CLOCK;
      *                         ADD MORE REASON FOR RED FLAGS&MESSAGES.
      *06/05/23   RJA  CNLD-251 PER NEW CAN WRR -
      *                         ALL EMPS MUST AVAIL MIN 2HR LEAD TIME
      *                         FROM MTOD TO ON-DUTY TIME
      *06/06/23   RJA  CNLD-244 RENAMED P925-ORDR-LT-RESET;
      *                      #3 EMPLOYEES SHOULD BE RESTED FOR ON-DUTY
      *                         TIME (PER EARLIER SPEC THEY NEEDED TO BE
      *                         RESTED FOR ORDER TIME)
      *06/08/23   RKW  CNLD-244 DISPLAY ON-DUTY TIME AS ORDER-TIME MINUS
      *                      #2 PREP TIME
      *06/12/23   RJA  CNLD-246 YARDMASTER TRAINEES ON YARDMASTER JOBS,
      *                         LIKE YARDMASTERS, ARE HOS EXEMPT.
      *06/20/23   DXC  CNLD-257 7/28 DAYS MESSAGE CHANGE
      *06/28/23   RJA  CNLD-259 E95 DUEBACK IS END OF MSTR3-SYSTEM-UD2,
      *                         BUT EMP CANNOT BE PUT ON-DUTY UNTIL
      *                         AFTER MSTR3-SYSTEM-RESET-BRK.
      *07/19/23   SXP  CNLD-265 COMPARE PERS REST WITH ORDER-LEAD TIME
      *07/19/23   SXP  CNLD-245 BLOCK CALL IF USHR > LOCAL TIME
      *07/26/23   RJA  CNLD-269 USING DECISION RULE FLAGS TO IDENTIFY
      *                         PROMOTED(BOOSTED) EMPLOYEE
      *08/01/23   RJA  CNLD-270 TURNS WILL BE PRESENTED BASED ON
      *                         ORDER TIME
      *11/01/23   RJA  CNLD-285 INITIALIZE WS-EMP-UNDST-REST-FLAG
      *               /CNLD-286            WS-REST-US-STATUS-FLAG
      *                                    WS-SAVE-UD-DTTM
      *06/27/23   RJA  CNLD-330 FIX 'ET VACANCY INTERFERES WITH CO CALL'
      *                         ISSUE. (FIXING CNLD-245 CHANGES)
      *08/16/24   RJA  CNLD-309 MTOY AND MTOR ARE OBSOLETE.
      ******************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER.  IBM-9370.
       OBJECT-COMPUTER.  IBM-9370.
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01  FILLER                          PIC X(009) VALUE 'PGM08 W/S'.
       01  NXT-PROGRAM                     PIC X(008) VALUE SPACES.
      *C1170B - BEG
      *01  P08-COMM-LGTH                   PIC S9(04) COMP VALUE +2400.
       01  P08-COMM-LGTH                   PIC S9(04) COMP VALUE +2500.
      *C1170B - END

       01  WS-SUBSCRIPTS.
           05  POS-SUB                     PIC S9(04) COMP VALUE +0.
           05  POS-CRAFT-SUB               PIC S9(04) COMP VALUE +0.
           05  WS-POS-MAX                  PIC S9(04) COMP VALUE +7.
           05  I                           PIC 9(002) VALUE ZEROS.
           05  J                           PIC 9(002) VALUE ZEROS.
           05  T                           PIC 9(002) VALUE ZEROS.
           05  SUBA                        PIC 9(002) VALUE ZEROS.
           05  SUBB                        PIC 9(002) VALUE ZEROS.
      *CNC0572 - BEG
           05  SUBC                        PIC 9(002) VALUE ZEROS.
      *CNC0572 - END
           05  SUB1                        PIC 9(002) VALUE ZEROS.
           05  SUB2                        PIC 9(002) VALUE ZEROS.
           05  SUB3                        PIC 9(001) VALUE ZEROS.
           05  SUB4                        PIC 9(001) VALUE ZEROS.
           05  SUB4-ALPHA REDEFINES SUB4   PIC X(001).
           05  FUNC-SUB                    PIC 9(002) VALUE ZEROS.
           05  ZSUB                        PIC 9(002) VALUE ZEROS.
           05  HOLD-FUNC-SUB               PIC 9(002) VALUE ZEROS.
           05  SAVE-FUNC-SUB               PIC 9(002) VALUE ZEROS.
           05  ARRAY-MAX                   PIC 9(002) VALUE 07.
           05  FUNC-ARRAY-MAX              PIC 9(002) VALUE 14.
           05  CRAFT-SUB                   PIC 9(002) VALUE ZEROS.
           05  REST-SUB                    PIC 9(002) VALUE ZEROS.
           05  SUBXB                       PIC 9(002) VALUE ZEROS.
           05  CRAFT-ARRAY-MAX             PIC 9(002) VALUE 10.
           05  SUBY                        PIC 9(002) VALUE ZEROS.
           05  SUBZ                        PIC 9(002) VALUE ZEROS.
           05  SAVE-SENR-SUB               PIC 9(002) VALUE ZEROS.
           05 ARRAY-SIZE                   PIC 99     VALUE 12.
      *CNC0520-BEG
           05  SUB5                        PIC 9(02)  VALUE ZEROS.
           05  SUB6                        PIC 9(02)  VALUE ZEROS.
           05  SUB7                        PIC 9(02)  VALUE ZEROS.
           05  QUAL                        PIC 9(02)  VALUE ZEROS.
      *CNC0520-END
      *C1150.1 - BEG
           05  SUB8                        PIC 9(001) VALUE ZEROS.
           05  SUB8-ALPHA REDEFINES SUB8   PIC X(001).
      *C1150.1 - END
      *C1170 - BEG
           05  SUB9                        PIC 9(002) VALUE ZEROS.
      *C1170 - END
      *C1150.3 - BEG
           05  SUB10                       PIC 9(001) VALUE ZEROS.
      *C1150.3 - END
      *CNLD-244#2
           05  JT                          PIC 9(2) VALUE ZERO.

       01  WS-SAVE-LOCAL-ERT.
           05  WS-LOCAL-ERT-SAVED-FL       PIC X(001) VALUE 'N'.
               88  WS-LOCAL-ERT-NOT-SAVED             VALUE 'N'.
               88  WS-LOCAL-ERT-SAVED                 VALUE 'Y'.
           05  WS-SAVE-LOCAL-ERT-HR-MN.
               10  WS-SAVE-LOCAL-ERT-HR    PIC 9(002) VALUE ZEROS.
               10  WS-SAVE-LOCAL-ERT-MN    PIC 9(002) VALUE ZEROS.

       01  WS-DATE-TIME.
           05  WS-DATE                     PIC X(008) VALUE SPACES.
           05  WS-TIME.
               10  WS-HRMN                 PIC X(005) VALUE SPACES.
               10  FILLER                  PIC X(003) VALUE SPACES.
           05  WS-HR-MN.
               10  WS-HR                   PIC 9(002) VALUE ZEROS.
               10  WS-MN                   PIC 9(002) VALUE ZEROS.
           05  WS-MIN1                     PIC 9(004) VALUE ZEROS.
           05  WS-MIN2                     PIC 9(004) VALUE ZEROS.
           05  WS-SCR08-ORDER-DATE         PIC X(006) VALUE SPACES.
           05  WS-SCR08-ORDER-TIME         PIC X(005) VALUE SPACES.
           05  WS-SAVE-CALL-DT             PIC X(010) VALUE SPACES.
           05  FILLER          PIC X(020) VALUE 'WS-PREF-TIME FOLLOWS'.
           05  WS-PREF-TIME.
               10  WS-PREF-START-EN-TIME   PIC X(004) VALUE SPACES.
               10  WS-PREF-END-EN-TIME     PIC X(004) VALUE SPACES.
               10  WS-PREF-START-TR-TIME   PIC X(004) VALUE SPACES.
               10  WS-PREF-END-TR-TIME     PIC X(004) VALUE SPACES.
           05  WS-TASK-DATE-TIME.
               10  WS-TASK-DATE            PIC X(006) VALUE SPACES.
               10  WS-TASK-TIME            PIC X(004) VALUE SPACES.

       01  WS-HIST-CLOCK-TIME.
           02  WS-HIST-CCYYMMDD-TIME.
               03  WS-HIST-CE             PIC 9(02)  VALUE ZEROS.
               03  WS-HIST-DATE.
                   04  WS-HIST-YY         PIC 9(02)  VALUE ZEROS.
                   04  WS-HIST-MM         PIC 9(02)  VALUE ZEROS.
                   04  WS-HIST-DD         PIC 9(02)  VALUE ZEROS.
               03  WS-HIST-TIME           PIC 9(04)  VALUE ZEROS.
               03  FILLER                 PIC 9(02)  VALUE ZEROS.
               03  WS-HIST-DATE-TIME-TIE  PIC 9(02)  VALUE ZEROS.
       01  FILLER REDEFINES WS-HIST-CLOCK-TIME.
           02  WS-HIST-DATE-CCYYMMDD      PIC X(08).
           02  WS-HIST-TIME-AREA          PIC X(08).
       01  FILLER REDEFINES WS-HIST-CLOCK-TIME.
           02  FILLER                     PIC X(02).
           02  WS-HIST-DATE-TIME          PIC X(14).

       01  PRESENT-TIME-X.
           02  PRESENT-DATE            PIC 9(6).
           02  PRESENT-TOD             PIC 9(8).

       01  WS-PERS-REST.
           02  WS-PERS-REST-TIME       PIC X(4) VALUE SPACES.
           02  FILLER                  PIC X(1) VALUE SPACES.
           02  WS-PERS-REST-DAY        PIC X(2) VALUE SPACES.

       01  WS-ORDER-DATE-TIME.
           02  WS-ORDER-DATE           PIC 9(6) VALUE ZEROES.
           02  WS-ORDER-TIME           PIC 9(4) VALUE ZEROES.

       01  WS-FLAGS.
           05  DAILY-MARK-YARD-CODE        PIC X(001) VALUE '0'.
               88  DAILY-MARK-YARD                    VALUE '1'.
           05  SCREEN-FLAG                 PIC X(001) VALUE '0'.
               88  CONTINUE-SCREEN                    VALUE '0'.
               88  CREATE-SCREEN                      VALUE '1'.
               88  SEND-BUFFER                        VALUE '2'.
           05  VALID-PRINT-CLASS           PIC X(001) VALUE '0'.
               88  VALID-CLASS                        VALUE '1'.
           05  PROFILE-FOUND-CODE          PIC X(001) VALUE '0'.
               88  PROFILE-FOUND                      VALUE '1', '2'.
               88  PROFILE-NOT-YARD-JOB               VALUE '2'.
           05  ASGN-FOUND-CODE             PIC X(001) VALUE '0'.
               88  ASGN-FOUND                         VALUE '1'.
           05  ERRORS-FOUND-CODE           PIC X(001) VALUE '0'.
               88  ERRORS-FOUND                       VALUE '1'.
           05  WS-XB-DONE-CODE             PIC X(001) VALUE ' '.
               88  XB-DONE                            VALUE 'Y'.
           05  WS-DONE-CODE                PIC X(001) VALUE '0'.
               88  DONE                               VALUE '1'.
           05  JOB-HIST-DONE-FLAG          PIC X(001) VALUE 'N'.
               88  JOB-HIST-NOT-DONE                  VALUE 'N'.
               88  JOB-HIST-DONE                      VALUE 'Y'.
           05  TASK-DONE-CODE              PIC X(001) VALUE 'N'.
               88  TASK-NOT-DONE                      VALUE 'N'.
               88  TASK-DONE                          VALUE 'Y'.
           05  WS-TURN-FOUND-CODE          PIC X(001) VALUE '0'.
               88  TURN-FOUND                         VALUE '1'.
               88  TURN-NOT-FOUND                     VALUE '0'.
           05  WS-SCHEDULE-DONE-CODE       PIC X(001) VALUE '0'.
               88  SCHEDULE-DONE                      VALUE '1'.
           05  SCHED-1ST-CODE              PIC 9(001) VALUE ZERO.
               88  ON-SCHED-1ST                       VALUE ZERO.
               88  NOT-ON-SCHED-1ST                   VALUE 1.
           05  WS-ALTERNATE-DONE-CODE      PIC X(001) VALUE '0'.
               88  ALTERNATE-DONE                     VALUE '1'.
           05  WS-ALTERNATE-USE-CODE       PIC X(001) VALUE SPACES.
               88  ALTERNATE-USE                      VALUE 'Y'.
           05  WS-BP-ALTERNATE-DONE-CODE   PIC X(001) VALUE '0'.
               88  BP-ALTERNATE-DONE                  VALUE '1'.
           05  WS-BP-ALTERNATE-USE-CODE    PIC X(001) VALUE SPACES.
               88  BP-ALTERNATE-USE                   VALUE 'Y'.
           05  WS-ASGN-DONE-CODE           PIC X(001) VALUE SPACES.
               88  ASGN-DONE                          VALUE 'Y'.
           05  TEMP-ASGN-XB-AUG-FLAG       PIC X(001) VALUE SPACES.
               88  TEMP-ASGN-XB-AUG              VALUE 'Y'.
           05  ON-DUTY-OUT-TOWN-CODE       PIC X(10) VALUE '9999999999'.
               88  OUT-TOWN                          VALUE '0000000000'.
           05  WS-ASSOCIATED-TURN-CODE     PIC X(001) VALUE SPACES.
               88  ASSOCIATED-TURN                    VALUE '1', '2'.
               88  ASSOCIATED-OPT-TURN                VALUE '2'.
               88  STUDENT-TURN                       VALUE '3'.
           05  EN-FI-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  EN-FI-MARRIED                      VALUE 'Y', '1'.
               88  EN-SE-MARRIED                      VALUE '1'.
           05  EN-ET-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  EN-ET-MARRIED                      VALUE 'Y'.
           05  CO-BK-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  CO-BK-MARRIED                      VALUE 'Y'.
           05  CO-B1-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  CO-B1-MARRIED                      VALUE 'Y'.
           05  CO-B2-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  CO-B2-MARRIED                      VALUE 'Y'.
           05  CO-BG-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  CO-BG-MARRIED                      VALUE 'Y'.
           05  CO-TT-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  CO-TT-MARRIED                      VALUE 'Y'.
           05  B1-B2-MARRIED-FLAG          PIC X(001) VALUE SPACES.
               88  B1-B2-MARRIED                      VALUE 'Y'.
           05  EN-ID-POOL-FLAG             PIC X(001) VALUE SPACES.
               88  EN-ID-POOL                         VALUE 'Y'.
           05  TR-ID-POOL-FLAG             PIC X(001) VALUE SPACES.
               88  TR-ID-POOL                         VALUE 'Y'.
           05  ON-REST-DAY-FLAG            PIC X(001) VALUE SPACES.
               88  IS-ON-REST-DAY                     VALUE 'Y'.
           05  WS-EMP-DISQUALIFIED         PIC X(001) VALUE SPACES.
               88  EMP-DISQUALIFIED                   VALUE 'Y'.
           05  WS-ASSOCIATED-DCAN-FLAG     PIC X(001) VALUE SPACES.
               88  ASSOCIATED-DCAN                    VALUE 'Y'.
           05  WS-XB-FOUND-FLAG            PIC X(001) VALUE SPACES.
               88  XB-FOUND                           VALUE 'Y'.
           05  WS-XB-DAY-FOUND-FLAG        PIC X(001) VALUE SPACES.
               88  XB-DAY-FOUND                       VALUE 'Y'.
           05  WS-XB-DAY-TIME-FOUND-FLAG   PIC X(001) VALUE SPACES.
               88  XB-DAY-TIME-FOUND                  VALUE 'Y'.
           05  WS-ALLOW-QUICK-TIE-FLAG     PIC X(001) VALUE SPACES.
               88  ALLOW-QUICK-TIEUP                  VALUES 'Y' 'B'.
           05  WS-SVC-OVERRIDE-FLAG        PIC X(001) VALUE 'N'.
               88  USE-SVC-OVERRIDE                   VALUE 'Y'.
               88  DONT-USE-SVC-OVERRIDE              VALUE 'N'.
           05  WS-SVC-OVERRIDE-CHECK-FLAG  PIC X(001) VALUE SPACES.
               88  SVC-OVERRIDE-CHECK                 VALUE 'Y'.
           05  POOL-SERVICE-FLAG           PIC X(001) VALUE SPACE.
               88  MINE-TURN-SVC                      VALUE 'M'.
           05  EN-UNDISTURBED-REST-FLAG    PIC X(001) VALUE SPACE.
               88  EN-GETS-UNDISTURBED-REST           VALUE 'Y'.
           05  TR-UNDISTURBED-REST-FLAG    PIC X(001) VALUE SPACE.
               88  TR-GETS-UNDISTURBED-REST           VALUE 'Y'.
           05  CALL-CHECK-FLAG             PIC X(001) VALUE SPACE.
               88  DETAIL-CALL-CHECK                  VALUE 'D'.
               88  SUMMARY-CALL-CHECK                 VALUE 'S'.
           05  BIDPACK-FOUND-FLAG          PIC X(001) VALUE SPACE.
               88  NOT-BIDPACK-FOUND                  VALUE ' '.
               88  BIDPACK-FOUND                      VALUE 'Y'.
           05  FIND-MC-CODE-FLAG           PIC X(001) VALUE 'Y'.
               88  FIND-MC-CODE                       VALUE 'Y'.
               88  DONT-FIND-MC-CODE                  VALUE 'N'.
           05  WS-WESTERN-DIVN-FLAG        PIC X(001) VALUE ' '.
               88  WS-WESTERN-DIVN                    VALUE 'Y'.
           05  WS-TIME-FLAG                PIC X(001) VALUE '0'.
               88  TIME-NOT-DONE                      VALUE '0'.
               88  TIME-DONE                          VALUE '1'.
           05  WS-SETBACK-CALL-FLAG        PIC X(001) VALUE ' '.
               88  WS-SETBACK-CALL                    VALUE 'Y'.
           05  ADD-TELE-LEAD-FLAG          PIC X(001) VALUE 'N'.
               88  DONT-ADD-TELE-LEAD                 VALUE 'N'.
               88  ADD-TELE-LEAD                      VALUE 'Y'.
           05  P08CA-CLEARED-FLAG          PIC X(001) VALUE 'N'.
               88  P08CA-NOT-CLEARED                  VALUE 'N'.
               88  P08CA-CLEARED                      VALUE 'Y'.
           05  WS-SAVE-ALT-EN-AWAY-FL      PIC X(001) VALUE SPACES.
               88  WS-SAVE-ALT-EN-AWAY-FND            VALUE 'Y' 'N'.
               88  WS-SAVE-ALT-EN-AWAY-YES            VALUE 'Y'.
               88  WS-SAVE-ALT-EN-AWAY-NO             VALUE 'N'.
           05  WS-SAVE-ALT-TR-AWAY-FL      PIC X(001) VALUE SPACES.
               88  WS-SAVE-ALT-TR-AWAY-FND            VALUE 'Y' 'N'.
               88  WS-SAVE-ALT-TR-AWAY-YES            VALUE 'Y'.
               88  WS-SAVE-ALT-TR-AWAY-NO             VALUE 'N'.
           05  WS-LEAD-TIME-FLAG           PIC X(001) VALUE 'Y'.
               88  WS-INCLUDE-LEAD-TIME               VALUE 'Y'.
               88  WS-IGNORE-LEAD-TIME                VALUE 'N'.
           05  SCHED-DONE-CODE             PIC 9(001) VALUE ZEROS.
               88  SCHED-DONE                         VALUE 1.
           05  SCHED-2ND-CODE              PIC 9(001) VALUE ZEROS.
               88  SCHED-2ND                          VALUE 1.
           05  SCHED-LST-CODE              PIC 9(001) VALUE ZEROS.
               88  SCHED-LST                          VALUE 1.
           05  SCHED-FOUND-CODE            PIC 9(001) VALUE ZEROS.
               88  SCHED-FOUND                        VALUE 1.
           05  HOS-PROCESSED-FLAG          PIC X(001) VALUE 'N'.
               88  HOS-NOT-PROCESSED                  VALUE 'N'.
               88  HOS-PROCESSED                      VALUE 'Y'.
           05  WS-ETRK-DONE-FLAG           PIC X(001) VALUE 'N'.
               88  ETRK-NOT-DONE                      VALUE 'N'.
               88  ETRK-DONE                          VALUE 'Y'.
           05  CALC-TRK-HOS-FLAG           PIC X(001) VALUE 'N'.
               88  CALC-TRK-HOS-NO                    VALUE 'N'.
               88  CALC-TRK-HOS                       VALUE 'Y'.
           05  YARDMASTER-EMP-CODE         PIC 9(001) VALUE ZEROS.
               88  NON-YARDMASTER-EMP                 VALUE ZERO.
               88  YARDMASTER-EMP                     VALUE 1.
           05  WS-US-DOM-FLAG              PIC X(001) VALUE SPACES.
               88  WS-US-DOM-YES                      VALUE 'Y'.
           05  WS-HS-US-ACTIVATE-FL        PIC X(001) VALUE SPACES.
               88 WS-HS-US-ACTIVATE                   VALUE 'Y'.
           05  WS-PRE-CALL-WITH-TOC-FL     PIC X(001) VALUE SPACES.
               88 WS-PRE-CALL-WITH-TOC                VALUE 'Y'.
           05  WS-IVR-CANCEL-ALLOWED-FL    PIC X(001) VALUE SPACE.
               88  WS-IVR-CANCEL-ALLOWED              VALUE 'Y'.
               88  WS-IVR-CANCEL-NOT-ALLOWED          VALUE ' '.
           05  WS-PAGER-GRACE-FL           PIC X(001) VALUE SPACES.
               88 WS-PAGER-GRACE                      VALUE 'Y'.
           05  WS-GOT-A-FUNC-FL            PIC X(001) VALUE SPACES.
               88 WS-GOT-A-FUNC                       VALUE 'Y'.
           05  WS-FULL-CREW-MQ-FL          PIC X(001) VALUE SPACES.
               88 WS-FULL-CREW-NOT-MQ                 VALUE 'Y'.
           05  WS-VRUINFO-DUP-FL           PIC X(001) VALUE SPACES.
               88 WS-VRUINFO-DUP                      VALUE 'Y'.
           05  WS-BYPASS-PREP-FLAG         PIC X(001) VALUE SPACES.
               88  WS-BYPASS-PREP                     VALUE 'Y'.
           05  WS-TASK-FOUND-FLAG          PIC X(001) VALUE SPACES.
               88  WS-TASK-FOUND                      VALUE 'Y'.
           05  WS-VRUINFO-FOUND-FLAG       PIC X(001) VALUE SPACES.
               88  WS-VRUINFO-FOUND                   VALUE 'Y'.
           05  WS-FROM-PARA-P0215-FLAG     PIC X(001) VALUE SPACES.
               88  FROM-PARA-P0215                    VALUE 'Y'.
           05  WS-REEDIT-FLAG              PIC X(001) VALUE SPACES.
               88  WS-REEDIT-YES                      VALUE 'Y'.
           05  WS-P0220-OVERRIDE-FLAG      PIC X(001) VALUE SPACES.
               88  WS-P0220-OVERRIDE                  VALUE 'Y'.
           05  TOPC-CALL-IN-PROCESS-FL     PIC X(001) VALUE SPACES.
               88  TOPC-CALL-IN-PROCESS               VALUE 'Y'.
           05  WS-VRUINFO-DELETE-FL        PIC X(001) VALUE SPACE.
               88  WS-VRUINFO-DELETE-OK               VALUE 'Y'.
               88  WS-VRUINFO-DELETE-NOT              VALUE 'N'.
           05  WS-AHM-DONE-FLAG            PIC X(01)  VALUE SPACES.
               88  WS-AHM-DONE                        VALUE 'Y'.
           05  WS-CROSS-SERVICE-FL         PIC X(001) VALUE SPACES.
               88 CROSS-SERVICE                       VALUE 'Y'.
               88 NOT-CROSS-SERVICE                   VALUE 'N'.
           05  WS-IF-SAME-TRAIN-CALLED     PIC X(001) VALUE SPACE.
               88  SAME-TRAIN                         VALUE 'Y'.
               88  SAME-TRAIN-NOT-CALLED              VALUE 'N'.
           05  WS-QUAL-FLAG                PIC X(001) VALUE SPACE.
               88  QUAL-MSG-YES                       VALUE 'Y'.
               88  QUAL-MSG-NO                        VALUE 'N'.
           05  DONE-CODE1                  PIC X(001) VALUE 'N'.
               88  DONE1                              VALUE 'Y'.
               88  NOT-DONE1                          VALUE 'N'.
           05  WS-CALL-FLAG                PIC X(001) VALUE SPACE.
               88  WS-CALL-YES                        VALUE 'Y'.
               88  WS-CALL-NO                         VALUE 'N'.
           05  WS-EMP-CALLED-FLAG          PIC X(001) VALUE SPACE.
               88  EMP-CALLED                         VALUE 'Y'.
               88  EMP-NOT-CALLED                     VALUE 'N'.
           05  WS-MU-DONE-CODE             PIC X(001) VALUE '0'.
               88 MU-NOT-DONE                         VALUE '0'.
               88 MU-DONE                             VALUE '1'.
           05  EMP-STATUS-FLAG             PIC X(001) VALUE '0'.
               88 EMP-STATUS-UNAVAIL                  VALUE '1'.
           05  WS-ASSOC-MU-TURN-FL         PIC X(001) VALUE SPACE.
               88  WS-ASSOC-MU-TURN-FOUND             VALUE 'Y'.
      *CNLD-330-B COMMENTING
      **CNLD-245-B
      *     05  WS-SHOW-JOB-FL              PIC X(001) VALUE SPACE.
      *         88  WS-SHOW-JOB                        VALUE 'Y'.
      **CNLD-245-E
      *CNLD-330-E

      *07/26/23 RJA B CNC0600 CNLD-269
           05  WS-CHECK-LOCAL-TM-FL        PIC X(001) VALUE SPACE.
               88  CHECK-LOCAL-TM                     VALUE 'Y'.
               88  DONT-CHECK-LOCAL-TM                VALUE SPACE.
      *07/26/23 RJA E

      *C1210.2 - BEG
           05  WS-AH2-DONE-CODE            PIC X(001) VALUE '0'.
               88  AH2-DONE                           VALUE '1'.
      *C1210.2 - END
      *CNC0598-B
           05  WS-CAN-WRR-FLAG             PIC X(001) VALUE ' '.
               88  WS-CAN-WRR-NEW                     VALUE 'N'.
      *CNC0598-E
      *CNC0598-NXA-B
           05  WS-EMP-UNDST-REST-FLAG      PIC X(001) VALUE 'N'.
               88  WS-EMP-UNDST-REST                  VALUE 'Y'.
           05  WS-MSTR3-FOUND-FLAG         PIC X(001) VALUE 'N'.
               88  WS-MSTR3-REC-FOUND                 VALUE 'Y'.
               88  WS-MSTR3-NOT-FOUND                 VALUE 'N'.
      *CNC0598-NXA-E
      *CNLD-230-B

           05  WS-REASON-FOR-RED           PIC X(001) VALUE ' '.
      *CNLD-259 B CNC0600
               88  WS-RFR-LEAD-IN-SYS-UD              VALUE 'U'.
               88  WS-RFR-OD-IN-SYS-RB                VALUE 'S'.
      *CNLD-259 E
               88  WS-RFR-7DAY-RND-ERT                VALUE 'R'.
               88  WS-RFR-7DAY-ERT                    VALUE 'E'.
               88  WS-RFR-7DAY-HRS                    VALUE 'H'.
      *CNLD-257-DXC-B
               88  WS-RFR-60-ERT                      VALUE 'L'.
               88  WS-RFR-192-ERT                     VALUE 'N'.
               88  WS-RFR-60-HRS                      VALUE '6'.
               88  WS-RFR-192-HRS                     VALUE '7'.
      *CNLD-257-DXC-E
               88  WS-RFR-MTOD                        VALUE 'M'.
      *CNLD-265-B
               88  WS-RFR-PERS                        VALUE 'P'.
      *CNLD-265-E
      *CNLD-230-E
      *

       01  WS-DATA-ARRAY.
           05 WS-DATA-CURRENT OCCURS 100 TIMES.
              10 WS-TASK-KEY.
                20 WS-LINE-SEG             PIC X(08) VALUE SPACES.
                20 WS-QUAL-CODE            PIC X(04) VALUE SPACES.
                20 WS-LSD-TRIPS            PIC 9(02) VALUE ZEROES.
                20 WS-LSD-INIT-DAYS        PIC X(04) VALUE SPACES.
                20 WS-EXP-TS               PIC X(26) VALUE SPACES.
       01  WK-LINE-SEG-ARRAY.
           05 WK-LINE-SEG-O   OCCURS 100 TIMES.
              10 WK-LINE-SEG               PIC X(08) VALUE SPACES.
              10 WK-EXP-TS                 PIC X(26) VALUE SPACES.
      *CNC0520-END

       01  WS-FROM-IVR-ABEND-AREA.
           05  WS-FROM-IVR-ABEND-FLAG      PIC X(001).
               88  WS-FROM-IVR-CALL                   VALUE 'C'.
               88  WS-FROM-IVR                        VALUE 'C'.
               88  WS-IVR-ABEND                       VALUE 'A'.
               88  WS-IVR-OUTAGE                      VALUE 'O'.
           05  WS-FROM-IVR-INFO            PIC X(010).
           05  WS-FROM-P2200-FLAG          PIC X(001).
               88  WS-FROM-P2200                      VALUE 'Y'.
           05  WS-NOT-NORMAL-FLAG          PIC X(001) VALUE SPACE.
               88  NOT-NORMAL                         VALUE 'Y'.

       01  WS-MISC.
           05  WS-CRAFT-BEFORE-WILD        PIC X(002) VALUE SPACES.
           05  WS-EMPLOYEE-ZONE            PIC X(001) VALUE SPACES.
           05  WS-HOLD-SENR-ASGN           PIC X(013) VALUE SPACES.
           05  WS-DCAN-FROM-TURNKEY        PIC X(012) VALUE SPACES.
           05  WS-DCAN-TO-TURNKEY          PIC X(012) VALUE SPACES.
           05  WS-JS-CRAFT                 PIC X(002) VALUE SPACES.
           05  ASGN-OWNER                  PIC X(009) VALUE SPACES.
               88  HAVE-ASGN-OWNER                    VALUE '000000001'
                                                       THRU '999999995'.
           05  ASGN-TEMPORARY-EMP          PIC X(009) VALUE SPACES.
               88  HAVE-ASGN-TEMPORARY-EMP            VALUE '000000001'
                                                       THRU '999999995'.
           05  ASGN-ON-DUTY-EMP            PIC X(009) VALUE SPACES.
               88  HAVE-ASGN-ON-DUTY-EMP              VALUE '000000001'
                                                       THRU '999999995'.
           05  HAVE-XB-EMP-FLAG            PIC X(001) VALUE SPACES.
               88  HAVE-XB-EMP                        VALUE 'Y'.
           05  WS-ANNUL-FROM-DATE          PIC X(006) VALUE SPACES.
           05  WS-ANNUL-TO-DATE            PIC X(006) VALUE SPACES.
           05  WS-OPEN-MSGS.
               10  WS-OPEN-MSG     OCCURS 2 PIC X(025).
           05  WS-DISCONT-MSGS.
               10  WS-DISCONT-MSG  OCCURS 2 PIC X(025).
           05  WS-VACANCY-MSGS.
               10  WS-VACANCY-MSG  OCCURS 2 PIC X(025).
           05  WS-VACANT-MSGS.
               10  WS-VACANT-MSG   OCCURS 2 PIC X(025).
           05  WS-ANNULLED-MSGS.
               10  WS-ANNULLED-MSG OCCURS 2 PIC X(025).
           05  WS-OFF-MSGS.
               10  WS-OFF-MSG      OCCURS 2 PIC X(025).
           05  WS-XTRA-MSGS.
               10  WS-XTRA-MSG     OCCURS 2 PIC X(025).
           05  WS-NO-MORE-MSGS.
               10  WS-NO-MORE-MSG  OCCURS 2 PIC X(025).
           05  WS-NO-AVL-MSGS.
               10  WS-NO-AVL-MSG   OCCURS 2 PIC X(025).
           05  WS-END-FILE-MSGS.
               10  WS-END-FILE-MSG OCCURS 2 PIC X(025).
           05  WS-NOT-EFFECTIVE-MSG-V.
               10  FILLER PIC X(25) VALUE 'ASGN IS NOT IN EFFECT'.
               10  FILLER PIC X(25) VALUE 'AFF N''EST PAS EN VIGUEUR'.
           05  FILLER REDEFINES WS-NOT-EFFECTIVE-MSG-V OCCURS 2 TIMES.
               10  WS-NOT-EFFECTIVE-MSG    PIC X(025).
           05  WS-STARTS-DISQUALIFY        PIC 9(002) VALUE 04.
           05  WS-STARTS-TOTAL             PIC 9(003) VALUE ZEROS.
           05  WS-TRCN-FILE-HOLD           PIC X(256) VALUE SPACES.
           05  WS-CNTL-FILE-HOLD           PIC X(256) VALUE SPACES.
           05  WS-CNTL-FILE-HOLD-2A        PIC X(256) VALUE SPACES.
           05  WS-AJ-FLAG                  PIC X      VALUE 'Y'.
               88  WS-AJ-EFFECTIVE                    VALUE 'Y'.
               88  WS-AJ-NOT-EFFECTIVE                VALUE 'N'.
           05  DEFAULT-EN-LEAD-TIME        PIC X(4)   VALUE ZEROES.
           05  DEFAULT-TR-LEAD-TIME        PIC X(4)   VALUE ZEROES.
           05  HOLD-INIT-REASON            PIC X(2)   VALUE SPACES.
           05  WS-HOLD-CC                  PIC X(2)   VALUE SPACES.
           05  WK-TRCN-EN-FNL-STN          PIC X(5)   VALUE SPACES.
           05  WK-TRCN-TR-FNL-STN          PIC X(5)   VALUE SPACES.
           05  WK-COMPANY-CODE             PIC X(1)   VALUE SPACES.
           05  WORK-TIME.
               10  WORK-HR                 PIC  9(002) VALUE ZEROS.
                   88 VALID-HR                         VALUE 0 THRU 23.
               10  WORK-MN                 PIC  9(002) VALUE ZEROS.
                   88 VALID-MN                         VALUE 0 THRU 59.
           05  WS-PREP-TIME                PIC  9(004) VALUE ZEROS.
           05  WS-EARLIEST-CENT-DATE-TIME.
               10  WS-EARLIEST-CENT        PIC  X(002) VALUE SPACES.
               10  WS-EARLIEST-DATE        PIC  X(006) VALUE SPACES.
               10  WS-EARLIEST-TIME        PIC  X(004) VALUE SPACES.
           05  WS-EARLI-US-CENT-DATE-TIME.
               10  WS-EARLI-US-CENT        PIC  X(002) VALUE SPACES.
               10  WS-EARLI-US-DATE        PIC  X(006) VALUE SPACES.
               10  WS-EARLI-US-TIME        PIC  X(004) VALUE SPACES.
           05  WS-EMP-OD-CENT-DATE-TIME.
               10  WS-EMP-OD-CENT          PIC  X(002) VALUE SPACES.
               10  WS-EMP-OD-DATE          PIC  X(006) VALUE SPACES.
               10  WS-EMP-OD-TIME          PIC  X(004) VALUE SPACES.
           05  WS-TOTAL-HOURS-X.
               10  WS-TOTAL-HOURS          PIC 9(05)   VALUE ZEROES.
           05  WS-TOTAL-MINUTES-X.
               10  WS-TOTAL-MINUTES        PIC 9(03)   VALUE ZEROES.
           05  WS-64-TOT-TIME-ON-DUTY      PIC 9(007)  VALUE ZEROES.
           05  FILLER REDEFINES WS-64-TOT-TIME-ON-DUTY.
               10  WS-64-TOT-HRS-ON-DUTY   PIC 9(005).
               10  WS-64-TOT-MNS-ON-DUTY   PIC 9(002).
           05  WS-DATE-GREG                PIC X(006)  VALUE SPACES.
           05  HOLD-XB-SCHEDULED-FL        PIC X(001)  VALUE SPACES.
               88  HOLD-XB-EXTENDED-SCHED              VALUE 'E'.
           05  WS-ADJUSTED-DATE-TIME.
               10  WS-ADJUSTED-CC          PIC X(002) VALUE SPACES.
               10  WS-ADJUSTED-DATE        PIC X(006) VALUE SPACES.
               10  WS-ADJUSTED-TIME.
                   15  WS-ADJUSTED-HR      PIC X(002) VALUE SPACES.
                   15  WS-ADJUSTED-MN      PIC X(002) VALUE SPACES.
           05  WS-WK-TAXI-DATE-TIME.
               10  WS-WK-TAXI-CC           PIC X(002) VALUE SPACES.
               10  WS-WK-TAXI-DATE         PIC X(006) VALUE SPACES.
               10  WS-WK-TAXI-TIME.
                   15  WS-WK-TAXI-HR       PIC X(002) VALUE SPACES.
                   15  WS-WK-TAXI-MN       PIC X(002) VALUE SPACES.
           05  WS-SHORT-CALL-DATE-TIME.
               10  WS-SHORT-CALL-CC        PIC X(002) VALUE SPACES.
               10  WS-SHORT-CALL-DATE      PIC X(006) VALUE SPACES.
               10  WS-SHORT-CALL-TIME.
                   15  WS-SHORT-CALL-HR    PIC X(002) VALUE SPACES.
                   15  WS-SHORT-CALL-MN    PIC X(002) VALUE SPACES.
           05  WS-CALL-INFO.
               10  WS-CALL-INFO-ASGN       PIC X(010) VALUE SPACES.
               10  WS-CALL-INFO-CC         PIC X(002) VALUE SPACES.
               10  FILLER                  PIC X(018) VALUE SPACES.
           05  WS-SETBACK-CC               PIC X(002) VALUE SPACES.
           05  WS-LEAD-MSG                 PIC X(005) VALUE 'LEAD='.
           05  WS-NEW-LEAD-TIME            PIC X(004) VALUE SPACES.
           05  WS-LEAD-TIME-WAS            PIC X(004) VALUE SPACES.
           05  WS-LEAD-TIME-IS             PIC X(004) VALUE SPACES.
           05  CREW-FROM-TERM              PIC X(001) VALUE SPACES.
           05  HOLD-LEAD-TIME              PIC X(004) VALUE SPACES.
           05  WS-OLD-NAME-COL             PIC X(001) VALUE SPACES.
           05  WS-ERR-CD                   PIC X(001) VALUE SPACES.
           05  WS-FORMAT-TYPE              PIC X(001) VALUE SPACES.
               88  WS-DH-FORMAT                       VALUE '3' '4' '5'.
           05  WS-TELEPHONE-NBRS.
               10  WS-TELEPHONE-ENTRY OCCURS 3.
                   15  WS-TELEPHONE-NBR.
                       20  WS-TELEPHONE-AREA     PIC X(3).
                       20  FILLER                PIC X.
                       20  WS-TELEPHONE-PREFIX   PIC X(3).
                       20  FILLER                PIC X.
                       20  WS-TELEPHONE-SUFFIX   PIC X(4).
                       20  FILLER                PIC X.
                   15  WS-TELEPHONE-CODE-AREA.
                       20  WS-TELEPHONE-CODE     PIC X(01).
                       20  FILLER                PIC X.
                   15  WS-TELEPHONE-COMMENT-AREA.
                       20  WS-TELEPHONE-COMMENTS PIC X(10).
                       20  FILLER                PIC X.
               10  WS-TELEPHONE-FILLER           PIC X(01).
           05  WS-TELEPHONE-NBRS2.
               10  WS-TELEPHONE-ENTRY2 OCCURS 3.
                   15  WS-TELEPHONE-NBR2.
                       20  WS-TELEPHONE-AREA2    PIC X(3).
                       20  WS-TELEPHONE-PREFIX2  PIC X(3).
                       20  WS-TELEPHONE-SUFFIX2  PIC X(4).
                       20  FILLER                PIC X.
                   15  WS-TELEPHONE-CODE-AREA2.
                       20  WS-TELEPHONE-CODE2    PIC X(01).
                       20  FILLER                PIC X.
                   15  WS-TELEPHONE-COMMENT-AREA2.
                       20  WS-TELEPHONE-COMMENTS2 PIC X(07).
                       20  FILLER                PIC X.
               10  WS-TELEPHONE-FILLER2          PIC X(01).
           05  WS-IVR-CALL-PROF-EN               PIC X(08).
           05  WS-IVR-CALL-PROF-TR               PIC X(08).
           05  WS-POOL-STATION                   PIC X(05).
           05  WS-AFHT-FAC-CODE            PIC X(03) VALUE SPACES.
           05  WS-AFHT-FAC-NAME            PIC X(25) VALUE SPACES.
           05  WS-AFHT-FAC-PHONE           PIC X(12) VALUE SPACES.
      *CNC0507
      *    05  WS-AFHT-ROOM-NBR            PIC X(03) VALUE SPACES.
           05  WS-AFHT-ROOM-NBR            PIC X(04) VALUE SPACES.
           05  WS-SAVE-FUNC                PIC X(004) VALUE SPACES.
           05  WS-MISC-LIMBO-TM.
               10 WS-LIMBO-TM1             PIC X(1) VALUE SPACES.
               10 WS-LIMBO-TM2             PIC X(5) VALUE SPACES.
           05  WS-MISC-TOT-TM.
               10 WS-TOT-TM1               PIC X(1) VALUE SPACES.
               10 WS-TOT-TM2               PIC X(5) VALUE SPACES.
           05  WS-MISC-CONSEC-STARTS.
               10 WS-CONSEC-STARTS         PIC X(2) VALUE SPACES.
           05  WS-SHORT-CALL-REQ           PIC X(004) VALUE SPACES.
           05  WS-SHORT-FLAG               PIC X(001) VALUE SPACES.
               88  WS-SHORT-LEAD                      VALUE 'L'.
               88  WS-SHORT-CALL                      VALUE 'C'.
           05  WS-SAVE-FCLTY-CD            PIC X(003) VALUE SPACES.
           05  WS-FCLTY-VAL                PIC 9(002) VALUE ZEROES.
           05  WS-FCLTY-VAL-GP REDEFINES
               WS-FCLTY-VAL.
               10 FILLER                   PIC X(1).
               10 WS-FCLTY-VAL-X           PIC X(1).
           05  WS-FCLTY-CD-TBL OCCURS 7 TIMES.
               10  WS-FCLTY-CD             PIC X(3) VALUE SPACES.
           05  WS-FULL-CREW-VAL-TABLE.
               10  WS-FULL-CREW-VAL-TAB OCCURS 7 TIMES.
                   15  WS-FULL-CREW-VAL-TBL    PIC X(1) VALUE SPACES.
                   15  WS-FULL-CREW-VAL-MQ     PIC X(1) VALUE SPACES.
           05  WS-HIGHEST-GRP.
               10  WS-HIGHEST-GRP-NUM      PIC 9(1) VALUE ZEROES.
           05  CNT-UNDER-VRU-CONTROL       PIC 9(1) VALUE ZEROES.
           05  CNT-CMA-NOT-CALLED          PIC 9(1) VALUE ZEROES.
           05  CNT-VRU-UNSUCCESSFUL        PIC 9(1) VALUE ZEROES.
           05  CNT-REQUIRED-CRAFT          PIC 9(1) VALUE ZEROES.
           05  CNT-SHORT-CALLED            PIC 9(1) VALUE ZEROES.
           05  CNT-CALL-SUCCESS            PIC 9(1) VALUE ZEROES.
           05  CNT-AHM                     PIC 9(1) VALUE ZEROES.
           05  WS-HOLD-SCHED-KEY           PIC X(20) VALUE SPACES.
           05  WS-TAXI-TIME.
               10  WS-TAXI-TIME-HR         PIC 9(02).
               10  WS-TAXI-TIME-MN         PIC 9(02).
           05  WS-TAXI-TIME-NUM REDEFINES WS-TAXI-TIME
                                           PIC 9(04).
           05  WS-CNTL-TAXI-TIME           PIC X(04) VALUE SPACES.
           05  WS-VCNY-FLAG                PIC X(01) VALUE SPACE.
           05  WS-TOPC-POS                 PIC XX    VALUE SPACES.
           05  FILLER REDEFINES WS-TOPC-POS.
               10 WS-TOPC-POS-ENTRY        PIC X OCCURS 2 TIMES.

           05  WS-CAPITALIZE-NUM           PIC S9(4) COMP VALUE ZERO.
           05  FILLER REDEFINES WS-CAPITALIZE-NUM.
               10  FILLER                  PIC X.
               10  WS-CAPITALIZE-BYTE      PIC X.
           05  WS-IVR-CALL-CMPLT-EN        PIC X      VALUE SPACE.
           05  WS-IVR-CALL-CMPLT-TR        PIC X      VALUE SPACE.
           05  WS-RES-MN                   PIC  9(004) VALUE ZEROES.
           05  WS-TOPC-VRUINFO-KEY.
               10  WS-TOPC-VRUINFO-KEY1    PIC  X(004) VALUE SPACES.
               10  WS-TOPC-VRUINFO-KEY2    PIC  X(010) VALUE SPACES.
               10  WS-TOPC-VRUINFO-KEY3    PIC  X(010) VALUE SPACES.
               10  WS-TOPC-VRUINFO-KEY4    PIC  X(001) VALUE SPACES.
               10  WS-TOPC-VRUINFO-KEY5    PIC  X(004) VALUE SPACES.
           05  WS-CNTL-POOL                PIC  X(002) VALUE ZEROES.
           05  WS-CNTL-I-O                 PIC  X(001) VALUE ZEROES.
           05  WS-SAVE-CBCK-FLAG           PIC  X(001) VALUE SPACES.
           05  WS-ROUTE-DSGN               PIC  X(005) VALUE SPACES.
           05  COUNT1                      PIC  S9(04) COMP VALUE ZERO.
           05  COUNT2                      PIC  S9(04) COMP VALUE ZERO.
           05  COUNT3                      PIC  S9(04) COMP VALUE ZERO.
           05  COUNTMAX                    PIC  S9(04) COMP VALUE ZERO.
           05  WS-TEMP-QUAL                PIC  X(004) VALUE SPACES.
           05  WS-SV-EN-FROM-DIST          PIC  X(002) VALUE SPACES.
           05  WS-SV-EN-FROM-SDIST         PIC  X(002) VALUE SPACES.
           05  WS-SV-EN-FROM-POOL          PIC  X(002) VALUE SPACES.
           05  WS-SV-TR-FROM-DIST          PIC  X(002) VALUE SPACES.
           05  WS-SV-TR-FROM-SDIST         PIC  X(002) VALUE SPACES.
           05  WS-SV-TR-FROM-POOL          PIC  X(002) VALUE SPACES.
      *C1210.2 - BEG
           05 WS-SV-AH2KEY                 PIC  X(020) VALUE SPACES.
      *C1210.2 - END
      *CNLD-207-DXC-B
           05 WS-SAVE-REST-STATUS          PIC  X(001) VALUE SPACES.
      *CNLD-207-DXC-E
      *CNLD-230-B
           05 WS-RFR-MSG                   PIC  X(004) VALUE SPACES.
      *CNLD-230-E
      *CNLD-244#2-B
           05 WS-JOB-TYPE                  PIC X(02).
           05 WS-TBL-PREP-TIME.
              10 WS-TBL-PREP-HR            PIC 99.
              10 WS-TBL-PREP-MN            PIC 99.
           05 WS-JOB-TYPE-FOUND-FL         PIC X.
              88   JOB-TYPE-FOUND          VALUE 'Y'.
              88   JOB-TYPE-NOT-FOUND      VALUE 'N'.
      *CNLD-244#2-E
      *08/01/23 RJA B CNC0600 CNLD-270
           05 WS-TRCN-INIT-DH-TIME         PIC X(04).
      *08/01/23 RJA E CNC0600 CNLD-270
      *CNLD-245-B
006000     05 WS-SAVE-UD-DTTM              PIC 9(010) VALUE ZEROS.
006000     05 WS-SAVE-LEAD-TIME            PIC 9(004) VALUE ZEROS.
      *CNLD-330-B COMMENTING
006000*    05 WS-REST-US-STATUS-FLAG       PIC X(001) VALUE SPACES.
014400*       88  WS-EMP-US-STATUS-RED                VALUE 'R'.
014500*       88  WS-EMP-US-STATUS-YELLOW             VALUE 'Y'.
014600*       88  WS-EMP-US-STATUS-GREEN              VALUE 'G'.
      *CNLD-330-E
      *CNLD-245-E
      *CNC0600-NXA-B
       01  WS-UD-MESG.
           05 WS-TEXT                      PIC X(38)
              VALUE 'EMPLOYEE IS ON UNDISTURBED REST UNTIL '.
           05 WS-TIME1.
              06 WS-UD-HH                  PIC X(02).
              06 FILLER                    PIC X(01)   VALUE ':'.
              06 WS-UD-MM                  PIC X(02).
      *CNC0600-NXA-E
      *CNLD-207-DXC-B
       01  WS-RB-1-MESG.
      *CNLD-244-B #3 CNC0600
      *    05 WS-RB-1-TEXT                 PIC X(40)
      *       VALUE 'EMP WILL RESET SHORTLY,CAN BE CALLED AT '.
           05 WS-RB-1-TEXT-1               PIC X(41)
              VALUE 'EMP WILL RESET SHORTLY, CAN BE CALLED AT '.
      *CNLD-244-E
           05 WS-RB-1-TIME.
              06 WS-RB-1-HH                PIC X(02)   VALUE SPACES.
              06 FILLER                    PIC X(01)   VALUE ':'.
              06 WS-RB-1-MM                PIC X(02)   VALUE SPACES.
      *CNLD-265-B
       01  WS-US-DOM-FL                    PIC X(001) VALUE SPACES.
           88  WS-US-DOM-Y                            VALUE 'Y'.
      *CNLD-265-E
      *
       01  WS-RB-2-MESG.
           05 WS-RB-2-TEXT-1               PIC X(18)
              VALUE 'EMP WILL RESET IN '.
           05 WS-RB-2-MM                   PIC X(02).
           05 WS-RB-2-TEXT-2               PIC X(03)
              VALUE ' MN'.
      *CNLD-244-B #3 CNC0600
      *    05 WS-RB-2-TEXT-3               PIC X(34)
      *       VALUE ' CONSIDER DELAYING TRAIN ORDER BY '.
           05 WS-RB-2-TEXT-3               PIC X(35)
              VALUE ' CONSIDER DELAYING ON-DUTY TIME BY '.
      *CNLD-244-E
           05 WS-RB-2-MM-1                 PIC X(02).
           05 WS-RB-2-TEXT-2               PIC X(03)
              VALUE ' MN'.
      *CNLD-207-DXC-E

       01  WS-MISC-2.
           05  HOLD-WK-JSK1-EXP-DATE.
               10  HOLD-JSK1-CE            PIC 9(002) VALUE ZEROES.
               10  HOLD-JSK1-YYMMDD.
                   15  HOLD-JSK1-YY        PIC 9(002) VALUE ZEROES.
                   15  HOLD-JSK1-MM        PIC 9(002) VALUE ZEROES.
                   15  HOLD-JSK1-DD        PIC 9(002) VALUE ZEROES.

       01  WS-TRAIN-SYMBOL.
           05  WS-TRAIN-ASGN.
               10  WS-TRAIN-SYMBOL-BYTE1   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE2   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE3   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE4   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE5   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE6   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE7   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE8   PIC X(001) VALUE SPACES.
           05  WS-TRAIN-ASGN-TYPE.
               10  WS-TRAIN-SYMBOL-BYTE9   PIC X(001) VALUE SPACES.
               10  WS-TRAIN-SYMBOL-BYTE10  PIC X(001) VALUE SPACES.

       01  WS-TEMP-NAME                               VALUE SPACES.
           05  WS-TEMP-TURN                PIC X(012).
           05  FILLER                      PIC X(001).
           05  WS-TEMP-EMPNO               PIC X(009).
           05  FILLER                      PIC X(004).

       01  WS-ASGN-MERG-CLASS              PIC XX     VALUE SPACES.
       01  WS-HOLD-IVR-CANCEL-ASGN-KEY     PIC X(12) VALUE SPACES.

       01  WS-MERG-KEY.
           02  WS-MERG-DIST                PIC XX.
           02  WS-MERG-SUB                 PIC XX.
           02  WS-MERG-REST.
               04  WS-MERG-POOL            PIC XX.
               04  FILLER                  PIC X(4).
           02  FILLER                      PIC X(2).

       01  WS-ASGN-TYPE                    PIC X.
           88  UFP-ASGN                        VALUE '1'.
           88  AJ-ASGN                         VALUE '2'.
       01  WK-TRCNKEY2                                VALUE SPACES.
           05  WK-TRCN-ORG-STATION         PIC X(005).
           05  WK-TRCN-ASGN                PIC X(008).

       01  WK-ASGN-KEY.
           05  WK-ASGN-KEY-DIST            PIC X(002) VALUE SPACES.
           05  WK-ASGN-KEY-SDIST           PIC X(002) VALUE SPACES.
           05  WK-ASGN-KEY-POOL            PIC X(002) VALUE SPACES.
           05  FILLER                      PIC X(004) VALUE SPACES.

       01  WS-AHM-KEY.
           05  WS-AHIST-KEY                PIC X(026) VALUE SPACES.
           05  WS-AHIST-MISC-KEY           PIC X(017) VALUE SPACES.

       01  SAVE-ASGN-KEY                   PIC X(012) VALUE SPACES.
       01  WORK-COMMAREA                              VALUE SPACES.
           05  WK-CCA-ASGN-HIST-KEY        PIC X(026).
           05  WK-CCA-TASK-KEY             PIC X(041).
           05  WK-CCA-PROFILE-KEY          PIC X(018).

       01  HOLD-JS-KEY1                    PIC X(030) VALUE SPACES.
       01  HOLD-JS-KEY2                    PIC X(030) VALUE SPACES.
       01  HOLD-TASK-KEY                   PIC X(041) VALUE SPACES.

       01  SAVE-JOB-ON-DUTY.
           05  SAVE-JOB-OD-DATE            PIC X(006).
           05  SAVE-JOB-OD-TIME            PIC X(004).

      *CNC0520-BEG
      *01  WS-FUNCTION-TABLE-SIZE          PIC S9(04) COMP VALUE +41.
      *CNC0600-B
      *01  WS-FUNCTION-TABLE-SIZE          PIC S9(04) COMP VALUE +42.
       01  WS-FUNCTION-TABLE-SIZE          PIC S9(04) COMP VALUE +43.
      *CNC0600-E

      *CNC0520-END
       01  WS-FUNCTION-TABLE.
           05  FILLER                      PIC X(027)
               VALUE 'CALL A Y NORMAL CALL       '.
           05  FILLER                      PIC X(027)
               VALUE 'CAOT A Y CALL OVERTIME     '.
           05  FILLER                      PIC X(027)
               VALUE 'FILL A Y 1ST VACANCY FILL  '.
           05  FILLER                      PIC X(027)
               VALUE 'OFF  A Y LAYOFF            '.
           05  FILLER                      PIC X(027)
               VALUE 'REJT U Y REJECT TURN       '.
           05  FILLER                      PIC X(027)
               VALUE 'RJSU A Y REJECT EMP SUPV   '.
           05  FILLER                      PIC X(027)
               VALUE 'RJNR A Y REJECT EMP NOT RST'.
           05  FILLER                      PIC X(027)
               VALUE 'RJNW A Y REJECT NO WORK    '.
           05  FILLER                      PIC X(027)
               VALUE 'RJRT A Y REJECT RESTRICTION'.
           05  FILLER                      PIC X(027)
               VALUE 'RJNQ A Y REJECT EMP NO QUAL'.
           05  FILLER                      PIC X(027)
               VALUE 'RJH  A Y REJECT/HOLD       '.
           05  FILLER                      PIC X(027)
               VALUE 'RJHS A Y REJECT HRS SERVICE'.
           05  FILLER                      PIC X(027)
               VALUE 'VACT A Y VACATE ASGN       '.
           05  FILLER                      PIC X(027)
               VALUE 'HELP A Y MANUAL OVERRIDE   '.
           05  FILLER                      PIC X(027)
               VALUE 'DROP U Y DROP TURN         '.
           05  FILLER                      PIC X(027)
               VALUE 'ANNU A Y ANNULL ASSIGN     '.
           05  FILLER                      PIC X(027)
               VALUE 'YES  A N CREW CONSIST YES  '.
           05  FILLER                      PIC X(027)
               VALUE 'NO   A N CREW CONSIST NO   '.
           05  FILLER                      PIC X(027)
               VALUE 'SENR A Y SENIOR MAN        '.
           05  FILLER                      PIC X(027)
               VALUE 'DCAN U Y DELAY/CANCEL      '.
           05  FILLER                      PIC X(027)
               VALUE 'REJM U Y REJECT AND MARK   '.
           05  FILLER                      PIC X(027)
               VALUE 'PHON A Y PHONE NUMBERS     '.
           05  FILLER                      PIC X(027)
               VALUE 'QTIE A N QUICK TIE         '.
           05  FILLER                      PIC X(027)
               VALUE 'ATNA A Y ATTEMPT NO ANSWER '.
           05  FILLER                      PIC X(027)
               VALUE 'ATBU A Y ATTEMPT BUSY      '.
           05  FILLER                      PIC X(027)
               VALUE 'CDSP A Y CALL DH SEP PVT AU'.
           05  FILLER                      PIC X(027)
               VALUE 'CDSC A Y CALL DH SEP CAB   '.
           05  FILLER                      PIC X(027)
               VALUE 'CDCP A Y COMBINE/DH/SVC PVT'.
           05  FILLER                      PIC X(027)
               VALUE 'CDCC A Y COMBINE/DH/SVC CAB'.
           05  FILLER                      PIC X(027)
               VALUE 'REST A Y DISPLAY HRS SVC   '.
           05  FILLER                      PIC X(027)
               VALUE 'HOUR A N HOURS FUNCTION    '.
           05  FILLER                      PIC X(027)
               VALUE 'CBCK A N CALLBACK          '.
           05  FILLER                      PIC X(027)
               VALUE 'SETB A Y SETBACK           '.
           05  FILLER                      PIC X(027)
               VALUE 'VCLL B Y NORMAL CALL       '.
           05  FILLER                      PIC X(027)
               VALUE 'VAOT B Y CALL OVERTIME     '.
           05  FILLER                      PIC X(027)
               VALUE 'VDSP B Y IVR-CLL DH SEP PVT'.
           05  FILLER                      PIC X(027)
               VALUE 'VDSC B Y IVR-CLL DH SEP CAB'.
           05  FILLER                      PIC X(027)
               VALUE 'VDCP B Y IVR-COMB/DH/SV PVT'.
           05  FILLER                      PIC X(027)
               VALUE 'VDCC B Y IVR-COMB/DH/SV CAB'.
           05  FILLER                      PIC X(027)
               VALUE 'HOS  A Y DISPLAY HOS INFO  '.
           05  FILLER                      PIC X(027)
      *CNC0520-BEG
      *        VALUE '                           '.
               VALUE 'QUAL A Y DISPLAY QUAL INFO '.
      *CNC0520-END
           05  FILLER                      PIC X(027)
      *CNC0600-B
      *        VALUE '                           '.
               VALUE 'HOSO A N HOS OVERRIDE RULE '.
      *CNC0600-E
           05  FILLER                      PIC X(027)
               VALUE '                           '.
           05  FILLER                      PIC X(027)
               VALUE '                           '.
           05  FILLER                      PIC X(027)
               VALUE '                           '.
           05  FILLER                      PIC X(027)
               VALUE '                           '.
           05  FILLER                      PIC X(027)
               VALUE '                           '.
           05  FILLER                      PIC X(027)
               VALUE '                           '.
           05  FILLER                      PIC X(027)
               VALUE '                           '.
           05  FILLER                      PIC X(027)
               VALUE '                           '.
       01  FILLER REDEFINES WS-FUNCTION-TABLE.
           05  WS-FUNC-ARRAY                          OCCURS 50 TIMES.
               10  WS-FUNC-CODE            PIC X(004).
               10  FILLER                  PIC X(001).
               10  WS-FUNC-USAGE           PIC X(001).
                   88  UFP-USAGE                  VALUE 'A', 'U', 'R'.
                   88  LOCAL-USAGE                VALUE 'A', 'O', 'R'.
                   88  YARD-USAGE                 VALUE 'A', 'Y'.
                   88  ROAD-USAGE                 VALUE 'A', 'R'.
                   88  ALL-USAGE                  VALUE 'A'.
                   88  IVR-UFP-USAGE              VALUE 'B', 'V', 'S'.
                   88  IVR-LOCAL-USAGE            VALUE 'B', 'P', 'S'.
                   88  IVR-YARD-USAGE             VALUE 'B', 'Z'.
                   88  IVR-ROAD-USAGE             VALUE 'B', 'S'.
                   88  IVR-ALL-USAGE              VALUE 'B'.
               10  FILLER                  PIC X(001).
               10  WS-FUNC-DISPLAY-FLAG    PIC X(001).
                   88  WS-FUNC-IS-DISPLAYED       VALUE 'Y'.
               10  FILLER                  PIC X(001).
               10  WS-FUNC-DESC            PIC X(018).

       01  WS-FORMAT-FUNCTIONS                        VALUE SPACES.
           05  WS-FORMAT-FUNC-DETAIL                  OCCURS  3 TIMES.
               10  WS-FORMAT-FUNC-ARRAY               OCCURS 14 TIMES.
                   15  WS-FORMAT-FUNC      PIC X(004).
                   15  WS-FORMAT-DASH      PIC X(001).

       01  NORMAL-ASGNMT-FLAG              PIC X(001) VALUE SPACES.
           88  NORM-ASGN-UFP                          VALUE 'U'.
           88  NORM-ASGN-XB                           VALUE 'X'.
           88  NORM-ASGN-AJ                           VALUE 'A'.
       01  NORMAL-ASGNMT                              VALUE SPACES.
           05  NA-DIST                     PIC X(002).
           05  NA-SUB-DIST                 PIC X(002).
           05  NA-AREA.
               10  NA-1                    PIC X(006).
               10  NA-2 REDEFINES NA-1.
                   15  NA-POOL             PIC X(002).
                   15  NA-TURN             PIC X(004).
               10  NA-3 REDEFINES NA-1.
                   15  NA-FILLER           PIC X(002).
                   15  NA-XB-TURN          PIC X(004).
               10  NA-CC                   PIC X(002).

       01  TEMPORARY-ASGNMT-FLAG           PIC X(001) VALUE SPACES.
           88  TEMP-ASGN-UFP                          VALUE 'U'.
           88  TEMP-ASGN-XB                           VALUE 'X'.
           88  TEMP-ASGN-AJ                           VALUE 'A'.
       01  TEMPORARY-ASGNMT                           VALUE SPACES.
           05  TA-DIST                     PIC X(002).
           05  TA-SUB-DIST                 PIC X(002).
           05  TA-AREA.
               10  TA-1                    PIC X(006).
               10  TA-2 REDEFINES TA-1.
                   15  TA-POOL             PIC X(002).
                   15  TA-TURN             PIC X(004).
               10  TA-3 REDEFINES TA-1.
                   15  TA-XB               PIC X(002).
                   15  TA-XB-TURN          PIC X(004).
               10  TA-CC                   PIC X(002).

       01  ON-DUTY-ASGNMT-FLAG             PIC X(001) VALUE SPACES.
           88  ON-DUTY-UFP                            VALUE 'U'.
           88  ON-DUTY-AJ                             VALUE 'A'.
       01  ON-DUTY-ASGNMT                             VALUE SPACES.
           05  OD-DIST                     PIC X(002).
           05  OD-SUB-DIST                 PIC X(002).
           05  OD-AREA.
               10  OD-1                    PIC X(006).
               10  OD-2 REDEFINES OD-1.
                   15  OD-POOL             PIC X(002).
                   15  OD-TURN             PIC X(004).
               10  OD-CC                   PIC X(002).
      *C983-BEG
      *    BELOW FIELDS ARE REQUIRED FOR HOMEAWAY COPYBOOK
       01  CURRENT-ASGNMT-FLAG             PIC X(01)  VALUE SPACES.
           88  CURR-ASGN-UFP                          VALUE 'U'.
           88  CURR-ASGN-XB                           VALUE 'X'.
           88  CURR-ASGN-AJ                           VALUE 'A'.
       01  CURRENT-ASGNMT                             VALUE SPACES.
           05  CU-DIST                     PIC X(02).
           05  CU-SUB-DIST                 PIC X(02).
           05  CU-AREA.
               10  CU-1                    PIC X(06).
               10  CU-2 REDEFINES CU-1.
                   15  CU-POOL             PIC X(02).
                   15  CU-TURN             PIC X(04).
               10  CU-3 REDEFINES CU-1.
                   15  CU-FILLER           PIC X(02).
                   15  CU-XB-TURN          PIC X(04).
               10  CU-CC                   PIC X(02).

       01  WS-EMP-AT-FLAG          PIC X(01) VALUE SPACE.
           88  WS-EMP-AT-HOME                VALUE 'H'.
           88  WS-EMP-AT-AWAY                VALUE 'A'.
       01  WS-DEADHEAD-FOUND-FLAG  PIC X(01) VALUE 'N'.
           88  WS-DEADHEAD-FOUND             VALUE 'Y'.
           88  WS-NO-DEADHEAD-FOUND          VALUE 'N'.
       01  WS-DH-F-NOTICE-FLAG     PIC X     VALUE 'N'.
           88  WS-DH-F-NOTICE                VALUE 'Y'.
       01  POINTER-DONE-FLAG       PIC X(01) VALUE 'N'.
           88  POINTER-DONE                  VALUE 'Y'.
           88  POINTER-NOT-DONE              VALUE 'N'.
       01  WS-POINT-EFF-DATE-TIME.
           04  WS-POINT-EFF-DATE   PIC X(08) VALUE SPACES.
           04  WS-POINT-EFF-TIME   PIC X(04) VALUE SPACES.
       01  HOLD-IN-ZONE            PIC X(01) VALUE SPACES.
       01  HOLD-OUT-ZONE           PIC X(01) VALUE SPACES.
      *C983-END
       01  WORK-ASGNKEY1.
           05  WK-ASGN-JOB-TYPE            PIC X(001) VALUE SPACES.
           05  WK-ASGN-ASSIGNMENT                     VALUE SPACES.
               10  WK-ASGN-DIST            PIC X(002).
               10  WK-ASGN-SUB-DIST        PIC X(002).
               10  WK-ASGN-ASSIGN.
                   15  WK-ASGN-POOL        PIC X(002).
                   15  WK-ASGN-TURN        PIC X(004).
                   15  WK-ASGN-CC          PIC X(002).
           05  WK-ASGN-REC-TYPE            PIC X(001) VALUE '1'.
           05  WK-ASGN-DATE-TIME           PIC 9(010) VALUE ZEROS.

       01  WORK-ASGNKEY2.
           05  WK-ASGN-EMP-NO              PIC 9(009) VALUE ZEROS.
           05  WK-ASGN-EMP-REC-TYPE        PIC X(001) VALUE SPACES.
           05  WK-ASGN-EMP-DATE-TIME       PIC 9(010) VALUE ZEROS.

       01  WS-SAVE-ASGN-FILE               PIC X(128) VALUE SPACES.
       01  SAVE-TRCN-FILE                  PIC X(350) VALUE SPACES.
       01  WS-HOLD-JOB-SCHED               PIC X(128) VALUE SPACES.

       01  WS-SAVE-MISC.
           05  WS-SAVE-HOME-BOARD.
               10  WS-SAVE-DIST            PIC X(002) VALUE SPACES.
               10  WS-SAVE-SDIST           PIC X(002) VALUE SPACES.
               10  WS-SAVE-POOL            PIC X(002) VALUE SPACES.
               10  WS-SAVE-IO-TOWN         PIC X(001) VALUE SPACES.
           05  WS-SAVE-ALT-EN-TK-PROFILE   PIC X(008) VALUE SPACES.
           05  WS-SAVE-ALT-TR-TK-PROFILE   PIC X(008) VALUE SPACES.
      *CNC0544-BEG
           05  WS-SAVE-ALT-EST-RUN-TM      PIC X(004) VALUE SPACES.
           05  WS-SAVE-ALT-SOURCE-FLAG     PIC X(001) VALUE SPACES.
               88 EN-FROM-ALT-SOURCE                  VALUE 'E'.
               88 TR-FROM-ALT-SOURCE                  VALUE 'T'.
               88 BOTH-FROM-ALT-SOURCE                VALUE 'B'.
      *CNC0544-END

       01  WORK-CNTL-76-KEY                           VALUE SPACES.
           05  FILLER                      PIC X(002).
           05  WK-CNTL-76-PROF             PIC X(008).
           05  WK-CNTL-76-CREW             PIC X(001).
           05  FILLER                      PIC X(006).
           05  WK-CNTL-76-SEQ              PIC X(003).

       01  WORK-CNTLKEY                               VALUE SPACES.
           05  WK-CNTL-REC-TYPE                          PIC X(002).
           05  WK-CNTLKEY-AREA.
               10  WK-CNTL-DIST                          PIC X(002).
               10  WK-CNTL-SUB-DIST                      PIC X(002).
               10  WK-CNTL-GENERAL-AREA.
                   15  WK-CNTL-ASSIGN.
                       20  WK-CNTL-AJ-JOB-NO.
                           25  WK-CNTL-AJ-1-4            PIC X(004).
                           25  WK-CNTL-AJ-5-6            PIC X(002).
                       20  FILLER                        PIC X(003).
                   15  WK-CNTL-XB REDEFINES
                       WK-CNTL-ASSIGN.
                       20  WK-CNTL-XB-CODE               PIC X(002).
                       20  FILLER                        PIC X(007).
                   15  WK-CNTL-UFP REDEFINES
                       WK-CNTL-ASSIGN.
                       20  WK-CNTL-POOL                  PIC X(002).
                       20  WK-CNTL-POOL-MISC.
                           25  WK-CNTL-POOL-TYPE         PIC X(001).
                           25  FILLER                    PIC X(006).
                       20  WK-CNTL-POOL-SEN
                           REDEFINES WK-CNTL-POOL-MISC.
                           25  WK-CNTL-POOL-TURN.
                               30  WK-CNTL-POOL-TURN-PREFIX PIC X(002).
                               30  WK-CNTL-POOL-TURN-NO  PIC X(002).
                           25  WK-CNTL-POOL-CC           PIC X(002).
                           25  FILLER                    PIC X(001).
                   15  WK-CNTL-ASSIGN-QUAL
                       REDEFINES WK-CNTL-ASSIGN.
                       20  WK-CNTL-ASGN-QUAL-TYPE        PIC X(001).
                       20  WK-CNTL-ASGN-QUAL.
                           25  WK-CNTL-ASGN-QUAL-1-2     PIC X(002).
                           25  WK-CNTL-ASGN-QUAL-3-4     PIC X(002).
                           25  WK-CNTL-ASGN-QUAL-5-6     PIC X(002).
                           25  WK-CNTL-ASGN-QUAL-7-8     PIC X(002).
                   15  FILLER                            PIC X(005).
               10  WK-CNTL-GENERAL-AREA77 REDEFINES
                   WK-CNTL-GENERAL-AREA.
                   15  WK-CNTL-77-POOL                   PIC X(002).
                   15  WK-CNTL-77-TERM                   PIC X(001).
                   15  WK-CNTL-77-CREW                   PIC X(002).
                   15  WK-CNTL-77-TRAIN                  PIC X(008).
                   15  FILLER                            PIC X(001).
           05  WK-CNTL-MC-KEY REDEFINES
               WK-CNTLKEY-AREA.
               10  WK-CNTL-MC-CODE         PIC  X(004).
               10  WK-CNTL-MC-TYPE-SVC     PIC  X(002).
               10  WK-CNTL-MC-DIST         PIC  X(002).
               10  WK-CNTL-MC-SDIST        PIC  X(002).
               10  WK-CNTL-MC-XB           PIC  X(002).
               10  WK-CNTL-MC-CONS         PIC  X(002).
               10  FILLER                  PIC  X(004).
           05  FILLER REDEFINES
               WK-CNTLKEY-AREA.
               10  FILLER                  PIC X(06).
               10  WK-CNTL-I-O             PIC X.
               10  WK-CNTL-TYPE            PIC X.
               10  WK-CNTL-HOST-SEQ        PIC XX.
               10  FILLER                  PIC X(08).

       01  WORK-AJTRAIN                               VALUE SPACES.
           05  WK-AJTRAIN-DIST             PIC X(002).
           05  WK-AJTRAIN-SUB-DIST         PIC X(002).
           05  WK-AJTRAIN-TRAIN            PIC X(010).
           05  WK-AJTRAIN-CC               PIC X(002).

       01  WORK-UFPTRAIN                              VALUE SPACES.
           05  WK-UFPTRAIN-DIST            PIC X(002).
           05  WK-UFPTRAIN-SUB-DIST        PIC X(002).
           05  WK-UFPTRAIN-POOL            PIC X(002).
           05  WK-UFPTRAIN-TRAIN           PIC X(010).
           05  WK-UFPTRAIN-CC              PIC X(002).

       01  WORK-UFPPOS                                VALUE SPACES.
           05  WK-UFPPOS-DIST              PIC X(002).
           05  WK-UFPPOS-SUB-DIST          PIC X(002).
           05  WK-UFPPOS-POOL              PIC X(002).
           05  WK-UFPPOS-CC                PIC X(002).
           05  WK-UFPPOS-IN-OUT.
               10  FILLER                  PIC X(001).
               10  WK-UFPPOS-IN-OUT-TERM   PIC X(001).
           05  WK-UFPPOS-KEY.
               10  WK-UFPPOS-BOARD         PIC X(001).
                   88  WK-UFPPOS-ON-BOARD           VALUE '0' THRU '8'.
                   88  WK-UFPPOS-ACTIVE-BOARD         VALUE '0'.
                   88  WK-UFPPOS-ID-ACTIVE-BOARD      VALUE '0'.
                   88  WK-UFPPOS-ID-INACTIVE-BOARD    VALUE '1'.
                   88  WK-UFPPOS-OFF-BOARD            VALUE '9'.
               10  WK-UFPPOS-TIME.
                   15  WK-UFPPOS-DATE-TIME PIC X(010).
                   15  WK-UFPPOS-TIE-BRKR  PIC X(004).
                   15  WK-UFPPOS-TIE-NUM REDEFINES
                       WK-UFPPOS-TIE-BRKR  PIC 9(004).

       01  WS-SAVE-WORK-UFPPOS             PIC X(025) VALUE SPACES.

       01  WS-ASSOC-TEST-CRAFT             PIC X(002) VALUE SPACES.
       01  WS-ASSOCIATED-CRAFT-ARRAY                  VALUE SPACES.
           05  WS-ASSOC-CC-ARRAY                      OCCURS 10 TIMES.
               10  WS-ASSOC-CRAFT          PIC X(002).
               10  WS-ASSOC-CRAFT-STATUS   PIC X(001).
                   88  PRIMARY-TURN                   VALUE '1'.
                   88  OPTIONAL-TURN                  VALUE '2'.

      *CNC0499 - MFO - TESTING - BEG
       01  MAKEUP-TURN.
           02  MAKEUP-DIST                   PIC X(2)  VALUE SPACES.
           02  MAKEUP-SUB-DIST               PIC X(2)  VALUE SPACES.
           02  MAKEUP-POOL                   PIC X(2)  VALUE SPACES.
           02  MAKEUP-TURN-NBR.
               03  MAKEUP-TURN-PREFIX        PIC X(2)  VALUE SPACES.
               03  MAKEUP-TURN-NUMERIC       PIC 9(2)  VALUE ZEROS.
           02  MAKEUP-CC                     PIC X(2)  VALUE SPACES.
       01  WS-SV-UFPTURN-AREA.
           02  FILLER                        PIC X(6)  VALUE SPACE.
           02  WS-SV-UFP-TURN                PIC X(4)  VALUE SPACE.
           02  FILLER                        PIC XX    VALUE SPACE.
       01  WS-ORIG-TURN-NBR                  PIC X(4)  VALUE SPACE.
      *CNC0499 - MFO - TESTING - END
       01  WORK-HIST-TIMEX.
           05  WORK-HIST-TIME              PIC 9(012) VALUE ZEROS.
           05  WORK-HIST-TIME-TIE          PIC 9(002) VALUE ZEROS.

       01  WS-CALL-DATE-TIME-CENT.
           05  WS-CALL-DATE-CENT           PIC X(002) VALUE SPACES.
           05  WS-CALL-DATE-TIME                      VALUE SPACES.
               10  WS-CALL-DATE.
                   15 WS-CALL-YR           PIC X(002).
                   15 WS-CALL-MO           PIC X(002).
                   15 WS-CALL-DY           PIC X(002).
               10  WS-CALL-TIME.
                   15 WS-CALL-HR           PIC X(002).
                   15 WS-CALL-MN           PIC X(002).

      *CNLD-244 #2 B - RPV1
       01  WS-PREP-OD-DATE-TIME-CENT.
           05  WS-PREP-OD-DATE-CENT           PIC X(002) VALUE SPACES.
           05  WS-PREP-ODDATE-TIME                      VALUE SPACES.
               10  WS-PREP-OD-DATE.
                   15 WS-PREP-OD-YR           PIC X(002).
                   15 WS-PREP-OD-MO           PIC X(002).
                   15 WS-PREP-OD-DY           PIC X(002).
               10  WS-PREP-OD-TIME.
                   15 WS-PREP-OD-HR           PIC X(002).
                   15 WS-PREP-OD-MN           PIC X(002).
      *CNLD-244 #2 B - SXG1
       01  WS-CALC-OD-DATE.
           05 WS-CALC-OD-YR                   PIC X(002).
           05 WS-CALC-OD-MO                   PIC X(002).
           05 WS-CALC-OD-DY                   PIC X(002).
       01  WS-CALC-OD-TIME.
           05 WS-CALC-OD-HR                   PIC X(002).
           05 WS-CALC-OD-MN                   PIC X(002).
      *CNLD-244 #2 E - SXG1
      *CNLD-244 #2 E - RPV1
       01  WS-CALL-MINUS-LTIME                        VALUE SPACES.
           05  WS-CALL-MINUS-LEAD.
               10  WS-CALL-MINUS-LEAD-CENT PIC X(002).
               10  WS-CALL-MINUS-LEAD-DATE PIC X(006).
               10  WS-CALL-MINUS-LEAD-TIME PIC X(004).
RJA   * CNC0600 B
RJA        05  FILLER REDEFINES WS-CALL-MINUS-LEAD.
RJA            10  FILLER                  PIC X(002).
RJA            10  WS-CALL-MINUS-LEAD-DTTM PIC X(010).
RJA   * CNC0600 E

       01  WS-CALL-DATE-TIME-SYS                      VALUE SPACES.
           05  WS-CALL-DATE-SYS.
               10  WS-CALL-YR-SYS          PIC X(002).
               10  WS-CALL-MO-SYS          PIC X(002).
               10  WS-CALL-DY-SYS          PIC X(002).
           05  WS-CALL-TIME-SYS.
               10  WS-CALL-HR-SYS          PIC X(002).
               10  WS-CALL-MN-SYS          PIC X(002).

       01  WS-CHECK-REST-DATE-TIME-CENT.
           02  WS-CHECK-REST-CENT          PIC X(02).
           02  WS-CHECK-REST-DATE          PIC X(06).
           02  WS-CHECK-REST-TIME          PIC X(04).

       01  WS-MIN-AWAY-DATE-TIME                      VALUE SPACES.
           05  WS-MIN-AWAY-DATE            PIC X(006).
           05  WS-MIN-AWAY-TIME            PIC X(004).

       01  WS-FORMAT-TRAIN                 PIC X(010) VALUE SPACES.
       01  WS-UFP-TRAIN                    PIC X(008) VALUE SPACES.

       01  WS-COMPARE-DATE-TIME-CENT                  VALUE SPACES.
           05  WS-COMPARE-CENT             PIC X(002).
           05  WS-COMPARE-DATE             PIC X(006).
           05  WS-COMPARE-TIME             PIC X(004).

       01  WS-TURN-TO-CALL                 PIC X(012) VALUE SPACES.

       01  WS-COMPARE-TURN                            VALUE SPACES.
           05  FILLER                      PIC X(006).
           05  FILLER                      PIC X(002).
           05  FILLER                      PIC X(002).

       01  WS-LEAD-TIME.
           05  WS-LEAD-TIME-HR             PIC 9(002) VALUE ZEROS.
           05  WS-LEAD-TIME-MN             PIC 9(002) VALUE ZEROS.
       01  WS-LEAD-TIME-MN3                PIC 9(003) VALUE ZEROS.

       01  WS-SCH-EXP-DATE                 PIC X(006) VALUE SPACES.
       01  WS-SCH-DATE-TIME                           VALUE SPACES.
           05  WS-SCH-DATE                 PIC X(006).
           05  WS-SCH-TIME                 PIC X(004).
       01  WS-SCH-DAY-TIME-FROM.
           05  WS-SCH-DAY-FROM             PIC 9(003) VALUE ZEROS.
           05  WS-SCH-TIME-FROM            PIC 9(004) VALUE ZEROS.
           05  WS-SCH-DATE-FROM            PIC X(006) VALUE SPACES.
       01  WS-SCH-DAY-TIME-TO.
           05  WS-SCH-DAY-TO               PIC 9(003) VALUE ZEROS.
           05  WS-SCH-TIME-TO              PIC 9(004) VALUE ZEROS.
           05  WS-SCH-DATE-TO              PIC X(006) VALUE SPACES.
       01  WS-SCH-DAY-TIME.
           05  WS-SCH-DAY                  PIC 9(003) VALUE ZEROS.
           05  WS-SCH-START-TIME           PIC 9(004) VALUE ZEROS.
           05  WS-SCH-END-TIME             PIC 9(004) VALUE ZEROS.

       01  WS-SENIOR-EMP-NO                PIC X(09)  VALUE SPACES.
       01  WS-SENIOR-DEC-KEY               PIC X(020) VALUE SPACES.

       01  WS-SENIOR-SEN.
           02  WS-SENIOR-LVL                PIC X(02) VALUE SPACES.
           02  WS-SENIOR-SEN-DATE           PIC X(08) VALUE SPACES.
       01  WS-COMPARE-SEN.
           02  WS-COMPARE-LVL               PIC X(02) VALUE SPACES.
           02  WS-COMPARE-SEN-DATE          PIC X(08) VALUE SPACES.

       01  WS-COMPARE-EMP-NO               PIC X(009) VALUE SPACES.
       01  WS-SENIOR-FUNC-SUB              PIC 9(002) VALUE ZEROS.

       01  WS-CRAFT-REQUIRED-TABLE.
           05  WS-CRAFT-REQUIRED-ROW       OCCURS 10 TIMES.
               10  WS-CRAFT-REQUIRED-FL    PIC X(01)  VALUE SPACES.
                   88  WS-CRAFT-REQUIRED              VALUE 'Y'.
               10  WS-CRAFT-CODE           PIC X(02)  VALUE SPACES.

       01  WS-PAGER-GRACE-LINE.
           05  FILLER         PIC X(11) VALUE 'LAST PAGED '.
           05  WS-PG-LAST-DT  PIC X(06) VALUE SPACES.
           05  FILLER         PIC X(04) VALUE ' AT '.
           05  WS-PG-LAST-HR  PIC X(02) VALUE SPACES.
           05  WS-PG-LAST-MN  PIC X(02) VALUE SPACES.
           05  FILLER        PIC X(24) VALUE ' - GRACE PERIOD EXPIRES '.
           05  WS-PG-EXP-DT   PIC X(06) VALUE SPACES.
           05  FILLER         PIC X(04) VALUE ' AT '.
           05  WS-PG-EXP-HR   PIC X(02) VALUE SPACES.
           05  WS-PG-EXP-MN   PIC X(02) VALUE SPACES.

      *    TSQUEUE TO BE WRITTEN WHEN BROWSING FOR HELP
       01  P08-TSQ-ID.
           02  P08-TSQ-TRAN                PIC X(0004) VALUE 'PG08'.
           02  P08-TSQ-TERM                PIC X(0004) VALUE SPACES.
      *C1170 - BEG
      *01  P08-TSQ-LGTH                    PIC S9(004) COMP VALUE +5658.
       01  P08-TSQ-LGTH                    PIC S9(004) COMP VALUE +5758.
      *C1170 - END
       01  P08-TSQ-ITEM                    PIC S9(004) COMP VALUE +1.
       01  P08-TSQ-AREA.
           02  P08-TSQ-DATA                PIC X(3256) VALUE SPACES.
      *CNC0520-END
           02  P08-TSQ-PSTCOMM-AREA        PIC X(0170) VALUE SPACES.
      *C1170 - BEG
      ***  02  P08-TSQ-SCREEN-AREA         PIC X(2080) VALUE SPACES.
           02  P08-TSQ-SCREEN-AREA         PIC X(2180) VALUE SPACES.
      *C1170 - END
           02  P08-TSQ-SAVE-AREA           PIC X(0150) VALUE SPACES.
           02  P08-TSQ-FUNC-SUB            PIC 9(0002) VALUE ZEROS.

       01  WORK-PASS-KEY.
           02  WORK-NAME                   PIC X(0026) VALUE SPACES.
           02  WORK-NUMBER                 PIC X(0009) VALUE SPACES.

       01  JCL-INPUT-CARD.
           02  FILLER                   PIC X     VALUE QUOTE.
           02  JCL-LANG-SUB             PIC 9     VALUE ZERO.
           02  JCL-AH-KEY               PIC X(26) VALUE SPACES.
           02  FILLER                   PIC X     VALUE QUOTE.

      *C892-BEG
       01  WORK-ALT-UFPPOS                        VALUE SPACES.
           05  WK-ALT-UFPPOS-DIST              PIC X(002).
           05  WK-ALT-UFPPOS-SUB-DIST          PIC X(002).
           05  WK-ALT-UFPPOS-POOL              PIC X(002).
           05  WK-ALT-UFPPOS-TERM              PIC X(001).
      *C892-END
      *CNC0555 - BEG
       01  WS-CNTL-PRNTR-FL             PIC X(01) VALUE SPACES.
       01  WS-PRINTER-ID                PIC X(008).
           88 WS-INVALID-PRNTR-ID                 VALUE '    XXXX',
                                                        '   XXXXX',
                                                        '  XXXXXX',
                                                        ' XXXXXXX',
                                                        'XXXXXXXX',
                                                        'XXXXXXX ',
                                                        'XXXXXX  ',
                                                        'XXXXX   ',
                                                        'XXXX    '.
      *CNC0555 - END
      ******************************************************************
      ***                  TEMPORARY STORAGE QUEUE                   ***
      ******************************************************************
       01  P08TSQ-QUEUE-ITEM          PIC S9(4)  COMP VALUE +1.
       01  P08TSQ-MAP-QUEUE-ID.
           05  P08TSQ-MAP-QUEUE       PIC X(4)   VALUE '08M'.
           05  P08TSQ-MAP-TERM-ID     PIC X(4)   VALUE SPACES.
       01  P08TSQ-CA-QUEUE-ID.
           05  P08TSQ-CA-QUEUE        PIC X(4)   VALUE '08C'.
           05  P08TSQ-CA-TERM-ID      PIC X(4)   VALUE SPACES.
       01  P08TSQ-QLGTH               PIC S9(4)  COMP VALUE +1.
      *****************************************************************
      ***                 I/O STATUS CHECK FIELDS
      *****************************************************************
       01  WS-RESPONSE                     PIC S9(008) COMP VALUE ZEROS.
       01  FILE-STATUS                     PIC  9(004) VALUE ZEROS.
           COPY IOCODES.
      *****************************************************************
      ***                      COMMAREA COPYBOOKS
      *****************************************************************
           COPY PSTCOMM.
      *CNC0520-BEG
           COPY P08FCOMM.
           COPY P08DCOMM.
      *CNC0520-END
      *CNC0600-B
           COPY P18CCOMM.
      *CNC0600-E
           COPY P998COMM.
           COPY P997COMM.
           COPY P08CCOMM.
           COPY P08COMM.
           05  P08CA-SCREEN-COMMAREA.
               10  P08CA-LAST-ORG-STATION               PIC X(005).
               10  P08CA-LAST-ASGN                      PIC X(010).
               10  P08CA-CALL-DAY-OF-WEEK               PIC X(001).
               10  P08CA-CALL-DAY-OF-WEEK-NUM REDEFINES
                   P08CA-CALL-DAY-OF-WEEK               PIC 9(001).
               10  P08CA-SCH-CALL-DATE-TIME.
                   15  P08CA-SCH-CALL-DATE              PIC X(006).
                   15  P08CA-SCH-CALL-TIME              PIC X(004).
               10  P08CA-CALL-SET-CODE                  PIC X(001).
                   88  P08CA-CALL-SET                       VALUE 'Y'.
               10  P08CA-COLOR-ARRAY.
                   15  P08CA-ASGN-COLOR                 PIC X(001)
                                                            OCCURS 7.
               10  P08CA-SCREEN-AREA.
                   15  P08CA-SCREEN-ARRAY                   OCCURS 7.
      *C1100 - BEG
                       20  P08CA-ASGN-TYP               PIC X(001).
      *C1100 - END
                       20  P08CA-ASGN-KEY.
                           25  FILLER                   PIC X(004).
                           25  P08CA-ASGN-ID            PIC X(006).
                           25  P08CA-ASGN-CC            PIC X(002).
                       20  P08CA-ASGN-KEY-XB.
                           25  FILLER                   PIC X(024).
                       20  P08CA-JSKEY1                 PIC X(030).
                       20  P08CA-ASGN-STAT-CODE         PIC X(001).
                           88  P08CA-ASGN-SET               VALUE '1'.
                           88  P08CA-ASGN-MU                VALUE '2'
                                                                  '3'.
                           88  P08CA-ASGN-MU-XB             VALUE '3'.
                           88  P08CA-ASGN-IVR-XFER          VALUE '4'.
                           88  P08CA-ASGN-IVR-CONTROL       VALUE '5'.
                           88  P08CA-ASGN-IVR               VALUE '4',
                                                                  '5'.
                       20  P08CA-EMP-NO                 PIC X(009).
                       20  P08CA-REG-EMP-NO             PIC X(009).
                       20  P08CA-VCNY-FLAG              PIC X(001).
                           88  P08CA-ASGN-NO-VCNY           VALUE ' '.
                           88  P08CA-ASGN-IS-VCNY           VALUE '1'.
                           88  P08CA-ASGN-IS-BOTH           VALUE '2'.
                           88  P08CA-ASGN-IS-CLOSED         VALUE '3'.
                           88  P08CA-ASGN-IS-DSPLY-ONLY     VALUE '4'.
                       20  P08CA-DEC-AREA.
                           25  P08CA-DEC-KEY            PIC X(020).
                           25  P08CA-SENR-RESTRICT-FLAG PIC X(001).
                               88  P08CA-SENR-RESTRICTED    VALUE 'Y'.
                           25  P08CA-BLANK-FLAG         PIC X(001).
                               88  P08CA-BLANKABLE-ASGN     VALUE 'Y'.
                           25  P08CA-LAST-POS           PIC X(028).
                           25  P08CA-LAST-SEN           PIC X(008).
                           25  P08CA-LAST-STARTS        PIC X(002).
                           25  P08CA-PRIORITY-ONLY.
                               30  P08CA-PRIOR-ONLY     PIC 9(002).
                           25  P08CA-VCNY-AVLIST-FLAG   PIC X(001).
                               88 P08CA-VCNY-AVLIST         VALUE 'Y'.
                           25  P08CA-FASTSLOW-BOARD     PIC X(001).
                               88  P08CA-FROM-FAST-BOARD    VALUE 'F'.
                               88  P08CA-FROM-SLOW-BOARD    VALUE 'S'.
                       20  P08CA-ASGN-QUAL-AREA.
      *CNC0572 - BEG
      ***                  25  P08CA-ASGN-QUAL              OCCURS 6.
                           25  P08CA-ASGN-QUAL              OCCURS 8.
      *CNC0572 - END
                               30  FILLER               PIC X(001).
                                   88  P08CA-ASGN-QUAL-RSTR VALUE '%'.
                               30  FILLER               PIC X(003).
                       20  P08CA-REST-CODE              PIC X(001).
                           88  P08CA-CALL-TIME              VALUE '1'.
                           88  P08CA-CALL-MINUS-LEAD        VALUE '2'.
                       20  P08CA-TRK-REASON            PIC X(002).
                           88  P08CA-TRK-RJH                VALUE '05'.
                           88  P08CA-TRK-MCALL              VALUE '10'.
                           88  P08CA-TRK-ON-DUTY            VALUE '20'.
                           88  P08CA-TRK-NOT-NOTIFIED       VALUE '25'.
                           88  P08CA-TRK-REQUIRED-REST      VALUE '30'.
                           88  P08CA-TRK-UNAVAIL            VALUE '35'.
                           88  P08CA-TRK-PERS-REST          VALUE '40'.
                           88  P08CA-TRK-NOT-QUALIFIED      VALUE '45'.
                           88  P08CA-TRK-QUICK-TIE          VALUE '50'.
                           88  P08CA-TRK-STARTS             VALUE '55'.
                           88  P08CA-TRK-ASGN-XB-WINDOW     VALUE '65'.
                           88  P08CA-TRK-DONT-TRACK         VALUE '88'.
                           88  P08CA-TRK-UNKNOWN            VALUE '99'.
                   15  P08CA-COND-2BK-FLAG              PIC X(001).
                       88  P08CA-COND-GETS-2BK              VALUE 'Y'.
                   15  P08CA-RJHS-EMPNO                 PIC X(009)
                       OCCURS 7.
               10  P08CA-SCHD-AREA.
                   15  P08CA-SCHD-ARRAY                     OCCURS 7.
                       20  P08CA-SCHD-TYP               PIC X(001).
                           88  P08CA-NO-SCHED               VALUE ' '.
                           88  P08CA-SCHED-TURN             VALUE '1'.
                           88  P08CA-SCHED-POOL             VALUE '2'.
                           88  P08CA-SCHED-MKUP             VALUE '3'.
                           88  P08CA-SCHED-ALT              VALUE '4'.
                           88  P08CA-SCHED-COMPLETE         VALUE '5'.
                           88  P08CA-SCHED-BIDPACK          VALUE '6'.
                           88  P08CA-SCHED-ALT-BIDPACK      VALUE '7'.
                           88  P08CA-NON-BP-WITH-ALT        VALUE '8'.
                           88  P08CA-SCHED-BIDPACK-FIFO     VALUE '9'.
                       20  P08CA-NON-BIDPACK-AREA.
                           25 P08CA-SCHD-KEY            PIC X(020).
                           25 P08CA-SCHD-TURN           PIC X(010).
                           25 P08CA-SCHD-XB-AREA
                              REDEFINES P08CA-SCHD-TURN.
                               30 P08CA-SCHD-XB-DIST    PIC X(002).
                               30 P08CA-SCHD-XB-SDIST   PIC X(002).
                               30 P08CA-SCHD-XB         PIC X(002).
                               30 P08CA-SCHD-XB-TURN    PIC X(004).
                       20  P08CA-BIDPACK-AREA
                           REDEFINES P08CA-NON-BIDPACK-AREA.
                           25  P08CA-BIDPACK-DATA-AREA.
                               30  P08CA-START-DATE-TIME PIC X(012).
                               30  P08CA-CALL-ORDER      PIC X(001).
                               30  P08CA-SEQ             PIC X(003).
                               30  P08CA-EFF-DATE        PIC X(008).
                               30  P08CA-DATA-TURN-ID    PIC X(004).
                           25  FILLER                    PIC X(002).
                       20  P08CA-SCHD-POOL-ID.
                           25  P08CA-SCHD-DIST          PIC X(002).
                           25  P08CA-SCHD-SDIST         PIC X(002).
                           25  P08CA-SCHD-POOL          PIC X(002).
                           25  P08CA-SCHD-TERM          PIC X(001).
      *C1150.1 - BEG
      *                    25  FILLER                   PIC X(002).
                           25  P08CA-HT-CREW-SUPPLY     PIC X(001).
                           25  FILLER                   PIC X(001).
      *C1150.1 - END
                       20  P08CA-SCHD-POOL-ID-ALT.
                           25  P08CA-SCHD-DIST-ALT      PIC X(002).
                           25  P08CA-SCHD-SDIST-ALT     PIC X(002).
                           25  P08CA-SCHD-POOL-ALT      PIC X(002).
                           25  P08CA-SCHD-TERM-ALT      PIC X(001).
                       20  P08CA-SCHD-REST-FLAG         PIC X(001).
                       20  P08CA-SCHD-CATCHUP-DATE      PIC X(005).
                       20  P08CA-SCHD-CATCHUP           PIC X(001).
                       20  P08CA-SCHD-ALT               PIC X(001).
                       20  P08CA-SCHD-DLY               PIC X(001).
                       20  P08CA-SCHD-ALT-USE           PIC X(001).
               10  P08CA-EN-LEAD-TIME                   PIC X(004).
               10  P08CA-TR-LEAD-TIME                   PIC X(004).
               10  P08CA-RESTRICTION-ARRAY.
                   15  P08CA-EMP-RESTR-FLAG        PIC X(001) OCCURS 7.
                       88 P08CA-EMP-RESTRICTED          VALUE '1'.
               10  P08CA-STARTS-AREA OCCURS 7.
                   15  P08CA-STARTS-DISQUAL-FLAG        PIC X(001).
                       88  P08CA-STARTS-DISQUALIFIED    VALUE '1'.
                   15  P08CA-STARTS-TOTAL               PIC 9(003).
               10  P08CA-ASGN-XB-AREA OCCURS 7.
                   15  P08CA-ASGN-XB-DISQUAL-FLAG       PIC X(001).
                       88  P08CA-ASGN-XB-DISQUALIFIED   VALUE '1'.
               10  P08CA-BYPASS-POINTER-AREA OCCURS 7.
                   15  P08CA-BYPASS-POINTER-FLAG        PIC X(001).
                       88  P08CA-BYPASS-POINTER         VALUE '1'.
               10  P08CA-TURNS-RESET-FLAG               PIC X(001).
                   88  P08CA-TURNS-RESET                    VALUE 'Y'.
               10  P08CA-EN-DHD-HOME-FLAG               PIC X(001).
                   88  P08CA-EN-DHD-HOME                    VALUE 'Y'.
               10  P08CA-TR-DHD-HOME-FLAG               PIC X(001).
                   88  P08CA-TR-DHD-HOME                    VALUE 'Y'.
      *TJR 03/01/2001 NEW COMMAREA FIELDS
               10  P08CA-USER-ENTERED-DATE-TIME OCCURS 7 TIMES.
                   15  P08CA-USER-ENTERED-DATE          PIC X(006).
                   15  P08CA-USER-ENTERED-TIME          PIC X(004).
               10  P08CA-SCREEN-SAVED-DATE-TIME OCCURS 7 TIMES.
                   15  P08CA-SCREEN-SAVED-DATE          PIC X(006).
                   15  P08CA-SCREEN-SAVED-TIME          PIC X(004).
               10  P08CA-USER-OVERRIDE-ARRAY OCCURS 7.
                   15  P08CA-USER-OVERRIDE-FLAG         PIC X(001).
                       88  P08CA-USER-OVERRIDE              VALUE 'Y'.
               10  P08CA-HOS-FLAG OCCURS 7 TIMES PIC X(001).
                   88  P08CA-HOS-EXEMPT                 VALUE 'Y'.
                   88  P08CA-NOT-HOS-EXEMPT             VALUE 'N' ' '.
               10  P08CA-REST-STATUS OCCURS 7 TIMES PIC X(001).
                   88  P08CA-REST-GREEN                 VALUE 'G'.
                   88  P08CA-REST-YELLOW                VALUE 'Y'.
                   88  P08CA-REST-RED                   VALUE 'R'.
               10  P08CA-RESUB-FLAG  OCCURS 7 TIMES PIC X(001).
                   88  P08CA-RESUB                      VALUE 'Y'.
               10  P08CA-PRE-CALL-TOC-KEY           PIC X(026).
               10  P08CA-EMP-RESTED-FL OCCURS 7 TIMES PIC X(001).
                   88  P08CA-EMP-RESTED-YES             VALUE 'Y'.
                   88  P08CA-EMP-RESTED-NO              VALUE 'N'.
               10  P08CA-CALL-COMPLETE-FLAG         PIC X(001).
               10  P08CA-CALL-COMPLETE-TOPC         PIC X(001).
      *#1505
               10  P08CA-NO-PHONE-FL OCCURS 7 TIMES PIC X(001).
                   88  P08CA-NO-PHONE-YES               VALUE 'Y'.
      *#1503
               10  P08CA-NOT-RESTED-FL OCCURS 7 TIMES PIC X(001).
                   88  P08CA-NOT-RESTED                 VALUE 'Y'.
               10  FILLER                           PIC X(004).
      *C1170 - BEG
               10  P08CA-SV-ALT-SCHD-ARRAY.
                   15  P08CA-SV-ALT-SCHD-ARRAY OCCURS 7.
                       20  P08CA-SV-ALT-POOL-ID.
                           25  P08CA-SV-ALT-DIST    PIC X(002).
                           25  P08CA-SV-ALT-SDIST   PIC X(002).
                           25  P08CA-SV-ALT-POOL    PIC X(002).
                           25  P08CA-SV-ALT-TERM    PIC X(001).
      *CNC0600-B
      *        10  FILLER                           PIC X(051).
               10  P08CA-HOSO-ALLOW-FL OCCURS 7 TIMES PIC X(001).
                   88  P08CA-HOSO-ALLOW                 VALUE 'Y'.
               10  P08CA-HOSO-DONE-FL  OCCURS 7 TIMES PIC X(001).
                   88  P08CA-HOSO-DONE                  VALUE 'Y'.
      *CNC0600-E
      *CNLD-330-B
      *        10  FILLER                           PIC X(037).
               10  P08CA-SHOW-JOB-FL   OCCURS 7 TIMES PIC X(001).
                   88  P08CA-SHOW-JOB                   VALUE 'Y'.
                   88  P08CA-SHOW-JOB-NOT               VALUE 'N'.
               10  FILLER                           PIC X(030).
      *CNLD-330-E
      *C1170 - END
           05  P08CA-SAVE-COMMAREA                      VALUE SPACES.
               10  P08CA-SAVE-OD-DTTM OCCURS 7 TIMES.
                   15  P08CA-SAVE-OD-DATE           PIC X(006).
                   15  P08CA-SAVE-OD-TIME           PIC X(004).
               10  P08CA-SAVE-TAXI-TIME  OCCURS 7 TIMES.
                   15  P08CA-SAVE-TAXI-TM           PIC X(004).
               10  P08CA-SAVE-CBCK-FLAG  OCCURS 7 TIMES
                                                    PIC X(001).
               10  P08CA-SAVE-CREW-RPT-LOCATION     PIC X(005).
               10  P08CA-SAVE-ALLOW-VCLL-FL         PIC X(001).
      *CNC0579 - BEG
      ***      10  FILLER                           PIC X(039).
               10  P08CA-DEC-RPT-LOCATION OCCURS 7 TIMES
                                                    PIC X(005).
               10  FILLER                           PIC X(004).
      *CNC0579 - END
      *****************************************************************
      ***                     MAP AREA COPYBOOK
      *****************************************************************
           COPY PSM08RE.
      *****************************************************************
      ***                   PROGRAM NAMES COPYBOOKS
      *****************************************************************
           COPY PSTCB03.
           COPY PSTCB03A.
           COPY PSTCB04S.
           COPY PSTCB08.
           COPY PSTCB08C.
           COPY PSTCB08S.
           COPY PSTCB997.
           COPY PSTCB998.
      *CNC0520-BEG
           COPY PSTCB08F.
           COPY PSTCB08D.
      *CNC0520-END
      *CNC0600-B
           COPY PSTCB18C.
      *CNC0600-E
           COPY PSTBATCH.
      *****************************************************************
      ***                 CALLED ROUTINES COPYBOOKS.
      *****************************************************************
           COPY PSTERAR.
           COPY P902COMM.
           COPY P903COMM.
           COPY P906COMM.
           COPY P909COMM.
           COPY P915COMM.
           COPY P916COMM.
           COPY P917COMM.
           COPY P921COMM.
           COPY P922COMM.
           COPY P923COMM.
           COPY P925COMM.
           COPY P926COMM.
           COPY P927COMM.
           COPY P930COMM.
           COPY P931COMM.
           COPY P932COMM.
           COPY PS32COMM.
           COPY P938COMM.
           COPY P942COMM.
           COPY P943COMM.
           COPY P947COMM.
           COPY P980COMM.
           COPY PS42COMM.
           COPY PS52COMM.
           COPY PS94COMM.
           COPY P0ESCOMM.
      *****************************************************************
      ***                     FILE COPYBOOKS
      *****************************************************************
           COPY WSAHIST.
           COPY WSAHMISC.
           COPY WSAJ.
           COPY WSASGN.
           COPY WSCARR.
           COPY WSCNTL.
           COPY WSDEC.
           COPY WSEMPTRK.
           COPY WSJHIST.
           COPY WSJS.
           COPY WSMSTR.
           COPY WSMSTR2.
           COPY WSMSTR3.
           COPY WSTELE.
           COPY WSQUAL.
           COPY WSSCHED.
           COPY WSSEN.
           COPY WSSWASGN.
           COPY WSTASK.
           COPY WSTKCR.
           COPY WSTRCN.
           COPY WSUFP.
           COPY WSVRUINF.
      *C983-BEG
           COPY WSPOINTR.
      *C983-END
           EXEC SQL INCLUDE TOCV     END-EXEC.
           EXEC SQL INCLUDE TOCWS    END-EXEC.

           EXEC SQL INCLUDE IERV     END-EXEC.
           EXEC SQL INCLUDE IERWS    END-EXEC.

           EXEC SQL INCLUDE IEPV     END-EXEC.
           EXEC SQL INCLUDE IEPWS    END-EXEC.

           EXEC SQL INCLUDE LVPV     END-EXEC.
           EXEC SQL INCLUDE LVPWS    END-EXEC.

           EXEC SQL INCLUDE LVEV     END-EXEC.
           EXEC SQL INCLUDE LVEWS    END-EXEC.

           EXEC SQL INCLUDE HSTV     END-EXEC.
           EXEC SQL INCLUDE HSTWS    END-EXEC.
      *CNC0520-BEG
           EXEC SQL INCLUDE LSPV     END-EXEC.
           EXEC SQL INCLUDE LSPWS    END-EXEC.

           EXEC SQL INCLUDE LSDV     END-EXEC.
           EXEC SQL INCLUDE LSDWS    END-EXEC.

           EXEC SQL INCLUDE TRRV     END-EXEC.
           EXEC SQL INCLUDE TRRWS    END-EXEC.

      *CNC0520-END
      *****************************************************************
      ***                     MISC. COPYBOOKS
      *****************************************************************
           COPY PSTKEYS.
           COPY PSTATTR.
           COPY WSBIF.
           COPY WSMSG.
           COPY WSEDDATE.
           COPY WSEDTIME.
           COPY WSCENTER.
           COPY PSTCCRFT.
           COPY WSZONE.
           COPY WSSYDTTM.
           COPY WSAJDEFN.
           COPY WSMSCALL.
           COPY WSBUFFER.
           COPY WSZAP.
           COPY CALLFUNC.
           COPY WSEMCALL.
           EXEC SQL INCLUDE SQLCA    END-EXEC.
           EXEC SQL INCLUDE WSCOMMON END-EXEC.

       LINKAGE SECTION.
       01  DFHCOMMAREA.
           05  LINK-COMM-A          PIC X(170).
      *C1170 - BEG
      ***  05  LINK-COMM-B          PIC X(2080).
           05  LINK-COMM-B          PIC X(2180).
      *C1170 - END
           05  LINK-COMM-C          PIC X(0150).

       PROCEDURE DIVISION.
      *
       P0000-MAINLINE.
      *
      *
           EXEC CICS IGNORE CONDITION
                     ERROR
           END-EXEC
           EXEC CICS HANDLE ABEND
                     LABEL(P9999-GOT-PROBLEM)
           END-EXEC
           COPY ABSTIME.
           IF EIBCALEN = ZERO
              PERFORM P9990-CLEAR-SCREEN
           END-IF
           IF EIBCALEN > PSTCOMM-LGTH
              MOVE LINK-COMM-A TO PSTCOMM-AREA
              MOVE LINK-COMM-B TO P08CA-SCREEN-COMMAREA
              MOVE LINK-COMM-C TO P08CA-SAVE-COMMAREA
           ELSE
              MOVE LINK-COMM-A TO PSTCOMM-AREA
              MOVE SPACES TO P08CA-SCREEN-COMMAREA
                             P08CA-SAVE-COMMAREA
           END-IF
           EXEC CICS ASKTIME
                     ABSTIME(WS-ABSTIME)
           END-EXEC
           ADD WS-ABSTIME-OFFSET  TO WS-ABSTIME
           EXEC CICS FORMATTIME
                     ABSTIME(WS-ABSTIME)
                     YYYYMMDD(WS-SYSTEM-DATE-CENT)
                     TIME(WS-SYSTEM-TIME-AREA)
           END-EXEC

           MOVE EIBAID   TO PF-CHECK

      *
      *    INSTALL APPLICATION DATE/TIME
      *
           IF PSTCA-DATE-TIME-OFFSET > SPACES
              MOVE ZEROS          TO DATE-CONVERSION-PARMS
              MOVE WS-SYSTEM-DATE TO PARM-PRI-DATE-GREG
              MOVE WS-SYSTEM-TIME TO PARM-PRI-HRMN
              PERFORM P9810-PROCESS-OFFSET
              MOVE PARM-RES-DATE-GREG
                                  TO WS-SYSTEM-DATE
              MOVE PARM-RES-GREG-CENT
                                  TO WS-SYSTEM-CENT
              MOVE PARM-RES-HRMN
                                  TO WS-SYSTEM-TIME
           END-IF
      *
      *       CONVERT SYSTEM DATE/TIME TO LOCAL DATE/TIME
      *
           MOVE SPACES                  TO TZ-PARAMETERS
           MOVE TZ-SYSTEM-TIME-ZONE     TO TZ-IN-ZONE
           MOVE WS-PRESENT-TIME         TO TZ-IN-DATE-TIME
           MOVE PSTCA-TIME-ZONE         TO TZ-OUT-ZONE
           PERFORM P8996-TIMEZONE
           IF TZ-INVALID-PARAMETERS
              MOVE '000003'             TO ERR-PARAGRAPH
              PERFORM P8996-TZERROR
           END-IF
           MOVE TZ-OUT-DATE-TIME-CENT   TO WS-LOCAL-DATE-TIME-CENT
      *
      *
           MOVE WS-SYSTEM-DATE-TIME TO WORK-HIST-TIME
           MOVE ZEROS TO WORK-HIST-TIME-TIE
      *
           IF EIBTRNID NOT = P08-TRAN
              SET CREATE-SCREEN          TO TRUE
              MOVE LOW-VALUES            TO PSTS08

              IF EIBTRNID                      = P08C-TRAN
                 MOVE P08CA-PRE-CALL-WITH-TOC-FL
                                         TO WS-PRE-CALL-WITH-TOC-FL
      *          PERFORM P7010-READ-TSQUEUE
                 PERFORM P9600-READ-TSQUEUE
                 MOVE LOW-VALUES            TO PSTS08
                 MOVE P08-TSQ-DATA          TO PSTS08
                 EXEC CICS DELETEQ TS
                           QUEUE(P08-TSQ-ID)
                 END-EXEC
                 MOVE P08-TSQ-PSTCOMM-AREA  TO PSTCOMM-AREA
                 MOVE P08-TSQ-SCREEN-AREA   TO P08CA-SCREEN-COMMAREA
                 MOVE P08-TSQ-SAVE-AREA     TO P08CA-SAVE-COMMAREA
                 MOVE WS-PRE-CALL-WITH-TOC-FL
                                         TO P08CA-PRE-CALL-WITH-TOC-FL
                 PERFORM P9050-RESET-ATTRIBUTES
                 IF WS-PRE-CALL-WITH-TOC
                    PERFORM P0020-GET-TOPC-COMMENTS
                 ELSE
                    MOVE SPACES          TO P08CA-PRE-CALL-TOC-KEY
                 END-IF
                 MOVE SPACES           TO SCR08-ERRORMSG
                 MOVE -1               TO SCR08-FUNC-CURSOR(1)
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF

              IF EIBTRNID                      = P998-TRAN
                 MOVE P998CA-CURSOR-POS       TO EIBCPOSN
                 PERFORM P7010-READ-TSQUEUE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF

              IF EIBTRNID = P997-TRAN
                 PERFORM P9600-READ-TSQUEUE
                 MOVE LOW-VALUES            TO PSTS08
                 MOVE P08-TSQ-DATA          TO PSTS08
                 EXEC CICS DELETEQ TS
                           QUEUE(P08-TSQ-ID)
                 END-EXEC
                 IF P997CA-RECORD-SELECTED
                    MOVE P997CA-PASS-KEY       TO WORK-PASS-KEY
                    MOVE P08-TSQ-PSTCOMM-AREA  TO PSTCOMM-AREA
                    MOVE P08-TSQ-SCREEN-AREA   TO P08CA-SCREEN-COMMAREA
                    MOVE P08-TSQ-SAVE-AREA     TO P08CA-SAVE-COMMAREA
                    PERFORM P9050-RESET-ATTRIBUTES
                    MOVE 'HELP'       TO SCR08-FUNC(P08-TSQ-FUNC-SUB)
                    MOVE WORK-NAME    TO SCR08-NAME(P08-TSQ-FUNC-SUB)
                    MOVE -1     TO SCR08-FUNC-CURSOR(P08-TSQ-FUNC-SUB)
      *                  'PRESS ENTER TO PROCESS HELP'
                    MOVE 'P167'                TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 ELSE
                    MOVE P08-TSQ-PSTCOMM-AREA  TO PSTCOMM-AREA
                    MOVE P08-TSQ-SCREEN-AREA   TO P08CA-SCREEN-COMMAREA
                    MOVE P08-TSQ-SAVE-AREA     TO P08CA-SAVE-COMMAREA
                    PERFORM P9050-RESET-ATTRIBUTES
                    MOVE SPACES           TO SCR08-ERRORMSG
                    MOVE -1               TO SCR08-FUNC-CURSOR(1)
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              END-IF
      *CNC0520-BEG
              IF EIBTRNID = P08F-TRAN
                 PERFORM P9600-READ-TSQUEUE
                 MOVE LOW-VALUES                TO PSTS08
                 MOVE P08-TSQ-DATA              TO PSTS08
                 EXEC CICS DELETEQ TS
                           QUEUE(P08-TSQ-ID)
                 END-EXEC
                 MOVE PSTCA-VARIABLE-AREA(19:5) TO WS-ROUTE-DSGN
                 MOVE P08-TSQ-SCREEN-AREA       TO P08CA-SCREEN-COMMAREA
                 MOVE P08-TSQ-SAVE-AREA         TO P08CA-SAVE-COMMAREA
                 PERFORM P9050-RESET-ATTRIBUTES
                 MOVE SPACES                    TO SCR08-ERRORMSG
      *          MOVE YELLOW                    TO SCR08-ERRORMSG-COL
                 MOVE -1                        TO SCR08-FUNC-CURSOR(1)
                 IF  WS-ROUTE-DSGN > SPACES
                 AND WS-ROUTE-DSGN NOT = SCR08-ROUTE-DSGN
      *             'PRESS ENTER TO PROCESS NEW ROUTE DESIGNATION'
                    MOVE 'P279'                 TO MSGLOG-CODE
                 END-IF
                 IF WS-ROUTE-DSGN > SPACES
                    MOVE WS-ROUTE-DSGN          TO SCR08-ROUTE-DSGN
                 END-IF
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
              IF EIBTRNID = P08D-TRAN
                 PERFORM P9600-READ-TSQUEUE
                 MOVE LOW-VALUES                TO PSTS08
                 MOVE P08-TSQ-DATA              TO PSTS08
                 EXEC CICS DELETEQ TS
                           QUEUE(P08-TSQ-ID)
                 END-EXEC
                 MOVE P08-TSQ-PSTCOMM-AREA      TO PSTCOMM-AREA
                 MOVE P08-TSQ-SCREEN-AREA       TO P08CA-SCREEN-COMMAREA
                 MOVE P08-TSQ-SAVE-AREA         TO P08CA-SAVE-COMMAREA
                 PERFORM P9050-RESET-ATTRIBUTES
                 MOVE SPACES                    TO SCR08-ERRORMSG
      *          MOVE YELLOW                    TO SCR08-ERRORMSG-COL
                 MOVE -1                        TO SCR08-FUNC-CURSOR(1)
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
      *CNC0520-END
      *CNC0600-B
              IF EIBTRNID = P18C-TRAN
                 PERFORM P9600-READ-TSQUEUE
                 MOVE LOW-VALUES                TO PSTS08
                 MOVE P08-TSQ-DATA              TO PSTS08
                 EXEC CICS DELETEQ TS
                           QUEUE(P08-TSQ-ID)
                 END-EXEC
                 MOVE P08-TSQ-PSTCOMM-AREA      TO PSTCOMM-AREA
                 MOVE P08-TSQ-SCREEN-AREA       TO P08CA-SCREEN-COMMAREA
                 MOVE P08-TSQ-SAVE-AREA         TO P08CA-SAVE-COMMAREA
                 SET P08CA-HOSO-DONE(P08-TSQ-FUNC-SUB)
                                                TO TRUE

                 PERFORM P9050-RESET-ATTRIBUTES
                 MOVE RED       TO SCR08-NAME-COL(P08-TSQ-FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-NAME-HI(P08-TSQ-FUNC-SUB)
      *          EMP HOS OVERRIDE COMPLETE, ENTER FUNCTION DESIRED
                 MOVE 'E370'    TO MSGLOG-CODE
                 MOVE -1        TO SCR08-FUNC-CURSOR(P08-TSQ-FUNC-SUB)
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
      *CNC0600-E

              IF P08CA-TASK-KEY > SPACES
                 PERFORM P8700-READ-P08CA-TASK
                 IF  SUCCESS
                 AND TASK-USE-TOPC-AREA
                    PERFORM P8750-WRITE-TOPC-VRUINFO
                 END-IF
              END-IF
              IF  NOT P08CA-SETBACK-CALL
              AND EIBTRNID = (P03A-TRAN OR P04S-TRAN)
              AND (TASK-ORDER-VX OR TASK-VRU-CALL-INIT)
                 SET P08CA-ORDER-VX       TO TRUE
                 SET P08CA-TURNS-RESET    TO TRUE
                 PERFORM P0005-ORDER-INITIAL-DSPLY
                 PERFORM P0101-INIT-MISC-MSG
                 IF YARD-CALL OR LOCAL-CALL
                    PERFORM P0210-FIND-ASSIGNED-CREW
                    PERFORM P0215-FIND-REMAIN-ASGNMTS
                    PERFORM P0260-SYNC-VRUINFO
                    PERFORM P1021-SET-VRU-CALL-ATTR
                 ELSE
                    PERFORM P0310-SETUP-DISPLAY
                    PERFORM P0330-FIND-UNASSIGNED-CREW
                    PERFORM P1021-SET-VRU-CALL-ATTR
                 END-IF
              ELSE
                 IF YARD-CALL
                 AND NOT P08CA-SETBACK-CALL
                    MOVE PSTCA-DIST       TO SCR08-DIST
                    MOVE PSTCA-SUB-DIST   TO SCR08-SUB-DIST
                    PERFORM P8050-GET-TIME-ZONE
                    MOVE -1               TO SCR08-ORG-STATION-CURSOR
                    MOVE SPACES           TO SCR08-ASGN-TYPE
                                             SCR08-DH-RSN
                                             SCR08-SIDE-TRIP-HDR1
                                             SCR08-SIDE-TRIP-HDR2
                                             SCR08-SIDE-TRIP-HDR3
      *CNC0520-BEG
                                             SCR08-ROUTE-DSGN-H1
                                             SCR08-ROUTE-DSGN-H2
                                             SCR08-ROUTE-DSGN-H3
      *CNC0520-END
                    MOVE AUTOSKIP-MDT     TO SCR08-ASGN-TYPE-ATTR
                                             SCR08-CALL-COMPLETE-ATTR
                                             SCR08-DH-RSN-ATTR
                                             SCR08-SIDE-TRIP-ATTR
      *CNC0520-BEG
                                             SCR08-ROUTE-DSGN-ATTR
      *CNC0520-END
                    PERFORM P5110-IVR-PFKEY-EDITS
                    PERFORM P0010-LOAD-FUNCTIONS-PFKEYS
      *                  'ENTER ORIGIN STATION, ASSIGNMENT '
      *                  'ID - PRESS ENTER TO OBTAIN CREW'
                    MOVE 'E034' TO MSGLOG-CODE
                 END-IF
              END-IF
              IF YARD-CALL
                 CONTINUE
              ELSE
                 PERFORM P0005-ORDER-INITIAL-DSPLY
                 MOVE -1                 TO SCR08-ASGN-CURSOR
              END-IF
              IF P08CA-TASK-KEY            > SPACES
                 PERFORM P0020-GET-TOPC-COMMENTS
              END-IF
              IF NOT P08CA-SETBACK-CALL
                 PERFORM P9000-SEND-MAP-AND-RETURN
              ELSE
                 SET ENTER-KEY            TO TRUE
                 SET WS-SETBACK-CALL      TO TRUE
              END-IF
           ELSE
              IF P08CA-SETBACK-CALL
                 PERFORM P8700-READ-P08CA-TASK
              END-IF
           END-IF
           IF EXIT-KEY
              MOVE EIBTRMID    TO P08-TSQ-TERM
              EXEC CICS DELETEQ TS
                        QUEUE(P08-TSQ-ID)
                        RESP(WS-RESPONSE)
              END-EXEC
              PERFORM P8030-DELETE-MU-ASGN
              IF P08CA-TASK-KEY > SPACES
                 PERFORM P8700-READ-P08CA-TASK
                 IF  SUCCESS
                 AND TASK-USE-TOPC-AREA
                    PERFORM P8760-DELETE-TOPC-VRUINFO
                 END-IF
              END-IF
              IF P08CA-PRE-CALL-WITH-TOC
                 INITIALIZE WS-TOC-STORAGE
                 IF P08CA-TASK-KEY > SPACES
      *             PERFORM P8700-READ-P08CA-TASK
                    IF TASK-TOPC-TRAIN-SYM NOT > SPACES
                       MOVE P08CA-TASK-KEY         TO TOC-TASK-KEY
                    END-IF
                 ELSE
                    IF P08CA-PRE-CALL-TOC-KEY > SPACES
                       MOVE P08CA-PRE-CALL-TOC-KEY TO TOC-TASK-KEY
                    END-IF
                 END-IF
                 IF TOC-TASK-KEY > SPACES
                    PERFORM PSQL-TOCDEL01
                 END-IF
              END-IF
              IF PSTCA-FROM-PROGRAM = P03A-PGM
              AND P08CA-ORDER-VX
                 PERFORM P9130-SETUP-SCR03A
              ELSE
                 IF PSTCA-FROM-PROGRAM = P04S-PGM
                 AND P08CA-ORDER-VX
                    PERFORM P9140-SETUP-SCR04S
                 ELSE
                    IF YARD-CALL
                       PERFORM P9110-SETUP-SCR08S
                    ELSE
                       IF PSTCA-FROM-PROGRAM = P03A-PGM
                          PERFORM P9130-SETUP-SCR03A
                       ELSE
                          PERFORM P9100-SETUP-SCR03
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF
           PERFORM P0100-PROCESS-INPUT.
      *
       P0005-ORDER-INITIAL-DSPLY.
      *
           MOVE AUTOSKIP-MDT                 TO SCR08-ORG-STATION-ATTR
           MOVE P08CA-PROFILE-KEY            TO TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           MOVE 25                           TO CTXT-UNF-FIELD-LEN
           MOVE TRCN-DESCRIPTION             TO CTXT-UNF-FIELD
           PERFORM P8994-CENTER-TEXT
           MOVE CTXT-FOR-FIELD               TO SCR08-TITLE
      *    MOVE -1                           TO SCR08-ASGN-CURSOR
      *---------------------------------------------------------------*
      *    CONVERT PSTCA-TIMEZONE        TO PROFILE TIME-ZONE         *
      *---------------------------------------------------------------*
           MOVE TRCN-DIST                    TO SCR08-DIST
           MOVE TRCN-SDIST                   TO SCR08-SUB-DIST
           MOVE SPACES                       TO TZ-PARAMETERS
           MOVE PSTCA-TIME-ZONE              TO TZ-IN-ZONE
           PERFORM P8050-GET-TIME-ZONE
           IF P08CA-ORDER-DATE-TIME > SPACE
              MOVE P08CA-ORDER-DATE-TIME     TO TZ-IN-DATE-TIME
              MOVE PSTCA-TIME-ZONE           TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000001' TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE               TO SCR08-ORDER-DATE
              MOVE TZ-OUT-TIME               TO SCR08-ORDER-TIME
           ELSE
              MOVE WS-PRESENT-TIME           TO TZ-IN-DATE-TIME
              MOVE TZ-SYSTEM-TIME-ZONE TO TZ-IN-ZONE
              MOVE PSTCA-TIME-ZONE           TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000002' TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE               TO SCR08-ORDER-DATE
              MOVE TZ-OUT-TIME               TO SCR08-ORDER-TIME
           END-IF
           MOVE TRCN-ORIGIN-STN              TO SCR08-ORG-STATION
           MOVE TRCN-TRAIN-ASGN              TO SCR08-PROFILE
           MOVE TRCN-ROUTE-DESIGNATION       TO SCR08-ROUTE-DSGN
           PERFORM P5110-IVR-PFKEY-EDITS
           PERFORM P0010-LOAD-FUNCTIONS-PFKEYS
           MOVE P08CA-DH-RSN                 TO SCR08-DH-RSN
           IF P08CA-TRAIN > SPACE
              MOVE P08CA-TRAIN(1:8)          TO SCR08-ASGN
              MOVE P08CA-TRAIN(9:2)          TO SCR08-ASGN-TYPE
           ELSE
              MOVE P08CA-TRAIN-PROFILE TO SCR08-ASGN
           END-IF
           IF MSGLOG-CODE NOT = 'E335'
           IF SCR08-ORDER-DATE > SPACES
              AND SCR08-ORDER-TIME > SPACES
      *              'MODIFY TRAIN ID, ORDER DATE/TIME '
      *              'IF DESIRED - '
      *              'ENTER TO OBTAIN CREW'
              MOVE 'M018' TO MSGLOG-CODE
           ELSE
      *        'MODIFY TRAIN ID IF DESIRED, '
      *        'ENTER ORDER DATE/TIME - '
      *        'ENTER TO OBTAIN CREW'
              MOVE 'M017' TO MSGLOG-CODE
           END-IF
           END-IF
           IF YARD-CALL
              MOVE AUTOSKIP-MDT        TO SCR08-ASGN-TYPE-ATTR
                                          SCR08-CALL-COMPLETE-ATTR
                                          SCR08-DH-RSN-ATTR
                                          SCR08-SIDE-TRIP-ATTR
      *CNC0520-BEG
                                          SCR08-ROUTE-DSGN-ATTR
      *CNC0520-END
           END-IF
           .
      *
       P0010-LOAD-FUNCTIONS-PFKEYS.
      *
           MOVE SPACES TO WS-FORMAT-FUNCTIONS
           MOVE 1 TO SUB1
           MOVE ZEROS TO SUB2
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > WS-FUNCTION-TABLE-SIZE
              IF WS-FUNC-CODE(FUNC-SUB) > SPACES
                 IF   WS-FUNC-IS-DISPLAYED(FUNC-SUB)
                 AND ((P08CA-IVR-CALL-ACTIVE
                 AND ((YARD-CALL         AND IVR-YARD-USAGE (FUNC-SUB))
                  OR  (LOCAL-CALL        AND IVR-LOCAL-USAGE(FUNC-SUB))
                  OR  (UFP-CALL          AND IVR-UFP-USAGE  (FUNC-SUB))
                  OR  (ROAD-SERVICE-CALL AND IVR-ROAD-USAGE(FUNC-SUB))))
                  OR (YARD-CALL          AND YARD-USAGE     (FUNC-SUB))
                  OR (LOCAL-CALL         AND LOCAL-USAGE    (FUNC-SUB))
                  OR (UFP-CALL           AND UFP-USAGE      (FUNC-SUB))
                  OR (ROAD-SERVICE-CALL  AND ROAD-USAGE     (FUNC-SUB)))
                    IF  SUB2          NOT  = 0
                    AND SUB2          NOT  = FUNC-ARRAY-MAX
                       MOVE '-'           TO WS-FORMAT-DASH(SUB1, SUB2)
                    END-IF
                    ADD  1                TO SUB2
                    IF SUB2                > FUNC-ARRAY-MAX
                       ADD  1             TO SUB1
                       MOVE 1             TO SUB2
                       IF SUB1             > 3
                          MOVE WS-FUNCTION-TABLE-SIZE TO FUNC-SUB
                       ELSE
                          MOVE WS-FUNC-CODE(FUNC-SUB)
                                          TO WS-FORMAT-FUNC(SUB1, SUB2)
                       END-IF
                    ELSE
                       MOVE WS-FUNC-CODE(FUNC-SUB)
                                          TO WS-FORMAT-FUNC(SUB1, SUB2)
                    END-IF
                 END-IF
              ELSE
                 PERFORM VARYING WS-MC-SUB FROM 1 BY 1
                   UNTIL WS-MC-SUB > WS-MC-MAX
                    IF WS-MISS-CALL-CODE(WS-MC-SUB) > SPACES
                       IF SUB2 NOT = 0
                          MOVE '-' TO WS-FORMAT-DASH(SUB1, SUB2)
                       END-IF
                       ADD 1 TO SUB2
                       IF SUB2 > FUNC-ARRAY-MAX
                          ADD 1 TO SUB1
                          MOVE 1 TO SUB2
                          IF SUB1 > 2
                             MOVE WS-FUNCTION-TABLE-SIZE TO FUNC-SUB
                             MOVE WS-MC-MAX              TO WS-MC-SUB
                          ELSE
                             MOVE WS-MISS-CALL-CODE(WS-MC-SUB)
                                   TO WS-FORMAT-FUNC(SUB1, SUB2)
                          END-IF
                       ELSE
                          MOVE WS-MISS-CALL-CODE(WS-MC-SUB)
                                   TO WS-FORMAT-FUNC(SUB1, SUB2)
                       END-IF
                    END-IF
                 END-PERFORM
                 MOVE WS-FUNCTION-TABLE-SIZE TO FUNC-SUB
              END-IF
           END-PERFORM

           MOVE WS-FORMAT-FUNC-DETAIL(1) TO SCR08-FUNC1
           MOVE WS-FORMAT-FUNC-DETAIL(2) TO SCR08-FUNC2
           MOVE WS-FORMAT-FUNC-DETAIL(3) TO SCR08-FUNC3

           IF YARD-CALL
              IF P08CA-IVR-CALL-ACTIVE
                 IF PSTCA-SUB = 1
                    MOVE ' ENTER=PROCESS F1=HELP  F3=EXIT   F5=IVR CALL
      -                  '  F10=BROWSE   F12=NEXT JOB  '
                                                 TO SCR08-PFKEYS
                 ELSE
                    MOVE ' ENTER=EXECUTION F1=AIDE F3=SORTIE F5=IVR CALL
      -                  '  F10=LECT  F12=POSTE SUIVANT'
                                                 TO SCR08-PFKEYS
                 END-IF
              ELSE
                 IF PSTCA-SUB = 1
                    MOVE '       ENTER=PROCESS   F1=HELP   F3=EXIT   F10
      -                  '=BROWSE   F12=NEXT JOB       '
                                                 TO SCR08-PFKEYS
                 ELSE
                    MOVE '  ENTER=EXECUTION   F1=AIDE   F3=SORTIE   F10=
      -                  'LECT   F12=POSTE SUIVANT     '
                                                 TO SCR08-PFKEYS
                 END-IF
              END-IF
           ELSE
              IF P08CA-IVR-CALL-ACTIVE
                 IF PSTCA-SUB = 1
      *CNC0520-BEG
                    MOVE ' ENTER=PROCESS F1=HELP F3=EXIT F5=IVR CALL PF6
      -                  '=ALT ROUTES F10=BROWSE F11=CMNTS'
      *CNC0520-END
                                                 TO SCR08-PFKEYS
                 ELSE
      *CNC0520-BEG
                    MOVE ' ENTER=EXECUTION F1=AIDE F3=SORTIE F5=IVR CALL
      -                  ' F6=ALT ROUTES F10=LECT F11=CMNTS'
      *CNC0520-END
                                                 TO SCR08-PFKEYS
                 END-IF
              ELSE
                 IF PSTCA-SUB = 1
                    MOVE '              ENTER=PROCESS   F1=HELP   F3=EXI
      -                  'T   F10=BROWSE               '
                                                 TO SCR08-PFKEYS
                 ELSE
                    MOVE '            ENTER=EXECUTION   F1=AIDE   F3=SOR
      -                  'TIE   F10=LECT               '
                                                 TO SCR08-PFKEYS
                 END-IF
              END-IF
           END-IF
           .
      *
       P0020-GET-TOPC-COMMENTS.
      *
           INITIALIZE WS-TOC-STORAGE
           IF P08CA-TASK-KEY > SPACES
              MOVE P08CA-TASK-KEY             TO TOC-TASK-KEY
           ELSE
              MOVE P08CA-PRE-CALL-TOC-KEY     TO TOC-TASK-KEY
           END-IF
           PERFORM PSQL-TOCSEL01
           IF SQL-SUCCESS
              MOVE TOC-COMMENTS-TEXT        TO SCR08-CALL-COMMENTS
              MOVE REV-VIDEO                TO SCR08-CALL-COMMENTS-HI
              MOVE AUTOSKIP-BRIGHT          TO SCR08-CALL-COMMENTS-ATTR
      *    ELSE
      *       MOVE SPACES                   TO SCR08-CALL-COMMENTS
           END-IF
           .
      *
       P0100-PROCESS-INPUT.
      *
      * 9/14/10 IF A TOPC TASK AND NO CALL OR VCLL HAS BEEN PERFORMED
      *    WITHIN 15 MINUTES OF EXECUTING THE TASK, NEED TO START OVER
      *    AND EXECUTE THE TASK AGAIN.
           MOVE SPACE                   TO TOPC-CALL-IN-PROCESS-FL
           IF P08CA-TASK-KEY > SPACES
              PERFORM P8700-READ-P08CA-TASK
              IF  SUCCESS
              AND TASK-USE-TOPC-AREA
                 PERFORM VARYING SUB1 FROM 1 BY 1
                    UNTIL SUB1 > ARRAY-MAX
                    IF SCR08-CC(SUB1) > SPACES
                       MOVE SCR08-FUNC(SUB1) TO WS-FUNCTION-CODE
                       IF CALL-FUNCTION
                       OR IVR-CALL-FUNCTION
                          SET TOPC-CALL-IN-PROCESS  TO TRUE
                          MOVE ARRAY-MAX TO SUB1
                       END-IF
                    END-IF
                 END-PERFORM
                 IF NOT TOPC-CALL-IN-PROCESS
                    MOVE SPACES       TO WORK-CNTLKEY
                    MOVE 'TT'         TO WK-CNTL-REC-TYPE
                    PERFORM P8610-READ-CNTLFILE
                    IF SUCCESS
                       IF CNTL-TOPC-MAX-TIME-NUM NOT NUMERIC
                          MOVE 015    TO CNTL-TOPC-MAX-TIME-NUM
                       END-IF
                    ELSE
                       MOVE 015       TO CNTL-TOPC-MAX-TIME-NUM
                    END-IF
                    PERFORM P8770-READ-TOPC-VRUINFO
                    IF SUCCESS
                       MOVE ZEROES          TO DATE-CONVERSION-PARMS
                       SET PARM-DIFF        TO TRUE
                       MOVE VRUINFO-EFF-DATE TO PARM-PRI-DATE-GREG
                       MOVE VRUINFO-EFF-TIME TO PARM-PRI-HRMN
                       MOVE WS-SYSTEM-DATE  TO PARM-SEC-DATE-GREG
                       MOVE WS-SYSTEM-TIME  TO PARM-SEC-HRMN
                       PERFORM P9700-LINK-P903
                       IF NOT SUCCESS
                          MOVE 'P0100-1'             TO ERR-PARAGRAPH
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                       MOVE PARM-RES-MN    TO WS-RES-MN
                       IF PARM-RES-HR > 0
                          COMPUTE WS-RES-MN = PARM-RES-MN
                                            + PARM-RES-HR * 60
                       END-IF
                       IF PARM-RES-TOT-DAYS > 0
                       OR WS-RES-MN         > CNTL-TOPC-MAX-TIME-NUM
                          MOVE -1      TO SCR08-FUNC-CURSOR(1)
      *                   'TOPC MAX TIME EXPIRED, MUST EXIT AND RE-EXEC
      *                                                         TASK
                          MOVE 'T249'  TO MSGLOG-CODE
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF

           IF NOT WS-SETBACK-CALL
              MOVE P08-MAP-VERSION(PSTCA-SUB) TO P08-MAP
              EXEC CICS RECEIVE MAP(P08-MAP)
                                MAPSET(P08-SET)
                                INTO(PSTS08)
                                RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE             TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P0100-2'            TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
           IF PFKEY1
              PERFORM P7000-WRITE-TSQUEUE
              PERFORM P9800-SETUP-SCR998
           END-IF

           PERFORM P0101-INIT-MISC-MSG

           IF PFKEY10
              PERFORM P1070-RESET-COLORS
              IF SCR08-CC(1)              NOT  > SPACES
      *               'CANNOT BROWSE UNTIL ASGN IS OBTAINED'
                 MOVE 'C134'                  TO MSGLOG-CODE
                 MOVE -1                     TO SCR08-ORG-STATION-CURSOR
                 PERFORM VARYING FUNC-SUB FROM 1 BY 1
                    UNTIL FUNC-SUB             > ARRAY-MAX
                    MOVE SPACES               TO SCR08-FUNC(FUNC-SUB)
                 END-PERFORM
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF

              PERFORM VARYING FUNC-SUB FROM 1 BY 1
                 UNTIL FUNC-SUB                > ARRAY-MAX
                 IF SCR08-FUNC(FUNC-SUB)       = 'HELP'
                    AND NOT P08CA-ASGN-SET(FUNC-SUB)
                    PERFORM P9600-READ-TSQUEUE
                    MOVE FUNC-SUB             TO P08-TSQ-FUNC-SUB
                    PERFORM P9550-REWRITE-TSQUEUE
                    PERFORM P9150-SETUP-SCR997
                 END-IF
              END-PERFORM
              MOVE -1                         TO SCR08-FUNC-CURSOR(1)
      *            'CAN ONLY BROWSE WHEN HELPING SOMEONE ON'
              MOVE 'C135'                     TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           IF YARD-CALL
              PERFORM P0200-PROCESS-YARD-INPUT
           ELSE
              PERFORM P0300-PROCESS-ROAD-INPUT
              IF SCR08-CALL-COMPLETE > SPACE
                 IF SCR08-CALL-COMPLETE = 'Y'
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF  P08CA-EMP-NO(SUB1) IS NUMERIC
                       AND SCR08-CC(SUB1) > SPACES
                          MOVE SPACES            TO WS-MSTR
                          MOVE P08CA-EMP-NO(SUB1)
                                                 TO MSTRNBRK
                          PERFORM P8505-READ-MASTER-ONLY
                          IF IVR-CALL-IN-PROCESS
      *#1440                 NEED TO CHECK VRUINFO FOR SHORT CALL
      *                      IF THIS EMP IS BEING SHORT CALLED, IT IS
      *                      OK TO CALL COMPLETE
                             IF P08CA-TASK-KEY > SPACES
                                MOVE P08CA-TASK-KEY  TO VRUINFO-TASK-KEY
                                PERFORM P9330-READ-VRUINFO
                                IF  SUCCESS
                                AND VRU-SHORT-CALLED(SUB1)
                                   CONTINUE
                                ELSE
                                   MOVE SPACES    TO SCR08-CALL-COMPLETE
                                   MOVE -1    TO SCR08-FUNC-CURSOR(SUB1)
                                   MOVE REV-VIDEO TO SCR08-FUNC-HI(SUB1)
      *                            'VRU IN PROCESS EMPLOYEES EXIST -
      *                             CANNOT COMPLETE CALL'
                                   MOVE 'V168' TO MSGLOG-CODE
                                   PERFORM P9000-SEND-MAP-AND-RETURN
                                END-IF
                             ELSE
                                MOVE SPACES    TO SCR08-CALL-COMPLETE
                                MOVE -1    TO SCR08-FUNC-CURSOR(SUB1)
                                MOVE REV-VIDEO TO SCR08-FUNC-HI(SUB1)
      *                        'VRU IN PROCESS EMPLOYEES EXIST -
      *                          CANNOT COMPLETE CALL'
                                MOVE 'V168' TO MSGLOG-CODE
                                PERFORM P9000-SEND-MAP-AND-RETURN
                             END-IF
                          END-IF
                          IF NOT-NOTIFIED
                             MOVE EMP-NBR OF WS-MSTR TO IER-EMP-NBR
                             PERFORM PSQL-IERSEL07
                             IF SQL-SUCCESS
                                MOVE SPACES    TO SCR08-CALL-COMPLETE
                                MOVE -1       TO SCR08-FUNC-CURSOR(SUB1)
                                MOVE REV-VIDEO TO SCR08-FUNC-HI(SUB1)
      *                         'VRU IN PROCESS EMPLOYEES EXIST - CANNOT
      *                           COMPLETE CALL'
                                MOVE 'V168' TO MSGLOG-CODE
                                PERFORM P9000-SEND-MAP-AND-RETURN
                             END-IF
                          END-IF
                       END-IF
                    END-PERFORM
                    MOVE ZEROS            TO SUB2
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF (P08CA-ASGN-SET(SUB1)
                       OR  P08CA-ASGN-IVR-CONTROL(SUB1))
                       AND SCR08-CC(SUB1) > SPACES
                          MOVE 1          TO SUB2
                          MOVE ARRAY-MAX  TO SUB1
                       END-IF
                    END-PERFORM
                    IF SUB2 > ZERO
                       MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                       MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
                       MOVE '20'             TO WS-CALL-DATE-CENT
                       PERFORM P8030-DELETE-MU-ASGN
                       PERFORM P9120-SETUP-SCR08C
                    ELSE
                       MOVE -1 TO SCR08-CALL-COMPLETE-CURSOR
                       MOVE REV-VIDEO TO SCR08-CALL-COMPLETE-HI
      *                       'CANNOT USE CALL COMPLETE UNTIL '
      *                       'AN ASSIGNMENT HAS BEEN CALLED'
                       MOVE 'C006' TO MSGLOG-CODE
                    END-IF
                 ELSE
                    MOVE -1 TO SCR08-CALL-COMPLETE-CURSOR
                    MOVE REV-VIDEO TO SCR08-CALL-COMPLETE-HI
      *                  INVALID-CODE-MSG
                    MOVE 'I041' TO MSGLOG-CODE
                 END-IF
              END-IF
           END-IF
           PERFORM P9000-SEND-MAP-AND-RETURN.
      *
       P0101-INIT-MISC-MSG.
      *
      *    INITIALIZE SOME MISC MESSAGES IN WORKING STORAGE FOR USE
      *    LATER THROUGHOUT THIS PROGRAM
      *
           MOVE '** OPEN ASSIGNMENT **'           TO WS-OPEN-MSG(1)
           MOVE '** POSTE VACANT **'              TO WS-OPEN-MSG(2)
      *
           MOVE '** DISCONTINUED **'              TO WS-DISCONT-MSG(1)
           MOVE '** DISCONTINUATION **'           TO WS-DISCONT-MSG(2)
      *
           MOVE '** VACANCY **'                   TO WS-VACANCY-MSG(1)
           MOVE '** VACANT **'                    TO WS-VACANCY-MSG(2)
      *
           MOVE '** VACANT ASSIGNMENT **'         TO WS-VACANT-MSG(1)
           MOVE '** AFFECTATION VACANT **'        TO WS-VACANT-MSG(2)
      *
           MOVE '** ANNULLED **'                  TO WS-ANNULLED-MSG(1)
           MOVE '** ANNULLED **'                  TO WS-ANNULLED-MSG(2)
      *
           MOVE '** OFF **'                       TO WS-OFF-MSG(1)
           MOVE '** COGES **'                     TO WS-OFF-MSG(2)
      *
           MOVE '** FILL FROM SPAREBOARD **'      TO WS-XTRA-MSG(1)
           MOVE '** REMPLIR A PARTIR DE SB **'    TO WS-XTRA-MSG(2)
      *
           MOVE '** NO MORE AVAILABLE **'         TO WS-NO-MORE-MSG(1)
           MOVE '** AUCUNE DISPONIBILITE **'      TO WS-NO-MORE-MSG(2)
      *
           MOVE '** NONE AVAILABLE **'            TO WS-NO-AVL-MSG(1)
           MOVE '** AUCUNE DISPONIBILITE **'      TO WS-NO-AVL-MSG(2)
      *
           MOVE '** END OF FILE ** '              TO WS-END-FILE-MSG(1)
           MOVE '** FIN DU DOSSIER **'            TO WS-END-FILE-MSG(2)
           .
      *
       P0200-PROCESS-YARD-INPUT.
      *
           MOVE DEFAULT-ATTR         TO SCR08-ORG-STATION-HI
                                        SCR08-ASGN-HI
                                        SCR08-ORDER-DATE-HI
                                        SCR08-ORDER-TIME-HI
      *CNC0520-BEG
                                        SCR08-ROUTE-DSGN-HI
      *CNC0520-END
           PERFORM P1070-RESET-COLORS
           MOVE SPACES               TO SCR08-ERRORMSG
           EVALUATE TRUE
              WHEN ENTER-KEY
              WHEN PFKEY12
                   CONTINUE
              WHEN PFKEY5
                   IF P08CA-IVR-CALL-NOT-ACTIVE
                      PERFORM P5111-COMPANY-EDIT
                      IF NOT CNTL-OUTBND-IVR-CALL-ACTIVE
      *    'IVR NOT AVAILABLE-VERIFY "OPTION 16" IF MANUAL INTERVENTION
      *    REQUIRED'
                         MOVE 'I606'             TO MSGLOG-CODE
                         MOVE -1                 TO SCR08-FUNC-CURSOR(1)
                         PERFORM P9000-SEND-MAP-AND-RETURN
                      ELSE
      *                    'IVR CALLS ARE NOT ACTIVE FOR THIS JOB'
                         MOVE 'I392'             TO MSGLOG-CODE
                         MOVE -1                 TO SCR08-FUNC-CURSOR(1)
                         PERFORM P9000-SEND-MAP-AND-RETURN
                      END-IF
                   END-IF
                   PERFORM P5000-PREFILL-VCLL
              WHEN OTHER
                   MOVE -1                    TO SCR08-ASGN-CURSOR
      *            INVALID-FUNC-MSG
                   MOVE 'I006'                TO MSGLOG-CODE
                   PERFORM P9000-SEND-MAP-AND-RETURN
           END-EVALUATE
           MOVE SCR08-ORG-STATION    TO BIF-FIELD
           MOVE +5                   TO BIF-LEN
           PERFORM P8999-BIFEDIT
           MOVE BIF-EDITED-FIELD     TO SCR08-ORG-STATION
           IF SCR08-ORG-STATION NOT > '00000'
              MOVE -1                TO SCR08-ORG-STATION-CURSOR
              MOVE REV-VIDEO         TO SCR08-ORG-STATION-HI
      *             'ENTER ORIGIN STATION'
              MOVE 'E017'            TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF NOT PFKEY12
              AND SCR08-ASGN NOT > SPACES
              MOVE -1                TO SCR08-ASGN-CURSOR
              MOVE REV-VIDEO         TO SCR08-ASGN-HI
      *            'MUST ENTER A VALID ASSIGNMENT'
              MOVE 'M016'            TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           MOVE SPACES               TO SCR08-ASGN-TYPE
           IF SCR08-ORG-STATION = P08CA-LAST-ORG-STATION
              AND SCR08-ASGN = P08CA-LAST-ASGN
              AND NOT PFKEY12
              MOVE SCR08-ORDER-DATE  TO DE-YYMMDD
              SET DE-YYMMDD-FORMAT   TO TRUE
              PERFORM P8998-DATEEDIT
              IF DE-INVALID-DATE
                 MOVE -1             TO SCR08-ORDER-DATE-CURSOR
                 MOVE REV-VIDEO      TO SCR08-ORDER-DATE-HI
      *               INVALID-DATE-MSG
                 MOVE 'I034'         TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
              MOVE SCR08-ORDER-TIME  TO TE-MILITARY-TIME
              SET TE-MILITARY-FORMAT TO TRUE
              PERFORM P8997-TIMEEDIT
              IF TE-INVALID-TIME
                 MOVE -1             TO SCR08-ORDER-TIME-CURSOR
                 MOVE REV-VIDEO      TO SCR08-ORDER-TIME-HI
      *               INVALID-TIME-MSG
                 MOVE 'I022'         TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
      *
      *       CONVERT SYSTEM DATE/TIME TO LOCAL DATE/TIME
      *
              MOVE SPACES               TO TZ-PARAMETERS
              MOVE TZ-SYSTEM-TIME-ZONE  TO TZ-IN-ZONE
              MOVE WS-PRESENT-TIME      TO TZ-IN-DATE-TIME
              MOVE PSTCA-TIME-ZONE      TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000003'          TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
      *       MOVE TZ-OUT-DATE-TIME     TO WS-LOCAL-DATE-TIME
              MOVE TZ-OUT-DATE-TIME-CENT   TO WS-LOCAL-DATE-TIME-CENT
      *
      *08/01/23 RJA B CNC0600     (1) CNLD-270
      **CNLD-244 #2 B - SXG1 - YARD INQUIRY
      *        IF WS-CAN-WRR-FLAG NOT > SPACE
      *           MOVE WS-CNTL-FILE        TO WS-CNTL-FILE-HOLD
      *           MOVE SPACES              TO WORK-CNTLKEY
      *           MOVE '02'                TO WK-CNTL-REC-TYPE
      *           MOVE SCR08-DIST            TO WK-CNTL-DIST
      *           MOVE SCR08-SUB-DIST        TO WK-CNTL-SUB-DIST
      *           PERFORM P8610-READ-CNTLFILE
      *           IF NOT SUCCESS
      *              MOVE 'P0300-2'        TO ERR-PARAGRAPH
      *              MOVE WORK-CNTLKEY     TO ERR-KEY
      *              PERFORM P9999-GOT-PROBLEM
      *           END-IF
      *           MOVE CNTL-CAN-WRR-FLAG   TO WS-CAN-WRR-FLAG
      **CNLD-265-B
      *           MOVE CNTL-US-DOM         TO WS-US-DOM-FL
      **CNLD-265-E
      *           MOVE WS-CNTL-FILE-HOLD   TO WS-CNTL-FILE
      *           MOVE CNTLKEY-AREA        TO WORK-CNTLKEY
      *        END-IF
      ** GET THE PREP VALUES
      *        IF WS-CALL-DATE NOT > SPACES
      *           AND WS-CAN-WRR-NEW
      *           MOVE ZEROES TO DATE-CONVERSION-PARMS
      *           PERFORM P6040-GET-PREP-TIME
      *           MOVE WS-CALC-OD-DATE    TO WS-CALL-DATE
      *                                      WS-PREP-OD-DATE
      *           MOVE WS-CALC-OD-TIME    TO WS-CALL-TIME
      *                                      WS-PREP-OD-TIME
      *        ELSE
      **CNLD-244 #2 E - SXG1
      *08/01/23 RJA E CNC0600  CNLD-270
                 MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                 MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600  CNLD-270
      **CNLD-244 #2 B - SXG1
      *        END-IF
      **CNLD-244 #2 E - SXG1
      *08/01/23 RJA E CNC0600  CNLD-270
              MOVE '20'                 TO WS-CALL-DATE-CENT
              SET SUMMARY-CALL-CHECK    TO TRUE
              PERFORM P1030-EDIT-CALL-DATE
              IF ERRORS-FOUND
                 MOVE -1                TO SCR08-ORDER-DATE-CURSOR
                 MOVE REV-VIDEO         TO SCR08-ORDER-DATE-HI
                                           SCR08-ORDER-TIME-HI
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
      *
      *       MAKE SURE STARTING TIME MATCHES SHIFT
      *
              IF P08CA-SCH-CALL-DATE-TIME > '0000000000'
                 MOVE P08CA-SCH-CALL-TIME  TO JOB-SHIFT-TIME
                 IF 1ST-SHIFT-JOB
                    MOVE SCR08-ORDER-TIME  TO JOB-SHIFT-TIME
                    IF NOT 1ST-SHIFT-JOB
                       MOVE -1             TO SCR08-ORDER-TIME-CURSOR
                       MOVE REV-VIDEO      TO SCR08-ORDER-TIME-HI
      *                    'INVALID ORDER TIME ENTERED '
                       MOVE 'I087'         TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 ELSE
                    IF 2ND-SHIFT-JOB
                       MOVE SCR08-ORDER-TIME
                                           TO JOB-SHIFT-TIME
                       IF NOT 2ND-SHIFT-JOB
                          MOVE -1          TO SCR08-ORDER-TIME-CURSOR
                          MOVE REV-VIDEO   TO SCR08-ORDER-TIME-HI
      *                    'INVALID ORDER TIME ENTERED '
                          MOVE 'I087'      TO MSGLOG-CODE
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       END-IF
                    ELSE
                       MOVE SCR08-ORDER-TIME
                                           TO JOB-SHIFT-TIME
                       IF NOT 3RD-SHIFT-JOB
                          MOVE -1          TO SCR08-ORDER-TIME-CURSOR
                          MOVE REV-VIDEO   TO SCR08-ORDER-TIME-HI
      *                    'INVALID ORDER TIME ENTERED '
                          MOVE 'I087'      TO MSGLOG-CODE
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       END-IF
                    END-IF
                 END-IF
              END-IF
              MOVE AUTOSKIP-MDT         TO SCR08-ORDER-DATE-ATTR
                                           SCR08-ORDER-TIME-ATTR
      *CNC0520-BEG
              PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END
      *
      *       GET CALL DAY OF WEEK
      *
              IF P08CA-CALL-DAY-OF-WEEK NOT NUMERIC
                 MOVE ZEROS             TO DATE-CONVERSION-PARMS
                 SET PARM-CONV          TO TRUE
                 MOVE SCR08-ORDER-DATE  TO PARM-PRI-DATE-GREG
                 PERFORM P9700-LINK-P903
                 IF NOT SUCCESS
                    MOVE 'P0200-1'      TO ERR-PARAGRAPH
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE PARM-PRI-DAY-OF-WEEK TO P08CA-CALL-DAY-OF-WEEK
              END-IF
              SET P08CA-CALL-SET        TO TRUE
              PERFORM P2000-PROCESS-FUNCTIONS
           ELSE
              PERFORM P8030-DELETE-MU-ASGN
              PERFORM VARYING FUNC-SUB FROM 1 BY 1
                 UNTIL FUNC-SUB > ARRAY-MAX
                 PERFORM P1060-CLEAR-DATA-LINE
                 MOVE SPACES         TO SCR08-CC(FUNC-SUB)
                                        SCR08-FUNC(FUNC-SUB)
                                        SCR08-OD-DATE(FUNC-SUB)
                                        SCR08-OD-TIME(FUNC-SUB)
                                        SCR08-TAXI-TM(FUNC-SUB)
                                        P08CA-SAVE-OD-DTTM(FUNC-SUB)
                                        P08CA-SAVE-TAXI-TM(FUNC-SUB)
                 MOVE MDT            TO SCR08-FUNC-ATTR(FUNC-SUB)
                                        SCR08-NAME-ATTR(FUNC-SUB)
                                        SCR08-ST-ATTR(FUNC-SUB)
                                        SCR08-ECC-ATTR(FUNC-SUB)
                                        SCR08-OD-DATE-ATTR(FUNC-SUB)
                                        SCR08-OD-TIME-ATTR(FUNC-SUB)
                                        SCR08-TAXI-TM-ATTR(FUNC-SUB)
                 MOVE DEFAULT-ATTR   TO SCR08-FUNC-HI(FUNC-SUB)
                                        SCR08-NAME-HI(FUNC-SUB)
                                        SCR08-OD-DATE-HI(FUNC-SUB)
                                        SCR08-OD-TIME-HI(FUNC-SUB)
                                        SCR08-TAXI-TM-HI(FUNC-SUB)
              END-PERFORM
              IF NOT P08CA-SETBACK-CALL
                 MOVE SPACES         TO P08COMM-AREA
              END-IF
              MOVE SPACES            TO P08CA-SCREEN-COMMAREA
                                        SCR08-ORDER-DATE
                                        SCR08-ORDER-TIME
              MOVE MDT               TO SCR08-ORDER-DATE-ATTR
                                        SCR08-ORDER-TIME-ATTR
      *CNC0520-BEG
              PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END
              SET YARD-CALL             TO TRUE
              MOVE SCR08-ORG-STATION    TO WK-TRCN-ORG-STATION
              MOVE SCR08-ASGN           TO WK-TRCN-ASGN
              PERFORM P8010-GET-NEXT-YARD-PROFILE
              IF PROFILE-NOT-YARD-JOB
                 OR NOT PROFILE-FOUND
                 MOVE -1                TO SCR08-ASGN-CURSOR
                 IF PFKEY12
      *                  'END OF YARD JOBS FOR THIS SUB DISTRICT'
                    MOVE 'E032'         TO MSGLOG-CODE
                 ELSE
                    MOVE REV-VIDEO      TO SCR08-ASGN-HI
                    IF PROFILE-NOT-YARD-JOB
      *                       'ONLY "YARD" ASSIGNMENTS MAY BE '
      *                       'CALLED IN THIS SCREEN'
                       MOVE 'O002'      TO MSGLOG-CODE
                    ELSE
      *                     'YARD ASSIGNMENT NOT FOUND'
                       MOVE 'Y002'      TO MSGLOG-CODE
                    END-IF
                 END-IF
                 PERFORM P9000-SEND-MAP-AND-RETURN
              ELSE
                 MOVE 25                TO CTXT-UNF-FIELD-LEN
                 MOVE TRCN-DESCRIPTION  TO CTXT-UNF-FIELD
                 PERFORM P8994-CENTER-TEXT
                 MOVE CTXT-FOR-FIELD    TO SCR08-TITLE
                 MOVE TRCN-DIST         TO SCR08-DIST
                 MOVE TRCN-SDIST        TO SCR08-SUB-DIST
                 PERFORM P8050-GET-TIME-ZONE
      *
      *          CONVERT SYSTEM DATE/TIME TO LOCAL DATE/TIME
      *
                 MOVE SPACES               TO TZ-PARAMETERS
                 MOVE TZ-SYSTEM-TIME-ZONE  TO TZ-IN-ZONE
                 MOVE WS-PRESENT-TIME      TO TZ-IN-DATE-TIME
                 MOVE PSTCA-TIME-ZONE      TO TZ-OUT-ZONE
                 PERFORM P8996-TIMEZONE
                 IF TZ-INVALID-PARAMETERS
                    MOVE '000004'          TO ERR-PARAGRAPH
                    PERFORM P8996-TZERROR
                 END-IF
      *          MOVE TZ-OUT-DATE-TIME      TO WS-LOCAL-DATE-TIME
                 MOVE TZ-OUT-DATE-TIME-CENT TO WS-LOCAL-DATE-TIME-CENT
                 MOVE TRCN-TRAIN-ASGN       TO SCR08-PROFILE
                 IF PFKEY12
                    MOVE TRCN-TRAIN-ASGN   TO SCR08-ASGN
                 END-IF
                 MOVE TRCN-KEY1            TO P08CA-PROFILE-KEY
                                              TRCNKEY1
                 PERFORM P8000-READ-TRCNKEY1
                 PERFORM P5110-IVR-PFKEY-EDITS
                 PERFORM P0210-FIND-ASSIGNED-CREW
                 PERFORM P0215-FIND-REMAIN-ASGNMTS
                 PERFORM P1021-SET-VRU-CALL-ATTR
      *
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - SXG1
      ** CALCULATE ON DUTY TIME FOR YARD - NON ASSIGNED CRAFTS
      *           PERFORM P6070-CALC-PREP-TIME
      **CNLD-244 #2 E - SXG1
      *08/01/23 RJA E CNC0600 CNLD-270
              END-IF
           END-IF.
      *
       P0210-FIND-ASSIGNED-CREW.
      *
           MOVE SCR08-ORG-STATION        TO P08CA-LAST-ORG-STATION
           MOVE SCR08-ASGN               TO P08CA-LAST-ASGN
      *
      *    SETUP NEW JOB
      *
           MOVE TRCN-ASSIGNMENT          TO JOB-DEF-CHECK
           SET JOB-IND TO 1
           SEARCH JOB-ENTRIES VARYING JOB-IND
              AT END
                 MOVE 1 TO SUB1
              WHEN JOB-DEF-TBL-CLASS(JOB-IND) = JOB-DEF-CLASS
                 SET SUB1 TO JOB-IND
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              MOVE JOB-DEF-TBL-CRAFT-CODE(SUB1, FUNC-SUB)
                                              TO SCR08-CC(FUNC-SUB)
              IF SCR08-CC(FUNC-SUB) = TASK-INFO(11:2)
                 MOVE WS-TASK-DATE            TO SCR08-OD-DATE(FUNC-SUB)
                 MOVE WS-TASK-TIME            TO SCR08-OD-TIME(FUNC-SUB)
              END-IF
              SET CT-IND        TO 1
              SEARCH CRAFT-CODE-TABLE VARYING CT-IND
                 AT END CONTINUE
                 WHEN CT-CRAFT-CODE(CT-IND) = SCR08-CC(FUNC-SUB)
                    IF CT-CRAFT-CODE(CT-IND) > SPACE
                       MOVE CT-CRAFT-COLOR(CT-IND)
                          TO P08CA-ASGN-COLOR(FUNC-SUB)
                    END-IF
              END-SEARCH
              IF SCR08-CC(FUNC-SUB) NOT > SPACES
                 SET P08CA-ASGN-SET(FUNC-SUB) TO TRUE
                 MOVE AUTOSKIP-MDT TO SCR08-FUNC-ATTR(FUNC-SUB)
                                      SCR08-NAME-ATTR(FUNC-SUB)
                                      SCR08-ST-ATTR(FUNC-SUB)
                                      SCR08-ECC-ATTR(FUNC-SUB)
                                      SCR08-OD-DATE-ATTR(FUNC-SUB)
                                      SCR08-OD-TIME-ATTR(FUNC-SUB)
                                      SCR08-TAXI-TM-ATTR(FUNC-SUB)
              ELSE
                 MOVE 'TAXI TM:'   TO SCR08-TAXI-HD(FUNC-SUB)
              END-IF
           END-PERFORM
           PERFORM P1070-RESET-COLORS
      *
           MOVE SPACES                TO WORK-CNTLKEY
           MOVE '02'                  TO WK-CNTL-REC-TYPE
           MOVE SCR08-DIST            TO WK-CNTL-DIST
           MOVE SCR08-SUB-DIST        TO WK-CNTL-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P0210-1'       TO ERR-PARAGRAPH
              MOVE CNTLKEY         TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *CNLD-244 #2 B - RPV1
           MOVE CNTL-CAN-WRR-FLAG     TO WS-CAN-WRR-FLAG
      *CNLD-265-B
           MOVE CNTL-US-DOM           TO WS-US-DOM-FL
      *CNLD-265-E
      *CNLD-244 #2 E - RPV1
           MOVE CNTL-LEAD-CALL-TIME TO WS-LEAD-TIME
           IF TRCN-ADDL-LEAD-TIME > SPACES
              ADD TRCN-ADDL-LEAD-TIME-HR TO WS-LEAD-TIME-HR
              MOVE WS-LEAD-TIME-MN       TO WS-LEAD-TIME-MN3
              ADD TRCN-ADDL-LEAD-TIME-MN TO WS-LEAD-TIME-MN3
              IF WS-LEAD-TIME-MN3 > 60
                 ADD 1         TO WS-LEAD-TIME-HR
                 SUBTRACT 60 FROM WS-LEAD-TIME-MN3
              END-IF
              MOVE WS-LEAD-TIME-MN3 TO WS-LEAD-TIME-MN
           END-IF
           MOVE WS-LEAD-TIME        TO P08CA-EN-LEAD-TIME
           MOVE WS-LEAD-TIME        TO P08CA-TR-LEAD-TIME
           IF DAILY-MARKUP-ALLOWED
              SET DAILY-MARK-YARD  TO TRUE
           END-IF
      *
      *    SEE IF JOB ALREADY CALLED
      *
           MOVE SPACES                TO WS-JOB-SCHEDULE
                                         WS-SCH-DATE-TIME
           MOVE '0'                   TO ASGN-FOUND-CODE
           MOVE SPACES                TO WORK-AJTRAIN
           MOVE SCR08-DIST            TO WK-AJTRAIN-DIST
           MOVE SCR08-SUB-DIST        TO WK-AJTRAIN-SUB-DIST
           STRING SCR08-ASGN
                  SCR08-ASGN-TYPE
                  DELIMITED BY SIZE
                  INTO WK-AJTRAIN-TRAIN
           MOVE WORK-AJTRAIN       TO AJTRAINKEY
           EXEC CICS STARTBR
                     DATASET(AJ-VIA-TRAIN)
                     RIDFLD(AJTRAINKEY)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF SUCCESS
              MOVE '0' TO WS-DONE-CODE
              PERFORM UNTIL DONE
                 EXEC CICS READNEXT
                           DATASET(AJ-VIA-TRAIN)
                           INTO(WS-ASGNED-JOBS)
                           LENGTH(AJTRAIN-RLGTH)
                           RIDFLD(AJTRAINKEY)
                           KEYLENGTH(AJTRAIN-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS
                    IF AJ-TRAIN-DIST = WK-AJTRAIN-DIST
                       AND AJ-TRAIN-SUB-DIST = WK-AJTRAIN-SUB-DIST
                       AND AJ-TRAIN-SYMBOL   = WK-AJTRAIN-TRAIN
                       PERFORM VARYING FUNC-SUB FROM 1 BY 1
                          UNTIL SCR08-CC(FUNC-SUB) = AJ-TRAIN-CC
                          OR FUNC-SUB > ARRAY-MAX
                       END-PERFORM
      *C1194 - BEG
                       IF (YARD-CALL
                       AND FUNC-SUB NOT > ARRAY-MAX)
                          IF  JSK1-ASSIGNMENT NOT > SPACES
                          OR (JSK1-ASSIGNMENT > SPACES
                          AND SCR08-CC(FUNC-SUB) NOT = JSK1-ASGN-CC)
                             IF P08CA-ORDER-VX
                                IF P08CA-TASK-KEY > SPACES
                                   MOVE P08CA-TASK-KEY
                                                    TO VRUINFO-TASK-KEY
                                   PERFORM P9330-READ-VRUINFO
                                   IF VRU-CALL-UNSUCCESSFUL(FUNC-SUB)
                                      SET WS-P0220-OVERRIDE TO TRUE
                                   END-IF
                                END-IF
                                IF AJ-JOB-ON-DUTY
                                   MOVE AJ-JOB-ON-DUTY-DATE
                                                     TO WS-CALL-DATE
                                   MOVE AJ-JOB-ON-DUTY-HRMN
                                                     TO WS-CALL-TIME
                                   MOVE WS-CALL-DATE-TIME
                                                     TO WS-SCH-DATE-TIME
                                END-IF
                                PERFORM P0220-FIND-SCHEDULE
                             END-IF
                          END-IF
                       END-IF
      *C1194 - END
                       PERFORM P0240-SETUP-JOB-LINE
                       SET P08CA-CALL-SET    TO TRUE
                    ELSE
                       SET DONE TO TRUE
                    END-IF
                 ELSE
                    SET DONE TO TRUE
                    IF NOT (NO-RECORD-FND OR END-OF-FILE)
                       MOVE 'P0210-2'    TO ERR-PARAGRAPH
                       MOVE AJTRAINKEY   TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 END-IF
              END-PERFORM
              EXEC CICS ENDBR
                        DATASET(AJ-VIA-TRAIN)
                        RESP(WS-RESPONSE)
              END-EXEC
           END-IF.
      *
       P0215-FIND-REMAIN-ASGNMTS.
      *
      *    NOW PICK UP ANY REMAINING ASSIGNMENTS THAT HAVE NOT
      *    BEEN CALLED ALREADY
      *
      *#1375
           IF P08CA-ORDER-VX
              MOVE P08CA-TASK-KEY   TO VRUINFO-TASK-KEY
              PERFORM P9330-READ-VRUINFO
           END-IF
           MOVE SPACE                     TO WS-FROM-PARA-P0215-FLAG
           MOVE '0'                       TO WS-DONE-CODE
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              MOVE SPACES                 TO WS-P0220-OVERRIDE-FLAG
              IF (SCR08-CC(FUNC-SUB) > SPACES
                 AND P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES)
              OR (SCR08-CC(FUNC-SUB) > SPACES
                 AND P08CA-ORDER-VX)
      *#1375
                 IF P08CA-ORDER-VX
                 AND VRU-CALL-UNSUCCESSFUL(FUNC-SUB)
                    SET WS-P0220-OVERRIDE TO TRUE
                 END-IF
                 PERFORM P0220-FIND-SCHEDULE
                 IF JSK2-ASSIGNMENT > SPACES
                    MOVE SPACES              TO WS-ANNUL-FROM-DATE
                                                WS-ANNUL-TO-DATE
                    IF JSK1-ASGN-DIST     NOT = JSK2-ASGN-DIST
                    OR JSK1-ASGN-SUB-DIST NOT = JSK2-ASGN-SUB-DIST
      *    CNC0077 - FLW, 9/25/96, START
      *             OR JSK1-ASSIGNMENT    NOT = JSK2-ASSIGNMENT
                    OR JSK1-ASGN          NOT = JSK2-ASGN
                    OR JSK1-ASGN-CC       NOT = JSK2-ASGN-CC
      *    CNC0077 - FLW, 9/25/96, END
                       MOVE JSK1-ASGN-DIST     TO AJ-JOB-DIST
                       MOVE JSK1-ASGN-SUB-DIST TO AJ-JOB-SUB-DIST
                       MOVE JSK1-ASSIGNMENT    TO AJ-JOB-ASSIGNMENT
                       MOVE AJJOBKEY-AREA      TO AJJOBKEY
                       PERFORM P8600-READ-AJJOBKEY
                       IF SUCCESS
                       AND AJ-ANNUL-FROM-DATE > '000000'
                          MOVE AJ-ANNUL-FROM-DATE
                                             TO WS-ANNUL-FROM-DATE
                          MOVE AJ-ANNUL-TO-DATE
                                             TO WS-ANNUL-TO-DATE
                       END-IF
                    END-IF
      *    CNC0077 - FLW, 10/10/96, START
                    IF JSK2-ASGN-SPAREBOARD
                       SET FROM-PARA-P0215   TO TRUE
                       PERFORM P0240-SETUP-JOB-LINE
                    ELSE
                       MOVE JSK2-ASGN-DIST   TO AJ-JOB-DIST
                       MOVE JSK2-ASGN-SUB-DIST
                                             TO AJ-JOB-SUB-DIST
                       MOVE JSK2-ASGN        TO AJ-JOB-ASGN-ID
                       MOVE JSK2-ASGN-CC     TO AJ-JOB-ASGN-CC
                       MOVE AJJOBKEY-AREA    TO AJJOBKEY
                       PERFORM P8600-READ-AJJOBKEY
                       IF SUCCESS
                          IF AJ-ANNUL-FROM-DATE > '000000'
                             MOVE AJ-ANNUL-FROM-DATE
                                             TO WS-ANNUL-FROM-DATE
                             MOVE AJ-ANNUL-TO-DATE
                                             TO WS-ANNUL-TO-DATE
                          END-IF
                          IF JSK1-ASGN-DIST NOT = JSK2-ASGN-DIST
                          OR JSK1-ASGN-SUB-DIST NOT = JSK2-ASGN-SUB-DIST
                          OR JSK1-ASGN       NOT = JSK2-ASGN
                          OR JSK1-ASGN-CC    NOT = JSK2-ASGN-CC
                             MOVE SPACES     TO JOB-SCHED-SPEC-COND
                          END-IF
      *----------------------------------------------------------------*
      *                CONVERT TO CNTL-TIME-ZONE                       *
      *----------------------------------------------------------------*
                          IF JSK2-ASGN-DIST       NOT = SCR08-DIST
                          OR JSK2-ASGN-SUB-DIST   NOT = SCR08-SUB-DIST
                             MOVE SPACES          TO WORK-CNTLKEY
                             MOVE '02'            TO WK-CNTL-REC-TYPE
                             MOVE JSK2-ASGN-DIST  TO WK-CNTL-DIST
                             MOVE JSK2-ASGN-SUB-DIST TO WK-CNTL-SUB-DIST
                             PERFORM P8610-READ-CNTLFILE
                             IF NOT SUCCESS
                                MOVE 'P0215-1'    TO ERR-PARAGRAPH
                                MOVE CNTLKEY      TO ERR-KEY
                                PERFORM P9999-GOT-PROBLEM
                             END-IF
                             MOVE SPACES          TO TZ-PARAMETERS
                             MOVE PSTCA-TIME-ZONE TO TZ-IN-ZONE
                             MOVE WS-LOCAL-DATE-TIME TO TZ-IN-DATE-TIME
                             MOVE CNTL-TIME-ZONE  TO TZ-OUT-ZONE
                             PERFORM P8996-TIMEZONE
                             IF TZ-INVALID-PARAMETERS
                                MOVE '131000'     TO ERR-PARAGRAPH
                                PERFORM P8996-TZERROR
                             END-IF
                          ELSE
                             MOVE WS-LOCAL-DATE      TO TZ-OUT-DATE
                          END-IF
      *
      *CW0797 START
                          SET WS-AJ-EFFECTIVE TO TRUE
      *CW0797 END
                          SET DE-YYMMDD-FORMAT     TO TRUE
                          MOVE AJ-EFF-DATE         TO DE-YYMMDD
                          PERFORM P8998-DATEEDIT
                          MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
                          SET DE-YYMMDD-FORMAT     TO TRUE
                          MOVE TZ-OUT-DATE         TO DE-YYMMDD
                          PERFORM P8998-DATEEDIT
                          MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE

      *                   IF AJ-EFF-DATE > TZ-OUT-DATE
                          IF DE-COMPARE1-DATE > DE-COMPARE2-DATE
                             SET JOB-SCHED-ASGN-OFF TO TRUE
      *CW0797 START
                             SET WS-AJ-NOT-EFFECTIVE TO TRUE
      *CW0797 END
                          END-IF
                          PERFORM P0240-SETUP-JOB-LINE
                       ELSE
                          IF NOT NO-RECORD-FND
                             MOVE 'P0215-2'  TO ERR-PARAGRAPH
                             MOVE AJJOBKEY   TO ERR-KEY
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                       END-IF
      *    CNC0077 - FLW, 10/10/96, END
                    END-IF
                 END-IF
              END-IF
           END-PERFORM
      *
      *    MAKE SURE ASSIGNMENT HAS NOT BEEN CALLED TODAY
      *
           PERFORM P0250-SEE-IF-ASGN-CALLED-TODAY
           IF NOT ERRORS-FOUND
              IF NOT ASGN-FOUND
                 IF YARD-CALL
                    MOVE -1           TO SCR08-ASGN-CURSOR
      *             STRING 'PROFILE EXISTS FOR REQUESTED ASSIGNMENT, '
      *                    'BUT ASSIGNMENT NOT YET CREATED'
                    MOVE 'P007' TO MSGLOG-CODE
                 ELSE
                    MOVE -1           TO SCR08-FUNC-CURSOR(1)
      *                    'PROFILE EXISTS FOR REQUESTED ASSIGNMENT, '
      *                    'BUT ASSIGNMENT NOT YET CREATED'
                    MOVE 'P007' TO MSGLOG-CODE
                 END-IF
              ELSE
                 IF NOT P08CA-CALL-SET
                    IF YARD-CALL
                       MOVE -1 TO SCR08-ORDER-DATE-CURSOR
                    END-IF
                 ELSE
                    IF YARD-CALL
                       MOVE -1 TO SCR08-ORDER-DATE-CURSOR
                    END-IF
                 END-IF
              END-IF
           END-IF.
      *
       P0220-FIND-SCHEDULE.
      *
      *    ESTABLISH THE SCHEDULE "WINDOW"
      *
           IF WS-SCH-DATE-TIME NOT > SPACES
              MOVE WS-LOCAL-DATE-TIME     TO WS-SCH-DATE-TIME
           END-IF

           MOVE WS-SCH-DATE               TO WS-SCH-EXP-DATE

           MOVE ZEROS                     TO DATE-CONVERSION-PARMS
           SET PARM-SUBTRACT              TO TRUE
           MOVE WS-SCH-DATE               TO PARM-PRI-DATE-GREG
           MOVE WS-SCH-TIME               TO PARM-PRI-HRMN
      *#1375
           IF WS-P0220-OVERRIDE
              MOVE WS-SCH-TIME            TO PARM-SEC-HRMN
           ELSE
              MOVE 0600                   TO PARM-SEC-HRMN
           END-IF
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P0220-1'              TO ERR-PARAGRAPH
              MOVE 'P903LINK'             TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE PARM-RES-DAY-OF-WEEK      TO WS-SCH-DAY-FROM
           MOVE PARM-RES-HRMN             TO WS-SCH-TIME-FROM
           MOVE PARM-RES-DATE-GREG        TO WS-SCH-DATE-FROM

           MOVE ZEROS                     TO DATE-CONVERSION-PARMS
           SET PARM-ADD                   TO TRUE
           MOVE WS-SCH-DATE               TO PARM-PRI-DATE-GREG
           MOVE WS-SCH-TIME               TO PARM-PRI-HRMN
           MOVE 0600                      TO PARM-SEC-HRMN
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P0220-2'              TO ERR-PARAGRAPH
              MOVE 'P903LINK'             TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE PARM-RES-DAY-OF-WEEK      TO WS-SCH-DAY-TO
           MOVE PARM-RES-HRMN             TO WS-SCH-TIME-TO
           MOVE PARM-RES-DATE-GREG        TO WS-SCH-DATE-TO

           IF WS-SCH-TIME-FROM = 0000
           AND NOT WS-P0220-OVERRIDE
              MOVE 2400                   TO WS-SCH-TIME-FROM
              IF WS-SCH-DAY-FROM > 1
                 SUBTRACT 1             FROM WS-SCH-DAY-FROM
              ELSE
                 MOVE 7                   TO WS-SCH-DAY-FROM
              END-IF
           ELSE
              IF WS-SCH-DAY-FROM  = WS-SCH-DAY-TO  AND
                 WS-SCH-TIME-FROM > WS-SCH-TIME-TO
                 IF WS-SCH-DAY-FROM > 1
                    SUBTRACT 1          FROM WS-SCH-DAY-FROM
                 ELSE
                    MOVE 7                TO WS-SCH-DAY-FROM
                 END-IF
              END-IF
           END-IF

      *    FIRST LOCK IN ON THE CORRECT SCHEDULE "SET" BY DETERMINING
      *    THE EXPIRATION DATE
      *
           MOVE TRCN-KEY3                 TO JS-KEY1
           IF NOT SVC-OVERRIDE-CHECK
              MOVE SCR08-CC(FUNC-SUB)     TO WS-JS-CRAFT
           END-IF
           MOVE WS-JS-CRAFT               TO JSK1-ASGN-CC
      *    MOVE WS-SCH-DATE-FROM          TO JSK1-EXP-DATE
           MOVE WS-SCH-EXP-DATE           TO JSK1-EXP-DATE
           SET JSK1-ASGN-STATS            TO TRUE
           MOVE JS-KEY1                   TO JSKEY1
           EXEC CICS READ
                     DATASET(JS-VIA-JSKEY1)
                     INTO(WS-JOB-SCHEDULE)
                     LENGTH(JSKEY1-RLGTH)
                     RIDFLD(JSKEY1)
                     KEYLENGTH(JSKEY1-KLGTH)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE               TO FILE-STATUS
      *    IF SUCCESS
      *       SET DE-YYMMDD-FORMAT        TO TRUE
      *       MOVE JSK1-EXP-DATE          TO DE-YYMMDD
      *       PERFORM P8998-DATEEDIT
      *       MOVE DE-CCYYMMDD            TO DE-COMPARE1-DATE
      *    END-IF
           IF SUCCESS
              AND JSK1-ASGN-DIST     = TRCN-DIST3
              AND JSK1-ASGN-SUB-DIST = TRCN-SDIST3
              AND JSK1-ASGN          = TRCN-ASSIGNMENT
              AND JSK1-ASGN-CC       = WS-JS-CRAFT
      *       AND DE-COMPARE1-DATE  >= WS-LOCAL-DATE-CENT
              AND JSK1-EXP-DATE     >= P08CA-ORDER-DATE
              AND JSK1-ASGN-STATS
              CONTINUE
           ELSE
              IF SUCCESS
                 SET NO-RECORD-FND        TO TRUE
              END-IF
           END-IF
           IF SUCCESS
              MOVE JS-KEY1                TO WORK-JS-KEY1
              MOVE WS-SCH-DAY-FROM        TO WS-SCH-DAY
              MOVE WS-SCH-TIME-FROM       TO WS-SCH-START-TIME
              IF WS-SCH-DAY-TO NOT = WS-SCH-DAY-FROM
                 MOVE 2400                TO WS-SCH-END-TIME
                 PERFORM P0230-SEARCH-SCHEDULE
                 IF NOT SUCCESS
                    MOVE WS-SCH-DAY-TO    TO WS-SCH-DAY
                    MOVE ZEROS            TO WS-SCH-START-TIME
                    MOVE WS-SCH-TIME-TO   TO WS-SCH-END-TIME
                    PERFORM P0230-SEARCH-SCHEDULE
                 END-IF
              ELSE
                 MOVE WS-SCH-TIME-TO      TO WS-SCH-END-TIME
                 PERFORM P0230-SEARCH-SCHEDULE
              END-IF
           END-IF
      *
      *    CW0797
      *    BUILD DEFAULT JOB SCHEDULE FOR CRAFT WITH NO SCHEDULE
      *    UNLESS WE ARE DOING A SERVICE OVERRIDE CHECK.
      *
           IF NOT SUCCESS
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P0220-3'           TO ERR-PARAGRAPH
                 MOVE JSKEY2              TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE SPACES                 TO WS-JOB-SCHEDULE
              IF NOT SVC-OVERRIDE-CHECK
                 MOVE TRCN-DIST3          TO JSK2-ASGN-DIST
                                             JSK1-ASGN-DIST
                 MOVE TRCN-SDIST3         TO JSK2-ASGN-SUB-DIST
                                             JSK1-ASGN-SUB-DIST
                 MOVE TRCN-ASSIGNMENT     TO JSK2-ASGN
                                             JSK1-ASGN
                 MOVE SCR08-CC(FUNC-SUB)  TO JSK2-ASGN-CC
                                             JSK1-ASGN-CC
      *    CW0797 START
      *          MOVE WS-SCH-DAY-FROM     TO JSK2-ASGN-DAY-NUM
      *                                      JSK1-ASGN-DAY-NUM
                 MOVE P08CA-CALL-DAY-OF-WEEK TO JSK2-ASGN-DAY-NUM
                                                JSK1-ASGN-DAY-NUM


      *          MOVE WS-SCH-TIME-FROM    TO JSK2-ASGN-START-TIME
      *                                      JSK1-ASGN-START-TIME
                 MOVE WS-LOCAL-TIME       TO JSK2-ASGN-START-TIME
                                             JSK1-ASGN-START-TIME
      *    CW0797 END
                 MOVE ALL '9'             TO JSK1-EXP-DATE
                                             JSK2-EXP-DATE
                 MOVE WS-SCH-TIME-TO      TO JOB-SCHED-END-TIME
                 SET JOB-SCHED-ASGN-LIMIT TO TRUE
      *    CNC0077 - FLW, 9/25/96, START
                 SET JSK2-ASGN-ASSIGNED   TO TRUE
      *    CNC0077 - FLW, 9/25/96, END
              END-IF
           END-IF.
      *
       P0230-SEARCH-SCHEDULE.
      *
      *    THEN USING THAT KEY AS A BASE, LOOK UP THE CORRECT
      *    SCHEDULE TO BE CALLED NEXT
      *
           MOVE WS-SCH-DAY                TO WK-JSK1-ASGN-DAY-NUM
           MOVE WS-SCH-START-TIME         TO WK-JSK1-ASGN-START-TIME
           MOVE WORK-JS-KEY1              TO JSKEY1
           EXEC CICS READ
                     DATASET(JS-VIA-JSKEY1)
                     INTO(WS-JOB-SCHEDULE)
                     LENGTH(JSKEY1-RLGTH)
                     RIDFLD(JSKEY1)
                     KEYLENGTH(JSKEY1-KLGTH)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF SUCCESS
              AND JSK1-ASGN-DIST = WK-JSK1-ASGN-DIST
              AND JSK1-ASGN-SUB-DIST = WK-JSK1-ASGN-SUB-DIST
              AND JSK1-ASSIGNMENT = WK-JSK1-ASSIGNMENT
              AND JSK1-EXP-DATE = WK-JSK1-EXP-DATE
              AND JSK1-ASGN-DAY-NUM = WK-JSK1-ASGN-DAY-NUM
              AND JSK1-ASGN-START-TIME NOT > WS-SCH-END-TIME
              CONTINUE
           ELSE
              IF SUCCESS
                 SET NO-RECORD-FND       TO TRUE
              END-IF
           END-IF
           IF NOT SUCCESS
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P0230-1'           TO ERR-PARAGRAPH
                 MOVE JSKEY2              TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P0240-SETUP-JOB-LINE.
      *
           IF FUNC-SUB NOT > ARRAY-MAX
              SET ASGN-FOUND              TO TRUE
              MOVE 'A'                    TO WK-ASGN-JOB-TYPE
                                             P08CA-ASGN-TYP(FUNC-SUB)
              MOVE AJJOBKEY-AREA          TO WK-ASGN-ASSIGNMENT
                                             P08CA-ASGN-KEY(FUNC-SUB)
              MOVE AJ-JOB-ASSIGNMENT      TO JOB-DEF-CHECK
              IF JOB-DEF-YARDMASTER-ASGN
                 PERFORM P0241-DETERMINE-IF-HOS-EXEMPT
              END-IF
      *    CNC0077 - FLW, 10/10/96, START
              IF JSK2-ASGN-SPAREBOARD
                 MOVE JSK2-ASGN-TYPE      TO WK-ASGN-JOB-TYPE
                                             P08CA-ASGN-TYP(FUNC-SUB)
                 MOVE JSK2-ASGN-DIST      TO WK-ASGN-DIST
                 MOVE JSK2-ASGN-SUB-DIST  TO WK-ASGN-SUB-DIST
                 MOVE JSK2-ASGN(1:6)      TO WK-ASGN-ASSIGN(1:6)
                 MOVE JSK2-ASGN-CC        TO WK-ASGN-CC
                 MOVE WORK-ASGNKEY1       TO P08CA-ASGN-KEY-XB(FUNC-SUB)
      *C1087 - BEG
                 MOVE WK-ASGN-ASSIGNMENT  TO AJJOBKEY
                 PERFORM P8600-READ-AJJOBKEY
                 IF SUCCESS
                 AND AJ-ANNUL-FROM-DATE > '000000'
                    MOVE AJ-ANNUL-FROM-DATE
                                          TO WS-ANNUL-FROM-DATE
                    MOVE AJ-ANNUL-TO-DATE
                                          TO WS-ANNUL-TO-DATE
                 END-IF
      *C1087 - END
              END-IF
      *    CNC0077 - FLW, 10/10/96, END
              MOVE JS-KEY1                TO P08CA-JSKEY1(FUNC-SUB)
              IF FILL-VACANCY
      *C916
                 IF SCR08-FUNC(FUNC-SUB) = 'FILL'
                    SET P08CA-ASGN-MU(FUNC-SUB)
                                          TO TRUE
                 END-IF
      *
              END-IF
              IF JSK2-ASGN-TRAIN AND
                 UFP-CALL
                 SET P08CA-ASGN-MU-XB(FUNC-SUB)
                                          TO TRUE
              END-IF
      *
      *       GET CALL DAY OF WEEK
      *
              IF P08CA-CALL-DAY-OF-WEEK NOT NUMERIC
                 OR P08CA-CALL-DAY-OF-WEEK NOT > ZEROES
                 IF AJ-JOB-ON-DUTY
      *----------------------------------------------------------------*
      *                CONVERT TO PSTCA-TIME-ZONE                      *
      *----------------------------------------------------------------*
                    IF AJ-JOB-DIST              NOT = SCR08-DIST
                    OR AJ-JOB-SUB-DIST          NOT = SCR08-SUB-DIST
                       MOVE SPACES              TO WORK-CNTLKEY
                       MOVE '02'                TO WK-CNTL-REC-TYPE
                       MOVE AJ-JOB-DIST         TO WK-CNTL-DIST
                       MOVE AJ-JOB-SUB-DIST     TO WK-CNTL-SUB-DIST
                       PERFORM P8610-READ-CNTLFILE
                       IF NOT SUCCESS
                          MOVE 'P0240-1'    TO ERR-PARAGRAPH
                          MOVE CNTLKEY      TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                       MOVE SPACES              TO TZ-PARAMETERS
                       MOVE CNTL-TIME-ZONE      TO TZ-IN-ZONE
                       MOVE PSTCA-TIME-ZONE     TO TZ-OUT-ZONE
                       MOVE AJ-JOB-ON-DUTY-TIME TO TZ-IN-DATE-TIME
                       PERFORM P8996-TIMEZONE
                       IF TZ-INVALID-PARAMETERS
                          MOVE '132000'     TO ERR-PARAGRAPH
                          PERFORM P8996-TZERROR
                       END-IF
                       MOVE TZ-OUT-DATE-TIME    TO AJ-JOB-ON-DUTY-TIME
      *
                       MOVE SPACES              TO TZ-PARAMETERS
                       MOVE CNTL-TIME-ZONE      TO TZ-IN-ZONE
                       MOVE PSTCA-TIME-ZONE     TO TZ-OUT-ZONE
                       MOVE AJ-ON-DUTY-TIME     TO TZ-IN-DATE-TIME
                       PERFORM P8996-TIMEZONE
                       IF TZ-INVALID-PARAMETERS
                          MOVE '133000'     TO ERR-PARAGRAPH
                          PERFORM P8996-TZERROR
                       END-IF
                       MOVE TZ-OUT-DATE-TIME    TO AJ-ON-DUTY-TIME
                    END-IF
      *
                    MOVE ZEROS            TO DATE-CONVERSION-PARMS
                    SET PARM-CONV         TO TRUE
                    MOVE AJ-JOB-ON-DUTY-DATE
                                          TO PARM-PRI-DATE-GREG
                    PERFORM P9700-LINK-P903
                    IF NOT SUCCESS
                       MOVE 'P0240-2'     TO ERR-PARAGRAPH
                       MOVE 'P903LINK'    TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE PARM-PRI-DAY-OF-WEEK
                                          TO P08CA-CALL-DAY-OF-WEEK-NUM
                 ELSE
                    MOVE JSK1-ASGN-DAY-NUM
                                          TO P08CA-CALL-DAY-OF-WEEK-NUM
                 END-IF
                 IF AJ-JOB-ON-DUTY
                    MOVE AJ-JOB-ON-DUTY-DATE TO WS-CALL-DATE
                    MOVE AJ-JOB-ON-DUTY-HRMN TO WS-CALL-TIME
                    MOVE WS-CALL-DATE-TIME   TO WS-SCH-DATE-TIME
                 ELSE
                    IF P08CA-CALL-DAY-OF-WEEK-NUM = WS-SCH-DAY-FROM
                       MOVE WS-SCH-DATE-FROM TO WS-CALL-DATE
                    ELSE
                       MOVE WS-SCH-DATE-TO   TO WS-CALL-DATE
                    END-IF
                    MOVE JSK1-ASGN-START-TIME TO WS-CALL-TIME
                 END-IF
                 MOVE WS-CALL-DATE        TO SCR08-ORDER-DATE
      *CW0797 START
      ***                                    P08CA-SCH-CALL-DATE
      *CW0797 END
                 MOVE WS-CALL-TIME        TO SCR08-ORDER-TIME
      *CW0797 START
      ***                                    P08CA-SCH-CALL-TIME
      *CW0797 END
              END-IF
      *
      *CW0797 START
              IF P08CA-SCH-CALL-DATE-TIME <= ZERO
                 IF JOB-SCHED-ASGN-LIMIT
                    OR JOB-SCHED-ASGN-OFF
                    CONTINUE
                 ELSE
                    IF AJ-JOB-ON-DUTY
                       MOVE AJ-JOB-ON-DUTY-TIME
                         TO P08CA-SCH-CALL-DATE-TIME
                    ELSE
                       IF P08CA-CALL-DAY-OF-WEEK-NUM = WS-SCH-DAY-FROM
                          MOVE WS-SCH-DATE-FROM TO P08CA-SCH-CALL-DATE
                       ELSE
                          MOVE WS-SCH-DATE-TO TO P08CA-SCH-CALL-DATE
                       END-IF
                       MOVE JSK1-ASGN-START-TIME TO P08CA-SCH-CALL-TIME
                    END-IF
                 END-IF
              END-IF
      *CW0797 END
      *----------------------------------------------------------------*
      *                CONVERT TO PSTCA-TIME-ZONE                      *
      *----------------------------------------------------------------*
              IF (AJ-JOB-DIST              NOT = SCR08-DIST
               OR AJ-JOB-SUB-DIST          NOT = SCR08-SUB-DIST)
              AND AJ-OPEN-DATE-TIME > SPACES
                 MOVE SPACES              TO WORK-CNTLKEY
                 MOVE '02'                TO WK-CNTL-REC-TYPE
                 MOVE AJ-JOB-DIST         TO WK-CNTL-DIST
                 MOVE AJ-JOB-SUB-DIST     TO WK-CNTL-SUB-DIST
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P0240-3'    TO ERR-PARAGRAPH
                    MOVE CNTLKEY      TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE SPACES              TO TZ-PARAMETERS
                 MOVE CNTL-TIME-ZONE      TO TZ-IN-ZONE
                 MOVE PSTCA-TIME-ZONE     TO TZ-OUT-ZONE
                 MOVE AJ-OPEN-DATE-TIME   TO TZ-IN-DATE-TIME
                 PERFORM P8996-TIMEZONE
                 IF TZ-INVALID-PARAMETERS
                    MOVE '134000'     TO ERR-PARAGRAPH
                    PERFORM P8996-TZERROR
                 END-IF
                 MOVE TZ-OUT-DATE-TIME    TO AJ-OPEN-DATE-TIME
              END-IF
      *
      *    CNC0077 - FLW, 01/20/96, START
              IF NOT HAVE-XB-EMP
                 PERFORM P8020-GET-ASGN-EMPS
      * JES 10/11/10
                 IF NOT HAVE-ASGN-ON-DUTY-EMP
                 AND WK-ASGN-JOB-TYPE = 'X'
                    MOVE 'A' TO WK-ASGN-JOB-TYPE
                    PERFORM PXXXX-ON-DUTY-EMP
                    IF ASGN-EMP-NO > ZERO
                       MOVE ASGN-EMP-NO TO ASGN-ON-DUTY-EMP
                    END-IF
                 END-IF
              END-IF
      *    CNC0077 - FLW, 01/20/96, END
              PERFORM P1090-GET-JOB-QUALIFICATIONS
              PERFORM P1000-SETUP-EMPLOYEE-DATA
      * 03/23/11 JES
      *#1529S
      *       IF  P08CA-NOT-RESTED    (FUNC-SUB)
      *       AND P08CA-SAVE-CBCK-FLAG(FUNC-SUB) NOT = 'Y'
      *       AND NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *          SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
      *          MOVE SPACES TO P08CA-EMP-NO(FUNC-SUB)
      *          MOVE SCR08-NAME(FUNC-SUB) TO SCR08-NAMEB(FUNC-SUB)
      *          MOVE SCR08-ST  (FUNC-SUB) TO SCR08-STB  (FUNC-SUB)
      *          MOVE SCR08-ECC (FUNC-SUB) TO SCR08-ECCB (FUNC-SUB)
      *          PERFORM P1060-CLEAR-EMP-LINE
      *          MOVE WS-VACANCY-MSG(PSTCA-SUB) TO SCR08-NAME(FUNC-SUB)
      *       END-IF
           END-IF.
      *
       P0241-DETERMINE-IF-HOS-EXEMPT.
      *** 331E - NEW LOGIC TO SEE IF YARDMASTER JOBS ARE HOS EXEMPT
      *
           MOVE WS-CNTL-FILE            TO WS-CNTL-FILE-HOLD
      *
           MOVE WS-CNTL-FILE-HOLD-2A    TO WS-CNTL-FILE
           IF SUB-DIST-TYPE-2A-REC
              AND CNTL-DIST              = AJ-JOB-DIST
              AND CNTL-SUB-DIST          = AJ-JOB-SUB-DIST
              CONTINUE
           ELSE
              MOVE SPACES               TO WS-CNTL-FILE
              MOVE AJ-JOB-DIST          TO CNTL-DIST
              MOVE AJ-JOB-SUB-DIST      TO CNTL-SUB-DIST
              SET SUB-DIST-TYPE-2A-REC  TO TRUE
              MOVE CNTLKEY-AREA         TO WORK-CNTLKEY
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0241-1'         TO ERR-PARAGRAPH
                 MOVE CNTLKEY           TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              ELSE
                 MOVE WS-CNTL-FILE      TO WS-CNTL-FILE-HOLD-2A
              END-IF
           END-IF
      *
           IF CNTL-YDM-HOS-EXEMPT
              SET P08CA-HOS-EXEMPT(FUNC-SUB) TO TRUE
           END-IF
      *
           MOVE WS-CNTL-FILE-HOLD       TO WS-CNTL-FILE
           MOVE CNTLKEY-AREA            TO WORK-CNTLKEY.
      *
       P0250-SEE-IF-ASGN-CALLED-TODAY.
      *
           MOVE SPACES                     TO AH-KEY-1
                                              ERRORS-FOUND-CODE
           IF (YARD-CALL OR LOCAL-CALL)
              MOVE AJ-JOB-DIST                TO AHK1-DIST
              MOVE AJ-JOB-SUB-DIST            TO AHK1-SUB-DIST
              IF LOCAL-CALL
                 MOVE JOB-DEF-LOCAL-POOL      TO AHK1-POOL
                 MOVE SCR08-ASGN              TO AHK1-TRAIN-SYM
                 MOVE SCR08-ASGN-TYPE         TO AHK1-TRAIN-CODE
              ELSE
                 MOVE JOB-DEF-YARD-POOL       TO AHK1-POOL
                 MOVE SCR08-ASGN              TO AHK1-ASSIGNMENT
              END-IF
           ELSE
              IF TRCN-EN-FROM-DIST > SPACES
                 MOVE TRCN-EN-FROM-DIST       TO AHK1-DIST
                 MOVE TRCN-EN-FROM-SDIST      TO AHK1-SUB-DIST
                 MOVE TRCN-EN-FROM-POOL       TO AHK1-POOL
              ELSE
                 MOVE TRCN-TR-FROM-DIST       TO AHK1-DIST
                 MOVE TRCN-TR-FROM-SDIST      TO AHK1-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL       TO AHK1-POOL
              END-IF
              MOVE SCR08-ASGN                 TO AHK1-TRAIN-SYM
              MOVE SCR08-ASGN-TYPE            TO AHK1-TRAIN-CODE
           END-IF
      *----------------------------------------------------------------*
      *                CONVERT TO CNTL-TIME-ZONE                       *
      *----------------------------------------------------------------*
           IF AHK1-DIST                NOT = SCR08-DIST
           OR AHK1-SUB-DIST            NOT = SCR08-SUB-DIST
              MOVE SPACES              TO WORK-CNTLKEY
              MOVE '02'                TO WK-CNTL-REC-TYPE
              MOVE AHK1-DIST           TO WK-CNTL-DIST
              MOVE AHK1-SUB-DIST       TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0250-1'    TO ERR-PARAGRAPH
                 MOVE CNTLKEY      TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE SPACES              TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE      TO TZ-OUT-ZONE
              MOVE PSTCA-TIME-ZONE     TO TZ-IN-ZONE
              MOVE SCR08-ORDER-DATE    TO TZ-IN-DATE
              MOVE SCR08-ORDER-TIME    TO TZ-IN-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '135000'     TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME    TO AHK1-EFF-DATE-TIME
           ELSE
              MOVE SCR08-ORDER-DATE    TO AHK1-EFF-DATE
              MOVE SCR08-ORDER-TIME    TO AHK1-EFF-TIME
           END-IF
      *
           MOVE AH-KEY-1                      TO AH1KEY
           MOVE AH-FILE-VIA-K1                TO AH-DATASET
           PERFORM P8200-READ-AHIST
           IF SUCCESS
              MOVE AH-CALL-COMPLETE-FLAG TO P08CA-CALL-COMPLETE-FLAG
      * #1499
      *       IF NOT BYPASS-TOPC
              IF AH-TOPC-TRAIN-SYM > SPACES
                 MOVE 'Y' TO P08CA-CALL-COMPLETE-TOPC
              END-IF
              IF ROAD-SERVICE-CALL
                 IF AH-MISC-CREW-CANCELED
                    MOVE 'B101' TO MSGLOG-CODE
      *             'TRAIN ALREADY CALLED & CANCELLED FOR THIS DATE/TIME
                    MOVE -1 TO SCR08-ORDER-TIME-CURSOR
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              END-IF

              IF AH-SIDE-TRIP
                 MOVE 'Y' TO SCR08-SIDE-TRIP
              END-IF

              MOVE AH-DH-RSN               TO SCR08-DH-RSN
              IF AH-TIE-UP-DATE-TIME > '0000000000'
                 OR AH-TIE-UP-SET
                 IF ROAD-SERVICE-CALL
                    MOVE SPACE TO P08CA-CALL-SET-CODE
                    MOVE 'B102' TO MSGLOG-CODE
      *             'ASSIGNMENT HAS BEEN CALLED/TIED UP FOR THIS TIME'
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 ELSE
                    MOVE 'B103' TO MSGLOG-CODE
      *             'CAUTION - ASSIGNMENT HAS BEEN CALLED/TIED.....'
                 END-IF
              END-IF
           END-IF.
      *
       P0260-SYNC-VRUINFO.
      *
           MOVE SPACES                        TO VRUINFO-FILE
           MOVE P08CA-TASK-KEY                TO VRUINFO-TASK-KEY
           PERFORM P9330-READ-VRUINFO
           IF  SUCCESS
           AND NOT VRUINFO-YARD-BUILT-NEW
              PERFORM P9310-READ-UPDATE-VRUINFO
              IF SUCCESS
                 PERFORM VARYING VRUINFO-CC-SUB FROM 1 BY 1
                         UNTIL VRUINFO-CC-SUB > VRUINFO-CC-MAX
                    IF VRUINFO-CRAFT(VRUINFO-CC-SUB) > SPACES
                       IF VRUINFO-CRAFT(VRUINFO-CC-SUB) NOT =
                                       SCR08-CC(VRUINFO-CC-SUB)
                          PERFORM P0265-FIND-CC-POSITION
                       END-IF
                    ELSE
                       MOVE SCR08-CC(VRUINFO-CC-SUB)
                                       TO VRUINFO-CRAFT(VRUINFO-CC-SUB)
                    END-IF
                 END-PERFORM
                 PERFORM P9320-REWRITE-VRUINFO
      *#1471, #1473
              ELSE
                 EXEC CICS UNLOCK
                           DATASET(VRU-INFO-FILE)
                           RESP(WS-RESPONSE)
                 END-EXEC
              END-IF
           END-IF
           .
      *
       P0265-FIND-CC-POSITION.
      *
           PERFORM VARYING SUBY FROM 1 BY 1
                   UNTIL SUBY > VRUINFO-CC-MAX
              IF SCR08-CC(SUBY) = VRUINFO-CRAFT(VRUINFO-CC-SUB)
                 MOVE VRUINFO-CREW-ITEM(VRUINFO-CC-SUB)
                   TO VRUINFO-CREW-ITEM(SUBY)
                 MOVE SPACES        TO VRUINFO-CREW-ITEM(VRUINFO-CC-SUB)
                    MOVE SCR08-CC(VRUINFO-CC-SUB)
                                    TO VRUINFO-CRAFT(VRUINFO-CC-SUB)
                 MOVE VRUINFO-CC-MAX TO SUBY
              END-IF
           END-PERFORM
           .
      *
       P0300-PROCESS-ROAD-INPUT.
      *
      *----------------------------------------------------------------*
      *    CONVERT SYSTEM DATE/TIME TO LOCAL DATE/TIME
      *----------------------------------------------------------------*
           MOVE SPACES               TO TZ-PARAMETERS
           MOVE TZ-SYSTEM-TIME-ZONE  TO TZ-IN-ZONE
           MOVE WS-PRESENT-TIME      TO TZ-IN-DATE-TIME
           MOVE PSTCA-TIME-ZONE      TO TZ-OUT-ZONE
           PERFORM P8996-TIMEZONE
           IF TZ-INVALID-PARAMETERS
              MOVE '136000'     TO ERR-PARAGRAPH
              PERFORM P8996-TZERROR
           END-IF
           MOVE TZ-OUT-DATE-TIME-CENT TO WS-LOCAL-DATE-TIME-CENT

           MOVE DEFAULT-ATTR    TO SCR08-ASGN-HI
                                   SCR08-ASGN-TYPE-HI
                                   SCR08-ORDER-DATE-HI
                                   SCR08-ORDER-TIME-HI
      *CNC0520-BEG
                                   SCR08-ROUTE-DSGN-HI
      *CNC0520-END
                                   SCR08-CALL-COMPLETE-HI
                                   SCR08-DH-RSN-HI
                                   SCR08-SIDE-TRIP-HI
           PERFORM P1070-RESET-COLORS
           MOVE SPACES TO SCR08-ERRORMSG
           STRING SCR08-ASGN
                  SCR08-ASGN-TYPE
                  DELIMITED BY SIZE
                  INTO WS-FORMAT-TRAIN
           EVALUATE TRUE
              WHEN ENTER-KEY
                   CONTINUE
              WHEN PFKEY5
                   IF P08CA-IVR-CALL-NOT-ACTIVE
                      PERFORM P5111-COMPANY-EDIT
                      IF NOT CNTL-OUTBND-IVR-CALL-ACTIVE
      *    'IVR NOT AVAILABLE-VERIFY "OPTION 16" IF MANUAL INTERVENTION
      *    REQUIRED'
                         MOVE 'I606'          TO MSGLOG-CODE
                         MOVE -1              TO SCR08-FUNC-CURSOR(1)
                         PERFORM P9000-SEND-MAP-AND-RETURN
                      ELSE
      *                 'IVR CALLS ARE NOT ACTIVE FOR THIS JOB'
                         MOVE 'I392'          TO MSGLOG-CODE
                         MOVE -1              TO SCR08-FUNC-CURSOR(1)
                         PERFORM P9000-SEND-MAP-AND-RETURN
                      END-IF
                   END-IF
                   IF P08CA-CALL-SET
                      PERFORM P5000-PREFILL-VCLL
                   ELSE
      *        'F5=IVR CALL NOT VALID UNTIL ON-DUTY TIME IS ESTABLISHED'
                      MOVE 'F210'             TO MSGLOG-CODE
                      MOVE -1                 TO SCR08-FUNC-CURSOR(1)
                      PERFORM P9000-SEND-MAP-AND-RETURN
                   END-IF
      *CNC0520-BEG
              WHEN PFKEY6
                   SET EMP-NOT-CALLED       TO TRUE
                   PERFORM VARYING SUB7 FROM 1 BY 1
                             UNTIL SUB7 > ARRAY-MAX
                     IF SCR08-ST(SUB7) = 'B0'
                        SET EMP-CALLED      TO TRUE
                     END-IF
                   END-PERFORM
                   IF EMP-CALLED
                      MOVE -1               TO SCR08-ASGN-CURSOR
      *           'PF6 NOT VALID,CREW IS ALREADY CALLED'
                      MOVE 'F220'           TO MSGLOG-CODE
                      MOVE PROTECT-MDT      TO SCR08-ROUTE-DSGN-ATTR
                      PERFORM P9000-SEND-MAP-AND-RETURN
                   END-IF
                   IF P08CA-IVR-CALL-NOT-ACTIVE
                      MOVE -1               TO SCR08-ASGN-CURSOR
      *                 INVALID-FUNC-MSG
                      MOVE 'I006'           TO MSGLOG-CODE
                      PERFORM P9000-SEND-MAP-AND-RETURN
                   END-IF
                   MOVE P08CA-PROFILE-KEY   TO TRCNKEY1
                   PERFORM P8001-READ-TRCNKEY1-ONLY
                   SET P08CCA-PRE-CALL-MODE TO TRUE
                   PERFORM P9126-SETUP-SCR08F-PF6
      *CNC0520-END
              WHEN PFKEY11
                   IF P08CA-IVR-CALL-NOT-ACTIVE
                      MOVE -1               TO SCR08-ASGN-CURSOR
      *                 INVALID-FUNC-MSG
                      MOVE 'I006'              TO MSGLOG-CODE
                      PERFORM P9000-SEND-MAP-AND-RETURN
                   END-IF
                   IF NOT P08CA-CALL-SET
      *               'F11 NOT VALID UNTIL ON-DUTY TIME IS ESTABLISHED'
                      MOVE 'F211'             TO MSGLOG-CODE
                      MOVE -1                 TO SCR08-FUNC-CURSOR(1)
                      PERFORM P9000-SEND-MAP-AND-RETURN
                   END-IF
                   MOVE P08CA-PROFILE-KEY     TO TRCNKEY1
                   PERFORM P8000-READ-TRCNKEY1
                   IF LOCAL-CALL
                      IF AJ-JOB-DIST     NOT > SPACES
                         MOVE TRCN-DIST       TO AJ-JOB-DIST
                      END-IF
                      IF AJ-JOB-SUB-DIST NOT > SPACES
                         MOVE TRCN-SDIST      TO AJ-JOB-SUB-DIST
                      END-IF
                   END-IF
                   PERFORM P0250-SEE-IF-ASGN-CALLED-TODAY
                   IF SUCCESS
      *               'F11 NOT VALID AFTER CALL ESTABLISHED'
                      MOVE 'F212'             TO MSGLOG-CODE
                      MOVE -1                 TO SCR08-FUNC-CURSOR(1)
                      PERFORM P9000-SEND-MAP-AND-RETURN
                   END-IF
                   IF P08CA-TASK-KEY NOT > SPACES
                      PERFORM P9600-READ-TSQUEUE
                      MOVE PSTCA-DIST          TO AHK1-DIST
                      MOVE PSTCA-SUB-DIST      TO AHK1-SUB-DIST
                      MOVE 'PC'                TO AHK1-POOL
                      MOVE SCR08-ASGN          TO AHK1-TRAIN-SYM
                      MOVE SCR08-ASGN-TYPE     TO AHK1-TRAIN-CODE
                      MOVE SCR08-ORDER-DATE    TO AHK1-EFF-DATE
                      MOVE SCR08-ORDER-TIME    TO AHK1-EFF-TIME
                      MOVE AH-KEY-1            TO P08CA-PRE-CALL-TOC-KEY
      *               PERFORM P7000-WRITE-TSQUEUE
                      MOVE FUNC-SUB            TO P08-TSQ-FUNC-SUB
                      PERFORM P9550-REWRITE-TSQUEUE
                      MOVE AH-KEY-1            TO P08CCA-ASGN-HIST-KEY
                   ELSE
      *               PERFORM P7000-WRITE-TSQUEUE
                      MOVE P08CA-TASK-KEY      TO WK-CCA-TASK-KEY
                   END-IF
                   SET P08CCA-PRE-CALL-MODE TO TRUE
                   PERFORM P9125-SETUP-SCR08C-PF11
              WHEN OTHER
                   MOVE -1                  TO SCR08-ASGN-CURSOR
      *                 INVALID-FUNC-MSG
                   MOVE 'I006'              TO MSGLOG-CODE
                   PERFORM P9000-SEND-MAP-AND-RETURN
           END-EVALUATE
      *
           IF P08CA-CALL-SET
              PERFORM P2000-PROCESS-FUNCTIONS
           ELSE
              IF P08CA-TURNS-RESET
                 PERFORM VARYING FUNC-SUB FROM 1 BY 1
                    UNTIL FUNC-SUB > ARRAY-MAX
                    IF SCR08-CC(FUNC-SUB) > SPACES
                       IF SCR08-OD-DATE(FUNC-SUB) > SPACES
                          OR SCR08-OD-TIME(FUNC-SUB) > SPACES
                          MOVE SCR08-ORDER-DATE TO DE-YYMMDD
                          SET DE-YYMMDD-FORMAT TO TRUE
                          PERFORM P8998-DATEEDIT
                          IF DE-INVALID-DATE
                             MOVE -1 TO SCR08-ORDER-DATE-CURSOR
                             MOVE REV-VIDEO TO SCR08-ORDER-DATE-HI
      *                           INVALID-DATE-MSG
                             MOVE 'I034' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                          MOVE SCR08-ORDER-TIME TO TE-MILITARY-TIME
                          SET TE-MILITARY-FORMAT TO TRUE
                          PERFORM P8997-TIMEEDIT
                          IF TE-INVALID-TIME
                             MOVE -1 TO SCR08-ORDER-TIME-CURSOR
                             MOVE REV-VIDEO TO SCR08-ORDER-TIME-HI
      *                           INVALID-TIME-MSG
                             MOVE 'I022' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
      *
      *08/01/23 RJA B CNC0600 CNLD-270
                          MOVE SCR08-OD-DATE(FUNC-SUB) TO DE-YYMMDD
                          SET DE-YYMMDD-FORMAT TO TRUE
                          PERFORM P8998-DATEEDIT
                          IF DE-INVALID-DATE
                             MOVE -1 TO SCR08-OD-DATE-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO
                                     TO SCR08-OD-DATE-HI(FUNC-SUB)
      *                           INVALID-DATE-MSG
                             MOVE 'I034' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                          MOVE SCR08-OD-TIME(FUNC-SUB)
                                                TO TE-MILITARY-TIME
                          SET TE-MILITARY-FORMAT TO TRUE
                          PERFORM P8997-TIMEEDIT
                          IF TE-INVALID-TIME
                             MOVE -1 TO SCR08-OD-TIME-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO
                                           TO SCR08-OD-TIME-HI(FUNC-SUB)
      *                           INVALID-TIME-MSG
                             MOVE 'I022' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
                          MOVE SCR08-OD-DATE(FUNC-SUB)
                                      TO WS-CALL-DATE
                          MOVE SCR08-OD-TIME(FUNC-SUB)
                                      TO WS-CALL-TIME
                          SET DETAIL-CALL-CHECK TO TRUE
                          PERFORM P1030-EDIT-CALL-DATE

                          IF ERRORS-FOUND
                             MOVE -1  TO SCR08-OD-DATE-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO
                                      TO SCR08-OD-DATE-HI(FUNC-SUB)
                                         SCR08-OD-TIME-HI(FUNC-SUB)
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
      *08/01/23 RJA B CNC0600 CNLD-270
                          MOVE SCR08-OD-DATE(FUNC-SUB)
                                 TO P08CA-USER-ENTERED-DATE(FUNC-SUB)
                          MOVE SCR08-OD-TIME(FUNC-SUB)
                                 TO P08CA-USER-ENTERED-TIME(FUNC-SUB)
      *08/01/23 RJA E CNC0600 CNLD-270
                       ELSE
                          IF P08CA-SETBACK-CALL
                             AND SCR08-CC(FUNC-SUB) = TASK-INFO(11:2)
                             MOVE WS-TASK-DATE
      *08/01/23 RJA B CNC0600 CNLD-270
      *                               TO SCR08-OD-DATE(FUNC-SUB)
                                      TO
      *08/01/23 RJA E CNC0600 CNLD-270
                                         WS-CALL-DATE
                             MOVE WS-TASK-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      *                               TO SCR08-OD-TIME(FUNC-SUB)
                                      TO
      *08/01/23 RJA E CNC0600 CNLD-270
                                         WS-CALL-TIME
                          ELSE
                             MOVE SCR08-ORDER-DATE
      *08/01/23 RJA B CNC0600 CNLD-270
      *                               TO SCR08-OD-DATE(FUNC-SUB)
                                      TO
      *08/01/23 RJA E CNC0600 CNLD-270
                                         WS-CALL-DATE
                             MOVE SCR08-ORDER-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      *                               TO SCR08-OD-TIME(FUNC-SUB)
                                      TO
      *08/01/23 RJA E CNC0600 CNLD-270
                                         WS-CALL-TIME
                          END-IF
                          PERFORM P1080-CALC-EMP-OD-TIME
                       END-IF
                       IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                          MOVE SCR08-TAXI-TM(FUNC-SUB)
                                                   TO TE-MILITARY-TIME
                          SET TE-MILITARY-FORMAT   TO TRUE
                          PERFORM P8997-TIMEEDIT
                          IF TE-INVALID-TIME
                             MOVE -1  TO SCR08-TAXI-TM-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO
                                      TO SCR08-TAXI-TM-HI(FUNC-SUB)
      *                      INVALID-TIME-MSG
                             MOVE 'I022'    TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                       ELSE
                          IF UFP-CALL
      *#1466
                             IF P08CA-SAVE-TAXI-TM(FUNC-SUB) = SPACES
                                PERFORM P0305-FIND-TAXI-TIME
                             ELSE
                                MOVE 'SPAC'
                                   TO P08CA-SAVE-TAXI-TM(FUNC-SUB)
                             END-IF
                          END-IF
                       END-IF
                       IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                          MOVE SCR08-TAXI-TM(FUNC-SUB)
                                TO P08CA-SAVE-TAXI-TM(FUNC-SUB)
                       END-IF
                    END-IF
                 END-PERFORM
                 MOVE SPACES       TO P08CA-SCREEN-COMMAREA
                 SET P08CA-TURNS-RESET
                                   TO TRUE
              ELSE
                 MOVE SPACES       TO P08CA-SCREEN-COMMAREA
                 IF P08CA-SETBACK-CALL
                    PERFORM VARYING FUNC-SUB FROM 1 BY 1
                       UNTIL FUNC-SUB > ARRAY-MAX
                       IF SCR08-CC(FUNC-SUB) > SPACES
                          AND SCR08-CC(FUNC-SUB) = TASK-INFO(11:2)
                          MOVE WS-TASK-DATE   TO SCR08-OD-DATE(FUNC-SUB)
                          MOVE WS-TASK-TIME   TO SCR08-OD-TIME(FUNC-SUB)
                       END-IF
                    END-PERFORM
                 END-IF
              END-IF

              IF SCR08-ASGN NOT > SPACES
                 MOVE -1 TO SCR08-ASGN-CURSOR
                 MOVE REV-VIDEO TO SCR08-ASGN-HI
      *               'TRAIN SYMBOL IS REQUIRED'
                 MOVE 'T001' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
              IF SCR08-ASGN-TYPE NOT > SPACES
                 MOVE SPACES TO SCR08-ASGN-TYPE
              END-IF
      *
              PERFORM P0315-EDIT-TRAIN-SYMBOL
      *CNC0520-BEG
              PERFORM P9051-RESET-ATTRIBUTES
              IF SCR08-ROUTE-DSGN > SPACES
                 PERFORM P0317-EDIT-ROUTE-DSGN
              ELSE
                 MOVE P08CA-PROFILE-KEY            TO TRCNKEY1
                 PERFORM P8001-READ-TRCNKEY1-ONLY
                 IF SUCCESS
                    MOVE TRCN-ROUTE-DESIGNATION    TO SCR08-ROUTE-DSGN
                 END-IF
              END-IF
      *CNC0520-END
      *
              IF  SCR08-SIDE-TRIP > SPACE
              AND SCR08-SIDE-TRIP NOT = 'Y'
                 MOVE -1 TO SCR08-SIDE-TRIP-CURSOR
                 MOVE REV-VIDEO TO SCR08-SIDE-TRIP-HI
      *          MOVE INVALID-CODE-MSG TO SCR08-ERRORMSG
                 MOVE 'I041' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
      *
      *       SEE IF TRAIN ALREADY CALLED
      *
              MOVE P08CA-PROFILE-KEY   TO TRCNKEY1
              PERFORM P8000-READ-TRCNKEY1
              IF NOT LOCAL-CALL
                 PERFORM P0310-SETUP-DISPLAY
                 PERFORM P1021-SET-VRU-CALL-ATTR
              ELSE
                 PERFORM P0210-FIND-ASSIGNED-CREW
              END-IF
              IF NOT P08CA-CALL-SET
                 IF SCR08-DH-RSN > SPACES
                    IF SCR08-DH-RSN NOT NUMERIC
                       MOVE -1                TO SCR08-DH-RSN-CURSOR
                       MOVE REV-VIDEO         TO SCR08-DH-RSN-HI
      *                     INVALID-DEADHEAD-REASON-MSG
                       MOVE 'I108'            TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 ELSE
      *
      *             CNC0482 - DH REASON REQUIRED WHEN DEALING WITH
      *             A 'DEADHEAD FORMAT' CREW PROFILE.
      *
                    MOVE TRCN-TRAIN-ID-FORMAT TO WS-FORMAT-TYPE
                    IF WS-DH-FORMAT
                       AND SCR08-DH-RSN-ATTR NOT = AUTOSKIP-MDT
                       MOVE -1                TO SCR08-DH-RSN-CURSOR
                       MOVE REV-VIDEO         TO SCR08-DH-RSN-HI
      *                     'DEADHEAD REASON REQUIRED'
                       MOVE 'D109'            TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
                 MOVE SCR08-ORDER-DATE   TO DE-YYMMDD
                 SET DE-YYMMDD-FORMAT    TO TRUE
                 PERFORM P8998-DATEEDIT
                 IF DE-INVALID-DATE
                    MOVE -1 TO SCR08-ORDER-DATE-CURSOR
                    MOVE REV-VIDEO TO SCR08-ORDER-DATE-HI
      *                  INVALID-DATE-MSG
                    MOVE 'I034' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 MOVE SCR08-ORDER-TIME TO TE-MILITARY-TIME
                 SET TE-MILITARY-FORMAT   TO TRUE
                 PERFORM P8997-TIMEEDIT
                 IF TE-INVALID-TIME
                    MOVE -1 TO SCR08-ORDER-TIME-CURSOR
                    MOVE REV-VIDEO TO SCR08-ORDER-TIME-HI
      *                  INVALID-TIME-MSG
                    MOVE 'I022' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
      *08/01/23 RJA B CNC0600     (2)  CNLD-270
      **CNLD-244 #2 B - RPV1  - ROAD JOB AFTER ENTER
      *           IF WS-CAN-WRR-FLAG NOT > SPACE
      *              MOVE WS-CNTL-FILE        TO WS-CNTL-FILE-HOLD
      *              MOVE SPACES              TO WORK-CNTLKEY
      *              MOVE '02'                TO WK-CNTL-REC-TYPE
      *              MOVE SCR08-DIST            TO WK-CNTL-DIST
      *              MOVE SCR08-SUB-DIST        TO WK-CNTL-SUB-DIST
      *              PERFORM P8610-READ-CNTLFILE
      *              IF NOT SUCCESS
      *                 MOVE 'P0300-2'        TO ERR-PARAGRAPH
      *                 MOVE WORK-CNTLKEY     TO ERR-KEY
      *                 PERFORM P9999-GOT-PROBLEM
      *              END-IF
      *              MOVE CNTL-CAN-WRR-FLAG   TO WS-CAN-WRR-FLAG
      **CNLD-265-B
      *              MOVE CNTL-US-DOM         TO WS-US-DOM-FL
      **CNLD-265-E
      *              MOVE WS-CNTL-FILE-HOLD   TO WS-CNTL-FILE
      *              MOVE CNTLKEY-AREA        TO WORK-CNTLKEY
      *           END-IF
      ** GET THE PREP VALUES
      *           IF WS-CALL-DATE NOT > SPACES
      *              AND WS-CAN-WRR-NEW
      *              MOVE ZEROES TO DATE-CONVERSION-PARMS
      *              PERFORM P6040-GET-PREP-TIME
      *              MOVE WS-CALC-OD-DATE    TO WS-CALL-DATE
      *                                         WS-PREP-OD-DATE
      *              MOVE WS-CALC-OD-TIME    TO WS-CALL-TIME
      *                                         WS-PREP-OD-TIME
      *           ELSE
      **CNLD-244 #2 E - RPV
      *08/01/23 RJA E CNLD-270
                    MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                    MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - RPV
      *           END-IF
      **CNLD-244 #2 E - RPV
      *08/01/23 RJA E CNLD-270
                 SET SUMMARY-CALL-CHECK TO TRUE
                 PERFORM P1030-EDIT-CALL-DATE
                 IF ERRORS-FOUND
                    MOVE -1 TO SCR08-ORDER-DATE-CURSOR
                    MOVE REV-VIDEO     TO SCR08-ORDER-DATE-HI
                                          SCR08-ORDER-TIME-HI
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 MOVE AUTOSKIP-MDT     TO SCR08-ASGN-ATTR
                                          SCR08-ASGN-TYPE-ATTR
                                          SCR08-ORDER-DATE-ATTR
                                          SCR08-ORDER-TIME-ATTR
                                          SCR08-DH-RSN-ATTR
                                          SCR08-SIDE-TRIP-ATTR
      *CNC0520-BEG
                 PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END
      *
      *          GET CALL DAY OF WEEK
      *
                 MOVE ZEROS TO DATE-CONVERSION-PARMS
                 SET PARM-CONV          TO TRUE
                 MOVE SCR08-ORDER-DATE TO PARM-PRI-DATE-GREG
                 PERFORM P9700-LINK-P903
                 IF NOT SUCCESS
                    MOVE 'P0300-1' TO ERR-PARAGRAPH
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE PARM-PRI-DAY-OF-WEEK    TO P08CA-CALL-DAY-OF-WEEK
                 SET P08CA-CALL-SET           TO TRUE
              END-IF
              IF LOCAL-CALL
                 PERFORM P0215-FIND-REMAIN-ASGNMTS
                 PERFORM P1021-SET-VRU-CALL-ATTR
              ELSE
                 PERFORM P0250-SEE-IF-ASGN-CALLED-TODAY
                 IF NOT ERRORS-FOUND
                    PERFORM P0330-FIND-UNASSIGNED-CREW
                 END-IF
              END-IF
      *CNC0520-BEG
              PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END
              IF NOT ERRORS-FOUND
                 IF NOT P08CA-TURNS-RESET
                    PERFORM P8030-DELETE-MU-ASGN
                    MOVE ' '        TO P08CA-CALL-SET-CODE
                    SET P08CA-TURNS-RESET
                                    TO TRUE
                    MOVE 'T193'     TO MSGLOG-CODE
                    PERFORM VARYING FUNC-SUB FROM 1 BY 1
                       UNTIL FUNC-SUB > ARRAY-MAX
                       IF SCR08-CC(FUNC-SUB) > SPACES
      *08/01/23 RJA B CNC0600     (3) CNLD-270
      ***CNLD-244 #2 B - RPV1 - ROAD JOB FIRST ENTER
      *                    IF NOT WS-CAN-WRR-NEW
      *                       MOVE SPACES TO SCR08-OD-DATE(FUNC-SUB)
      *                                      SCR08-OD-TIME(FUNC-SUB)
      *                    END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNLD-270
                          MOVE SPACES  TO
                                          SCR08-OD-DATE(FUNC-SUB)
                                           SCR08-OD-TIME(FUNC-SUB)
                                          SCR08-TAXI-TM(FUNC-SUB)
      *TJR 03/01/2001 CLEAR OUT OUR SAVED SCREEN FIELDS ALSO
                                P08CA-USER-ENTERED-DATE(FUNC-SUB)
                                P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                P08CA-USER-ENTERED-TIME(FUNC-SUB)
                                P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                P08CA-SAVE-OD-DTTM(FUNC-SUB)
                                P08CA-SAVE-TAXI-TM(FUNC-SUB)
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - RPV1
      *                   IF WS-PREP-OD-DATE > SPACES
      *                     AND SCR08-OD-DATE(FUNC-SUB) NOT > SPACES
      *                     AND WS-CAN-WRR-NEW
      *                      MOVE WS-PREP-OD-DATE TO
      *                                 SCR08-OD-DATE(FUNC-SUB)
      *                      MOVE WS-PREP-OD-TIME TO
      *                                 SCR08-OD-TIME(FUNC-SUB)
      *                   END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNLD-270
                       END-IF
                    END-PERFORM
                 END-IF
              END-IF
           END-IF.
      *
       P0305-FIND-TAXI-TIME.
      *
           MOVE SPACES                        TO WS-CNTL-TAXI-TIME
           MOVE P08CA-PROFILE-KEY             TO TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           MOVE SPACES                        TO WS-CNTL-FILE
           SET CREW-PROFILE-REC               TO TRUE
           MOVE 'F'                           TO CNTL-POOL-TYPE-3A
           MOVE SCR08-CC(FUNC-SUB)            TO WS-CRAFT-CODE-CHECK
           IF ENGINE-CRAFT
              MOVE TRCN-EN-FROM-DIST          TO CNTL-DIST-3A
              MOVE TRCN-EN-FROM-SDIST         TO CNTL-SUB-DIST-3A
              MOVE TRCN-EN-FROM-POOL          TO CNTL-POOL-CODE-3A
           ELSE
              MOVE TRCN-TR-FROM-DIST          TO CNTL-DIST-3A
              MOVE TRCN-TR-FROM-SDIST         TO CNTL-SUB-DIST-3A
              MOVE TRCN-TR-FROM-POOL          TO CNTL-POOL-CODE-3A
           END-IF
           MOVE CNTLKEY-AREA                  TO WORK-CNTLKEY
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P0305-1'                  TO ERR-PARAGRAPH
              MOVE CNTLKEY                    TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF ENGINE-CRAFT
              IF TRCN-EN-FROM-TERM         = '0'
                 MOVE CNTL-3A-TAXI-TIME(1)    TO WS-CNTL-TAXI-TIME
              ELSE
                 MOVE TRCN-EN-FROM-TERM       TO SUB4-ALPHA
                 ADD 1                        TO SUB4
                 MOVE CNTL-3A-TAXI-TIME(SUB4)
                                              TO WS-CNTL-TAXI-TIME
              END-IF
           ELSE
              IF TRCN-TR-FROM-TERM         = '0'
                 MOVE CNTL-3A-TAXI-TIME(1)    TO WS-CNTL-TAXI-TIME
              ELSE
                 MOVE TRCN-TR-FROM-TERM       TO SUB4-ALPHA
                 ADD 1                        TO SUB4
                 MOVE CNTL-3A-TAXI-TIME(SUB4)
                                              TO WS-CNTL-TAXI-TIME
              END-IF
           END-IF
           IF WS-CNTL-TAXI-TIME > SPACES
              AND WS-CNTL-TAXI-TIME  NOT = '0000'
              MOVE ZEROS                TO DATE-CONVERSION-PARMS
              SET PARM-SUBTRACT         TO TRUE
              MOVE SCR08-ORDER-DATE     TO PARM-PRI-DATE-GREG
              MOVE SCR08-ORDER-TIME     TO PARM-PRI-HRMN
              MOVE WS-CNTL-TAXI-TIME    TO PARM-SEC-HRMN
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P0305-2'         TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-HRMN        TO SCR08-TAXI-TM(FUNC-SUB)
           END-IF
           .
      *
       P0310-SETUP-DISPLAY.
      *
      *    SAVE OFF THE SUB DIST LEAD TIMES
      *
           MOVE ZEROES               TO DEFAULT-EN-LEAD-TIME
                                        DEFAULT-TR-LEAD-TIME
           MOVE SPACES               TO WORK-CNTLKEY
           MOVE '02'                 TO WK-CNTL-REC-TYPE
           IF TRCN-EN-FROM-AREA > SPACES
              MOVE TRCN-EN-FROM-DIST TO WK-CNTL-DIST
              MOVE TRCN-EN-FROM-SDIST TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0310-1'       TO ERR-PARAGRAPH
                 MOVE CNTLKEY         TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-LEAD-CALL-TIME TO DEFAULT-EN-LEAD-TIME
           END-IF
           IF TRCN-TR-FROM-AREA > SPACES
              IF TRCN-TR-FROM-DIST = TRCN-EN-FROM-DIST AND
                 TRCN-TR-FROM-SDIST = TRCN-EN-FROM-SDIST
                 MOVE CNTL-LEAD-CALL-TIME TO DEFAULT-TR-LEAD-TIME
              ELSE
                 MOVE TRCN-TR-FROM-DIST   TO WK-CNTL-DIST
                 MOVE TRCN-TR-FROM-SDIST  TO WK-CNTL-SUB-DIST
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P0310-2'       TO ERR-PARAGRAPH
                    MOVE CNTLKEY         TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE CNTL-LEAD-CALL-TIME TO DEFAULT-TR-LEAD-TIME
              END-IF
           END-IF
      *
      *    LOAD ENGINE SERVICE CRAFT ARRAY
      *
           MOVE ZEROS                 TO SUB1
           MOVE SPACES                TO WORK-CNTLKEY
           MOVE '03'                  TO WK-CNTL-REC-TYPE
           IF TRCN-EN-FROM-AREA > SPACES
              MOVE TRCN-EN-FROM-DIST  TO WK-CNTL-DIST
              MOVE TRCN-EN-FROM-SDIST TO WK-CNTL-SUB-DIST
              MOVE TRCN-EN-FROM-POOL  TO WK-CNTL-POOL
              MOVE 'F'                TO WK-CNTL-POOL-TYPE
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0310-3'       TO ERR-PARAGRAPH
                 MOVE CNTLKEY         TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF TRCN-EN-FROM-TERM = '0'
                 MOVE CNTL-POOL-HOME-LEAD-TIME TO P08CA-EN-LEAD-TIME
              ELSE
                 MOVE TRCN-EN-FROM-TERM TO SUB4-ALPHA
                 MOVE CNTL-AWAY-LTIME (SUB4)
                                      TO P08CA-EN-LEAD-TIME
              END-IF
              IF DEFAULT-EN-LEAD-TIME > ZEROES AND
                 P08CA-EN-LEAD-TIME NOT GREATER THAN ZEROES
                 MOVE DEFAULT-EN-LEAD-TIME  TO P08CA-EN-LEAD-TIME
              END-IF
              IF TRCN-ADDL-LEAD-TIME > SPACES
                 MOVE P08CA-EN-LEAD-TIME    TO WS-LEAD-TIME
                 MOVE WS-LEAD-TIME-MN       TO WS-LEAD-TIME-MN3
                 ADD TRCN-ADDL-LEAD-TIME-HR TO WS-LEAD-TIME-HR
                 ADD TRCN-ADDL-LEAD-TIME-MN TO WS-LEAD-TIME-MN3
                 IF WS-LEAD-TIME-MN3 > 60
                    ADD 1         TO WS-LEAD-TIME-HR
                    SUBTRACT 60 FROM WS-LEAD-TIME-MN3
                 END-IF
                 MOVE WS-LEAD-TIME-MN3      TO WS-LEAD-TIME-MN
                 MOVE WS-LEAD-TIME          TO P08CA-EN-LEAD-TIME
              END-IF
              IF CNTL-POOL-EN-CRAFT = ('Y' OR 'O')
                 ADD 1 TO SUB1
                 MOVE 'EN'            TO SCR08-CC(SUB1)
              END-IF
              IF CNTL-POOL-FI-CRAFT = ('Y' OR 'O')
                 ADD 1 TO SUB1
                 MOVE 'FI'            TO SCR08-CC(SUB1)
              ELSE
                 IF CNTL-POOL-SE-CRAFT = ('Y' OR 'O')
                    ADD 1 TO SUB1
                    MOVE 'SE'         TO SCR08-CC(SUB1)
                 END-IF
              END-IF
              ADD 1 TO SUB1
              MOVE 'ET'                  TO SCR08-CC(SUB1)
           END-IF
      *
      *    LOAD TRAIN SERVICE CRAFT ARRAY
      *
           IF TRCN-TR-FROM-AREA > SPACES
              IF TRCN-TR-FROM-DIST  NOT = WK-CNTL-DIST
              OR TRCN-TR-FROM-SDIST NOT = WK-CNTL-SUB-DIST
              OR TRCN-TR-FROM-POOL  NOT = WK-CNTL-POOL
                 MOVE TRCN-TR-FROM-DIST  TO WK-CNTL-DIST
                 MOVE TRCN-TR-FROM-SDIST TO WK-CNTL-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL  TO WK-CNTL-POOL
                 MOVE 'F'                TO WK-CNTL-POOL-TYPE
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P0310-4'       TO ERR-PARAGRAPH
                    MOVE CNTLKEY         TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              IF TRCN-TR-FROM-TERM = '0'
                 MOVE CNTL-POOL-HOME-LEAD-TIME TO P08CA-TR-LEAD-TIME
              ELSE
                 MOVE TRCN-TR-FROM-TERM TO SUB4-ALPHA
                 MOVE CNTL-AWAY-LTIME (SUB4)
                                        TO P08CA-TR-LEAD-TIME
              END-IF
              IF DEFAULT-TR-LEAD-TIME GREATER THAN ZEROES AND
                 P08CA-TR-LEAD-TIME NOT GREATER THAN ZEROES
                 MOVE DEFAULT-TR-LEAD-TIME  TO P08CA-TR-LEAD-TIME
              END-IF
              IF TRCN-ADDL-LEAD-TIME > SPACES
                 MOVE P08CA-TR-LEAD-TIME    TO WS-LEAD-TIME
                 MOVE WS-LEAD-TIME-MN       TO WS-LEAD-TIME-MN3
                 ADD TRCN-ADDL-LEAD-TIME-HR TO WS-LEAD-TIME-HR
                 ADD TRCN-ADDL-LEAD-TIME-MN TO WS-LEAD-TIME-MN3
                 IF WS-LEAD-TIME-MN3 > 60
                    ADD 1         TO WS-LEAD-TIME-HR
                    SUBTRACT 60 FROM WS-LEAD-TIME-MN3
                 END-IF
                 MOVE WS-LEAD-TIME-MN3      TO WS-LEAD-TIME-MN
                 MOVE WS-LEAD-TIME          TO P08CA-TR-LEAD-TIME
              END-IF
              IF CNTL-POOL-CO-CRAFT = ('Y' OR 'O')
                 ADD 1 TO SUB1
                 MOVE 'CO'               TO SCR08-CC(SUB1)
              END-IF
              IF CNTL-POOL-AC-CRAFT = ('Y' OR 'O')
                 ADD 1 TO SUB1
                 MOVE 'AC'               TO SCR08-CC(SUB1)
              END-IF
              IF CNTL-POOL-B1-CRAFT = ('Y' OR 'O')
                 ADD 1 TO SUB1
                 MOVE 'B1'               TO SCR08-CC(SUB1)
              END-IF
              IF CNTL-POOL-B2-CRAFT = ('Y' OR 'O')
                 ADD 1 TO SUB1
                 MOVE 'B2'               TO SCR08-CC(SUB1)
              END-IF
              IF CNTL-POOL-BG-CRAFT = ('Y' OR 'O')
                 ADD 1 TO SUB1
                 MOVE 'BG'               TO SCR08-CC(SUB1)
              END-IF
              ADD 1 TO SUB1
              MOVE 'TT'                  TO SCR08-CC(SUB1)
           END-IF
      *
      *    SETUP CRAFT COLORS AND PROTECT UNUSED ARRAY AREA(S)
      *
           MOVE SPACES                   TO P08CA-COLOR-ARRAY
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              SET CT-IND         TO 1
              SEARCH CRAFT-CODE-TABLE VARYING CT-IND
                 AT END CONTINUE
                 WHEN CT-CRAFT-CODE(CT-IND) = SCR08-CC(FUNC-SUB)
                    IF CT-CRAFT-CODE(CT-IND) > SPACE
                       MOVE CT-CRAFT-COLOR(CT-IND)
                          TO P08CA-ASGN-COLOR(FUNC-SUB)
                    END-IF
              END-SEARCH
              IF SCR08-CC(FUNC-SUB) NOT > SPACE
                 SET P08CA-ASGN-SET(FUNC-SUB) TO TRUE
                 MOVE AUTOSKIP-MDT TO SCR08-FUNC-ATTR(FUNC-SUB)
                                      SCR08-NAME-ATTR(FUNC-SUB)
                                      SCR08-ST-ATTR(FUNC-SUB)
                                      SCR08-ECC-ATTR(FUNC-SUB)
                                      SCR08-OD-DATE-ATTR(FUNC-SUB)
                                      SCR08-OD-TIME-ATTR(FUNC-SUB)
                                      SCR08-TAXI-TM-ATTR(FUNC-SUB)
              ELSE
                 MOVE 'TAXI TM:'   TO SCR08-TAXI-HD(FUNC-SUB)
              END-IF
           END-PERFORM
           PERFORM P1070-RESET-COLORS
           MOVE TRCN-EN-FROM-DIST        TO WK-UFPTRAIN-DIST
           MOVE TRCN-EN-FROM-SDIST       TO WK-UFPTRAIN-SUB-DIST
           MOVE TRCN-EN-FROM-POOL        TO WK-UFPTRAIN-POOL
           STRING SCR08-ASGN
                  SCR08-ASGN-TYPE
                  DELIMITED BY SIZE
                  INTO WK-UFPTRAIN-TRAIN
           MOVE SPACES                   TO WK-UFPTRAIN-CC
           PERFORM P0320-SEE-IF-TRAIN-CALLED
      *C1166 - BEG
           IF NOT P08CA-CALL-SET
              IF EN-FROM-ALT-SOURCE
              OR BOTH-FROM-ALT-SOURCE
                 IF  WS-SV-EN-FROM-DIST  > SPACES
                 AND WS-SV-EN-FROM-SDIST > SPACES
                 AND WS-SV-EN-FROM-POOL  > SPACES
                    MOVE WS-SV-EN-FROM-DIST     TO WK-UFPTRAIN-DIST
                    MOVE WS-SV-EN-FROM-SDIST    TO WK-UFPTRAIN-SUB-DIST
                    MOVE WS-SV-EN-FROM-POOL     TO WK-UFPTRAIN-POOL
                    STRING SCR08-ASGN
                           SCR08-ASGN-TYPE
                           DELIMITED BY SIZE
                           INTO WK-UFPTRAIN-TRAIN
                    MOVE SPACES                TO WK-UFPTRAIN-CC
                    PERFORM P0320-SEE-IF-TRAIN-CALLED
                 END-IF
              END-IF
           END-IF
      *C1166 - END
           IF TRCN-TR-FROM-DIST > SPACES
              IF TRCN-TR-FROM-DIST NOT = WK-UFPTRAIN-DIST
                 OR TRCN-TR-FROM-SDIST NOT = WK-UFPTRAIN-SUB-DIST
                 OR TRCN-TR-FROM-POOL NOT = WK-UFPTRAIN-POOL
                 MOVE TRCN-TR-FROM-DIST        TO WK-UFPTRAIN-DIST
                 MOVE TRCN-TR-FROM-SDIST       TO WK-UFPTRAIN-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL        TO WK-UFPTRAIN-POOL
                 STRING SCR08-ASGN
                        SCR08-ASGN-TYPE
                        DELIMITED BY SIZE
                        INTO WK-UFPTRAIN-TRAIN
                 MOVE SPACES                   TO WK-UFPTRAIN-CC
                 PERFORM P0320-SEE-IF-TRAIN-CALLED
      *C1166 - BEG
                 IF NOT P08CA-CALL-SET
                    IF TR-FROM-ALT-SOURCE
                    OR BOTH-FROM-ALT-SOURCE
                       IF  WS-SV-TR-FROM-DIST  > SPACES
                       AND WS-SV-TR-FROM-SDIST > SPACES
                       AND WS-SV-TR-FROM-POOL  > SPACES
                          IF WS-SV-TR-FROM-DIST  NOT = WK-UFPTRAIN-DIST
                          OR WS-SV-TR-FROM-SDIST
                                              NOT = WK-UFPTRAIN-SUB-DIST
                          OR WS-SV-TR-FROM-POOL  NOT = WK-UFPTRAIN-POOL
                             MOVE WS-SV-TR-FROM-DIST TO WK-UFPTRAIN-DIST
                             MOVE WS-SV-TR-FROM-SDIST
                                                 TO WK-UFPTRAIN-SUB-DIST
                             MOVE WS-SV-TR-FROM-POOL TO WK-UFPTRAIN-POOL
                             STRING SCR08-ASGN
                                    SCR08-ASGN-TYPE
                                    DELIMITED BY SIZE
                                    INTO WK-UFPTRAIN-TRAIN
                             MOVE SPACES          TO WK-UFPTRAIN-CC
                             PERFORM P0320-SEE-IF-TRAIN-CALLED
                          END-IF
                       END-IF
                    END-IF
                 END-IF
      *C1166 - END
              END-IF
           END-IF.
      *
      ******************************************************************
       P0315-EDIT-TRAIN-SYMBOL.
      ******************************************************************
           MOVE SCR08-ASGN           TO WS-TRAIN-ASGN
           MOVE SCR08-ASGN-TYPE      TO WS-TRAIN-ASGN-TYPE

           EVALUATE P08CA-TRAIN-ID-FORMAT
              WHEN '1'
                 IF WS-TRAIN-SYMBOL-BYTE1 = ' ' OR 'S' OR 'T' OR 'R' OR
                                            'P' OR 'J'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE2 ALPHABETIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE3 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE4 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE5 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE6 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE6 NUMERIC)
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE7 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE8 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I450' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-ASGN-TYPE < '01' OR
                    WS-TRAIN-ASGN-TYPE > '31'
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                     'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I450' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              WHEN '2'
                 IF WS-TRAIN-SYMBOL-BYTE1 = ' ' OR 'S' OR 'T' OR 'R' OR
                                            'P' OR 'J'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE2 = 'W'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE3 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE4 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE5 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE6 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE6 NUMERIC)
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE7 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE8 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I451' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-ASGN-TYPE < '01' OR
                    WS-TRAIN-ASGN-TYPE > '31'
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                     'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I451' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              WHEN '3'
                 IF WS-TRAIN-SYMBOL-BYTE1 = 'D'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I452' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE2 = 'H'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I452' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 PERFORM P0316-GET-COMPANY-CODE
                 IF WK-COMPANY-CODE = 'I'
                    IF WS-TRAIN-SYMBOL-BYTE3 = '0' OR '3'
                       CONTINUE
                    ELSE
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                     'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I452' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 ELSE
                    IF WS-TRAIN-SYMBOL-BYTE3 = '0' OR '6'
                       CONTINUE
                    ELSE
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                     'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I452' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE4 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I452' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE5 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I452' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE6 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE6 NUMERIC)
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I452' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE7 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I452' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE8 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I452' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-ASGN-TYPE < '01' OR
                    WS-TRAIN-ASGN-TYPE > '31'
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                     'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I452' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              WHEN '4'
                 IF WS-TRAIN-SYMBOL-BYTE1 = 'D'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE2 = 'H'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE3 NUMERIC
                    IF WS-TRAIN-SYMBOL-BYTE3 = '0'
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                    'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I453' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE4 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE5 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE6 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE6 NUMERIC)
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE7 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE8 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I453' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-ASGN-TYPE < '01' OR
                    WS-TRAIN-ASGN-TYPE > '31'
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                     'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I453' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              WHEN '5'
                 IF WS-TRAIN-SYMBOL-BYTE1 = 'D'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE2 = 'H'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE3 = 'T' OR 'B' OR 'C' OR 'A'
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE4 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE5 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-SYMBOL-BYTE6 NUMERIC
                    CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE7 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE7 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF (WS-TRAIN-SYMBOL-BYTE8 ALPHABETIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 NUMERIC) OR
                    (WS-TRAIN-SYMBOL-BYTE8 = SPACES)
                       CONTINUE
                 ELSE
                    MOVE -1 TO SCR08-ASGN-CURSOR
                    MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                  'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                    MOVE 'I454' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF WS-TRAIN-ASGN-TYPE < '01' OR
                    WS-TRAIN-ASGN-TYPE > '31'
                       MOVE -1 TO SCR08-ASGN-CURSOR
                       MOVE REV-VIDEO TO SCR08-ASGN-HI
      *                     'INVALID TRAIN SYSBOL FOR TRAIN ID FORMAT'
                       MOVE 'I454' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              WHEN OTHER
                 CONTINUE
           END-EVALUATE
           .
      ******************************************************************
       P0316-GET-COMPANY-CODE.
      ******************************************************************
           MOVE SPACES                TO WORK-CNTLKEY
           MOVE '01'                  TO WK-CNTL-REC-TYPE
           MOVE P08CA-PROF-DIST       TO WK-CNTL-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P0316-1'          TO ERR-PARAGRAPH
              MOVE WORK-CNTLKEY TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE CNTL-COMPANY-CODE     TO WK-COMPANY-CODE
           .
      *CNC0520-BEG
      ******************************************************************
       P0317-EDIT-ROUTE-DSGN.
      ******************************************************************
           MOVE P08CA-PROFILE-KEY     TO TRCNKEY1
           PERFORM P8001-READ-TRCNKEY1-ONLY
           MOVE SPACES                TO TKCRKEY-AREA
           SET  RUN-MILES-REC         TO TRUE
           MOVE SCR08-ORG-STATION     TO TKCR-FROM-LOCATION
           MOVE TRCN-FNL-STN          TO TKCR-TO-LOCATION
           MOVE SCR08-ROUTE-DSGN      TO TKCR-ROUTE-DESIGNATION
           MOVE TKCRKEY-AREA          TO TKCRKEY
           PERFORM P8100-READ-TKCR
           IF  SUCCESS
               AND RUN-MILES-REC
               AND SCR08-ORG-STATION   = TKCR-FROM-LOCATION
               AND TRCN-FNL-STN        = TKCR-TO-LOCATION
               AND SCR08-ROUTE-DSGN    = TKCR-ROUTE-DESIGNATION
               CONTINUE
           ELSE
      *       'NO RUN MILES TABLE RECORD FOR FROM/TO/ROUTE'
              MOVE 'N104'             TO MSGLOG-CODE
              MOVE -1                 TO SCR08-ROUTE-DSGN-CURSOR
              MOVE REV-VIDEO          TO SCR08-ROUTE-DSGN-HI
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF.
      *CNC0520-END
      *
       P0320-SEE-IF-TRAIN-CALLED.
      *
           MOVE WORK-UFPTRAIN            TO UFPTRAIN
           EXEC CICS STARTBR
                     DATASET(UFP-VIA-TRAIN-SYMBOL)
                     RIDFLD(UFPTRAIN)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF SUCCESS
              MOVE '0' TO WS-DONE-CODE
              PERFORM UNTIL DONE
                 EXEC CICS READNEXT
                           DATASET(UFP-VIA-TRAIN-SYMBOL)
                           INTO(WS-UFP)
                           LENGTH(UFPTRSYM-RLGTH)
                           RIDFLD(UFPTRAIN)
                           KEYLENGTH(UFPTRSYM-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS
                    IF DIST3 = WK-UFPTRAIN-DIST
                       AND SUB-DIST3 = WK-UFPTRAIN-SUB-DIST
                       AND POOL-NAME3 = WK-UFPTRAIN-POOL
                       AND TRAIN-SYMBOL = WK-UFPTRAIN-TRAIN
      *C970-START
      *
      *                NOW THAT THE DIST, SUB-DIST, POOL-NAME AND
      *                TRAIN-SYMBOL IS SAME, LETS CHECK IF SAME ORIGIN
      *                STATION.
      *
                       PERFORM P0325-CHECK-IF-SAME-TRAIN
      *
                       IF SAME-TRAIN
                          SET SAME-TRAIN-NOT-CALLED TO TRUE
      *C970-END
                          PERFORM VARYING FUNC-SUB FROM 1 BY 1
                             UNTIL SCR08-CC(FUNC-SUB) = POOL-CRAFT-CODE3
                             OR FUNC-SUB > ARRAY-MAX
                          END-PERFORM
                          IF FUNC-SUB NOT > ARRAY-MAX
                             PERFORM P1060-CLEAR-DATA-LINE
      *----------------------------------------------------------------*
      *                       CONVERT UFP TIMES                        *
      *----------------------------------------------------------------*
                             IF DIST2          NOT = SCR08-DIST
                             OR SUB-DIST2      NOT = SCR08-DIST
                                PERFORM P0400-CONVERT-UFP-TIMES
                             END-IF
      *
                             MOVE UFP-TRAIN-TIME TO WS-CALL-DATE-TIME
                             MOVE WS-CALL-DATE TO SCR08-ORDER-DATE
                             MOVE WS-CALL-TIME TO SCR08-ORDER-TIME
                             SET P08CA-CALL-SET TO TRUE
                             MOVE SPACES TO P08CA-SCREEN-ARRAY(FUNC-SUB)
                             PERFORM P0360-SETUP-TRAIN-LINE
                          END-IF
                       END-IF
                    ELSE
                       SET DONE TO TRUE
                    END-IF
                 ELSE
                    SET DONE TO TRUE
                    IF NOT (NO-RECORD-FND OR END-OF-FILE)
                       MOVE 'P0320-1'    TO ERR-PARAGRAPH
                       MOVE UFPTRAIN     TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 END-IF
              END-PERFORM
              EXEC CICS ENDBR
                        DATASET(UFP-VIA-TRAIN-SYMBOL)
                        RESP(WS-RESPONSE)
              END-EXEC
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P0320-2'    TO ERR-PARAGRAPH
                 MOVE UFPTRAIN     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *C970-START
      *
       P0325-CHECK-IF-SAME-TRAIN.
      *
      *    CHECK THE ASSIGNMENT HISTORY RECORD FOR UFP IN PROCESS.
      *
      *C1210.2 - BEG
           MOVE SPACES              TO WS-SV-AH2KEY
      *C1210.2 - END
           MOVE TRAIN-SYMBOL        TO AHK2-ASSIGNMENT
           MOVE UFP-TRAIN-TIME-DATE TO AHK2-EFF-DATE
           MOVE UFP-TRAIN-TIME-HRMN TO AHK2-EFF-TIME
      *
           MOVE AH-KEY-2            TO AH2KEY
      *C1210.2 - BEG
                                       WS-SV-AH2KEY
      *C1210.2 - END
           MOVE AH-FILE-VIA-K2      TO AH-DATASET
      *
           EXEC CICS READ
                     DATASET(AH-DATASET)
                     INTO(WS-AHIST)
                     LENGTH(AH2-RLGTH)
                     RIDFLD(AH2KEY)
                     KEYLENGTH(AH2-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE         TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P0325-1'        TO ERR-PARAGRAPH
              MOVE AH2KEY           TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
      *    CHECK IF THE ORIGIN STATION OF ASSIGNMENT HISTORY RECORD IS
      *    SAME AS THAT OF ORIGIN STATION FROM CALL SCREEN
      *
           IF AH-ORIGIN-STATION = SCR08-ORG-STATION
              MOVE 'Y' TO WS-IF-SAME-TRAIN-CALLED
      *       USE ORIGINAL TRAIN ROUTE DESIGNATION
              MOVE AH-MISC-ROUTE-DESIGNATION TO SCR08-ROUTE-DSGN
      *C1210.2 - BEG
           ELSE
              IF DUP-KEY-OK
                 PERFORM P0326-CHECK-ALT-AHC
              END-IF
      *C1210.2 - END
           END-IF.
      *
      *C970-END
      *C1210.2 - BEG
       P0326-CHECK-ALT-AHC.
      *
           MOVE SPACES              TO WS-AHIST
           MOVE WS-SV-AH2KEY        TO AH2KEY
           MOVE AH-FILE-VIA-K2      TO AH-DATASET
           EXEC CICS STARTBR
                     DATASET(AH-FILE-VIA-K2)
                     RIDFLD(AH2KEY)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE         TO FILE-STATUS
           IF SUCCESS
              MOVE ZERO             TO WS-AH2-DONE-CODE
              PERFORM UNTIL AH2-DONE
                 EXEC CICS READNEXT
                           DATASET(AH-FILE-VIA-K2)
                           INTO(WS-AHIST)
                           LENGTH(AH2-RLGTH)
                           RIDFLD(AH2KEY)
                           KEYLENGTH(AH2-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE   TO FILE-STATUS
                 IF  SUCCESS
                 AND AH-KEY-2 = WS-SV-AH2KEY
                    IF AH-ORIGIN-STATION = SCR08-ORG-STATION
                       MOVE 'Y'     TO WS-IF-SAME-TRAIN-CALLED
                       MOVE AH-MISC-ROUTE-DESIGNATION
                                    TO SCR08-ROUTE-DSGN
                       SET AH2-DONE TO TRUE
                    END-IF
                 ELSE
                    SET AH2-DONE    TO TRUE
                 END-IF
              END-PERFORM
              EXEC CICS ENDBR
                        DATASET(AH-FILE-VIA-K2)
                        RESP(WS-RESPONSE)
              END-EXEC
           END-IF.
      *C1210.2 - END
      *
       P0330-FIND-UNASSIGNED-CREW.
      *
           MOVE SPACES                    TO WS-FUNCTION-CODE
                                             WS-PREF-TIME
                                             P08CA-SCHD-AREA
           IF TRCN-EN-FROM-AREA > SPACES
      *
      *       FIRST SEE IF TRAIN IS CARDED/SCHEDULED AND IF SO
      *       LOAD PERTINENT INFORMATION IN THE COMMAREA.
      *
              MOVE SPACES                   TO P932-COMMAREA-PARMS
              MOVE P08CA-PROFILE-KEY        TO P932-PROFILE-KEY
              MOVE WS-FORMAT-TRAIN          TO P932-TRAIN
      *08/01/23 RJA B CNC0600     (4) CNLD-270
      **CNLD-244 #2 B - RPV1  - ROAD JOB AFTER FIRST ENTER
      **CNLD-244 #2 B - SXG1
      *        IF WS-CAN-WRR-FLAG NOT > SPACE
      *           MOVE WS-CNTL-FILE        TO WS-CNTL-FILE-HOLD
      *           MOVE SPACES              TO WORK-CNTLKEY
      *           MOVE '02'                TO WK-CNTL-REC-TYPE
      *           MOVE SCR08-DIST            TO WK-CNTL-DIST
      *           MOVE SCR08-SUB-DIST        TO WK-CNTL-SUB-DIST
      *           PERFORM P8610-READ-CNTLFILE
      *           IF NOT SUCCESS
      *              MOVE 'P0300-2'        TO ERR-PARAGRAPH
      *              MOVE WORK-CNTLKEY     TO ERR-KEY
      *              PERFORM P9999-GOT-PROBLEM
      *           END-IF
      *           MOVE CNTL-CAN-WRR-FLAG   TO WS-CAN-WRR-FLAG
      **CNLD-265-B
      *           MOVE CNTL-US-DOM         TO WS-US-DOM-FL
      **CNLD-265-E
      *           MOVE WS-CNTL-FILE-HOLD   TO WS-CNTL-FILE
      *           MOVE CNTLKEY-AREA        TO WORK-CNTLKEY
      *        END-IF
      **CNLD-244 #2 E - SXG1
      *        IF WS-PREP-OD-DATE > SPACES
      *          AND WS-CAN-WRR-NEW
      *           MOVE WS-PREP-OD-DATE       TO WS-CALL-DATE
      *           MOVE WS-PREP-OD-TIME       TO WS-CALL-TIME
      *        ELSE
      *           MOVE ZEROES TO DATE-CONVERSION-PARMS
      *           PERFORM P6040-GET-PREP-TIME
      ** DONT MOVE SPACES, CALCULATE ORDERTIME MINUS PREP TIME.
      *           MOVE WS-CALC-OD-DATE    TO WS-PREP-OD-DATE
      *                                      WS-CALL-DATE
      *           MOVE WS-CALC-OD-TIME    TO WS-PREP-OD-TIME
      *                                      WS-CALL-TIME
      *
      **          MOVE SCR08-ORDER-DATE      TO WS-CALL-DATE
      **          MOVE SCR08-ORDER-TIME      TO WS-CALL-TIME
      *        END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600  CNLD-270
      *08/01/23 RJA B CNC0600  CNLD-270
                  MOVE SCR08-ORDER-DATE      TO WS-CALL-DATE
                  MOVE SCR08-ORDER-TIME      TO WS-CALL-TIME
      *08/01/23 RJA E CNC0600  CNLD-270
      *08/01/23 RJA B CNC0600  CNLD-270
      *        PERFORM VARYING FUNC-SUB FROM 1 BY 1
      *           UNTIL FUNC-SUB > ARRAY-MAX
      *           IF SCR08-CC(FUNC-SUB) = 'EN'
      *              IF SCR08-OD-DATE(FUNC-SUB) > SPACES
      *                 MOVE SCR08-OD-DATE(FUNC-SUB)
      *                                      TO WS-CALL-DATE
      *                 MOVE SCR08-OD-TIME(FUNC-SUB)
      *                                      TO WS-CALL-TIME
      *              END-IF
      *           END-IF
      *        END-PERFORM
      *08/01/23 RJA E CNC0600  CNLD-270
              MOVE 'EN'                     TO P932-CRAFT-CODE
              MOVE WS-CALL-DATE-TIME        TO P932-CALL-DATE-TIME
              MOVE PSTCA-TIME-ZONE          TO P932-TIME-ZONE
              PERFORM P8700-READ-P08CA-TASK
              MOVE TASK-TOPC-EN-STA         TO P932-TOPC-EN-STA
              MOVE TASK-TOPC-TR-STA         TO P932-TOPC-TR-STA
              EXEC CICS LINK
                        PROGRAM(P932-PGM)
                        COMMAREA(P932-COMMAREA-PARMS)
                        LENGTH(P932-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE              TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P0330-1'             TO ERR-PARAGRAPH
                 MOVE 'P932LINK'            TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF P932-SCHD-ALT NOT = SPACES
                 MOVE ZEROES   TO WS-ALTERNATE-DONE-CODE
                 SET ALTERNATE-USE TO TRUE
                 PERFORM UNTIL ALTERNATE-DONE
                    PERFORM P0335-FIND-ALT
                 END-PERFORM
              ELSE
                 MOVE SPACES   TO WS-ALTERNATE-USE-CODE
              END-IF
              IF NOT P932-NO-SCHEDULE-FOUND
                 MOVE P932-SCH-START-TIME   TO WS-PREF-START-EN-TIME
                 MOVE P932-SCH-END-TIME     TO WS-PREF-END-EN-TIME
                 IF NOT P932-SCHED-COMPLETE
                    IF P932-ALT-SCHEDULE
                       MOVE P932-ALT-POOL-DIST
                                            TO TRCN-EN-FROM-DIST
                       MOVE P932-ALT-POOL-SDIST
                                            TO TRCN-EN-FROM-SDIST
                       MOVE P932-ALT-POOL   TO TRCN-EN-FROM-POOL
                       MOVE P932-ALT-POOL-TERM
                                            TO TRCN-EN-FROM-TERM
                    ELSE
                       MOVE P932-SCH-POOL-TERM
                                            TO TRCN-EN-FROM-TERM
                       IF P932-SCH-POOL-ID(1:5) = 'SPARE'
                          MOVE P932-TURN-DIST
                                            TO TRCN-EN-FROM-DIST
                          MOVE P932-TURN-SDIST
                                            TO TRCN-EN-FROM-SDIST
                          MOVE P932-TURN-POOL
                                            TO TRCN-EN-FROM-POOL
                       ELSE
                          MOVE P932-SCH-POOL-DIST
                                            TO TRCN-EN-FROM-DIST
                          MOVE P932-SCH-POOL-SDIST
                                            TO TRCN-EN-FROM-SDIST
                          MOVE P932-SCH-POOL
                                            TO TRCN-EN-FROM-POOL
                       END-IF
                    END-IF
                    MOVE 'N'                TO TRCN-EN-FROM-MU
                    IF P932-MAKEUP-TURN
                       MOVE 'Y'             TO TRCN-EN-FROM-MU
                    END-IF
                 END-IF
                 PERFORM VARYING SUB1 FROM 1 BY 1
                    UNTIL SUB1 > ARRAY-MAX
                    IF SCR08-CC(SUB1) = ('EN' OR 'SE' OR 'FI' OR 'ET')
                       IF P08CA-ASGN-KEY(SUB1) NOT > SPACE
                          MOVE P932-SCHEDULE-TYPE     TO
                                         P08CA-SCHD-TYP(SUB1)
                          MOVE P932-SCHEDULE-KEY      TO
                                         P08CA-SCHD-KEY(SUB1)
                          MOVE P932-TURN-PARM         TO
                                         P08CA-SCHD-TURN(SUB1)
                          MOVE P932-SCH-POOL-ID       TO
                                         P08CA-SCHD-POOL-ID(SUB1)
                          MOVE P932-ALT-POOL-ID       TO
                                         P08CA-SCHD-POOL-ID-ALT(SUB1)
                          MOVE P932-REST-FLAG         TO
                                         P08CA-SCHD-REST-FLAG(SUB1)
                          MOVE P932-CALL-CATCHUP-DATE TO
                                         P08CA-SCHD-CATCHUP-DATE(SUB1)
                          MOVE P932-CATCHUP-SCHED     TO
                                         P08CA-SCHD-CATCHUP(SUB1)
                          MOVE P932-SCHD-DLY          TO
                                         P08CA-SCHD-DLY    (SUB1)
                          MOVE P932-SCHD-ALT          TO
                                         P08CA-SCHD-ALT    (SUB1)
                          MOVE WS-ALTERNATE-USE-CODE  TO
                                         P08CA-SCHD-ALT-USE(SUB1)
                       END-IF
                    END-IF
                 END-PERFORM
              ELSE
                 PERFORM VARYING I FROM 1 BY 1
                    UNTIL I > ARRAY-MAX
                    IF SCR08-CC(I) = ('EN' OR 'SE' OR 'FI' OR 'ET')
                       IF P08CA-ASGN-KEY(I) NOT > SPACES
                          MOVE SPACES             TO HAVE-XB-EMP-FLAG
                          MOVE SPACES             TO PS32-COMMAREA-PARMS
                          MOVE P08CA-PROFILE-KEY  TO PS32-PROFILE-KEY
                          MOVE SCR08-CC(I)        TO PS32-CRAFT-CODE
                          MOVE PSTCA-TIME-ZONE    TO PS32-TIME-ZONE
      *08/01/23 RJA B CNC0600     (5) CNLD-270
      **CNLD-244 #2 B - RPV1 -
      *                    IF WS-PREP-OD-DATE > SPACES
      *                      AND WS-CAN-WRR-NEW
      *                       MOVE WS-PREP-OD-DATE TO WS-CALL-DATE
      *                       MOVE WS-PREP-OD-TIME TO WS-CALL-TIME
      *                    ELSE
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270
                            MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                            MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - RPV1
      *                    END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270

      *08/01/23 RJA B CNC0600 CNLD-270
      *                    IF SCR08-OD-DATE(I) > SPACES
      *                       MOVE SCR08-OD-DATE(I) TO WS-CALL-DATE
      *                       MOVE SCR08-OD-TIME(I) TO WS-CALL-TIME
      *                    END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
                          MOVE WS-CALL-DATE-TIME  TO PS32-CALL-DATE-TIME
                          MOVE TASK-TOPC-EN-STA   TO PS32-TOPC-EN-STA
                          MOVE TASK-TOPC-TR-STA   TO PS32-TOPC-TR-STA
                          EXEC CICS LINK
                                    PROGRAM(PS32-PGM)
                                    COMMAREA(PS32-COMMAREA-PARMS)
                                    LENGTH(PS32-LGTH)
                                    RESP(WS-RESPONSE)
                          END-EXEC
                          MOVE WS-RESPONSE           TO FILE-STATUS
                          IF NOT SUCCESS
                             MOVE 'P0330-2'          TO ERR-PARAGRAPH
                             MOVE 'PS32LINK'         TO ERR-KEY
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                          IF NOT PS32-NO-SCHEDULE-FOUND
                             MOVE I        TO ZSUB
                             MOVE '1'      TO WS-ERR-CD
                             PERFORM P0337-POPULATE-BIDPACK-DATA
                             SET P08CA-SCHED-BIDPACK(I)
                                                 TO TRUE
                             MOVE I              TO FUNC-SUB
                             PERFORM P0360-SETUP-TRAIN-LINE
      *C1150.1 - BEG
                             MOVE '1'      TO P08CA-HT-CREW-SUPPLY(I)
      *C1150.1 - END
                          ELSE
      *
      *CNC0426 - SPIN THROUGH ALTERNATE BIDPACK POOLS, IF ANY
      *
                             MOVE 2              TO SUB8
                             PERFORM P0338-SPIN-THRU-ALT-SCHED
                          END-IF
                       END-IF
                    END-IF
                 END-PERFORM
              END-IF
              PERFORM P0331-INIT-EN-WORK-KEYS
      *       SAVE EN-WORK-KEYS FOR LATER RESTORE
              MOVE WORK-UFPPOS TO WS-SAVE-WORK-UFPPOS
              PERFORM P0370-SET-EN-MARRIED-FLAGS
      *CNC0499 - 11/21/16 - BEG
      *** SYSTEM SHOULD LOOK FOR MARRIED TURN INSTEAD OF WHAT CNPS32 HAS
      *** RETURNED WHEN BIDPACK POOL WITH MARRIED TURN EXISTS
              IF EN-SE-MARRIED
              OR EN-FI-MARRIED
              OR EN-ET-MARRIED
                 PERFORM VARYING I FROM 1 BY 1
                    UNTIL I > ARRAY-MAX
                    IF (SCR08-CC(I) = 'EN'
                    AND P08CA-ASGN-KEY(I) > SPACES
      *02/17/17 - BEG
                    AND (P08CA-SCHED-BIDPACK(I)
                     OR  P08CA-SCHED-ALT-BIDPACK(I))
                       )
      *02/17/17 - END
                       PERFORM VARYING FUNC-SUB FROM 1 BY 1
                          UNTIL FUNC-SUB > ARRAY-MAX
                          IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                          AND SCR08-CC(FUNC-SUB) = 'SE'
                          AND EN-SE-MARRIED)
                             MOVE SPACES TO P08CA-ASGN-KEY(FUNC-SUB)
                             PERFORM P1060-CLEAR-DATA-LINE
                          END-IF
      *
                          IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                          AND SCR08-CC(FUNC-SUB) = 'FI'
                          AND EN-FI-MARRIED)
                             MOVE SPACES TO P08CA-ASGN-KEY(FUNC-SUB)
                             PERFORM P1060-CLEAR-DATA-LINE
                          END-IF
      *
                          IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                          AND SCR08-CC(FUNC-SUB) = 'ET'
                          AND EN-ET-MARRIED)
                             MOVE SPACES TO P08CA-ASGN-KEY(FUNC-SUB)
                             PERFORM P1060-CLEAR-DATA-LINE
                          END-IF
                       END-PERFORM
      *11/22/16 - BEG
                       MOVE I TO FUNC-SUB
                       MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN-AREA
                       MOVE UFPTURN-AREA             TO UFPTURN
                       PERFORM P8600-READ-UFPTURN
                       IF NOT SUCCESS
                          STRING 'P0330-5' WS-ERR-CD
                          DELIMITED BY SIZE        INTO ERR-PARAGRAPH
                          MOVE UFPTURN               TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                       PERFORM P0390-SETUP-ASSOC-CRAFTS
                       IF NOT ASSOCIATED-TURN
                          IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                             PERFORM P0350-GET-ASSOC-TURNS
                          END-IF
                       END-IF
      *11/22/16 - END
                    END-IF
                 END-PERFORM
              END-IF
      *CNC0499 - 11/21/16 - END
              PERFORM VARYING FUNC-SUB FROM 1 BY 1
                 UNTIL FUNC-SUB > ARRAY-MAX
                 IF SCR08-CC(FUNC-SUB) = ('EN' OR 'SE' OR 'FI' OR 'ET')
                    IF MINE-TURN-SVC
                       MOVE SPACES    TO WK-UFPPOS-DATE-TIME
                    END-IF
                    IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
                       PERFORM P0390-SETUP-ASSOC-CRAFTS
                       IF NOT ASSOCIATED-TURN
      *                   PERFORM P0331-INIT-EN-WORK-KEYS
                          MOVE WS-SAVE-WORK-UFPPOS TO WORK-UFPPOS
                          IF TRCN-EN-FROM-MU = 'Y'
                             PERFORM P2210-CREATE-ASSIGNMENT
                          ELSE
                             MOVE SCR08-CC(FUNC-SUB) TO WK-UFPPOS-CC
                             PERFORM P0340-GET-NEXT-TURN
                          END-IF
                          IF P08CA-ASGN-KEY(FUNC-SUB)   NOT > SPACES AND
                             P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
                             IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                                OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                                OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                                OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                                OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                                OR P08CA-NON-BP-WITH-ALT(FUNC-SUB))
                                PERFORM P0355-ADVANCE-SCHEDULE
                             END-IF
                          ELSE
                             IF P08CA-SCHD-DLY(FUNC-SUB) NOT = SPACES
                                PERFORM P0359-SET-SCHD-TYP
                             END-IF
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-PERFORM
           END-IF
           MOVE SPACES                      TO WS-FUNCTION-CODE

           IF TRCN-TR-FROM-AREA > SPACES
      *
      *       FIRST SEE IF TRAIN IS CARDED/SCHEDULED AND IF SO
      *       LOAD PERTINENT INFORMATION IN THE COMMAREA.
      *
              MOVE SPACES                   TO P932-COMMAREA-PARMS
              MOVE P08CA-PROFILE-KEY        TO P932-PROFILE-KEY
              MOVE WS-FORMAT-TRAIN          TO P932-TRAIN
      *08/01/23 RJA B CNC0600     (6) CNLD-270
      **CNLD-244 #2 B - RPV1 - ROAD JOB
      *        IF WS-PREP-OD-DATE > SPACES
      *           AND WS-CAN-WRR-NEW
      *           MOVE WS-PREP-OD-DATE       TO WS-CALL-DATE
      *           MOVE WS-PREP-OD-TIME       TO WS-CALL-TIME
      *        ELSE
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270
                 MOVE SCR08-ORDER-DATE      TO WS-CALL-DATE
                 MOVE SCR08-ORDER-TIME      TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - RPV1
      *        END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270

      *08/01/23 RJA B CNC0600 CNLD-270
      *        PERFORM VARYING FUNC-SUB FROM 1 BY 1
      *           UNTIL FUNC-SUB > ARRAY-MAX
      *           IF SCR08-CC(FUNC-SUB) = 'CO'
      *              IF SCR08-OD-DATE(FUNC-SUB) > SPACES
      *                 MOVE SCR08-OD-DATE(FUNC-SUB)
      *                                      TO WS-CALL-DATE
      *                 MOVE SCR08-OD-TIME(FUNC-SUB)
      *                                      TO WS-CALL-TIME
      *              END-IF
      *           END-IF
      *        END-PERFORM
      *08/01/23 RJA E CNC0600 CNLD-270
              MOVE 'CO'                     TO P932-CRAFT-CODE
              MOVE WS-CALL-DATE-TIME        TO P932-CALL-DATE-TIME
              MOVE PSTCA-TIME-ZONE          TO P932-TIME-ZONE
              PERFORM P8700-READ-P08CA-TASK
              MOVE TASK-TOPC-EN-STA         TO P932-TOPC-EN-STA
              MOVE TASK-TOPC-TR-STA         TO P932-TOPC-TR-STA
              EXEC CICS LINK
                        PROGRAM(P932-PGM)
                        COMMAREA(P932-COMMAREA-PARMS)
                        LENGTH(P932-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE              TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P0330-3'             TO ERR-PARAGRAPH
                 MOVE 'P932LINK'            TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF P932-SCHD-ALT NOT = SPACES
                 MOVE ZEROES   TO WS-ALTERNATE-DONE-CODE
                 SET ALTERNATE-USE TO TRUE
                 PERFORM UNTIL ALTERNATE-DONE
                    PERFORM P0335-FIND-ALT
                 END-PERFORM
              ELSE
                 MOVE SPACES TO WS-ALTERNATE-USE-CODE
              END-IF
              IF NOT P932-NO-SCHEDULE-FOUND
      *C1081-BEG
                 MOVE SPACES                TO ASGN-OWNER
                                               HAVE-XB-EMP-FLAG
      *C1081-END
                 MOVE P932-SCH-START-TIME   TO WS-PREF-START-TR-TIME
                 MOVE P932-SCH-END-TIME     TO WS-PREF-END-TR-TIME
                 IF NOT P932-SCHED-COMPLETE
                    IF P932-ALT-SCHEDULE
                       MOVE P932-ALT-POOL-DIST
                                            TO TRCN-TR-FROM-DIST
                       MOVE P932-ALT-POOL-SDIST
                                            TO TRCN-TR-FROM-SDIST
                       MOVE P932-ALT-POOL   TO TRCN-TR-FROM-POOL
                       MOVE P932-ALT-POOL-TERM
                                            TO TRCN-TR-FROM-TERM
                    ELSE
                       MOVE P932-SCH-POOL-TERM
                                            TO TRCN-TR-FROM-TERM
                       IF P932-SCH-POOL-ID(1:5) = 'SPARE'
                          MOVE P932-TURN-DIST
                                            TO TRCN-TR-FROM-DIST
                          MOVE P932-TURN-SDIST
                                            TO TRCN-TR-FROM-SDIST
                          MOVE P932-TURN-POOL
                                            TO TRCN-TR-FROM-POOL
                       ELSE
                          MOVE P932-SCH-POOL-DIST
                                            TO TRCN-TR-FROM-DIST
                          MOVE P932-SCH-POOL-SDIST
                                            TO TRCN-TR-FROM-SDIST
                          MOVE P932-SCH-POOL
                                            TO TRCN-TR-FROM-POOL
                       END-IF
                    END-IF
                    MOVE 'N'                TO TRCN-TR-FROM-MU
                    IF P932-MAKEUP-TURN
                       MOVE 'Y'             TO TRCN-TR-FROM-MU
                    END-IF
                 END-IF
                 PERFORM VARYING SUB1 FROM 1 BY 1
                    UNTIL SUB1 > ARRAY-MAX
                    IF SCR08-CC(SUB1) > SPACES
                       AND SCR08-CC(SUB1) NOT =
                          ('EN' AND 'SE' AND 'FI' AND 'ET')
                       IF P08CA-ASGN-KEY(SUB1) NOT > SPACE
                          MOVE P932-SCHEDULE-TYPE     TO
                                         P08CA-SCHD-TYP(SUB1)
                          MOVE P932-SCHEDULE-KEY      TO
                                         P08CA-SCHD-KEY(SUB1)
                          MOVE P932-TURN-PARM         TO
                                         P08CA-SCHD-TURN(SUB1)
                          MOVE P932-SCH-POOL-ID       TO
                                         P08CA-SCHD-POOL-ID(SUB1)
                          MOVE P932-ALT-POOL-ID       TO
                                         P08CA-SCHD-POOL-ID-ALT(SUB1)
                          MOVE P932-REST-FLAG         TO
                                         P08CA-SCHD-REST-FLAG(SUB1)
                          MOVE P932-CALL-CATCHUP-DATE TO
                                         P08CA-SCHD-CATCHUP-DATE(SUB1)
                          MOVE P932-CATCHUP-SCHED     TO
                                         P08CA-SCHD-CATCHUP(SUB1)
                          MOVE P932-SCHD-DLY          TO
                                         P08CA-SCHD-DLY    (SUB1)
                          MOVE P932-SCHD-ALT          TO
                                         P08CA-SCHD-ALT    (SUB1)
                          MOVE WS-ALTERNATE-USE-CODE  TO
                                         P08CA-SCHD-ALT-USE(SUB1)
                       END-IF
                    END-IF
                 END-PERFORM
              ELSE
                 PERFORM VARYING I FROM 1 BY 1
                    UNTIL I > ARRAY-MAX
                    IF SCR08-CC(I) > SPACES
                       AND SCR08-CC(I) NOT =
                       ('EN' AND 'SE' AND 'FI' AND 'ET')
                       IF P08CA-ASGN-KEY(I) NOT > SPACES
                          MOVE SPACES             TO HAVE-XB-EMP-FLAG
                          MOVE SPACES             TO PS32-COMMAREA-PARMS
                          MOVE P08CA-PROFILE-KEY  TO PS32-PROFILE-KEY
                          MOVE SCR08-CC(I)        TO PS32-CRAFT-CODE
                          MOVE PSTCA-TIME-ZONE    TO PS32-TIME-ZONE

      *08/01/23 RJA B CNC0600     (7) CNLD-270
      **CNLD-244 #2 B - RPV1 - ROAD JOB
      *                    IF WS-PREP-OD-DATE > SPACES
      *                      AND WS-CAN-WRR-NEW
      *                       MOVE WS-PREP-OD-DATE TO WS-CALL-DATE
      *                       MOVE WS-PREP-OD-TIME TO WS-CALL-TIME
      *                    ELSE
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270
                             MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                             MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - RPV1
      *                    END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270

      *08/01/23 RJA B CNC0600 CNLD-270
      *                   IF SCR08-OD-DATE(I) > SPACES
      *                      MOVE SCR08-OD-DATE(I) TO WS-CALL-DATE
      *                      MOVE SCR08-OD-TIME(I) TO WS-CALL-TIME
      *                   END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
                          MOVE WS-CALL-DATE-TIME  TO PS32-CALL-DATE-TIME
                          MOVE TASK-TOPC-EN-STA   TO PS32-TOPC-EN-STA
                          MOVE TASK-TOPC-TR-STA   TO PS32-TOPC-TR-STA
                          EXEC CICS LINK
                                    PROGRAM(PS32-PGM)
                                    COMMAREA(PS32-COMMAREA-PARMS)
                                    LENGTH(PS32-LGTH)
                                    RESP(WS-RESPONSE)
                          END-EXEC
                          MOVE WS-RESPONSE           TO FILE-STATUS
                          IF NOT SUCCESS
                             MOVE 'P0330-4'          TO ERR-PARAGRAPH
                             MOVE 'PS32LINK'         TO ERR-KEY
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                          IF NOT PS32-NO-SCHEDULE-FOUND
                             MOVE I           TO ZSUB
                             MOVE '3'         TO WS-ERR-CD
                             PERFORM P0337-POPULATE-BIDPACK-DATA
                             SET P08CA-SCHED-BIDPACK(I)
                                              TO TRUE
                             MOVE I           TO FUNC-SUB
                             PERFORM P0360-SETUP-TRAIN-LINE
      *C1150.1 - BEG
                             MOVE '1'         TO P08CA-HT-CREW-SUPPLY(I)
      *C1150.1 - END
                          ELSE
      *
      *CNC0426 - SPIN THROUGH ALTERNATE BIDPACK POOLS, IF ANY
      *
                             MOVE 2              TO SUB8
                             PERFORM P0338-SPIN-THRU-ALT-SCHED
                          END-IF
                       END-IF
                    END-IF
                 END-PERFORM
              END-IF
              PERFORM P0332-INIT-TR-WORK-KEYS
      *       SAVE TR-WORK-KEYS FOR LATER RESTORE
              MOVE WORK-UFPPOS TO WS-SAVE-WORK-UFPPOS
              PERFORM P0380-SET-TR-MARRIED-FLAGS
      *CNC0499 - 11/21/16 - BEG
      *** SYSTEM SHOULD LOOK FOR MARRIED TURN INSTEAD OF WHAT CNPS32 HAS
      *** RETURNED WHEN BIDPACK POOL WITH MARRIED TURN EXISTS
              IF CO-BK-MARRIED
              OR CO-TT-MARRIED
                 PERFORM VARYING I FROM 1 BY 1
                    UNTIL I > ARRAY-MAX
                    IF (SCR08-CC(I) = 'CO'
                    AND P08CA-ASGN-KEY(I) > SPACES
      *02/17/17 - BEG
                    AND (P08CA-SCHED-BIDPACK(I)
                     OR  P08CA-SCHED-ALT-BIDPACK(I))
                       )
      *02/17/17 - END
                       PERFORM VARYING FUNC-SUB FROM 1 BY 1
                          UNTIL FUNC-SUB > ARRAY-MAX
                          IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                          AND SCR08-CC(FUNC-SUB) = 'TT'
                          AND CO-TT-MARRIED)
                             MOVE SPACES TO P08CA-ASGN-KEY(FUNC-SUB)
                             PERFORM P1060-CLEAR-DATA-LINE
                          END-IF
      *
                          IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                          AND (SCR08-CC(FUNC-SUB) = ('B1' OR
                                                     'B2' OR 'BG'))
                          AND CO-BK-MARRIED)
                             IF (SCR08-CC(FUNC-SUB) = 'B1'
                             AND CO-B1-MARRIED)
                             OR (SCR08-CC(FUNC-SUB) = 'B2'
                             AND CO-B2-MARRIED)
                             OR (SCR08-CC(FUNC-SUB) = 'BG'
                             AND CO-BG-MARRIED)
                                MOVE SPACES TO P08CA-ASGN-KEY(FUNC-SUB)
                                PERFORM P1060-CLEAR-DATA-LINE
                             END-IF
                          END-IF
                       END-PERFORM
      *11/22/16 - BEG
                       MOVE I TO FUNC-SUB
                       MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN-AREA
                       MOVE UFPTURN-AREA             TO UFPTURN
                       PERFORM P8600-READ-UFPTURN
                       IF NOT SUCCESS
                          STRING 'P0330-6' WS-ERR-CD
                          DELIMITED BY SIZE        INTO ERR-PARAGRAPH
                          MOVE UFPTURN               TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                       PERFORM P0390-SETUP-ASSOC-CRAFTS
                       IF NOT ASSOCIATED-TURN
                          IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                             PERFORM P0350-GET-ASSOC-TURNS
                          END-IF
                       END-IF
      *11/22/16 - END
                    END-IF
                 END-PERFORM
              END-IF
              IF B1-B2-MARRIED
                 PERFORM VARYING I FROM 1 BY 1
                    UNTIL I > ARRAY-MAX
                    IF (SCR08-CC(I) = 'B1'
                    AND P08CA-SCHED-BIDPACK(I))
                       PERFORM VARYING FUNC-SUB FROM 1 BY 1
                          UNTIL FUNC-SUB > ARRAY-MAX
                          IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                          AND SCR08-CC(FUNC-SUB) = 'B2')
                             MOVE SPACES TO P08CA-ASGN-KEY(FUNC-SUB)
                             PERFORM P1060-CLEAR-DATA-LINE
                          END-IF
                       END-PERFORM
      *11/22/16 - BEG
                       MOVE I TO FUNC-SUB
                       MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN-AREA
                       MOVE UFPTURN-AREA             TO UFPTURN
                       PERFORM P8600-READ-UFPTURN
                       IF NOT SUCCESS
                          STRING 'P0330-7' WS-ERR-CD
                          DELIMITED BY SIZE        INTO ERR-PARAGRAPH
                          MOVE UFPTURN               TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                       PERFORM P0390-SETUP-ASSOC-CRAFTS
                       IF NOT ASSOCIATED-TURN
                          IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                             PERFORM P0350-GET-ASSOC-TURNS
                          END-IF
                       END-IF
      *11/22/16 - END
                    END-IF
                 END-PERFORM
              END-IF
      *CNC0499 - 11/21/16 - END
              PERFORM VARYING FUNC-SUB FROM 1 BY 1
                 UNTIL FUNC-SUB > ARRAY-MAX
                 IF SCR08-CC(FUNC-SUB) > SPACES
                    AND SCR08-CC(FUNC-SUB) NOT =
                        ('EN' AND 'SE' AND 'FI' AND 'ET')
                    IF MINE-TURN-SVC
                       MOVE SPACES           TO WK-UFPPOS-DATE-TIME
                    END-IF
                    IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
                       PERFORM P0390-SETUP-ASSOC-CRAFTS
                       IF NOT ASSOCIATED-TURN
      *                   PERFORM P0332-INIT-TR-WORK-KEYS
                          MOVE WS-SAVE-WORK-UFPPOS TO WORK-UFPPOS
                          IF TRCN-TR-FROM-MU = 'Y'
                             PERFORM P2210-CREATE-ASSIGNMENT
                          ELSE
                             IF SCR08-CC(FUNC-SUB) = 'B2'
                                MOVE FUNC-SUB       TO SUB1
                                SUBTRACT 1        FROM SUB1
                             END-IF
                             MOVE SCR08-CC(FUNC-SUB) TO WK-UFPPOS-CC
                             PERFORM P0340-GET-NEXT-TURN
                             IF SCR08-CC(FUNC-SUB) = 'B2'
                                AND P08CA-COND-GETS-2BK
                                AND P08CA-ASGN-KEY(FUNC-SUB)
                                              NOT > SPACE
                                MOVE 'B1'            TO WK-UFPPOS-CC
                                PERFORM P0345-GET-NEXT-B1
                             END-IF
                          END-IF
                          IF P08CA-ASGN-KEY(FUNC-SUB)   NOT > SPACES AND
                             P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
                             IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                                OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                                OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                                OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                                OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                                OR P08CA-NON-BP-WITH-ALT(FUNC-SUB))
                                PERFORM P0355-ADVANCE-SCHEDULE
                             END-IF
                          ELSE
                             IF P08CA-SCHD-DLY(FUNC-SUB) NOT = SPACES
                                PERFORM P0359-SET-SCHD-TYP
                             END-IF
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-PERFORM
           END-IF
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              IF SCR08-CC(FUNC-SUB) > SPACES
                 IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR 'SE' OR 'ET')
                    IF TRCN-EN-FROM-DISP = 'Y'
                       MOVE 'DISP'   TO SCR08-FUNC(FUNC-SUB)
                       PERFORM P1020-SET-ASGN-CALL-ATTR
                    END-IF
                 ELSE
                    IF TRCN-TR-FROM-DISP = 'Y'
                       MOVE 'DISP'    TO SCR08-FUNC(FUNC-SUB)
                       PERFORM P1020-SET-ASGN-CALL-ATTR
                    END-IF
                 END-IF
              END-IF
           END-PERFORM.
      *
       P0331-INIT-EN-WORK-KEYS.
      *
           MOVE SPACES                   TO WORK-UFPPOS
                                            WORK-CNTLKEY
           MOVE TRCN-EN-FROM-DIST        TO WK-UFPPOS-DIST
                                            WK-CNTL-DIST
           MOVE TRCN-EN-FROM-SDIST       TO WK-UFPPOS-SUB-DIST
                                            WK-CNTL-SUB-DIST
           MOVE TRCN-EN-FROM-POOL        TO WK-UFPPOS-POOL
                                            WK-CNTL-POOL
           MOVE ZEROS                    TO WK-UFPPOS-IN-OUT
           MOVE TRCN-EN-FROM-TERM        TO WK-UFPPOS-IN-OUT-TERM
           MOVE ZEROS                    TO WK-UFPPOS-KEY.
      *
       P0332-INIT-TR-WORK-KEYS.
      *
           MOVE SPACES                   TO WORK-UFPPOS
                                            WORK-CNTLKEY
           MOVE TRCN-TR-FROM-DIST        TO WK-UFPPOS-DIST
                                            WK-CNTL-DIST
           MOVE TRCN-TR-FROM-SDIST       TO WK-UFPPOS-SUB-DIST
                                            WK-CNTL-SUB-DIST
           MOVE TRCN-TR-FROM-POOL        TO WK-UFPPOS-POOL
                                            WK-CNTL-POOL
           MOVE ZEROS                    TO WK-UFPPOS-IN-OUT
           MOVE TRCN-TR-FROM-TERM        TO WK-UFPPOS-IN-OUT-TERM
           MOVE ZEROS                    TO WK-UFPPOS-KEY.
      *
       P0335-FIND-ALT.
      *
           MOVE P08CA-PROFILE-KEY        TO P932-PROFILE-KEY
           MOVE WS-FORMAT-TRAIN          TO P932-TRAIN
           MOVE WS-CALL-DATE-TIME        TO P932-CALL-DATE-TIME
           MOVE PSTCA-TIME-ZONE          TO P932-TIME-ZONE
           MOVE SPACES                   TO P932-SCHD-DLY
           MOVE SPACES                   TO P932-CATCHUP-SCHED
           PERFORM P8700-READ-P08CA-TASK
           MOVE TASK-TOPC-EN-STA         TO P932-TOPC-EN-STA
           MOVE TASK-TOPC-TR-STA         TO P932-TOPC-TR-STA

           EXEC CICS LINK
                     PROGRAM(P932-PGM)
                     COMMAREA(P932-COMMAREA-PARMS)
                     LENGTH(P932-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC

           MOVE WS-RESPONSE              TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P0335-1'             TO ERR-PARAGRAPH
              MOVE 'P932LINK'            TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF

           IF P932-SCHD-ALT     = SPACES
              SET ALTERNATE-DONE TO TRUE
           END-IF.
      *
       P0336-FIND-BP-ALT.
      *
           MOVE P08CA-PROFILE-KEY             TO PS32-PROFILE-KEY
           MOVE WS-CALL-DATE-TIME             TO PS32-CALL-DATE-TIME
           MOVE PSTCA-TIME-ZONE               TO PS32-TIME-ZONE
           PERFORM P8700-READ-P08CA-TASK
           MOVE TASK-TOPC-EN-STA              TO PS32-TOPC-EN-STA
           MOVE TASK-TOPC-TR-STA              TO PS32-TOPC-TR-STA

           EXEC CICS LINK
                     PROGRAM(PS32-PGM)
                     COMMAREA(PS32-COMMAREA-PARMS)
                     LENGTH(PS32-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC

           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P0336-1'                  TO ERR-PARAGRAPH
              MOVE 'P9S2LINK'                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF

      *C1170 - BEG
      *** SAVE THE LAST ALT-POOL...
           IF  PS32-SCHED-POOL-ID-ALT > SPACES
           AND PS32-ALT-TERM = '0'
              MOVE PS32-SCHED-POOL-ID-ALT TO P08CA-SV-ALT-POOL-ID(SUB9)
           END-IF
      *C1170 - END
           IF PS32-SCHD-ALT                    = SPACES
              SET BP-ALTERNATE-DONE           TO TRUE
      *C1150.1 - BEG
           ELSE
              ADD 1 TO SUB8
      *C1150.1 - END
           END-IF
           .
      *
       P0337-POPULATE-BIDPACK-DATA.
      *
           MOVE SPACES                  TO P08CA-SCREEN-ARRAY(ZSUB)
           MOVE PS32-SCHEDULE-KEY       TO P08CA-ASGN-KEY(ZSUB)
                                              UFPTURN-AREA
           MOVE PS32-KEY-DATA-AREA      TO P08CA-BIDPACK-DATA-AREA(ZSUB)
           MOVE PS32-SCHED-POOL-ID-ALT  TO P08CA-SCHD-POOL-ID-ALT(ZSUB)
           MOVE UFPTURN-AREA            TO UFPTURN
           PERFORM P8600-READ-UFPTURN
           IF NOT SUCCESS
              STRING 'P0337-' WS-ERR-CD
                 DELIMITED BY SIZE    INTO ERR-PARAGRAPH
              MOVE UFPTURN              TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *C1170.1 - BEG
       P0338-SPIN-THRU-ALT-SCHED.
      *
           IF PS32-SCHD-ALT > SPACES
              IF (PS32-SCHED-POOL-ID-ALT > SPACES
              AND PS32-ALT-TERM > '0')
                 CONTINUE
              ELSE
                 IF  PS32-SCHED-POOL-ID-ALT > SPACES
                 AND PS32-ALT-TERM = '0'
                    MOVE PS32-SCHED-POOL-ID-ALT
                                              TO P08CA-SV-ALT-POOL-ID(I)
                 END-IF
                 MOVE I TO SUB9
                 MOVE ZEROES                TO WS-BP-ALTERNATE-DONE-CODE
                 PERFORM UNTIL BP-ALTERNATE-DONE
                    PERFORM P0336-FIND-BP-ALT
                 END-PERFORM
              END-IF
              IF NOT PS32-NO-SCHEDULE-FOUND
                 MOVE I                      TO ZSUB
                 MOVE '2'                    TO WS-ERR-CD
                 PERFORM P0337-POPULATE-BIDPACK-DATA
                 SET P08CA-SCHED-ALT-BIDPACK(I) TO TRUE
                 MOVE SUB8-ALPHA             TO P08CA-HT-CREW-SUPPLY(I)
                 MOVE I                      TO FUNC-SUB
                 PERFORM P0360-SETUP-TRAIN-LINE
              ELSE
                 MOVE SUB8-ALPHA    TO P08CA-HT-CREW-SUPPLY(I)
                 MOVE I                      TO FUNC-SUB
                 PERFORM P0515-SET-BP-CA-VALUES
      ***
      ***     IF WE HAVE EXAUSTED ALL OF THE ALTERNATE SCHEDULES
      ***     AND ENDED ON A NON-BIDPACK POOL, MAKE SURE WE READ
      ***     FROM THAT POOL NEXT TIME IN P0340
      ***
                 IF P08CA-NO-SCHED(FUNC-SUB)
                    IF  PS32-NON-BIDPACK-POOL
                    AND PS32-SCHED-POOL-ID-ALT NOT > SPACES
                    AND PS32-SCHD-ALT = SPACES
                       IF  P08CA-HT-CREW-SUPPLY(FUNC-SUB) > '0'
                       AND P08CA-SV-ALT-POOL-ID(FUNC-SUB) > SPACES
                          SET P08CA-NON-BP-WITH-ALT(FUNC-SUB) TO TRUE
                          MOVE P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                                                     TO WORK-ALT-UFPPOS
                       END-IF
                    END-IF
                 END-IF
              END-IF
           ELSE
              IF NOT PS32-NO-SCHEDULE-FOUND
                 MOVE I                      TO ZSUB
                 MOVE '2'                    TO WS-ERR-CD
                 PERFORM P0337-POPULATE-BIDPACK-DATA
                 SET P08CA-SCHED-ALT-BIDPACK(I) TO TRUE
                 MOVE SUB8-ALPHA             TO P08CA-HT-CREW-SUPPLY(I)
                 MOVE I                      TO FUNC-SUB
                 PERFORM P0360-SETUP-TRAIN-LINE
              ELSE
                 IF  PS32-SCHED-POOL-ID-ALT > SPACES
                 AND PS32-ALT-TERM = '0'
                    MOVE PS32-SCHED-POOL-ID-ALT
                                             TO P08CA-SV-ALT-POOL-ID(I)
                 END-IF
                 MOVE SUB8-ALPHA    TO P08CA-HT-CREW-SUPPLY(I)
                 MOVE I                      TO FUNC-SUB
                 PERFORM P0515-SET-BP-CA-VALUES
                 IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB) > SPACES
                    PERFORM P0520-GET-BIDPACK-FIFO
                 ELSE
      ***
      ***     IF WE HAVE EXAUSTED ALL OF THE ALTERNATE SCHEDULES
      ***     AND ENDED ON A NON-BIDPACK POOL, MAKE SURE WE READ
      ***     FROM THAT POOL NEXT TIME IN P0340
      ***
                    IF P08CA-NO-SCHED(FUNC-SUB)
                       IF PS32-NON-BIDPACK-POOL
                       AND PS32-SCHED-POOL-ID-ALT NOT > SPACES
                       AND PS32-SCHD-ALT = SPACES
                          IF P08CA-HT-CREW-SUPPLY(FUNC-SUB) > '0'
                          AND P08CA-SV-ALT-POOL-ID(FUNC-SUB) > SPACES
                             SET P08CA-NON-BP-WITH-ALT(FUNC-SUB) TO TRUE
                             MOVE P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                                                      TO WORK-ALT-UFPPOS
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF
           .
      *C1170.1 - END
      *
       P0340-GET-NEXT-TURN.
      *
           MOVE P08CA-ASGN-KEY(FUNC-SUB)      TO SAVE-ASGN-KEY
           PERFORM P1060-CLEAR-DATA-LINE
           IF NOT STUDENT-TURN
              IF (REJECT-TURN OR DROP-TURN OR DCAN-TURN)
                 MOVE WS-NO-MORE-MSG(PSTCA-SUB)
                                    TO SCR08-NAME(FUNC-SUB)
              ELSE
                 MOVE WS-NO-AVL-MSG(PSTCA-SUB)
                                    TO SCR08-NAME(FUNC-SUB)
              END-IF
           END-IF
           SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
           MOVE SPACES              TO P08CA-TRK-REASON(FUNC-SUB)
      *
      *    CONVERT CALL DATE/TIME TO EST
      *
           MOVE SPACES              TO TZ-PARAMETERS
           MOVE PSTCA-TIME-ZONE     TO TZ-IN-ZONE
           MOVE TZ-SYSTEM-TIME-ZONE TO TZ-OUT-ZONE
           MOVE WS-CALL-DATE-TIME   TO TZ-IN-DATE-TIME
           PERFORM P8996-TIMEZONE
           IF TZ-INVALID-PARAMETERS
              MOVE '190000'         TO ERR-PARAGRAPH
              PERFORM P8996-TZERROR
           END-IF
           MOVE TZ-OUT-DATE-TIME    TO WS-CALL-DATE-TIME-SYS
           INITIALIZE PS42-COMMAREA-PARMS
           IF P08CA-SCHD-POOL-ID(FUNC-SUB)(1:5) = 'SPARE'
              AND NOT P08CA-SCHED-ALT(FUNC-SUB)
              PERFORM P0395-CHECK-ASSIGNED-XB
           ELSE
              IF NOT P08CA-SCHED-COMPLETE(FUNC-SUB)
                 IF P08CA-SCHED-BIDPACK(FUNC-SUB)
                    OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                    OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                    SET TURN-NOT-FOUND        TO TRUE
                    IF (REJECT-TURN
                       OR DCAN-TURN)
                       IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                          OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB))
                          AND P08CA-BIDPACK-DATA-AREA(FUNC-SUB)
                                               > SPACES
                          PERFORM P0500-NEXT-BIDPACK-TURN
                          IF TURN-FOUND
                             PERFORM P0360-SETUP-TRAIN-LINE

      ***                 ELSE
      *10/23/17 - BEG
      ***                    PERFORM P0515-SET-BP-CA-VALUES
      *10/23/17 - END
      *10/10/17 - BEG
      *                      IF (PS32-GET-ALT-SCHED
      *                      AND P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
      *                                               > SPACES)
      *                         MOVE 'Y'      TO PS32-SCHD-ALT
      *                      END-IF
      *10/10/17 - END

                          END-IF
                       END-IF
                       IF P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                          PERFORM P0342-SELECT-TURN
                          IF TURN-NOT-FOUND
      *
      *                      SEE IF THIS POOL HAS AN ALTERNATE.
      *
      *10/10/17 - BEG
                             IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                                                > SPACES
                                PERFORM P0525-GET-ALT-POOL-ID
                                PERFORM P0515-SET-BP-CA-VALUES
                             ELSE
                                MOVE SPACES TO
                                    P08CA-BIDPACK-DATA-AREA(FUNC-SUB)
                                    P08CA-SCHD-POOL-ID-ALT (FUNC-SUB)
                                SET P08CA-SCHED-COMPLETE(FUNC-SUB)
                                                                 TO TRUE
                             END-IF
      *10/10/17 - END
                          END-IF
                       END-IF
                    END-IF
                    IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                               > SPACES
                    AND TURN-NOT-FOUND
                       MOVE P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                              TO PS32-SCHED-POOL-ID-ALT
      *C1150.1 - BEG
                       MOVE P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                                                       TO SUB8-ALPHA
      *C1150.1 - END
                       PERFORM UNTIL TURN-FOUND
                                  OR P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                              <= SPACES
      *C1150.1 - BEG
                          ADD 1                        TO SUB8
      *C1150.1 - END
      *C1170 - BEG
      *** SAVE THE LAST ALT-POOL...
                          IF  PS32-SCHED-POOL-ID-ALT > SPACES
                          AND PS32-ALT-TERM = '0'
                             MOVE PS32-SCHED-POOL-ID-ALT
                               TO P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                          END-IF
                          IF PS32-SCHD-ALT     > SPACES
                             IF P08CA-SCHD-TERM-ALT(FUNC-SUB) > '0'
                                PERFORM P0521-CHK-NON-BIDPACK
                                IF CNTL-POOL-CYCLE-CODE = ('B' OR 'S')
                                   CONTINUE
                                ELSE
                                   PERFORM P0520-GET-BIDPACK-FIFO
                                END-IF
                                IF NOT TURN-FOUND
                                   MOVE FUNC-SUB TO SUB9
                                   PERFORM P0510-CHECK-ALT-POOL-SCHED
                                   IF TURN-FOUND
                                      PERFORM P0360-SETUP-TRAIN-LINE
                                      MOVE SUB8-ALPHA TO
                                          P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                                   ELSE
                                      IF PS32-NON-BIDPACK-POOL
                                         IF PS32-ALT-SCHD-TYPE > SPACES
                                            CONTINUE
                                         END-IF
                                         MOVE SPACES TO
                                        P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                      ELSE
                                         PERFORM P0515-SET-BP-CA-VALUES
                                         MOVE SPACES TO
                                        P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                      END-IF
                                   END-IF
                                END-IF
                             ELSE
                                MOVE FUNC-SUB TO SUB9
                                PERFORM P0510-CHECK-ALT-POOL-SCHED
                                IF TURN-FOUND
                                   PERFORM P0360-SETUP-TRAIN-LINE

                                   MOVE SUB8-ALPHA
                                       TO P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                                ELSE
      ***  THE SCHEDULED POOL PROFILE HAS POINTED US TO A NON-BIDPACK
      ***  POOL.
                                   IF PS32-SCHD-ALT     > SPACES
                                      IF PS32-NO-SCHEDULE-FOUND
                                      AND PS32-NON-BIDPACK-POOL
      ***    VERIFY TURN IS NOT SCHEDULED...
                                         PERFORM P0521-CHK-NON-BIDPACK
                                         IF CNTL-POOL-CYCLE-CODE =
                                                            ('B' OR 'S')
                                            CONTINUE
                                         ELSE
                                          PERFORM P0520-GET-BIDPACK-FIFO
                                         END-IF
                                         IF NOT TURN-FOUND
                                            MOVE SPACES TO
                                        P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                         END-IF
                                      ELSE
                                         PERFORM P0515-SET-BP-CA-VALUES

                                         IF (PS32-GET-ALT-SCHED AND
                                        P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                                               > SPACES)
                                            MOVE 'Y'   TO PS32-SCHD-ALT
                                         END-IF
                                      END-IF
                                   ELSE
                                    IF  PS32-NO-SCHEDULE-FOUND
                                    AND PS32-NON-BIDPACK-POOL
                                    IF (P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                                                                > SPACES
                                    AND P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                                 NOT = P08CA-SCHD-POOL-ID-ALT(FUNC-SUB))
                                     MOVE P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                                     TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                    END-IF
                                      PERFORM P0521-CHK-NON-BIDPACK
                                      IF CNTL-POOL-CYCLE-CODE =
                                                            ('B' OR 'S')
                                       PERFORM P0515-SET-BP-CA-VALUES
                                     IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                                                > SPACES
                                          PERFORM P0520-GET-BIDPACK-FIFO
                                       END-IF
                                      ELSE
                                        PERFORM P0522-GET-NON-BDPCK-FIFO
                                      END-IF
                                      IF NOT TURN-FOUND
                                           MOVE SPACES TO
                                        P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                      END-IF
                                    ELSE
                                     PERFORM P0515-SET-BP-CA-VALUES
                                     IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                                                > SPACES
                                        PERFORM P0520-GET-BIDPACK-FIFO
                                     END-IF
                                    END-IF
                                   END-IF
                                END-IF
                             END-IF
                          ELSE
                             MOVE FUNC-SUB TO SUB9
      *** VERIFY TURN IS NOT SCHEDULED...
                                   PERFORM P0521-CHK-NON-BIDPACK
                                   IF CNTL-POOL-CYCLE-CODE =
                                                            ('B' OR 'S')
                                      PERFORM P0520-GET-BIDPACK-FIFO
                                   ELSE
                                      PERFORM P0522-GET-NON-BDPCK-FIFO
                                   END-IF
                                   IF NOT TURN-FOUND
                                      MOVE SPACES
                                     TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                   END-IF
                          END-IF
                       END-PERFORM
                    END-IF
                 ELSE
      *C892-BEG
                    IF  P08CA-NON-BP-WITH-ALT(FUNC-SUB)
                    AND WORK-ALT-UFPPOS > SPACES
                       MOVE WK-ALT-UFPPOS-DIST
                                             TO WK-UFPPOS-DIST
                       MOVE WK-ALT-UFPPOS-SUB-DIST
                                             TO WK-UFPPOS-SUB-DIST
                       MOVE WK-ALT-UFPPOS-POOL
                                             TO WK-UFPPOS-POOL
                       MOVE WK-ALT-UFPPOS-TERM
                                             TO WK-UFPPOS-IN-OUT-TERM
                    END-IF
      *C892-END
                    PERFORM P0342-SELECT-TURN
      *C1170.3 - BEG
      ***  IF A NON BIDPACK IS POINTING TO ANOTHER POOL, WE'LL NEED TO
      ***  GO ON TO CHECK IT, OTHERWISE WE CAN MOVE SPACES TO THE ALT
      ***  AREA SO THE SCHEDULE COMPLETE FLAG WILL BE SET
                    IF NOT TURN-FOUND
                       IF P08CA-NON-BP-WITH-ALT(FUNC-SUB)
                          IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                             > SPACES
                             PERFORM P0521-CHK-NON-BIDPACK
                             IF CNTL-POOL-CYCLE-CODE = ('B' OR 'S')
                                CONTINUE
                             ELSE
                                MOVE SPACES        TO WORK-UFPPOS
                                                      WORK-CNTLKEY
                                MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                                   TO WK-UFPPOS-DIST
                                                      WK-CNTL-DIST
                                MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                                   TO WK-UFPPOS-SUB-DIST
                                                      WK-CNTL-SUB-DIST
                                MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                                   TO WK-UFPPOS-POOL
                                                      WK-CNTL-POOL
                                MOVE ZEROS         TO WK-UFPPOS-IN-OUT
                                MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                                TO WK-UFPPOS-IN-OUT-TERM
                                MOVE ZEROS         TO WK-UFPPOS-KEY
                                IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR
                                                         'SE' OR 'ET')
                                   PERFORM P0370-SET-EN-MARRIED-FLAGS
                                ELSE
                                   PERFORM P0380-SET-TR-MARRIED-FLAGS
                                END-IF
                                IF MINE-TURN-SVC
                                   MOVE SPACES    TO WK-UFPPOS-DATE-TIME
                                END-IF
                                PERFORM P0390-SETUP-ASSOC-CRAFTS
                                IF NOT ASSOCIATED-TURN
                                   MOVE SCR08-CC(FUNC-SUB)
                                                   TO WK-UFPPOS-CC
                                   PERFORM P0342-SELECT-TURN
                                      PERFORM P0525-GET-ALT-POOL-ID
                                      IF PS32-SCHED-POOL-ID-ALT > SPACES
                                      AND PS32-ALT-TERM = '0'
                                         MOVE PS32-SCHED-POOL-ID-ALT
                                       TO P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                                      END-IF
                                      PERFORM P0515-SET-BP-CA-VALUES
                                END-IF
                             END-IF
                          END-IF
                       END-IF
                    END-IF
      *C1170.3 - END
                 END-IF
                 IF TURN-FOUND
                    MOVE UFP-POS             TO WK-UFPPOS-KEY
                 END-IF
              END-IF
              IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                 PERFORM P0350-GET-ASSOC-TURNS
              END-IF
           END-IF.
      *
       P0342-SELECT-TURN.
      *
           MOVE WORK-UFPPOS              TO UFPPOS
           EXEC CICS STARTBR
                     DATASET(UFP-VIA-POSITION)
                     RIDFLD(UFPPOS)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF SUCCESS
              MOVE '0'                   TO WS-DONE-CODE
                                            WS-TURN-FOUND-CODE
              PERFORM UNTIL DONE
                 EXEC CICS READNEXT
                           DATASET(UFP-VIA-POSITION)
                           INTO(WS-UFP)
                           LENGTH(UFPPOS-RLGTH)
                           RIDFLD(UFPPOS)
                           KEYLENGTH(UFPPOS-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE        TO FILE-STATUS
                 IF SUCCESS
                    IF  DIST            OF WS-UFP = WK-UFPPOS-DIST
                    AND SUB-DIST        OF WS-UFP = WK-UFPPOS-SUB-DIST
                    AND POOL-NAME       OF WS-UFP = WK-UFPPOS-POOL
                    AND POOL-CRAFT-CODE OF WS-UFP = WK-UFPPOS-CC
                    AND IN-OUT-TOWN-FLAG          = WK-UFPPOS-IN-OUT
                    AND UFP-ON-BOARD
                       IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                          OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                          OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                          OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB))
                          PERFORM P0343-CHECK-SCHED-TURNS
                       ELSE
                          IF MINE-TURN-SVC
                             PERFORM P0343-CHECK-MINE-TURNS
                          ELSE
                             IF (ENGINE-POOL-CRAFT AND EN-ID-POOL)
                             OR (TRAIN-POOL-CRAFT  AND TR-ID-POOL)
                                PERFORM P0343-CHECK-ID-TURNS
                             ELSE
                                PERFORM P0343-CHECK-OTHER-TURNS
                             END-IF
                          END-IF
                       END-IF
                       IF TURN-FOUND
                          EXEC CICS ENDBR
                                    DATASET(UFP-VIA-POSITION)
                                    RESP(WS-RESPONSE)
                          END-EXEC
                          IF MINE-TURN-SVC
                             AND WS-TURN-TO-CALL > SPACES
                             MOVE WS-TURN-TO-CALL TO UFPTURN
                             PERFORM P8600-READ-UFPTURN
                             IF NOT SUCCESS
                                MOVE 'P0342-2'    TO ERR-PARAGRAPH
                                MOVE UFPTURN      TO ERR-KEY
                                PERFORM P9999-GOT-PROBLEM
                             END-IF
                          END-IF
                          MOVE SPACES    TO P08CA-SCREEN-ARRAY(FUNC-SUB)
                          PERFORM P0360-SETUP-TRAIN-LINE
                          SET DONE        TO TRUE
                          MOVE SPACES     TO WS-TURN-TO-CALL
                       END-IF
                    ELSE
                       SET DONE          TO TRUE
                    END-IF
                 ELSE
                    SET DONE TO TRUE
                    IF NOT (NO-RECORD-FND OR END-OF-FILE)
                       MOVE 'P0342-3'    TO ERR-PARAGRAPH
                       MOVE UFPPOS       TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 END-IF
              END-PERFORM
              EXEC CICS ENDBR
                        DATASET(UFP-VIA-POSITION)
                        RESP(WS-RESPONSE)
              END-EXEC
              IF MINE-TURN-SVC
                 AND WS-TURN-TO-CALL > SPACES
                 MOVE WS-TURN-TO-CALL TO UFPTURN
                 PERFORM P8600-READ-UFPTURN
                 IF NOT SUCCESS
                    MOVE 'P0342-4'    TO ERR-PARAGRAPH
                    MOVE UFPTURN      TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 PERFORM P0360-SETUP-TRAIN-LINE
                 MOVE SPACES          TO WS-TURN-TO-CALL
              END-IF
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P0342-5'    TO ERR-PARAGRAPH
                 MOVE UFPPOS       TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P0343-CHECK-ID-TURNS.
      *
      *C1170 - BEG
           IF P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE-SYS    TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE
              MOVE WS-CALL-TIME-SYS    TO DE-COMPARE2-TIME
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE UFP-POS-DATE-TIME(1:6) TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE3-DATE
              MOVE UFP-POS-DATE-TIME(7:4) TO DE-COMPARE3-TIME
              IF DE-COMPARE3-DATE-TIME > DE-COMPARE2-DATE-TIME
      ***     BOARD DATE/TIME AHEAD OF CALL DATE/TIME...
                 CONTINUE
              ELSE
                 SET DE-YYMMDD-FORMAT  TO TRUE
                 MOVE UFP-TIE-UP-TIME(1:6) TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD      TO DE-COMPARE1-DATE
                 MOVE UFP-TIE-UP-TIME(7:4) TO DE-COMPARE1-TIME
                 SET DE-YYMMDD-FORMAT  TO TRUE
                 MOVE WS-MIN-AWAY-DATE TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD      TO DE-COMPARE2-DATE
                 MOVE WS-MIN-AWAY-TIME TO DE-COMPARE2-TIME
                 IF WS-MIN-AWAY-DATE-TIME > '0000000000'
                    AND (DIST IN WS-UFP NOT = DIST2
                    OR SUB-DIST IN WS-UFP NOT = SUB-DIST2
                    OR POOL-NAME IN WS-UFP NOT = POOL-NAME2
                    OR NOT IN-TOWN)
      *             IF UFP-TIE-UP-TIME NOT > WS-MIN-AWAY-DATE-TIME
                    IF DE-COMPARE1-DATE-TIME NOT > DE-COMPARE2-DATE-TIME
                       PERFORM P0344-CHECK-REST-STATUS
                    END-IF
                 ELSE
                    PERFORM P0344-CHECK-REST-STATUS
                 END-IF
              END-IF
           ELSE
      *C1170 - END
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE UFP-TIE-UP-TIME(1:6) TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
              MOVE UFP-TIE-UP-TIME(7:4) TO DE-COMPARE1-TIME
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-MIN-AWAY-DATE    TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE
              MOVE WS-MIN-AWAY-TIME    TO DE-COMPARE2-TIME
              IF WS-MIN-AWAY-DATE-TIME > '0000000000'
                 AND (DIST IN WS-UFP NOT = DIST2
                 OR SUB-DIST IN WS-UFP NOT = SUB-DIST2
                 OR POOL-NAME IN WS-UFP NOT = POOL-NAME2
                 OR NOT IN-TOWN)
      *          IF UFP-TIE-UP-TIME    NOT > WS-MIN-AWAY-DATE-TIME
                 IF DE-COMPARE1-DATE-TIME NOT > DE-COMPARE2-DATE-TIME
                    PERFORM P0344-CHECK-REST-STATUS
                 END-IF
              ELSE
                 PERFORM P0344-CHECK-REST-STATUS
              END-IF
      *C1170 - BEG
           END-IF.
      *C1170 - END
      *
       P0343-CHECK-SCHED-TURNS.
      *
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE WS-CALL-DATE           TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE1-DATE
           MOVE WS-CALL-TIME           TO DE-COMPARE1-TIME
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE WS-CALL-DATE-SYS       TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE2-DATE
           MOVE WS-CALL-TIME-SYS       TO DE-COMPARE2-TIME
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE UFP-POS-DATE-TIME(1:6) TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE3-DATE
           MOVE UFP-POS-DATE-TIME(7:4) TO DE-COMPARE3-TIME
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE TURN-NBR-TIME(1:6)     TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE4-DATE
           MOVE TURN-NBR-TIME(7:4)     TO DE-COMPARE4-TIME
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE TURN-REST-TIME(1:6)    TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE5-DATE
           MOVE TURN-REST-TIME(7:4)    TO DE-COMPARE5-TIME
           IF ((ENGINE-POOL-CRAFT AND EN-ID-POOL)
              OR (TRAIN-POOL-CRAFT AND TR-ID-POOL)
      *       OR UFP-POS-DATE-TIME     NOT > WS-CALL-DATE-TIME-SYS
      *       OR TURN-NBR-TIME             > WS-CALL-DATE-TIME)
              OR DE-COMPARE3-DATE-TIME NOT > DE-COMPARE2-DATE-TIME
              OR DE-COMPARE4-DATE-TIME     > DE-COMPARE1-DATE-TIME)
      *C1170 - BEG
              IF DE-COMPARE3-DATE-TIME     > DE-COMPARE2-DATE-TIME
                 SET DONE                    TO TRUE
              ELSE
      *C1170 - END
                 IF P08CA-SCHD-REST-FLAG(FUNC-SUB) = 'Y'
      *             OR TURN-REST-TIME     NOT > WS-CALL-DATE-TIME
                    OR DE-COMPARE5-DATE-TIME NOT > DE-COMPARE1-DATE-TIME
                    IF P08CA-SCHED-TURN(FUNC-SUB)
                       MOVE UFPTURN-AREA     TO WS-COMPARE-TURN
                       IF P08CA-SCHD-TURN(FUNC-SUB) = WS-COMPARE-TURN
                          SET TURN-FOUND     TO TRUE
                       END-IF
                    ELSE
                       IF P08CA-SCHED-POOL(FUNC-SUB)
                          MOVE P08CA-SCHD-TURN(FUNC-SUB)
                                                TO WS-COMPARE-TURN
                          IF (WS-COMPARE-TURN(7:1) = '*'
                                OR UFPTURN-AREA(7:1)
                                = WS-COMPARE-TURN(7:1))
                             AND
                                (WS-COMPARE-TURN(8:1) = '*'
                                OR UFPTURN-AREA(8:1)
                                = WS-COMPARE-TURN(8:1))
                             AND
                                (WS-COMPARE-TURN(9:1) = '*'
                                OR UFPTURN-AREA(9:1)
                                = WS-COMPARE-TURN(9:1))
                             AND
                                (WS-COMPARE-TURN(10:1) = '*'
                                OR UFPTURN-AREA(10:1)
                                = WS-COMPARE-TURN(10:1))
                             SET TURN-FOUND TO TRUE
                          END-IF
                       ELSE
                          SET TURN-FOUND     TO TRUE
                       END-IF
                    END-IF
                 END-IF
                 IF TURN-FOUND
                    IF P08CA-SCHD-REST-FLAG(FUNC-SUB) = 'N'
                       PERFORM P0344A-CHECK-OWNER
                    END-IF
                 END-IF
      *C1170 - BEG
              END-IF
      *C1170 - END
           ELSE
              SET DONE                       TO TRUE
           END-IF.
      *
       P0343-CHECK-MINE-TURNS.
      *
      *
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE TURN-REST-TIME(1:6)    TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE1-DATE
           MOVE TURN-REST-TIME(7:4)    TO DE-COMPARE1-TIME
      *
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE ON-DUTY-TIME-DATE      TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE2-DATE
      *
           SET DE-YYMMDD-FORMAT        TO TRUE
           MOVE WS-CALL-DATE           TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE3-DATE
           MOVE WS-CALL-TIME           TO DE-COMPARE3-TIME
      *
           IF WS-TURN-TO-CALL NOT > SPACES
      *       IF TURN-REST-TIME NOT > WS-CALL-DATE-TIME
              IF DE-COMPARE1-DATE-TIME NOT > DE-COMPARE3-DATE-TIME
                 MOVE UFPTURN-AREA       TO WS-TURN-TO-CALL
      *          IF ON-DUTY-TIME-DATE < WS-CALL-DATE
                 IF DE-COMPARE2-DATE  < DE-COMPARE3-DATE
                    SET TURN-FOUND       TO TRUE
                 END-IF
              END-IF
           ELSE
      *       IF TURN-REST-TIME NOT > WS-CALL-DATE-TIME
              IF DE-COMPARE1-DATE-TIME NOT > DE-COMPARE3-DATE-TIME
      *          IF ON-DUTY-TIME-DATE < WS-CALL-DATE
                 IF DE-COMPARE2-DATE  < DE-COMPARE3-DATE
                    SET TURN-FOUND       TO TRUE
                    MOVE UFPTURN-AREA    TO WS-TURN-TO-CALL
                 END-IF
              END-IF
           END-IF.
      *
       P0343-CHECK-OTHER-TURNS.
      *
      *C1170 - BEG
           IF P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE-SYS    TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE
              MOVE WS-CALL-TIME-SYS    TO DE-COMPARE2-TIME
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE UFP-POS-DATE-TIME(1:6) TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE3-DATE
              MOVE UFP-POS-DATE-TIME(7:4) TO DE-COMPARE3-TIME
              IF DE-COMPARE3-DATE-TIME > DE-COMPARE2-DATE-TIME
      ***     BOARD DATE/TIME AHEAD OF CALL DATE/TIME...
                 CONTINUE
              ELSE
                 SET DE-YYMMDD-FORMAT  TO TRUE
                 MOVE WS-CALL-DATE     TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD      TO DE-COMPARE1-DATE
                 MOVE WS-CALL-TIME     TO DE-COMPARE1-TIME
                 SET DE-YYMMDD-FORMAT  TO TRUE
                 MOVE WS-CALL-DATE-SYS TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD      TO DE-COMPARE2-DATE
                 MOVE WS-CALL-TIME-SYS TO DE-COMPARE2-TIME
                 SET DE-YYMMDD-FORMAT  TO TRUE
                 MOVE UFP-POS-DATE-TIME(1:6) TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD      TO DE-COMPARE3-DATE
                 MOVE UFP-POS-DATE-TIME(7:4) TO DE-COMPARE3-TIME
                 SET DE-YYMMDD-FORMAT  TO TRUE
                 MOVE TURN-NBR-TIME(1:6) TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD      TO DE-COMPARE4-DATE
                 MOVE TURN-NBR-TIME(7:4) TO DE-COMPARE4-TIME
                 IF DE-COMPARE3-DATE-TIME NOT > DE-COMPARE2-DATE-TIME
                    OR DE-COMPARE4-DATE-TIME > DE-COMPARE1-DATE-TIME
                    PERFORM P0344-CHECK-REST-STATUS
                 ELSE
                    SET DONE                 TO TRUE
                 END-IF
              END-IF
           ELSE
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE        TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
              MOVE WS-CALL-TIME        TO DE-COMPARE1-TIME
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE-SYS    TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE
              MOVE WS-CALL-TIME-SYS    TO DE-COMPARE2-TIME
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE UFP-POS-DATE-TIME(1:6) TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE3-DATE
              MOVE UFP-POS-DATE-TIME(7:4) TO DE-COMPARE3-TIME
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE TURN-NBR-TIME(1:6)  TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE4-DATE
              MOVE TURN-NBR-TIME(7:4)  TO DE-COMPARE4-TIME
      *       IF UFP-POS-DATE-TIME  NOT > WS-CALL-DATE-TIME-SYS
      *          OR TURN-NBR-TIME       > WS-CALL-DATE-TIME
              IF DE-COMPARE3-DATE-TIME NOT > DE-COMPARE2-DATE-TIME
                 OR DE-COMPARE4-DATE-TIME > DE-COMPARE1-DATE-TIME
                 PERFORM P0344-CHECK-REST-STATUS
              ELSE
                 SET DONE                    TO TRUE
              END-IF
      *C1170 - BEG
           END-IF.
      *C1170 - END
      *================================================================*
       P0344-CHECK-REST-STATUS.
      *================================================================*
           SET TURN-FOUND             TO TRUE
           MOVE SPACES                TO WORK-CNTLKEY
           MOVE '03'                  TO WK-CNTL-REC-TYPE
           MOVE DIST IN WS-UFP        TO WK-CNTL-DIST
           MOVE SUB-DIST IN WS-UFP    TO WK-CNTL-SUB-DIST
           MOVE POOL-NAME IN WS-UFP   TO WK-CNTL-POOL
           MOVE 'F'                   TO WK-CNTL-POOL-TYPE
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P0344-1'          TO ERR-PARAGRAPH
              MOVE CNTLKEY            TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
      *    IF THE BOARD THE TURN SITS ON INDICATES THAT UNRESTED
      *    TURNS ARE NOT TO BE DISPLAYED, WE WILL BYPASS THE TURN
      *    AND GET THE NEXT AVAILABLE TURN. WE WILL ONLY DO THIS
      *    IF THE TURN IS UNMARRIED.
      *
           IF CNTL-03-DISPLAY-UNRESTED = 'N'
              PERFORM P0344A-CHECK-OWNER
           END-IF.
      *================================================================*
       P0344A-CHECK-OWNER.
      *================================================================*
           IF WS-ASSOCIATED-CRAFT-ARRAY NOT > SPACES
              MOVE 'U'           TO WK-ASGN-JOB-TYPE
              MOVE UFPTURN-AREA  TO WK-ASGN-ASSIGNMENT
              PERFORM P8020-GET-ASGN-EMPS
              IF OUT-OF-TOWN
                 OR DIST      IN WS-UFP NOT = DIST2
                 OR SUB-DIST  IN WS-UFP NOT = SUB-DIST2
                 OR POOL-NAME IN WS-UFP NOT = POOL-NAME2
                 IF HAVE-ASGN-ON-DUTY-EMP
                    MOVE ASGN-ON-DUTY-EMP  TO EMP-NBR IN WS-MSTR
                    PERFORM P2950-GET-HRS-SVC-INFO
                    MOVE POOL-CRAFT-CODE IN WS-UFP
                                        TO WS-CRAFT-CODE-CHECK
                    IF ENGINE-CRAFT
                       IF P925-EMP-STATUS-RED
                          AND NOT P08CA-EN-DHD-HOME
                          SET TURN-NOT-FOUND   TO TRUE
                       END-IF
                    ELSE
                       IF P925-EMP-STATUS-RED
                          AND NOT P08CA-TR-DHD-HOME
                          SET TURN-NOT-FOUND   TO TRUE
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 MOVE SPACES                   TO MSTRNBRK
                 IF HAVE-ASGN-ON-DUTY-EMP
                    MOVE ASGN-ON-DUTY-EMP      TO MSTRNBRK
                 ELSE
                    IF HAVE-ASGN-TEMPORARY-EMP
                       MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                    ELSE
                       IF HAVE-ASGN-OWNER
                          MOVE ASGN-OWNER      TO MSTRNBRK
                       END-IF
                    END-IF
                 END-IF
                 IF MSTRNBRK > SPACE
                    MOVE MSTRNBRK       TO EMP-NBR IN WS-MSTR
                    PERFORM P2950-GET-HRS-SVC-INFO
                    MOVE POOL-CRAFT-CODE IN WS-UFP
                                        TO WS-CRAFT-CODE-CHECK
                    IF ENGINE-CRAFT
                       IF P925-EMP-STATUS-RED
                          AND NOT P08CA-EN-DHD-HOME
                          SET TURN-NOT-FOUND  TO TRUE
                       END-IF
                    ELSE
                       IF P925-EMP-STATUS-RED
                          AND NOT P08CA-TR-DHD-HOME
                          SET TURN-NOT-FOUND  TO TRUE
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF.

       P0345-GET-NEXT-B1.
      *
           MOVE FUNC-SUB                TO SUB1
           SUBTRACT 1                 FROM SUB1
           IF SCR08-CC(SUB1) = 'B1'
              AND P08CA-ASGN-KEY(SUB1) > SPACE
              MOVE P08CA-ASGN-KEY(SUB1) TO UFPTURN
              PERFORM P8600-READ-UFPTURN
              IF NOT SUCCESS
                 MOVE 'P0345-1'         TO ERR-PARAGRAPH
                 MOVE UFPTURN           TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE UFPPOS-AREA          TO WORK-UFPPOS
              IF WK-UFPPOS-OFF-BOARD
                 SET WK-UFPPOS-ACTIVE-BOARD
                                        TO TRUE
              END-IF
              ADD 1                     TO WK-UFPPOS-TIE-NUM
              PERFORM P0340-GET-NEXT-TURN
           END-IF.
      *
       P0350-GET-ASSOC-TURNS.
      *
      *CNC0499 - MFO - TESTING - BEG
           MOVE UFPTURN-AREA                 TO WS-SV-UFPTURN-AREA
      *CNC0499 - MFO - TESTING - END
           MOVE FUNC-SUB TO HOLD-FUNC-SUB
           PERFORM VARYING CRAFT-SUB FROM 1 BY 1
              UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
              IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACES
                 PERFORM VARYING FUNC-SUB FROM 1 BY 1
                    UNTIL FUNC-SUB > ARRAY-MAX
                    IF SCR08-CC(FUNC-SUB) = WS-ASSOC-CRAFT(CRAFT-SUB)
                       PERFORM P1060-CLEAR-DATA-LINE
                       IF NOT OPTIONAL-TURN(CRAFT-SUB)
                          IF (REJECT-TURN OR DROP-TURN OR DCAN-TURN)
                              MOVE WS-NO-MORE-MSG(PSTCA-SUB)
                                         TO SCR08-NAME(FUNC-SUB)
                          ELSE
                             MOVE WS-NO-AVL-MSG(PSTCA-SUB)
                                         TO SCR08-NAME(FUNC-SUB)
                          END-IF
                       END-IF
                       MOVE P08CA-SCHD-TYP(HOLD-FUNC-SUB)
                                TO P08CA-SCHD-TYP(FUNC-SUB)
                       IF P08CA-ASGN-KEY(HOLD-FUNC-SUB) > SPACES
                          MOVE SCR08-CC(FUNC-SUB)      TO
                                                       POOL-CRAFT-CODE2
                          MOVE UFPTURN-AREA            TO UFPTURN
      *CNC0499 - MFO - TESTING - BEG
                                                          MAKEUP-TURN
      *CNC0499 - MFO - TESTING - END
      *MFO #7 - BEG
                          IF TURN-NBRA = 'MU'
                             PERFORM P0351-CHK-ASSOC-MU-TRN
                          ELSE
      *MFO #7 - END
                          PERFORM P8600-READ-UFPTURN
                          IF NOT SUCCESS
                             MOVE SPACES     TO WS-ASSOC-MU-TURN-FL
                             MOVE 'MU'       TO MAKEUP-TURN-PREFIX
                             MOVE 01         TO MAKEUP-TURN-NUMERIC
                             MOVE '0'        TO WS-MU-DONE-CODE
                             PERFORM UNTIL MU-DONE
                                MOVE MAKEUP-TURN TO UFPTURN
      ***                       PERFORM P8600-READ-UFPTURN
                                PERFORM P8655-READNXT-UFPTURN
                                IF SUCCESS
      *03/29/17 - BEG
      ***                          IF  DIST      OF WS-UFP = MAKEUP-DIST
      ***                          AND SUB-DIST  OF WS-UFP
      ***                                         = MAKEUP-SUB-DIST
      ***                          AND POOL-NAME OF WS-UFP
      ***                                         = MAKEUP-POOL
                                   IF  DIST2      = MAKEUP-DIST
                                   AND SUB-DIST2  = MAKEUP-SUB-DIST
                                   AND POOL-NAME2 = MAKEUP-POOL
      *03/29/17 - END
      *6/21/16 - BEG
                                   AND TURN-NBRA = 'MU'
      *6/21/16 - END

                                    IF UFP-TRNEE-MARRY-TURN-NBR > SPACES
                                    AND UFP-TRNEE-MARRY-TURN-NBR =
                                        WS-SV-UFP-TURN
                                    AND POOL-CRAFT-CODE2 =
                                        SCR08-CC(FUNC-SUB)
      *7/26/16 - BEG
                                    AND NOT UFP-ASSOC-PRIMARY-COMPLETE
      *7/26/16 - END
      *------------------------------------------------------------*
      *                       CONVERT UFP TIMES                    *
      *------------------------------------------------------------*
                                         IF DIST2 NOT = SCR08-DIST
                                         OR SUB-DIST2 NOT = SCR08-DIST
                                         PERFORM P0400-CONVERT-UFP-TIMES
                                         END-IF
                                         MOVE SPACES
                                         TO P08CA-SCREEN-ARRAY(FUNC-SUB)
                                         PERFORM P0360-SETUP-TRAIN-LINE

                                         SET MU-DONE TO TRUE
                                         SET WS-ASSOC-MU-TURN-FOUND
                                                     TO TRUE
                                     ELSE
                                         IF MAKEUP-TURN-NUMERIC < 99
                                            ADD 1 TO MAKEUP-TURN-NUMERIC
                                         ELSE
                                            MOVE 'P0350-1'
                                                        TO ERR-PARAGRAPH
                                            MOVE UFPTURN TO ERR-KEY
                                            PERFORM P9999-GOT-PROBLEM
                                         END-IF
                                     END-IF
                                   ELSE
                                      SET MU-DONE TO TRUE
                                   END-IF
                                ELSE
                                   SET MU-DONE TO TRUE
                                END-IF
                             END-PERFORM
      *CNC0499 - MFO - TESTING - BEG
                             IF NOT WS-ASSOC-MU-TURN-FOUND
                                SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                                MOVE SPACES
                                           TO P08CA-TRK-REASON(FUNC-SUB)
                                IF (NOT (SUCCESS OR NO-RECORD-FND
                                                 OR END-OF-FILE))
                                OR (NOT OPTIONAL-TURN(CRAFT-SUB))
                                   MOVE 'P0350-2' TO ERR-PARAGRAPH
                                   MOVE UFPTURN   TO ERR-KEY
                                   PERFORM P9999-GOT-PROBLEM
                                END-IF
                             END-IF
      *CNC0499 - MFO - TESTING - END
                          ELSE
      *------------------------------------------------------------*
      *                    CONVERT UFP TIMES                       *
      *------------------------------------------------------------*
                             IF DIST2             NOT = SCR08-DIST
                             OR SUB-DIST2         NOT = SCR08-DIST
                                PERFORM P0400-CONVERT-UFP-TIMES
                             END-IF
                             MOVE SPACES TO P08CA-SCREEN-ARRAY(FUNC-SUB)
                             PERFORM P0360-SETUP-TRAIN-LINE
                          END-IF
      *MFO #7 - BEG
                          END-IF
      *MFO #7 - END
                       END-IF
                       MOVE ARRAY-MAX TO FUNC-SUB
                    END-IF
                 END-PERFORM
              END-IF
           END-PERFORM
           MOVE HOLD-FUNC-SUB TO FUNC-SUB.
      *
       P0351-CHK-ASSOC-MU-TRN.
      *
           MOVE SPACES                       TO WS-ORIG-TURN-NBR
           IF UFP-ORIG-TURN-NBR > SPACES
              MOVE UFP-ORIG-TURN-NBR         TO WS-ORIG-TURN-NBR
      ***                                       TURN-NBR OF WS-UFP
      ***     MOVE UFPTURN-AREA TO UFPTURN
      ***     PERFORM P8600-READ-UFPTURN
      ***     IF SUCCESS
                 MOVE SPACES                 TO WS-ASSOC-MU-TURN-FL
                 MOVE 'MU'                   TO MAKEUP-TURN-PREFIX
                 MOVE 01                     TO MAKEUP-TURN-NUMERIC
                 MOVE '0'                    TO WS-MU-DONE-CODE
                 PERFORM UNTIL MU-DONE
                    MOVE MAKEUP-TURN TO UFPTURN
      ***           PERFORM P8600-READ-UFPTURN
                    PERFORM P8655-READNXT-UFPTURN
                    IF SUCCESS
      *03/29/17 - BEG
      ***              IF  DIST      OF WS-UFP = MAKEUP-DIST
      ***              AND SUB-DIST  OF WS-UFP = MAKEUP-SUB-DIST
      ***              AND POOL-NAME OF WS-UFP = MAKEUP-POOL
                       IF  DIST2               = MAKEUP-DIST
                       AND SUB-DIST2           = MAKEUP-SUB-DIST
                       AND POOL-NAME2          = MAKEUP-POOL
      *03/29/17 - END
      *6/21/16 - BEG
                       AND TURN-NBRA = 'MU'
      *6/21/16 - END

                          IF UFP-ORIG-TURN-NBR > SPACES
                          AND POOL-CRAFT-CODE2 = SCR08-CC(FUNC-SUB)
      *9/22/16 - BEG
      *                   AND (UFP-ORIG-TURN-NBR = WS-ORIG-TURN-NBR
      *                    OR (UFP-ORIG-TURN-NBR(1:2) = 'MU'
      *                   AND UFP-TRNEE-MARRY-TURN-NBR =
      *                        WS-ORIG-TURN-NBR))
                          AND (
                              (UFP-ORIG-TURN-NBR(1:2) NOT = 'MU' AND
                               UFP-ORIG-TURN-NBR = WS-ORIG-TURN-NBR)
                             OR
                              (UFP-ORIG-TURN-NBR(1:2) = 'MU' AND
                               UFP-TRNEE-MARRY-TURN-NBR =
                               WS-ORIG-TURN-NBR)
                             )
      *9/22/16 - END
      *7/26/16 - BEG
                          AND NOT UFP-ASSOC-PRIMARY-COMPLETE
      *7/26/16 - END
      *------------------------------------------------------------*
      *                       CONVERT UFP TIMES                    *
      *------------------------------------------------------------*
                             IF DIST2          NOT = SCR08-DIST
                             OR SUB-DIST2      NOT = SCR08-DIST
                                PERFORM P0400-CONVERT-UFP-TIMES
                             END-IF
                             MOVE SPACES TO P08CA-SCREEN-ARRAY(FUNC-SUB)
                             PERFORM P0360-SETUP-TRAIN-LINE
                             SET MU-DONE TO TRUE
                             SET WS-ASSOC-MU-TURN-FOUND TO TRUE
                          ELSE
                             IF MAKEUP-TURN-NUMERIC < 99
                                ADD 1 TO MAKEUP-TURN-NUMERIC
                             ELSE
                                MOVE 'P0351-1' TO ERR-PARAGRAPH
                                MOVE UFPTURN   TO ERR-KEY
                                PERFORM P9999-GOT-PROBLEM
                             END-IF
                          END-IF
                       ELSE
                          SET MU-DONE TO TRUE
                       END-IF
                    ELSE
                       SET MU-DONE TO TRUE
                    END-IF
                 END-PERFORM
                 IF NOT WS-ASSOC-MU-TURN-FOUND
                    SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                    MOVE SPACES TO P08CA-TRK-REASON(FUNC-SUB)
                    IF (NOT (SUCCESS OR NO-RECORD-FND OR END-OF-FILE))
                    OR (NOT OPTIONAL-TURN(CRAFT-SUB))
                       MOVE 'P0351-2'    TO ERR-PARAGRAPH
                       MOVE UFPTURN      TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 END-IF
      ***     END-IF
           END-IF
           .
      *
       P0355-ADVANCE-SCHEDULE.
      *
           IF P08CA-SCHD-CATCHUP(FUNC-SUB) NOT = SPACES OR
             (P08CA-SCHD-DLY    (FUNC-SUB) NOT = SPACES
              AND NOT P08CA-SCHED-ALT(FUNC-SUB))        OR
              P08CA-SCHD-ALT    (FUNC-SUB) NOT = SPACES
              MOVE ZEROES    TO WS-SCHEDULE-DONE-CODE
              PERFORM UNTIL SCHEDULE-DONE
                 PERFORM P0358-NEXT-SCHEDULE
              END-PERFORM
           END-IF

           IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
              AND NOT (P08CA-NO-SCHED(FUNC-SUB)
                  OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                  OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                  OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                  OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB))
              IF P08CA-SCHED-ALT(FUNC-SUB)
                 CONTINUE
              ELSE
                 IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR 'SE' OR 'ET')
                    IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB) > SPACES
                       SET P08CA-SCHED-ALT(FUNC-SUB)
                                                TO TRUE
                       MOVE SPACES          TO WORK-UFPPOS
                                               WORK-CNTLKEY
                       MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-DIST
                                               WK-CNTL-DIST
                       MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-SUB-DIST
                                               WK-CNTL-SUB-DIST
                       MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-POOL
                                               WK-CNTL-POOL
                       MOVE ZEROS           TO WK-UFPPOS-IN-OUT
                       MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-IN-OUT-TERM
                       MOVE ZEROS           TO WK-UFPPOS-KEY
                       PERFORM P0370-SET-EN-MARRIED-FLAGS
                       IF MINE-TURN-SVC
                          MOVE SPACES       TO WK-UFPPOS-DATE-TIME
                       END-IF
                       PERFORM P0390-SETUP-ASSOC-CRAFTS
                       IF NOT ASSOCIATED-TURN
                          MOVE SCR08-CC(FUNC-SUB)
                                            TO WK-UFPPOS-CC
                          PERFORM P0340-GET-NEXT-TURN
                       END-IF
                    ELSE
                       SET P08CA-SCHED-COMPLETE(FUNC-SUB)
                                            TO TRUE
                    END-IF
                 ELSE
                    IF P08CA-SCHD-POOL-ID-ALT(FUNC-SUB) > SPACES
                       SET P08CA-SCHED-ALT(FUNC-SUB)
                                                TO TRUE
                       MOVE SPACES          TO WORK-UFPPOS
                                               WORK-CNTLKEY
                       MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-DIST
                                               WK-CNTL-DIST
                       MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-SUB-DIST
                                               WK-CNTL-SUB-DIST
                       MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-POOL
                                               WK-CNTL-POOL
                       MOVE ZEROS           TO WK-UFPPOS-IN-OUT
                       MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                            TO WK-UFPPOS-IN-OUT-TERM
                       MOVE ZEROS           TO WK-UFPPOS-KEY
                       PERFORM P0380-SET-TR-MARRIED-FLAGS
                       IF MINE-TURN-SVC
                          MOVE SPACES       TO WK-UFPPOS-DATE-TIME
                       END-IF
                       PERFORM P0390-SETUP-ASSOC-CRAFTS
                       IF NOT ASSOCIATED-TURN
                          MOVE SCR08-CC(FUNC-SUB)
                                            TO WK-UFPPOS-CC
                          PERFORM P0340-GET-NEXT-TURN
                       END-IF
                    ELSE
                       SET P08CA-SCHED-COMPLETE(FUNC-SUB)
                                            TO TRUE
                    END-IF
                 END-IF
              END-IF
           END-IF

           IF P08CA-ASGN-KEY(FUNC-SUB)     > SPACES
              IF P08CA-SCHD-DLY(FUNC-SUB) NOT = SPACES
                 PERFORM P0359-SET-SCHD-TYP
              END-IF
           END-IF.
      *
       P0358-NEXT-SCHEDULE.
      *
           MOVE SPACES                   TO P932-COMMAREA-PARMS
           MOVE P08CA-PROFILE-KEY        TO P932-PROFILE-KEY
           MOVE WS-FORMAT-TRAIN          TO P932-TRAIN
           MOVE WS-CALL-DATE-TIME        TO P932-CALL-DATE-TIME
           MOVE PSTCA-TIME-ZONE          TO P932-TIME-ZONE
           PERFORM P8700-READ-P08CA-TASK
           MOVE TASK-TOPC-EN-STA         TO P932-TOPC-EN-STA
           MOVE TASK-TOPC-TR-STA         TO P932-TOPC-TR-STA

           IF P08CA-SCHD-CATCHUP(FUNC-SUB) NOT = SPACES
              MOVE P08CA-SCHD-KEY(FUNC-SUB)
                                         TO P932-SCHEDULE-KEY
              MOVE P08CA-SCHD-CATCHUP(FUNC-SUB)
                                         TO P932-CATCHUP-SCHED
           ELSE
              IF P08CA-SCHD-ALT    (FUNC-SUB) NOT = SPACES
                 MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                            TO P932-ALT-POOL-DIST
                 MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                            TO P932-ALT-POOL-SDIST
                 MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                            TO P932-ALT-POOL
                 MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                            TO P932-ALT-POOL-TERM
                 MOVE 'Y'                   TO P932-SCHD-ALT
              ELSE
                 MOVE P08CA-SCHD-KEY(FUNC-SUB)
                                            TO P932-SCHEDULE-KEY
                 MOVE 'Y'                   TO P932-SCHD-DLY
              END-IF
           END-IF

           IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR 'SE' OR 'ET')
              MOVE 'EN'                  TO P932-CRAFT-CODE
           ELSE
              MOVE 'CO'                  TO P932-CRAFT-CODE
           END-IF

           IF P08CA-SCHD-ALT-USE(FUNC-SUB) NOT = SPACES OR
              P08CA-SCHD-ALT    (FUNC-SUB) NOT = SPACES
              SET ALTERNATE-USE TO TRUE
           ELSE
              MOVE SPACES TO WS-ALTERNATE-USE-CODE
           END-IF

           EXEC CICS LINK
                     PROGRAM(P932-PGM)
                     COMMAREA(P932-COMMAREA-PARMS)
                     LENGTH(P932-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P0358-1'             TO ERR-PARAGRAPH
              MOVE 'P932LINK'            TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF

           MOVE P932-SCHEDULE-TYPE     TO
                          P08CA-SCHD-TYP(FUNC-SUB)
           MOVE P932-CATCHUP-SCHED     TO
                          P08CA-SCHD-CATCHUP(FUNC-SUB)
           MOVE P932-SCHD-DLY          TO
                          P08CA-SCHD-DLY    (FUNC-SUB)
           MOVE P932-SCHD-ALT          TO
                          P08CA-SCHD-ALT    (FUNC-SUB)
           MOVE WS-ALTERNATE-USE-CODE  TO
                          P08CA-SCHD-ALT-USE(FUNC-SUB)

           IF P08CA-NO-SCHED(FUNC-SUB)         OR
              P08CA-SCHED-COMPLETE(FUNC-SUB)
              SET SCHEDULE-DONE TO TRUE
           ELSE
              MOVE P932-SCHEDULE-KEY      TO
                             P08CA-SCHD-KEY(FUNC-SUB)
              MOVE P932-TURN-PARM         TO
                             P08CA-SCHD-TURN(FUNC-SUB)
              MOVE P932-SCH-POOL-ID       TO
                             P08CA-SCHD-POOL-ID(FUNC-SUB)
              MOVE P932-ALT-POOL-ID       TO
                             P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
              MOVE P932-REST-FLAG         TO
                             P08CA-SCHD-REST-FLAG(FUNC-SUB)
              MOVE P932-CALL-CATCHUP-DATE TO
                             P08CA-SCHD-CATCHUP-DATE(FUNC-SUB)
              MOVE SPACES                   TO WORK-UFPPOS
                                               WORK-CNTLKEY
              IF P08CA-SCHD-ALT    (FUNC-SUB) NOT = SPACES
                 CONTINUE
              ELSE
                 IF P08CA-SCHED-ALT(FUNC-SUB)
                    MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                               TO WK-UFPPOS-DIST
                                                  WK-CNTL-DIST
                    MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                               TO WK-UFPPOS-SUB-DIST
                                                  WK-CNTL-SUB-DIST
                    MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                               TO WK-UFPPOS-POOL
                                                  WK-CNTL-POOL
                    MOVE ZEROS                 TO WK-UFPPOS-IN-OUT
                    MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                               TO WK-UFPPOS-IN-OUT-TERM
                    MOVE ZEROS                 TO WK-UFPPOS-KEY
                 ELSE
                    MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                               TO WK-UFPPOS-DIST
                                                  WK-CNTL-DIST
                    MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                               TO WK-UFPPOS-SUB-DIST
                                                  WK-CNTL-SUB-DIST
                    MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                               TO WK-UFPPOS-POOL
                                                  WK-CNTL-POOL
                    MOVE ZEROS                 TO WK-UFPPOS-IN-OUT
                    MOVE P08CA-SCHD-TERM(FUNC-SUB)
                                               TO WK-UFPPOS-IN-OUT-TERM
                    MOVE ZEROS                 TO WK-UFPPOS-KEY
                 END-IF
                 IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR 'SE' OR 'ET')
                    PERFORM P0370-SET-EN-MARRIED-FLAGS
                 ELSE
                    PERFORM P0380-SET-TR-MARRIED-FLAGS
                 END-IF
                 PERFORM P0390-SETUP-ASSOC-CRAFTS
                 IF NOT ASSOCIATED-TURN
                    MOVE SCR08-CC(FUNC-SUB) TO WK-UFPPOS-CC
                    PERFORM P0340-GET-NEXT-TURN
                 ELSE
                    SET SCHEDULE-DONE       TO TRUE
                 END-IF
                 IF P08CA-ASGN-KEY(FUNC-SUB)  > SPACES
                    SET SCHEDULE-DONE       TO TRUE
                 END-IF
                 IF P08CA-SCHED-ALT(FUNC-SUB)
                    AND P08CA-ASGN-KEY(FUNC-SUB) <= SPACES
                    SET SCHEDULE-DONE       TO TRUE
                 END-IF
              END-IF
           END-IF.
      *
       P0359-SET-SCHD-TYP.
      *
           IF P08CA-SCHD-ALT-USE(FUNC-SUB) = SPACES
              IF P08CA-SCHD-CATCHUP(FUNC-SUB) NOT = SPACES
                 MOVE '  CATCHUP'   TO SCR08-SCHD-TYP(FUNC-SUB)
              ELSE
                 IF P08CA-SCHED-ALT(FUNC-SUB)
                    MOVE '  ALT SRC'   TO SCR08-SCHD-TYP(FUNC-SUB)
                 ELSE
                    MOVE '  CURRENT'   TO SCR08-SCHD-TYP(FUNC-SUB)
                 END-IF
              END-IF
           ELSE
              IF P08CA-SCHD-CATCHUP(FUNC-SUB) NOT = SPACES
                 MOVE ' ALT C/UP'   TO SCR08-SCHD-TYP(FUNC-SUB)
              ELSE
                 IF P08CA-SCHED-ALT(FUNC-SUB)
                    MOVE '  ALT ALT'   TO SCR08-SCHD-TYP(FUNC-SUB)
                 ELSE
                    MOVE ' ALT CURR'   TO SCR08-SCHD-TYP(FUNC-SUB)
                 END-IF
              END-IF
           END-IF.
      *
       P0360-SETUP-TRAIN-LINE.
      *
           IF FUNC-SUB NOT > ARRAY-MAX
              MOVE 'U'           TO WK-ASGN-JOB-TYPE
                                    P08CA-ASGN-TYP(FUNC-SUB)
              MOVE UFPTURN-AREA  TO WK-ASGN-ASSIGNMENT
                                    P08CA-ASGN-KEY(FUNC-SUB)
              IF CO-POOL
                 AND NOT CO-BK-MARRIED
                 AND NOT B1-B2-MARRIED
                 MOVE UFP-2ND-BK-FLAG        TO P08CA-COND-2BK-FLAG
              END-IF
      *    CNC0077 - FLW, 12/10/96, START
              IF FILL-VACANCY
                 SET P08CA-ASGN-MU(FUNC-SUB)
                                          TO TRUE
              END-IF
              IF (JSK2-ASGN-TRAIN
                 OR (PS42-POOL-TYPE AND HOLD-XB-EXTENDED-SCHED))
                 AND UFP-CALL
      *C1081-BEG
                 IF TURN-NBRA OF WS-UFP = 'MU'
      *C1081-BEG
                    SET P08CA-ASGN-MU-XB(FUNC-SUB)
                                          TO TRUE
      *C1081-BEG
                 END-IF
      *C1081-BEG
              END-IF
              IF NOT HAVE-XB-EMP
                 PERFORM P8020-GET-ASGN-EMPS
              END-IF
      *    CNC0077 - FLW, 12/10/96, END
              PERFORM P1090-GET-JOB-QUALIFICATIONS
              PERFORM P1000-SETUP-EMPLOYEE-DATA
              MOVE UFPTURN-AREA              TO SCR08-TURN(FUNC-SUB)
           END-IF.
      *
       P0370-SET-EN-MARRIED-FLAGS.
      *
           MOVE SPACES             TO EN-FI-MARRIED-FLAG
                                      EN-ET-MARRIED-FLAG
                                      EN-ID-POOL-FLAG
                                      WS-MIN-AWAY-DATE-TIME
                                      POOL-SERVICE-FLAG
      *    CNC0077 - FLW, 10/10/96, START
           IF WORK-CNTLKEY > SPACES
      *       FIX SUBSCRIPT ERROR
              IF FUNC-SUB > 7 OR FUNC-SUB < 1
                 MOVE 1         TO FUNC-SUB
              END-IF
              IF P932-SCH-POOL-ID(1:5)             = 'SPARE' OR
                 P08CA-SCHD-POOL-ID(FUNC-SUB)(1:5) = 'SPARE'
                 MOVE WS-TRCN-FILE       TO WS-TRCN-FILE-HOLD
                 MOVE P08CA-PROFILE-KEY  TO TRCNKEY1
                 PERFORM P8000-READ-TRCNKEY1
                 MOVE TRCN-EN-FROM-DIST  TO WK-CNTL-DIST
                 MOVE TRCN-EN-FROM-SDIST TO WK-CNTL-SUB-DIST
                 MOVE TRCN-EN-FROM-POOL  TO WK-CNTL-POOL
                 MOVE WS-TRCN-FILE-HOLD  TO WS-TRCN-FILE
              END-IF
              MOVE '3A'               TO WK-CNTL-REC-TYPE
              MOVE 'F'                TO WK-CNTL-POOL-TYPE
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0370-1' TO ERR-PARAGRAPH
                 MOVE CNTLKEY TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-POOL-UNDIST-REST-FLAG
                                      TO EN-UNDISTURBED-REST-FLAG
              MOVE '03'               TO WK-CNTL-REC-TYPE
              MOVE 'F'                TO WK-CNTL-POOL-TYPE
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0370-2' TO ERR-PARAGRAPH
                 MOVE CNTLKEY TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-EN-FI TO EN-FI-MARRIED-FLAG
              IF EN-FI-MARRIED
                 IF CNTL-POOL-FI-CRAFT NOT = ('Y' AND 'O')
                    SET EN-SE-MARRIED TO TRUE
                 END-IF
              END-IF
              MOVE CNTL-EN-ET             TO EN-ET-MARRIED-FLAG
              MOVE CNTL-POOL-SVC          TO POOL-SERVICE-FLAG
              MOVE TRCN-FNL-STN           TO WK-TRCN-EN-FNL-STN
              IF TRCN-FNL-STN = CNTL-POOL-HOME-STATION
                 AND SCR08-ASGN(1:2) = 'DH'
                 SET P08CA-EN-DHD-HOME    TO TRUE
              END-IF
              IF NOT EXIT-KEY
                 IF CNTL-ALT-DIST > SPACE
                    AND CNTL-ALT-SUB-DIST > SPACE
                    AND CNTL-ALT-EN-POOL > SPACE
                    SET EN-ID-POOL       TO TRUE
                    IF TRCN-OVRD-MIN-AWAY NOT = 'Y'
                       IF IDIV-MINIMUM-AWAY-TIME IS NUMERIC
                          AND IDIV-MINIMUM-AWAY-TIME > '0000'
                          MOVE ZEROS        TO DATE-CONVERSION-PARMS
                          SET PARM-SUBTRACT TO TRUE
                          MOVE WS-CALL-DATE TO PARM-PRI-DATE-GREG
                          MOVE WS-CALL-TIME TO PARM-PRI-HRMN
                          MOVE IDIV-MINIMUM-AWAY-TIME-NUM
                                            TO PARM-SEC-HRMN
                          PERFORM P9700-LINK-P903
                          IF NOT SUCCESS
                             MOVE 'P0370-3' TO ERR-PARAGRAPH
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                          MOVE PARM-RES-DATE-GREG
                                            TO WS-MIN-AWAY-DATE
                          MOVE PARM-RES-HRMN
                                            TO WS-MIN-AWAY-TIME
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF.
      *    CNC0077 - FLW, 10/10/96, END
      *
       P0380-SET-TR-MARRIED-FLAGS.
      *
           MOVE SPACES             TO CO-BK-MARRIED-FLAG
                                      CO-B1-MARRIED-FLAG
                                      CO-B2-MARRIED-FLAG
                                      CO-BG-MARRIED-FLAG
                                      B1-B2-MARRIED-FLAG
                                      CO-TT-MARRIED-FLAG
                                      TR-ID-POOL-FLAG
                                      WS-MIN-AWAY-DATE-TIME
                                      POOL-SERVICE-FLAG
      *    CNC0077 - FLW, 10/10/96, START
           IF WORK-CNTLKEY > SPACES
      *       FIX SUBSCRIPT ERROR
              IF FUNC-SUB > 7 OR FUNC-SUB < 1
                 MOVE 3         TO FUNC-SUB
              END-IF
              IF P932-SCH-POOL-ID(1:5)             = 'SPARE' OR
                 P08CA-SCHD-POOL-ID(FUNC-SUB)(1:5) = 'SPARE'
                 MOVE WS-TRCN-FILE       TO WS-TRCN-FILE-HOLD
                 MOVE P08CA-PROFILE-KEY  TO TRCNKEY1
                 PERFORM P8000-READ-TRCNKEY1
                 MOVE TRCN-TR-FROM-DIST  TO WK-CNTL-DIST
                 MOVE TRCN-TR-FROM-SDIST TO WK-CNTL-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL  TO WK-CNTL-POOL
                 MOVE WS-TRCN-FILE-HOLD  TO WS-TRCN-FILE
              END-IF
              MOVE '3A'               TO WK-CNTL-REC-TYPE
              MOVE 'F'                TO WK-CNTL-POOL-TYPE
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0380-1' TO ERR-PARAGRAPH
                 MOVE CNTLKEY TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-POOL-UNDIST-REST-FLAG
                                      TO TR-UNDISTURBED-REST-FLAG
              MOVE '03'               TO WK-CNTL-REC-TYPE
              MOVE 'F'                TO WK-CNTL-POOL-TYPE
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0380-1' TO ERR-PARAGRAPH
                 MOVE CNTLKEY TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-CO-B1-B2 TO CO-BK-MARRIED-FLAG
              IF CO-BK-MARRIED
                 IF CNTL-POOL-B1-CRAFT = ('Y' OR 'O')
                    SET CO-B1-MARRIED TO TRUE
                 END-IF
                 IF CNTL-POOL-B2-CRAFT = ('Y' OR 'O')
                    SET CO-B2-MARRIED TO TRUE
                 END-IF
                 IF CNTL-POOL-BG-CRAFT = ('Y' OR 'O')
                    SET CO-BG-MARRIED TO TRUE
                 END-IF
              END-IF
              MOVE CNTL-B1-B2             TO B1-B2-MARRIED-FLAG
              MOVE CNTL-CO-TT             TO CO-TT-MARRIED-FLAG
              MOVE CNTL-POOL-SVC          TO POOL-SERVICE-FLAG
              MOVE TRCN-FNL-STN           TO WK-TRCN-TR-FNL-STN
              IF TRCN-FNL-STN = CNTL-POOL-HOME-STATION
                 AND SCR08-ASGN(1:2) = 'DH'
                 SET P08CA-TR-DHD-HOME    TO TRUE
              END-IF
              IF NOT EXIT-KEY
                 IF CNTL-ALT-DIST > SPACE
                    AND CNTL-ALT-SUB-DIST > SPACE
                    AND CNTL-ALT-TR-POOL > SPACE
                    SET TR-ID-POOL       TO TRUE
                    IF TRCN-OVRD-MIN-AWAY NOT = 'Y'
                       IF IDIV-MINIMUM-AWAY-TIME IS NUMERIC
                          AND IDIV-MINIMUM-AWAY-TIME > '0000'
                          MOVE ZEROS        TO DATE-CONVERSION-PARMS
                          SET PARM-SUBTRACT TO TRUE
                          MOVE WS-CALL-DATE TO PARM-PRI-DATE-GREG
                          MOVE WS-CALL-TIME TO PARM-PRI-HRMN
                          MOVE IDIV-MINIMUM-AWAY-TIME-NUM
                                            TO PARM-SEC-HRMN
                          PERFORM P9700-LINK-P903
                          IF NOT SUCCESS
                             MOVE 'P0380-2' TO ERR-PARAGRAPH
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                          MOVE PARM-RES-DATE-GREG
                                            TO WS-MIN-AWAY-DATE
                          MOVE PARM-RES-HRMN
                                            TO WS-MIN-AWAY-TIME
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF.
      *    CNC0077 - FLW, 10/10/96, END
      *
       P0390-SETUP-ASSOC-CRAFTS.
      *
           MOVE SPACES             TO WS-ASSOCIATED-CRAFT-ARRAY
                                      WS-ASSOCIATED-TURN-CODE
           MOVE ZEROS              TO CRAFT-SUB
           MOVE SCR08-CC(FUNC-SUB) TO WS-ASSOC-TEST-CRAFT
           IF WS-ASSOC-TEST-CRAFT = 'EN'
              IF EN-FI-MARRIED
                 ADD 1 TO CRAFT-SUB
                 IF EN-SE-MARRIED
                    MOVE 'SE' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-SE-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 ELSE
                    MOVE 'FI' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-FI-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
              END-IF
              IF EN-ET-MARRIED
                 ADD 1 TO CRAFT-SUB
                 MOVE 'ET' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
              END-IF
           END-IF
           IF WS-ASSOC-TEST-CRAFT = ('FI' OR 'SE')
              IF EN-FI-MARRIED
                 MOVE '1'               TO WS-ASSOCIATED-TURN-CODE
                 IF CNTL-POOL-FI-CRAFT = 'O'
                    SET ASSOCIATED-OPT-TURN TO TRUE
                 ELSE
                    IF CNTL-POOL-SE-CRAFT = 'O'
                       SET ASSOCIATED-OPT-TURN TO TRUE
                    END-IF
                 END-IF
                 ADD 1 TO CRAFT-SUB
                 MOVE 'EN' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET PRIMARY-TURN(CRAFT-SUB) TO TRUE
                 IF EN-ET-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'ET' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                 END-IF
              END-IF
           END-IF
           IF WS-ASSOC-TEST-CRAFT = 'ET'
              IF EN-ET-MARRIED
                 SET ASSOCIATED-OPT-TURN TO TRUE
                 ADD 1 TO CRAFT-SUB
                 MOVE 'EN' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET PRIMARY-TURN(CRAFT-SUB) TO TRUE
                 IF EN-FI-MARRIED
                    ADD 1 TO CRAFT-SUB
                    IF EN-SE-MARRIED
                       MOVE 'SE' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                       IF CNTL-POOL-SE-CRAFT = 'O'
                          SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                       END-IF
                    ELSE
                       MOVE 'FI' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                       IF CNTL-POOL-FI-CRAFT = 'O'
                          SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 SET STUDENT-TURN TO TRUE
              END-IF
           END-IF
           IF WS-ASSOC-TEST-CRAFT = 'CO'
              IF CO-BK-MARRIED
                 IF CO-B1-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B1' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-B1-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-B2-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B2' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-B2-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-BG-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'BG' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-BG-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
              END-IF
              IF CO-TT-MARRIED
                 ADD 1 TO CRAFT-SUB
                 MOVE 'TT' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
              END-IF
           END-IF
           IF WS-ASSOC-TEST-CRAFT = 'B1'
              IF CO-BK-MARRIED
                 IF CNTL-POOL-B1-CRAFT =  'O'
                    SET ASSOCIATED-OPT-TURN TO TRUE
                 ELSE
                    MOVE '1'               TO WS-ASSOCIATED-TURN-CODE
                 END-IF
                 ADD 1 TO CRAFT-SUB
                 MOVE 'CO' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET PRIMARY-TURN(CRAFT-SUB) TO TRUE
                 IF CO-B2-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B2' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-B2-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-BG-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'BG' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-BG-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-TT-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'TT' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                 END-IF
              ELSE
                 IF B1-B2-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B2' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-B2-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
              END-IF
           END-IF
           IF WS-ASSOC-TEST-CRAFT = 'B2'
              IF CO-BK-MARRIED
                 IF CNTL-POOL-B2-CRAFT =  'O'
                    SET ASSOCIATED-OPT-TURN TO TRUE
                 ELSE
                    MOVE '1'                TO WS-ASSOCIATED-TURN-CODE
                 END-IF
                 ADD 1 TO CRAFT-SUB
                 MOVE 'CO' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET PRIMARY-TURN(CRAFT-SUB) TO TRUE
                 IF CO-B1-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B1' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-B1-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-BG-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'BG' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-BG-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-TT-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'TT' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                 END-IF
              ELSE
                 IF B1-B2-MARRIED
                    IF CNTL-POOL-B2-CRAFT = 'O'
                       SET ASSOCIATED-OPT-TURN TO TRUE
                    ELSE
                       MOVE '1'           TO WS-ASSOCIATED-TURN-CODE
                    END-IF
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B1' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    SET PRIMARY-TURN(CRAFT-SUB) TO TRUE
                 END-IF
              END-IF
           END-IF
           IF WS-ASSOC-TEST-CRAFT = 'BG'
              IF CO-BK-MARRIED
                 IF CNTL-POOL-BG-CRAFT =  'O'
                    SET ASSOCIATED-OPT-TURN TO TRUE
                 ELSE
                    MOVE '1'                TO WS-ASSOCIATED-TURN-CODE
                 END-IF
                 ADD 1 TO CRAFT-SUB
                 MOVE 'CO' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET PRIMARY-TURN(CRAFT-SUB) TO TRUE
                 IF CO-B1-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B1' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-B1-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-B1-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'B1' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    IF CNTL-POOL-B1-CRAFT = 'O'
                       SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                    END-IF
                 END-IF
                 IF CO-TT-MARRIED
                    ADD 1 TO CRAFT-SUB
                    MOVE 'TT' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                    SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                 END-IF
              END-IF
           END-IF
           IF WS-ASSOC-TEST-CRAFT = 'TT'
              IF CO-TT-MARRIED
                 SET ASSOCIATED-OPT-TURN TO TRUE
                 ADD 1 TO CRAFT-SUB
                 MOVE 'CO' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                 SET PRIMARY-TURN(CRAFT-SUB) TO TRUE
                 IF CO-BK-MARRIED
                    IF CO-B1-MARRIED
                       ADD 1 TO CRAFT-SUB
                       MOVE 'B1' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                       IF CNTL-POOL-B1-CRAFT = 'O'
                          SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                       END-IF
                    END-IF
                    IF CO-B2-MARRIED
                       ADD 1 TO CRAFT-SUB
                       MOVE 'B2' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                       IF CNTL-POOL-B2-CRAFT = 'O'
                          SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                       END-IF
                    END-IF
                    IF CO-BG-MARRIED
                       ADD 1 TO CRAFT-SUB
                       MOVE 'BG' TO WS-ASSOC-CRAFT(CRAFT-SUB)
                       IF CNTL-POOL-BG-CRAFT = 'O'
                          SET OPTIONAL-TURN(CRAFT-SUB) TO TRUE
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 SET STUDENT-TURN TO TRUE
              END-IF
           END-IF.
      *
      *    CNC0077 - FLW, 10/18/96, START
      *
       P0395-CHECK-ASSIGNED-XB.
      *
           IF P08CA-SCHD-XB-DIST(FUNC-SUB)        > SPACES  AND
              P08CA-SCHD-XB-SDIST(FUNC-SUB)       > SPACES  AND
              P08CA-SCHD-XB(FUNC-SUB)             > SPACES  AND
              P08CA-SCHD-XB-TURN(FUNC-SUB)        > SPACES

              MOVE SPACES                        TO WORK-CNTLKEY
              MOVE '08'                          TO WK-CNTL-REC-TYPE
              MOVE P08CA-SCHD-XB-DIST(FUNC-SUB)  TO WK-CNTL-DIST
              MOVE P08CA-SCHD-XB-SDIST(FUNC-SUB) TO WK-CNTL-SUB-DIST
              MOVE P08CA-SCHD-XB(FUNC-SUB)       TO WK-CNTL-XB-CODE
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P0395-1'                  TO ERR-PARAGRAPH
                 MOVE WORK-CNTLKEY               TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-XB-SCHEDULED-FLAG        TO HOLD-XB-SCHEDULED-FL
              MOVE SPACES                  TO WS-XB-FOUND-FLAG
                                              WS-XB-DAY-FOUND-FLAG
                                              WS-XB-DAY-TIME-FOUND-FLAG
                                              WS-XB-DONE-CODE
              MOVE P08CA-SCHD-KEY(FUNC-SUB)      TO WORK-CNTL-76-KEY
              IF HOLD-XB-EXTENDED-SCHED
                 PERFORM P0396-CHECK-EXTENDED-SCHEDULE
              ELSE
                 MOVE WK-CNTL-76-PROF            TO WK-JSK2-ASGN
                 MOVE SPACES                     TO WORK-JS-KEY1
                 MOVE P08CA-SCHD-XB-DIST(FUNC-SUB)
                                              TO WK-JSK1-ASGN-DIST
                 MOVE P08CA-SCHD-XB-SDIST(FUNC-SUB)
                                              TO WK-JSK1-ASGN-SUB-DIST
                 STRING 'EX'
                        P08CA-SCHD-XB-TURN(FUNC-SUB)
                        DELIMITED BY SIZE   INTO WK-JSK1-ASGN
                 MOVE P08CA-SCHD-XB(FUNC-SUB) TO WK-JSK1-ASGN-CC
                 MOVE 001                     TO WK-JSK1-ASGN-DAY-NUM
                 SET WK-JSK2-ASGN-TRAIN       TO TRUE
                 MOVE WORK-JS-KEY1            TO JSKEY1
                 EXEC CICS STARTBR
                           DATASET(JS-VIA-JSKEY1)
                           RIDFLD(JSKEY1)
                           GTEQ
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE             TO FILE-STATUS
                 IF NOT SUCCESS
                    IF NOT (NO-RECORD-FND OR END-OF-FILE)
      *                MOVE 'P0395-2'         TO ERR-PARAGRAPH
      *                MOVE JSKEY1            TO ERR-KEY
      *                PERFORM P9999-GOT-PROBLEM
      *             ELSE
                       SET XB-DONE            TO TRUE
                    END-IF
                 END-IF
                 PERFORM UNTIL XB-DONE
                    EXEC CICS READNEXT
                              DATASET(JS-VIA-JSKEY1)
                              INTO(WS-JOB-SCHEDULE)
                              LENGTH(JSKEY1-RLGTH)
                              RIDFLD(JSKEY1)
                              KEYLENGTH(JSKEY1-KLGTH)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE          TO FILE-STATUS
                    IF NOT SUCCESS
                       IF NOT (NO-RECORD-FND OR END-OF-FILE)
                          MOVE 'P0395-3'      TO ERR-PARAGRAPH
                          MOVE JSKEY2         TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
                       ELSE
                          SET XB-DONE         TO TRUE
                       END-IF
                    END-IF
                    IF JSK1-ASGN-DIST     = WK-JSK1-ASGN-DIST     AND
                       JSK1-ASGN-SUB-DIST = WK-JSK1-ASGN-SUB-DIST AND
                       JSK1-ASSIGNMENT    = WK-JSK1-ASSIGNMENT
                       IF JSK2-ASGN-TRAIN       AND
                          JSK2-ASGN = WK-JSK2-ASGN
                          SET XB-FOUND              TO TRUE
                          MOVE 'X'                  TO WK-ASGN-JOB-TYPE
                          MOVE JSK1-ASGN-DIST       TO WK-ASGN-DIST
                          MOVE JSK1-ASGN-SUB-DIST   TO WK-ASGN-SUB-DIST
                          MOVE JSK1-ASSIGNMENT      TO WK-ASGN-ASSIGN
                          MOVE ZEROS                TO WK-ASGN-DATE-TIME
                          MOVE JS-KEY1              TO HOLD-JS-KEY1
                          MOVE JS-KEY2              TO HOLD-JS-KEY2
                          IF JSK2-ASGN-DAY-NUM =
                                              P08CA-CALL-DAY-OF-WEEK-NUM
                             SET XB-DAY-FOUND       TO TRUE
                             IF SCR08-ORDER-TIME NOT >
                                                  JOB-SCHED-END-TIME AND
                                SCR08-ORDER-TIME NOT <
                                                  JSK2-ASGN-START-TIME
                                SET XB-DAY-TIME-FOUND  TO TRUE
                                SET XB-DONE            TO TRUE
                             END-IF
                          END-IF
                       END-IF
                    ELSE
                       SET XB-DONE                     TO TRUE
                    END-IF
                 END-PERFORM
                 EXEC CICS ENDBR
                           DATASET(JS-VIA-JSKEY1)
                           RESP(WS-RESPONSE)
                 END-EXEC
              END-IF
              IF XB-DAY-TIME-FOUND OR
                 XB-DAY-FOUND      OR
                 XB-FOUND
                 IF NOT XB-DAY-TIME-FOUND
                    SET P08CA-ASGN-XB-DISQUALIFIED(FUNC-SUB) TO TRUE
                 END-IF
                 PERFORM P8020-GET-ASGN-EMPS
                 IF HAVE-ASGN-ON-DUTY-EMP
                    MOVE ASGN-ON-DUTY-EMP      TO MSTRNBRK
                 ELSE
                    IF HAVE-ASGN-TEMPORARY-EMP
                       MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                    ELSE
                       IF HAVE-ASGN-OWNER
                          MOVE ASGN-OWNER      TO MSTRNBRK
                       END-IF
                    END-IF
                 END-IF
                 IF HAVE-ASGN-ON-DUTY-EMP
                 OR HAVE-ASGN-TEMPORARY-EMP
                 OR HAVE-ASGN-OWNER
                    IF HOLD-XB-EXTENDED-SCHED
                       MOVE 'X'              TO WK-ASGN-JOB-TYPE
                                                P08CA-ASGN-TYP(FUNC-SUB)
                       MOVE PS42-DIST-CD     TO WK-ASGN-DIST
                       MOVE PS42-SUB-DIST-CD TO WK-ASGN-SUB-DIST
                       STRING 'EX' PS42-TURN-CD
                         DELIMITED BY SIZE INTO WK-ASGN-ASSIGN(1:6)
                       MOVE PS42-BOARD-ID    TO WK-ASGN-CC
                    ELSE
                       MOVE HOLD-JS-KEY1     TO JS-KEY1
                       MOVE HOLD-JS-KEY2     TO JS-KEY2
                       MOVE JSK2-ASGN-TYPE   TO WK-ASGN-JOB-TYPE
                                                P08CA-ASGN-TYP(FUNC-SUB)
                       MOVE JSK1-ASGN-DIST   TO WK-ASGN-DIST
                       MOVE JSK1-ASGN-SUB-DIST TO WK-ASGN-SUB-DIST
                       MOVE JSK1-ASGN        TO WK-ASGN-ASSIGN(1:6)
                       MOVE JSK1-ASGN-CC     TO WK-ASGN-CC
                    END-IF
                    MOVE WORK-ASGNKEY1    TO P08CA-ASGN-KEY-XB(FUNC-SUB)
                    IF FUNC-SUB > 1
                       PERFORM VARYING SUBXB FROM 1 BY 1
                        UNTIL SUBXB IS GREATER THAN OR EQUAL TO FUNC-SUB
                          IF (P08CA-ASGN-KEY-XB(SUBXB) =
                                            P08CA-ASGN-KEY-XB(FUNC-SUB))
                          OR (P08CA-EMP-NO(SUBXB) = MSTRNBRK)
                             MOVE FUNC-SUB TO SUBXB
                             MOVE WS-OPEN-MSG(PSTCA-SUB)
                                                 TO SCR08-NAME(FUNC-SUB)
                             SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                             SET P08CA-TRK-DONT-TRACK(FUNC-SUB) TO TRUE
                             MOVE SPACES  TO P08CA-ASGN-KEY-XB(FUNC-SUB)
                          ELSE
                             SET P08CA-ASGN-NO-VCNY(FUNC-SUB) TO TRUE
                          END-IF
                       END-PERFORM
                    ELSE
                       SET P08CA-ASGN-NO-VCNY(FUNC-SUB) TO TRUE
                    END-IF
                    IF P08CA-ASGN-NO-VCNY(FUNC-SUB)
                       PERFORM P2215-CREATE-XB-ASSIGNMENT
                       PERFORM P1040-SETUP-NAME-LINE
                       IF LAYOFF-CODE OF WS-MSTR NOT = 'A0'
                          SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                          IF MISSED-CALL OF WS-MSTR
                             SET P08CA-TRK-MCALL  (FUNC-SUB) TO TRUE
                          ELSE
                             SET P08CA-TRK-UNAVAIL(FUNC-SUB) TO TRUE
                          END-IF
                          MOVE SPACES TO P08CA-EMP-NO(FUNC-SUB)
                          MOVE SCR08-NAME(FUNC-SUB)
                                           TO SCR08-NAMEB(FUNC-SUB)
                          MOVE SCR08-ST(FUNC-SUB)
                                           TO SCR08-STB(FUNC-SUB)
                          MOVE SCR08-ECC(FUNC-SUB)
                                           TO SCR08-ECCB(FUNC-SUB)
                          PERFORM P1060-CLEAR-EMP-LINE
                          MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                           TO SCR08-NAME(FUNC-SUB)
                       ELSE
                          MOVE SPACES      TO SCR08-NAMEB(FUNC-SUB)
                       END-IF
                    END-IF
                 ELSE
                    MOVE WS-OPEN-MSG(PSTCA-SUB)
                                           TO SCR08-NAME(FUNC-SUB)
                    SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                           TO TRUE
                    SET P08CA-TRK-DONT-TRACK(FUNC-SUB) TO TRUE
                 END-IF
              END-IF
           END-IF
      *C1022 - BEG
      *C1160 - BEG
           IF HOLD-XB-EXTENDED-SCHED
              CONTINUE
           ELSE
      *C1160 - END
              IF  TEMPORARY-ASGNMT       > SPACES
      *C1160 - BEG
              AND HOLD-JS-KEY1           > SPACES
      *C1160 - END
              AND NOT (TEMPORARY-ASGNMT  = HOLD-JS-KEY1(1:12))
              AND P08CA-EMP-NO(FUNC-SUB) >  SPACES
                 MOVE WS-NO-AVL-MSG(PSTCA-SUB)   TO SCR08-NAME(FUNC-SUB)
                 PERFORM P1060-CLEAR-DATA-LINE
                 SET P08CA-ASGN-IS-VCNY(FUNC-SUB)   TO TRUE
                 SET P08CA-TRK-DONT-TRACK(FUNC-SUB) TO TRUE
              END-IF
      *C1160 - BEG
           END-IF
      *C1160 - END
           .
      *C1022 - END
      *
      *    CNC0077 - FLW, 10/18/96, END
      *
       P0396-CHECK-EXTENDED-SCHEDULE.
      *
           INITIALIZE PS42-COMMAREA-PARMS
           SET PS42-GET-CURRENT-SCHED         TO TRUE
           MOVE P08CA-SCHD-XB-DIST(FUNC-SUB)  TO PS42-DIST-CD
           MOVE P08CA-SCHD-XB-SDIST(FUNC-SUB) TO PS42-SUB-DIST-CD
           MOVE P08CA-SCHD-XB(FUNC-SUB)       TO PS42-BOARD-ID
           MOVE P08CA-SCHD-XB-TURN(FUNC-SUB)  TO PS42-TURN-CD
           MOVE SCR08-ORDER-DATE              TO PS42-START-DATE
           MOVE SCR08-ORDER-TIME              TO PS42-FROM-TIME
           EXEC CICS LINK
                     PROGRAM(PS42-PGM)
                     COMMAREA(PS42-COMMAREA-PARMS)
                     LENGTH(PS42-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P0396-1'                  TO ERR-PARAGRAPH
              MOVE 'PS42-LINK'                TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF PS42-SCHEDULES-EXIST
              OR PS42-CURR-SCHED-FOUND
              IF PS42-CURR-SCHED-FOUND
                 AND PS42-ASGN-ID = WK-CNTL-76-PROF
      *
      *          THE XB TURN IS CURRENTLY PROTECTING THE SCHEDULED TURN
      *
                 SET XB-FOUND                 TO TRUE
                 SET XB-DAY-FOUND             TO TRUE
                 SET XB-DAY-TIME-FOUND        TO TRUE
                 MOVE 'X'                     TO WK-ASGN-JOB-TYPE
                 MOVE PS42-DIST-CD            TO WK-ASGN-DIST
                 MOVE PS42-SUB-DIST-CD        TO WK-ASGN-SUB-DIST
                 STRING 'EX' PS42-TURN-CD
                    DELIMITED BY SIZE       INTO WK-ASGN-ASSIGN(1:6)
                 MOVE PS42-BOARD-ID           TO WK-ASGN-CC
                 MOVE ZEROS                   TO WK-ASGN-DATE-TIME
              ELSE
                 IF PS42-PRV-ASGN-ID = WK-CNTL-76-PROF
                    PERFORM P0397-SEE-IF-ALREADY-PROTECTED
                 ELSE
                    IF PS42-NXT-ASGN-ID = WK-CNTL-76-PROF
                       PERFORM P0398-SEE-IF-WILL-PROTECT
                    END-IF
                 END-IF
                 IF NOT XB-DAY-FOUND
      *
      *             SEE IF THE XB TURN EVER PROTECTS THE POOL.
      *
                    SET PS42-CHECK-FOR-PROTECTION   TO TRUE
                    MOVE 'T'                        TO PS42-ASGN-TYP-CD
                    MOVE WK-CNTL-76-PROF            TO PS42-ASGN-ID
                    EXEC CICS LINK
                              PROGRAM(PS42-PGM)
                              COMMAREA(PS42-COMMAREA-PARMS)
                              LENGTH(PS42-LGTH)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE          TO FILE-STATUS
                    IF NOT SUCCESS
                       MOVE 'P0396-1'         TO ERR-PARAGRAPH
                       MOVE 'PS42-LINK'       TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    IF PS42-SCHEDULES-EXIST
                       SET XB-FOUND           TO TRUE
                    END-IF
                 END-IF
              END-IF
           END-IF
           .
      *
       P0397-SEE-IF-ALREADY-PROTECTED.
      *
      *    DETERMINE IF THE XB TURN ALREADY PROTECTED THE POOL
      *    TURN TODAY, BUT IS NOT CURRENTLY PROTECTING IT.
      *
           MOVE ZEROES                        TO DATE-CONVERSION-PARMS
           SET PARM-ADD                       TO TRUE
           MOVE PS42-START-DATE               TO PARM-PRI-DATE-GREG
           COMPUTE PARM-SEC-DATE-GREG = PS42-PRV-DAY-SEQ-NBR - 1
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P0397-1'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF PARM-RES-DATE-GREG = SCR08-ORDER-DATE
              SET XB-FOUND                    TO TRUE
              SET XB-DAY-FOUND                TO TRUE
           ELSE
              IF PS42-PRV-FROM-TIME >= SCR08-ORDER-TIME
                 AND PS42-PRV-TO-TIME <= SCR08-ORDER-TIME
                 MOVE PARM-RES-DATE-GREG      TO WS-DATE-GREG
                 MOVE ZEROES                  TO DATE-CONVERSION-PARMS
                 SET PARM-DIFF                TO TRUE
                 MOVE SCR08-ORDER-DATE        TO PARM-PRI-DATE-GREG
                 MOVE WS-DATE-GREG            TO PARM-SEC-DATE-GREG
                 PERFORM P9700-LINK-P903
                 IF NOT SUCCESS
                    MOVE 'P0397-2'            TO ERR-PARAGRAPH
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 IF PARM-RES-TOT-DAYS = 1
                    SET XB-FOUND              TO TRUE
                    SET XB-DAY-FOUND          TO TRUE
                 END-IF
              END-IF
           END-IF
           .
      *
       P0398-SEE-IF-WILL-PROTECT.
      *
      *    DETERMINE IF THE XB TURN WILL PROTECTED THE POOL TURN LATER
      *    ON TODAY.
      *
           MOVE ZEROES                        TO DATE-CONVERSION-PARMS
           SET PARM-ADD                       TO TRUE
           MOVE PS42-START-DATE               TO PARM-PRI-DATE-GREG
           COMPUTE PARM-SEC-DATE-GREG = PS42-NXT-DAY-SEQ-NBR - 1
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P0398-1'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF PARM-RES-DATE-GREG = SCR08-ORDER-DATE
              SET XB-FOUND                    TO TRUE
              SET XB-DAY-FOUND                TO TRUE
           END-IF
           .
      *
       P0400-CONVERT-UFP-TIMES.
      *
      *----------------------------------------------------------------*
      *      CONVERT UFP TIMES   TO  PSTCA-TIME-ZONE                   *
      *----------------------------------------------------------------*
           MOVE SPACES                   TO WORK-CNTLKEY
           MOVE '02'                     TO WK-CNTL-REC-TYPE
           MOVE DIST2                    TO WK-CNTL-DIST
           MOVE SUB-DIST2                TO WK-CNTL-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P0400-1'             TO ERR-PARAGRAPH
              MOVE CNTLKEY               TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
           IF UFP-TRAIN-TIME > '0000000000'
              MOVE SPACES                   TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE           TO TZ-IN-ZONE
              MOVE UFP-TRAIN-TIME           TO TZ-IN-DATE-TIME
              MOVE PSTCA-TIME-ZONE          TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000014'      TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME         TO UFP-TRAIN-TIME
           END-IF
      *
           IF UFP-TIE-UP-TIME > '0000000000'
              MOVE SPACES                   TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE           TO TZ-IN-ZONE
              MOVE UFP-TIE-UP-TIME          TO TZ-IN-DATE-TIME
              MOVE PSTCA-TIME-ZONE          TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000015'      TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME         TO UFP-TIE-UP-TIME
           END-IF
      *
           IF ON-DUTY-TIME > '0000000000'
              MOVE SPACES                   TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE           TO TZ-IN-ZONE
              MOVE ON-DUTY-TIME             TO TZ-IN-DATE-TIME
              MOVE PSTCA-TIME-ZONE          TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000016'      TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME         TO ON-DUTY-TIME
           END-IF
      *
           IF TURN-REST-TIME > ZEROS
              MOVE SPACES                   TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE           TO TZ-IN-ZONE
              MOVE TURN-REST-TIME           TO TZ-IN-DATE-TIME
              MOVE PSTCA-TIME-ZONE          TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000017'      TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME         TO TURN-REST-TIME
           END-IF
      *
           IF TURN-NBR-TIME > '0000000000'
              MOVE SPACES                   TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE           TO TZ-IN-ZONE
              MOVE TURN-NBR-TIME            TO TZ-IN-DATE-TIME
              MOVE PSTCA-TIME-ZONE          TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000018'      TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME         TO TURN-NBR-TIME
           END-IF.
      *
       P0500-NEXT-BIDPACK-TURN.
      *
           SET TURN-NOT-FOUND                 TO TRUE
           MOVE SPACES                        TO PS32-COMMAREA-PARMS
           MOVE P08CA-PROFILE-KEY             TO PS32-PROFILE-KEY
           MOVE SCR08-CC(FUNC-SUB)            TO PS32-CRAFT-CODE
           MOVE PSTCA-TIME-ZONE               TO PS32-TIME-ZONE
           MOVE SCR08-ORDER-DATE              TO WS-CALL-DATE
           MOVE SCR08-ORDER-TIME              TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600     (8) CNLD-270
      *    IF SCR08-OD-DATE(FUNC-SUB)          > SPACES
      *       MOVE SCR08-OD-DATE(FUNC-SUB)    TO WS-CALL-DATE
      *       MOVE SCR08-OD-TIME(FUNC-SUB)    TO WS-CALL-TIME
      *    END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
           MOVE WS-CALL-DATE-TIME             TO PS32-CALL-DATE-TIME
           MOVE TASK-TOPC-EN-STA              TO PS32-TOPC-EN-STA
           MOVE TASK-TOPC-TR-STA              TO PS32-TOPC-TR-STA
           MOVE P08CA-BIDPACK-DATA-AREA(FUNC-SUB)
                                              TO PS32-KEY-DATA-AREA
           SET PS32-GET-NEXT-SCHED            TO TRUE
           IF P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
              MOVE P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                              TO PS32-SCHED-POOL-ID-ALT
              SET PS32-GET-ALT-SCHED          TO TRUE
              MOVE 'Y'                        TO PS32-SCHD-ALT
           END-IF
           IF P08CA-BIDPACK-DATA-AREA(FUNC-SUB) > SPACES
              AND SAVE-ASGN-KEY                 > SPACES
              MOVE SAVE-ASGN-KEY              TO UFPTURN-AREA
              MOVE UFPTURN-AREA               TO UFPTURN
              PERFORM P8600-READ-UFPTURN
              IF NOT SUCCESS
                 MOVE 'P0500-1'               TO ERR-PARAGRAPH
                 MOVE UFPTURN                 TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              SET DE-YYMMDD-FORMAT            TO TRUE
              SET DE-REFORMAT-ONLY            TO TRUE
              MOVE UFP-POS-DATE-TIME(1:6)     TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-YYMMDD-CE               TO PS32-POS-CENT
              MOVE UFP-POS-DATE-TIME          TO PS32-POS-DATE-TIME
              MOVE UFP-POS-TIE-BREAKER        TO PS32-POS-TIE
           END-IF

           EXEC CICS LINK
                     PROGRAM(PS32-PGM)
                     COMMAREA(PS32-COMMAREA-PARMS)
                     LENGTH(PS32-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P0500-2'                  TO ERR-PARAGRAPH
              MOVE 'PS32LINK'                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF NOT PS32-NO-SCHEDULE-FOUND
      *C1170.1 - BEG
              MOVE PS32-SCHEDULE-KEY     TO UFPTURN-AREA
              MOVE UFPTURN-AREA           TO UFPTURN
              PERFORM P8600-READ-UFPTURN
              IF NOT SUCCESS
                 MOVE 'P0500-3'           TO ERR-PARAGRAPH
                 MOVE UFPTURN             TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
      *
              SET DE-YYMMDD-FORMAT        TO TRUE
              MOVE WS-CALL-DATE-SYS       TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD            TO DE-COMPARE2-DATE
              MOVE WS-CALL-TIME-SYS       TO DE-COMPARE2-TIME
              SET DE-YYMMDD-FORMAT        TO TRUE
              MOVE UFP-POS-DATE-TIME(1:6) TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD            TO DE-COMPARE3-DATE
              MOVE UFP-POS-DATE-TIME(7:4) TO DE-COMPARE3-TIME
              IF DE-COMPARE3-DATE-TIME > DE-COMPARE2-DATE-TIME
      ***  BOARD DATE/TIME AHEAD OF CALL DATE/TIME...
                 CONTINUE
              ELSE
                 MOVE SPACES             TO P08CA-SCREEN-ARRAY(FUNC-SUB)
                 MOVE PS32-SCHEDULE-KEY  TO P08CA-ASGN-KEY(FUNC-SUB)
                 MOVE PS32-KEY-DATA-AREA
                                    TO P08CA-BIDPACK-DATA-AREA(FUNC-SUB)
                 MOVE PS32-SCHED-POOL-ID-ALT
                                     TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                 SET BIDPACK-FOUND        TO TRUE
                 SET TURN-FOUND           TO TRUE
                 IF NOT PS32-GET-ALT-SCHED
                    SET P08CA-SCHED-BIDPACK(FUNC-SUB) TO TRUE
                 END-IF
              END-IF
              IF TURN-FOUND
                 CONTINUE
              ELSE
                 IF (PS32-SCHD-ALT = SPACES
                 AND PS32-GET-NEXT-SCHED
                 AND PS32-GET-ALT-SCHED)
                    IF PS32-SCHED-POOL-ID-ALT > SPACES
                       MOVE SPACES TO PS32-SCHED-POOL-ID-ALT
                    END-IF
                    PERFORM P0515-SET-BP-CA-VALUES
                 ELSE
                    PERFORM P0515-SET-BP-CA-VALUES
                 END-IF
              END-IF
           ELSE
              PERFORM P0515-SET-BP-CA-VALUES
           END-IF
           .
      *C1170.1 - END
      *
       P0510-CHECK-ALT-POOL-SCHED.
      *
      *C1150.3 - BEG
           MOVE SUB8                       TO SUB10
      *C1150.3 - END
           MOVE ZEROES                     TO WS-BP-ALTERNATE-DONE-CODE
      *C1150.1 - BEG
                                              SUB8
      *C1150.1 - END
           PERFORM UNTIL BP-ALTERNATE-DONE
              PERFORM P0336-FIND-BP-ALT
           END-PERFORM
           IF NOT PS32-NO-SCHEDULE-FOUND
              SET TURN-FOUND               TO TRUE
              MOVE FUNC-SUB                TO ZSUB
              MOVE '5'                     TO WS-ERR-CD
              PERFORM P0337-POPULATE-BIDPACK-DATA
              SET P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                                           TO TRUE
      *C1150.3 - BEG
              IF SUB8 = 0
                 MOVE SUB10 TO SUB8
              END-IF
      *C1150.3 - END
           END-IF
           .
      *
       P0515-SET-BP-CA-VALUES.
      *
           MOVE SPACES              TO P08CA-BIDPACK-DATA-AREA(FUNC-SUB)
           IF PS32-SCHED-POOL-ID-ALT > SPACES
              MOVE PS32-SCHED-POOL-ID-ALT
                                    TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
              IF PS32-NON-BIDPACK-POOL
                 SET P08CA-NON-BP-WITH-ALT(FUNC-SUB)
                                    TO TRUE
      *C892-BEG
                 MOVE PS32-SCHED-POOL-ID-ALT TO WORK-ALT-UFPPOS
      *C892-END
              ELSE
                 SET P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                                    TO TRUE
              END-IF
           ELSE
              MOVE SPACES           TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
              IF NOT PS32-NON-BIDPACK-POOL
                 SET P08CA-SCHED-BIDPACK(FUNC-SUB)
                                    TO TRUE
              END-IF
           END-IF
           .
      *
       P0520-GET-BIDPACK-FIFO.
      *
           SET P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                                     TO TRUE
           MOVE SPACES               TO WORK-UFPPOS
                                        WORK-CNTLKEY
           MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-DIST
                                        WK-CNTL-DIST
           MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-SUB-DIST
                                        WK-CNTL-SUB-DIST
           MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-POOL
                                        WK-CNTL-POOL
           MOVE SCR08-CC(FUNC-SUB)   TO WK-UFPPOS-CC
           MOVE ZEROS                TO WK-UFPPOS-IN-OUT
           MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-IN-OUT-TERM
           MOVE ZEROS                TO WK-UFPPOS-KEY
      ***  MOVE SPACES               TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)

           PERFORM P0342-SELECT-TURN
           .
      *10/10/17 - BEG
       P0521-CHK-NON-BIDPACK.
      *
           MOVE SPACES                         TO WORK-CNTLKEY
           MOVE '03'                           TO WK-CNTL-REC-TYPE
           MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)  TO WK-CNTL-DIST
           MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB) TO WK-CNTL-SUB-DIST
           MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)  TO WK-CNTL-POOL
           MOVE 'F'                            TO WK-CNTL-POOL-TYPE
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P0521-1'          TO ERR-PARAGRAPH
              MOVE CNTLKEY            TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P0522-GET-NON-BDPCK-FIFO.
      *
           SET P08CA-NON-BP-WITH-ALT(FUNC-SUB) TO TRUE

           MOVE SPACES               TO WORK-UFPPOS
                                        WORK-ALT-UFPPOS
                                        WORK-CNTLKEY
           MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-DIST
                                        WK-ALT-UFPPOS-DIST
                                        WK-CNTL-DIST
           MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-SUB-DIST
                                        WK-ALT-UFPPOS-SUB-DIST
                                        WK-CNTL-SUB-DIST
           MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-POOL
                                        WK-ALT-UFPPOS-POOL
                                        WK-CNTL-POOL
           MOVE SCR08-CC(FUNC-SUB)   TO WK-UFPPOS-CC
           MOVE ZEROS                TO WK-UFPPOS-IN-OUT
           MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                     TO WK-UFPPOS-IN-OUT-TERM
                                        WK-ALT-UFPPOS-TERM
           MOVE ZEROS                TO WK-UFPPOS-KEY

      *11/1/17 - BEG
      *    MOVE SPACES               TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
           IF (P08CA-SV-ALT-POOL-ID(FUNC-SUB) > SPACES
           AND P08CA-SV-ALT-POOL-ID(FUNC-SUB) NOT =
               P08CA-SCHD-POOL-ID-ALT(FUNC-SUB))
              MOVE P08CA-SV-ALT-POOL-ID(FUNC-SUB)
                                     TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
           ELSE
              MOVE SPACES            TO P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
           END-IF
      *11/1/17 - END

           PERFORM P0342-SELECT-TURN
           .
      *10/10/17 - END
      *
       P0525-GET-ALT-POOL-ID.
      *
      *    LINK TO CNPS32 TO DETERMINE IF AN ALTERNATE POOL IS DEFINED,
      *    AND IF WE NEED TO LOOK AT IT BY BIDPACK SCHEDULES, OR FIFO.
           MOVE SPACES                        TO PS32-COMMAREA-PARMS
           SET PS32-ALT-LOOKUP-ONLY           TO TRUE
           MOVE P08CA-PROFILE-KEY             TO PS32-PROFILE-KEY
           MOVE SCR08-CC(FUNC-SUB)            TO PS32-CRAFT-CODE
           MOVE PSTCA-TIME-ZONE               TO PS32-TIME-ZONE
      *08/01/23 RJA B CNC0600     (9) CNLD-270
      *    IF SCR08-OD-DATE(FUNC-SUB)          > SPACES
      *       MOVE SCR08-OD-DATE(FUNC-SUB)    TO WS-CALL-DATE
      *       MOVE SCR08-OD-TIME(FUNC-SUB)    TO WS-CALL-TIME
      *    ELSE
      *08/01/23 RJA E CNC0600 CNLD-270
              MOVE SCR08-ORDER-DATE           TO WS-CALL-DATE
              MOVE SCR08-ORDER-TIME           TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      *    END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
           MOVE WS-CALL-DATE-TIME             TO PS32-CALL-DATE-TIME
           PERFORM P8700-READ-P08CA-TASK
           MOVE TASK-TOPC-EN-STA              TO PS32-TOPC-EN-STA
           MOVE TASK-TOPC-TR-STA              TO PS32-TOPC-TR-STA
           MOVE P08CA-SCHD-POOL-ID-ALT(FUNC-SUB)
                                              TO PS32-SCHED-POOL-ID-ALT
           SET PS32-GET-ALT-SCHED             TO TRUE
           MOVE 'Y'                           TO PS32-SCHD-ALT

           EXEC CICS LINK
                     PROGRAM(PS32-PGM)
                     COMMAREA(PS32-COMMAREA-PARMS)
                     LENGTH(PS32-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC

           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P0525-1'                  TO ERR-PARAGRAPH
              MOVE 'P9S2LINK'                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE SPACES                        TO PS32-ALT-LOOKUP-FLAG
           .
      *
       P1000-SETUP-EMPLOYEE-DATA.
      *
      *
           MOVE SPACE     TO P08CA-SAVE-CBCK-FLAG(FUNC-SUB)
      * C909
           MOVE SCR08-FUNC(FUNC-SUB) TO WS-FUNCTION-CODE
      *
      * CNC0600 - B
RJA   *    IF YARD-CALL
      *CNLD-265-B
RJA   *    IF YARD-CALL AND NOT WS-CAN-WRR-NEW
           IF YARD-CALL AND (WS-US-DOM-Y OR NOT WS-CAN-WRR-NEW)
      *CNLD-265-E
      * CNC0600 - E
              SET P08CA-CALL-TIME(FUNC-SUB)       TO TRUE
           ELSE
              SET P08CA-CALL-MINUS-LEAD(FUNC-SUB)  TO TRUE
           END-IF
           IF (UFP-CALL
                 AND TRAIN-SYMBOL > SPACES
                 AND ON-DUTY-TIME IS NUMERIC
                 AND ON-DUTY-TIME > '000000000')
              OR (UFP-CALL
                 AND (OUT-OF-TOWN
                 OR (DIST OF WS-UFP NOT = DIST2
                 OR SUB-DIST OF WS-UFP NOT = SUB-DIST2
                 OR POOL-NAME OF WS-UFP NOT = POOL-NAME2)))
              OR ((YARD-CALL OR LOCAL-CALL)
                 AND AJ-JOB-ON-DUTY)
              OR ((YARD-CALL OR LOCAL-CALL)
                 AND (AJ-WAS-ANNULLED
      * GRH
                 AND AJ-JOB-ON-DUTY-DATE = WS-CALL-DATE))
      *          AND AJ-JOB-ON-DUTY-TIME = WS-CALL-DATE-TIME))
      * GRH
              IF (YARD-CALL OR LOCAL-CALL)
                 MOVE AUTOSKIP-MDT        TO SCR08-ORDER-DATE-ATTR
                                             SCR08-ORDER-TIME-ATTR
      *CNC0520-BEG
                 PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END
                 MOVE AJ-ON-DUTY-DATE     TO SCR08-OD-DATE(FUNC-SUB)
      *TJR 03/01/2001 SAVE TO THE COMMAREA
                                   P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                             WS-CALL-DATE
                 MOVE AJ-ON-DUTY-HRMN     TO SCR08-OD-TIME(FUNC-SUB)
                                   P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                             WS-CALL-TIME

                 MOVE AJ-CALL-FUNC-CODE   TO SCR08-FUNC(FUNC-SUB)
      *CNLD-71-BEG
                 IF NOT AJ-WAS-ANNULLED
      *CNLD-71-END
                    MOVE AJ-TRAIN-SYMBOL(1:8) TO SCR08-ASGN
                    MOVE AJ-TRAIN-SYMBOL(9:2) TO SCR08-ASGN-TYPE
                 END-IF
                 PERFORM P1020-SET-ASGN-CALL-ATTR
              ELSE
                 IF TRAIN-SYMBOL > SPACES
                    AND ON-DUTY-TIME NUMERIC
                    AND ON-DUTY-TIME > '0000000000'
                    MOVE AUTOSKIP-MDT     TO
                                          SCR08-ORDER-DATE-ATTR
                                          SCR08-ORDER-TIME-ATTR
                                          SCR08-ASGN-ATTR
                                          SCR08-ASGN-TYPE-ATTR
                                          SCR08-SIDE-TRIP-ATTR
      *CNC0520-BEG
                    PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END
                    MOVE ON-DUTY-TIME-DATE TO SCR08-OD-DATE(FUNC-SUB)
      *TJR 03/01/2001 SAVE TO THE COMMAREA
                                    P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                              WS-CALL-DATE
                    MOVE ON-DUTY-TIME-HRMN TO SCR08-OD-TIME(FUNC-SUB)
                                    P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                              WS-CALL-TIME

                    MOVE UFP-CALL-FUNC-CODE
                                          TO SCR08-FUNC(FUNC-SUB)
                    MOVE TRAIN-SYMBOL(1:8) TO SCR08-ASGN
                    MOVE TRAIN-SYMBOL(9:2) TO SCR08-ASGN-TYPE
                    PERFORM P1020-SET-ASGN-CALL-ATTR
                 ELSE
      *08/01/23 RJA B CNC0600 CNLD-270
      *             IF SCR08-OD-DATE(FUNC-SUB) > SPACES
      *                MOVE SCR08-OD-DATE(FUNC-SUB)
      *                                   TO WS-CALL-DATE
      *                MOVE SCR08-OD-TIME(FUNC-SUB)
      *                                   TO WS-CALL-TIME
      *             ELSE
      *08/01/23 RJA E CNC0600 CNLD-270

      *08/01/23 RJA B CNC0600     (10) CNLD-270
      **CNLD-244 #2 B - RPV1  THIS IS DH PROFILE
      *                 IF WS-PREP-OD-DATE > SPACES
      *                   AND WS-CAN-WRR-NEW
      *                    MOVE WS-PREP-OD-DATE  TO WS-CALL-DATE
      *                    MOVE WS-PREP-OD-TIME  TO WS-CALL-TIME
      *                 ELSE
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270
                          MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                          MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - RPV1
      *                 END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270
      * DHT ISSUE FIX
                       PERFORM P1080-CALC-EMP-OD-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      *             END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
                    MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 END-IF
              END-IF
              IF HAVE-ASGN-ON-DUTY-EMP
      *          READ AHM3 RECORD FOR THE TAXI TIME
                 PERFORM P1005-GET-TAXI-TIME
                 MOVE ASGN-ON-DUTY-EMP TO MSTRNBRK
                 PERFORM P1040-SETUP-NAME-LINE
                 PERFORM P1010-TEST-OWNER
                 IF UFP-CALL    AND
                    OUT-OF-TOWN
                    MOVE P08CA-EMP-NO(FUNC-SUB)
                                     TO P08CA-REG-EMP-NO(FUNC-SUB)
                 END-IF
              ELSE
                 IF ((YARD-CALL OR LOCAL-CALL)
                    AND (AJ-WAS-ANNULLED
      * GRH
                    AND AJ-JOB-ON-DUTY-DATE = WS-CALL-DATE))
      *             AND AJ-JOB-ON-DUTY-TIME = WS-CALL-DATE-TIME))
      * GRH
                    MOVE WS-ANNULLED-MSG(PSTCA-SUB)
                                     TO SCR08-NAME(FUNC-SUB)
                 ELSE
                    MOVE WS-VACANT-MSG(PSTCA-SUB)
                                     TO SCR08-NAME(FUNC-SUB)
                 END-IF
                 IF (UFP-CALL
                    AND (OUT-OF-TOWN
                    OR (DIST OF WS-UFP NOT = DIST2
                    OR SUB-DIST OF WS-UFP NOT = SUB-DIST2
                    OR POOL-NAME OF WS-UFP NOT = POOL-NAME2)))
                    SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                    SET P08CA-TRK-DONT-TRACK(FUNC-SUB) TO TRUE
                 END-IF
              END-IF
              IF HAVE-ASGN-TEMPORARY-EMP
                 IF ASGN-TEMPORARY-EMP NOT = ASGN-ON-DUTY-EMP
                    MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                    PERFORM P1050-SETUP-NAME-LINEB
                 ELSE
                    IF HAVE-ASGN-OWNER
                       MOVE ASGN-OWNER  TO MSTRNBRK
                       PERFORM P1050-SETUP-NAME-LINEB
                    ELSE
                       MOVE WS-OPEN-MSG(PSTCA-SUB)
                                    TO SCR08-NAMEB(FUNC-SUB)
                    END-IF
                 END-IF
      *                                                    PLS**
              ELSE
                 IF HAVE-ASGN-OWNER
                    IF ASGN-OWNER NOT = ASGN-ON-DUTY-EMP
                       MOVE ASGN-OWNER TO MSTRNBRK
                       PERFORM P1050-SETUP-NAME-LINEB
                    END-IF
                 ELSE
                    MOVE WS-OPEN-MSG(PSTCA-SUB)
                                    TO SCR08-NAMEB(FUNC-SUB)
                 END-IF
              END-IF
           ELSE
              IF (YARD-CALL OR LOCAL-CALL)
                 AND (JOB-SCHED-ASGN-OFF
                 OR   JOB-SCHED-ASGN-LIMIT)
                 IF JOB-SCHED-ASGN-OFF
                    IF WS-AJ-NOT-EFFECTIVE
                       MOVE WS-NOT-EFFECTIVE-MSG(PSTCA-SUB)
                         TO SCR08-NAME(FUNC-SUB)
                    ELSE
                       MOVE WS-OFF-MSG(PSTCA-SUB)
                         TO SCR08-NAME(FUNC-SUB)
                    END-IF
                 ELSE
                    MOVE '** CALL TIME LIMIT EXPD **'
                                       TO SCR08-NAME(FUNC-SUB)
                 END-IF
                 PERFORM P1020-SET-ASGN-CALL-ATTR
              ELSE
                 IF YARD-CALL
                    MOVE WS-CALL-DATE         TO SCR08-ORDER-DATE
                    MOVE JSK1-ASGN-START-TIME TO SCR08-ORDER-TIME
                                                 WS-CALL-TIME
      *08/01/23 RJA B CNC0600     (11) CNLD-270
      **CNLD-244 #2 B - SXG1
      ** UPDATE THE CALL-DATE AND CALL-TIME FOR VACANCY CRAFT
      *              IF WS-CALL-DATE > SPACES
      *                AND WS-CAN-WRR-NEW
      *                   MOVE ZEROES TO DATE-CONVERSION-PARMS
      *                   PERFORM P6040-GET-PREP-TIME
      *                   MOVE WS-CALC-OD-DATE    TO WS-CALL-DATE
      *                   MOVE WS-CALC-OD-TIME    TO WS-CALL-TIME
      *              END-IF
      **CNLD-244 #2 E - SXG1
      *08/01/23 RJA E CNC0600 CNLD-270
                    PERFORM P1080-CALC-EMP-OD-TIME
                 ELSE
      *08/01/23 RJA B CNC0600       (12) CNLD-270
      *              IF SCR08-OD-DATE(FUNC-SUB) > SPACES
      *                 MOVE SCR08-OD-DATE(FUNC-SUB)
      *                                        TO WS-CALL-DATE
      *                 MOVE SCR08-OD-TIME(FUNC-SUB)
      *                                        TO WS-CALL-TIME
      *              ELSE
      *08/01/23 RJA E CNC0600  CNLD-270
      *
      *08/01/23 RJA B CNC0600 CNLD-270
      *CNLD-244 #2 B - RPV1
      *                 IF WS-PREP-OD-DATE > SPACES
      *                   AND WS-CAN-WRR-NEW
      *                    MOVE WS-PREP-OD-DATE  TO WS-CALL-DATE
      *                    MOVE WS-PREP-OD-TIME  TO WS-CALL-TIME
      *                 ELSE
      *CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270
                          MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                          MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 E - RPV1
      *                 END-IF
      **CNLD-244 #2 E - RPV1
      *08/01/23 RJA E CNC0600 CNLD-270
                       PERFORM P1080-CALC-EMP-OD-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
      *             END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
                 END-IF
                 IF HAVE-ASGN-ON-DUTY-EMP
      *             READ AHM3 RECORD FOR THE TAXI TIME
                    PERFORM P1005-GET-TAXI-TIME
                    MOVE ASGN-ON-DUTY-EMP TO MSTRNBRK
                    PERFORM P1040-SETUP-NAME-LINE
                    MOVE EMP-HOME-ONLY-FLAG TO SCR08-HOME(FUNC-SUB)
      * JES 10/11/10
                    IF NOT FROM-PARA-P0215
                       PERFORM P1010-TEST-OWNER
                    END-IF
                    IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
                       IF HAVE-ASGN-TEMPORARY-EMP
                          OR HAVE-ASGN-OWNER
                          IF HAVE-ASGN-TEMPORARY-EMP
                             MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                          ELSE
                             MOVE ASGN-OWNER         TO MSTRNBRK
                          END-IF
                          PERFORM P1050-SETUP-NAME-LINEB
                       ELSE
                          MOVE WS-OPEN-MSG(PSTCA-SUB)
                                       TO SCR08-NAMEB(FUNC-SUB)
                       END-IF
                    ELSE
                       IF LOCAL-CALL
                          MOVE SPACES TO P08CA-EMP-NO(FUNC-SUB)
                          MOVE SCR08-NAME(FUNC-SUB)
                             TO SCR08-NAMEB(FUNC-SUB)
                          MOVE SCR08-ST(FUNC-SUB)
                                           TO SCR08-STB(FUNC-SUB)
                          MOVE SCR08-ECC(FUNC-SUB)
                                           TO SCR08-ECCB(FUNC-SUB)
                          PERFORM P1060-CLEAR-EMP-LINE
                          MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                           TO SCR08-NAME(FUNC-SUB)
                       END-IF
                    END-IF
                 ELSE
                    IF JOB-SCHED-ASGN-XTRA
                       SET P08CA-ASGN-IS-VCNY(FUNC-SUB)  TO TRUE
                       SET P08CA-TRK-DONT-TRACK(FUNC-SUB) TO TRUE
                       MOVE WS-XTRA-MSG(PSTCA-SUB)
                                               TO SCR08-NAME(FUNC-SUB)
                       IF HAVE-ASGN-TEMPORARY-EMP
                          OR HAVE-ASGN-OWNER
                          IF HAVE-ASGN-TEMPORARY-EMP
                             MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                          ELSE
                             MOVE ASGN-OWNER         TO MSTRNBRK
                          END-IF
                          SET IS-ON-REST-DAY         TO TRUE
                          PERFORM P1050-SETUP-NAME-LINEB
                       ELSE
                          MOVE AJ-OPEN-ASGN-MSG(PSTCA-SUB)
                                        TO SCR08-NAMEB(FUNC-SUB)
                       END-IF
                    ELSE
                       IF HAVE-ASGN-TEMPORARY-EMP
                          MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                          PERFORM P1040-SETUP-NAME-LINE
                          MOVE EMP-HOME-ONLY-FLAG
                                            TO SCR08-HOME(FUNC-SUB)
                          IF UFP-CALL
                             IF TEMPORARY-ASGNMT NOT = UFPTURN-AREA
      *C774                     IF TA-XB         NOT = 'EX'
                                   MOVE 'TV'   TO SCR08-ST(FUNC-SUB)
                                   MOVE '  '   TO SCR08-ECC(FUNC-SUB)
                                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                               TO TRUE
                                   SET P08CA-TRK-DONT-TRACK(FUNC-SUB)
                                               TO TRUE
      *                         END-IF
                             ELSE
                                IF ON-DUTY-ASGNMT > SPACE
                                   MOVE 'OT' TO SCR08-ST(FUNC-SUB)
                                   MOVE '  ' TO SCR08-ECC(FUNC-SUB)
                                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                            TO TRUE
                                   SET P08CA-TRK-ON-DUTY(FUNC-SUB)
                                               TO TRUE
                                END-IF
                             END-IF
                          ELSE
      *C774                  IF TEMPORARY-ASGNMT NOT = AJJOBKEY-AREA
                             IF TA-DIST        NOT = JSK2-ASGN-DIST
                                OR TA-SUB-DIST NOT = JSK2-ASGN-SUB-DIST
                                OR TA-1        NOT = JSK2-ASGN(1:6)
                                OR TA-CC       NOT = JSK2-ASGN-CC
      *                         IF TA-XB         NOT = 'EX'
                                   MOVE 'TV'   TO SCR08-ST(FUNC-SUB)
                                   MOVE '  '   TO SCR08-ECC(FUNC-SUB)
                                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                               TO TRUE
                                   SET P08CA-TRK-DONT-TRACK(FUNC-SUB)
                                               TO TRUE
      *                         END-IF
                             ELSE
                                IF ON-DUTY-ASGNMT > SPACE
                                   MOVE 'OT' TO SCR08-ST(FUNC-SUB)
                                   MOVE '  ' TO SCR08-ECC(FUNC-SUB)
                                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                            TO TRUE
                                   SET P08CA-TRK-ON-DUTY(FUNC-SUB)
                                               TO TRUE
                                END-IF
                             END-IF
                          END-IF
                          IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
                             PERFORM P1010-TEST-OWNER
                          END-IF
                          IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *FW0697 START
                             IF HAVE-ASGN-TEMPORARY-EMP
                                MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                                PERFORM P1050-SETUP-NAME-LINEB
                             ELSE
      *FW0697 END
                                IF HAVE-ASGN-OWNER
                                   MOVE ASGN-OWNER TO MSTRNBRK
                                   PERFORM P1050-SETUP-NAME-LINEB
                                ELSE
                                   MOVE WS-OPEN-MSG(PSTCA-SUB)
                                       TO SCR08-NAMEB(FUNC-SUB)
      *FW0697 START
                                END-IF
      *FW0697 END
                             END-IF
                          END-IF
                       ELSE
                          IF HAVE-ASGN-OWNER
                             MOVE ASGN-OWNER TO MSTRNBRK
                             PERFORM P1040-SETUP-NAME-LINE
                             MOVE EMP-HOME-ONLY-FLAG
                                             TO SCR08-HOME(FUNC-SUB)
                             IF TEMPORARY-ASGNMT > SPACE
                                MOVE 'TV'    TO SCR08-ST(FUNC-SUB)
                                MOVE '  '    TO SCR08-ECC(FUNC-SUB)
                                SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                                   TO TRUE
                                SET P08CA-TRK-DONT-TRACK(FUNC-SUB)
                                             TO TRUE
                             ELSE
                                IF ON-DUTY-ASGNMT > SPACE
                                   MOVE 'OT'   TO SCR08-ST(FUNC-SUB)
                                   MOVE '  '   TO SCR08-ECC(FUNC-SUB)
                                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                       TO TRUE
                                   SET P08CA-TRK-ON-DUTY(FUNC-SUB)
                                               TO TRUE
                                END-IF
                                IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                   PERFORM P1010-TEST-OWNER
                                END-IF
                             END-IF
                          ELSE
                             IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                MOVE WS-OPEN-MSG(PSTCA-SUB)
                                       TO SCR08-NAME(FUNC-SUB)
                                SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                       TO TRUE
                                SET P08CA-TRK-DONT-TRACK(FUNC-SUB)
                                             TO TRUE
                             END-IF
                          END-IF
                       END-IF
                       MOVE P08CA-EMP-NO(FUNC-SUB)
                                      TO P08CA-REG-EMP-NO(FUNC-SUB)
                       IF P08CA-ASGN-IS-VCNY(FUNC-SUB)
                          MOVE SPACES TO P08CA-EMP-NO(FUNC-SUB)
                          MOVE SCR08-NAME(FUNC-SUB)
                             TO SCR08-NAMEB(FUNC-SUB)
                          MOVE SCR08-ST(FUNC-SUB)
                                           TO SCR08-STB(FUNC-SUB)
                          PERFORM P1060-CLEAR-EMP-LINE
      * #1510
                          IF P08CA-SAVE-CBCK-FLAG(FUNC-SUB) = 'Y'
                             MOVE SPACES   TO SCR08-FUNC(FUNC-SUB)
                                          P08CA-SAVE-CBCK-FLAG(FUNC-SUB)
                             MOVE SCR08-ORDER-DATE
                                           TO SCR08-OD-DATE(FUNC-SUB)
                             MOVE SCR08-ORDER-TIME
                                           TO SCR08-OD-TIME(FUNC-SUB)
                             MOVE DEFAULT-ATTR
                                           TO SCR08-OD-DATE-HI(FUNC-SUB)
                                              SCR08-OD-TIME-HI(FUNC-SUB)
                                              SCR08-FUNC-HI   (FUNC-SUB)
                          END-IF
      *>>> DLO 94/05/20
                          IF UFP-BLANK-TURN
                              MOVE WS-DISCONT-MSG(PSTCA-SUB)
                                           TO SCR08-NAME(FUNC-SUB)
                          ELSE
                              MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                           TO SCR08-NAME(FUNC-SUB)
                          END-IF
      *>>> DLO 94/05/20
                       END-IF
                    END-IF
                 END-IF
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              END-IF
           END-IF

      **** FOLLOWING CODE MOVED FROM BEGINNING OF P1000 BY RRR 10/98
      **
           IF (YARD-CALL OR LOCAL-CALL)
              MOVE AJ-OPEN-ASGN-MSG(1)            TO WS-OPEN-MSG(1)
              MOVE AJ-OPEN-ASGN-MSG(2)            TO WS-OPEN-MSG(2)
              IF (AJ-WAS-ANNULLED AND
      * GRH
                  AJ-JOB-ON-DUTY-DATE = WS-CALL-DATE)
      *           AJ-JOB-ON-DUTY-TIME = WS-CALL-DATE-TIME)
      * GRH
                  CONTINUE
              ELSE
                 SET DE-YYMMDD-FORMAT     TO TRUE
                 MOVE WS-CALL-DATE        TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
                 SET DE-YYMMDD-FORMAT     TO TRUE
                 MOVE WS-ANNUL-FROM-DATE  TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE
                 SET DE-YYMMDD-FORMAT     TO TRUE
                 MOVE WS-ANNUL-TO-DATE    TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD         TO DE-COMPARE3-DATE
      *          IF WS-CALL-DATE     < WS-ANNUL-FROM-DATE OR
      *             WS-CALL-DATE     > WS-ANNUL-TO-DATE
                 IF DE-COMPARE1-DATE < DE-COMPARE2-DATE OR
                    DE-COMPARE1-DATE > DE-COMPARE3-DATE
                    CONTINUE
                 ELSE
                    MOVE WS-CALL-DATE         TO SCR08-ORDER-DATE
      *TJR 03/01/2001 SAVE TO THE COMMAREA
                                                 SCR08-OD-DATE(FUNC-SUB)
                                       P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                    MOVE WS-CALL-TIME         TO SCR08-ORDER-TIME
                                                 SCR08-OD-TIME(FUNC-SUB)
                                       P08CA-SCREEN-SAVED-TIME(FUNC-SUB)

                    IF P08CA-EMP-NO(FUNC-SUB) > SPACES
                       MOVE 'SCAN'            TO SCR08-FUNC   (FUNC-SUB)

                       IF PAY-AS-US
                          PERFORM P2150-CHECK-LAST-TIE-UP
                       END-IF

                       PERFORM P2110-PROCESS-ASSIGNED-CALL
                       MOVE AJJOBKEY-AREA     TO AJJOBKEY
                       PERFORM P8600-READ-AJJOBKEY
                    END-IF
                 END-IF
              END-IF
           END-IF

           MOVE SCR08-OD-DATE(FUNC-SUB) TO P08CA-SAVE-OD-DATE(FUNC-SUB)
           MOVE SCR08-OD-TIME(FUNC-SUB) TO P08CA-SAVE-OD-TIME(FUNC-SUB)
           .
      *
       P1005-GET-TAXI-TIME.
      *
           MOVE SPACES                   TO AHM-KEY
           MOVE AHM-FILE                 TO AHM-DATASET
           IF YARD-CALL OR LOCAL-CALL
              MOVE SCR08-DIST            TO AHM-DIST
              MOVE SCR08-SUB-DIST        TO AHM-SUB-DIST
              IF YARD-CALL
                 MOVE JOB-DEF-YARD-POOL  TO AHM-POOL
              ELSE
                 MOVE JOB-DEF-LOCAL-POOL TO AHM-POOL
              END-IF
           ELSE
              IF TRCN-EN-FROM-AREA > SPACES
                 MOVE TRCN-EN-FROM-DIST  TO AHM-DIST
                 MOVE TRCN-EN-FROM-SDIST TO AHM-SUB-DIST
                 MOVE TRCN-EN-FROM-POOL  TO AHM-POOL
              ELSE
                 MOVE TRCN-TR-FROM-DIST  TO AHM-DIST
                 MOVE TRCN-TR-FROM-SDIST TO AHM-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL  TO AHM-POOL
              END-IF
           END-IF
      *-------------------------------------------------------------*
      *           CONVERT  TO CNTL-TIME-ZONE                        *
      *-------------------------------------------------------------*
           IF AHM-DIST        NOT = SCR08-DIST
           OR AHM-SUB-DIST    NOT = SCR08-SUB-DIST
              MOVE SPACES                TO WORK-CNTLKEY
              MOVE '02'                  TO WK-CNTL-REC-TYPE
              MOVE AHM-DIST              TO WK-CNTL-DIST
              MOVE AHM-SUB-DIST          TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P1005'            TO ERR-PARAGRAPH
                 MOVE CNTLKEY            TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE SPACES                TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE        TO TZ-OUT-ZONE
              MOVE PSTCA-TIME-ZONE       TO TZ-IN-ZONE
              MOVE SCR08-ORDER-DATE      TO TZ-IN-DATE
              MOVE SCR08-ORDER-TIME      TO TZ-IN-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000024'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME      TO AHM-EFF-DATE-TIME
              MOVE WS-CALL-DATE-TIME     TO TZ-IN-DATE-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000025'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME      TO AHM-EMP-OD-DATE-TIME
           ELSE
              MOVE SCR08-ORDER-DATE      TO AHM-EFF-DATE
              MOVE SCR08-ORDER-TIME      TO AHMK1-EFF-TIME
              MOVE WS-CALL-DATE-TIME     TO AHM-EMP-OD-DATE-TIME
           END-IF
      *
           MOVE SCR08-ASGN               TO AHM-TRAIN
           MOVE SCR08-ASGN-TYPE          TO AHM-TRAIN-TYPE
           SET AHM-EMPLOYEE-RECORD-3     TO TRUE
           SET CT-IND                    TO 1
           SEARCH CRAFT-CODE-TABLE VARYING CT-IND
              AT END CONTINUE
                 MOVE '99'               TO AHM-CRAFT-SEQ
              WHEN CT-CRAFT-CODE(CT-IND) = SCR08-CC(FUNC-SUB)
                 MOVE CT-CRAFT-SEQ(CT-IND)
                                         TO AHM-CRAFT-SEQ
      *    MOVE WS-CALL-DATE-TIME        TO AHM-EMP-OD-DATE-TIME
           MOVE AHM-KEY                  TO AHMKEY
                                            WS-AHM-KEY
           EXEC CICS READ
                     DATASET(AHM-DATASET)
                     INTO(WS-AHIST-MISC)
                     LENGTH(AHM-RLGTH)
                     RIDFLD(AHMKEY)
                     KEYLENGTH(AHM-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE           TO FILE-STATUS
           IF SUCCESS
      *1496
           AND AHM3-TAXI-TIME > '0000'
              IF AHM-DIST     NOT = SCR08-DIST
              OR AHM-SUB-DIST NOT = SCR08-SUB-DIST
                 MOVE SPACES             TO TZ-PARAMETERS
                 MOVE CNTL-TIME-ZONE     TO TZ-IN-ZONE
                 MOVE PSTCA-TIME-ZONE    TO TZ-OUT-ZONE
                 MOVE AHM3-TAXI-DATE-TIME TO TZ-IN-DATE-TIME
                 PERFORM P8996-TIMEZONE
                 IF TZ-INVALID-PARAMETERS
                    MOVE '000025'        TO ERR-PARAGRAPH
                    PERFORM P8996-TZERROR
                 END-IF
                 MOVE TZ-OUT-TIME        TO SCR08-TAXI-TM(FUNC-SUB)
                                       P08CA-SAVE-TAXI-TM(FUNC-SUB)
              ELSE
                 MOVE AHM3-TAXI-TIME     TO SCR08-TAXI-TM(FUNC-SUB)
                                       P08CA-SAVE-TAXI-TM(FUNC-SUB)
              END-IF
           END-IF
           .
      *
      *
       P1010-TEST-OWNER.
      *
      *** 331E - SET "IGNORE LEAD TIME" IF FLAGS SET
           IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *#1503
           OR P08CA-USER-OVERRIDE(FUNC-SUB)
      *#1529S
           OR WS-FROM-P2200
              MOVE OD-AREA     TO JOB-DEF-CHECK
      * THE FOLLOWING IF STATEMENT WAS CHANGED TO FIX A BUG REPORTED BY
      * CN DURING THE QUICK TIE ENHANCEMENT. EMPLOYEES IN UNAVAILABLE
      * STATUS WERE NOT BEING PRESENTED FOR THE SECOND SPLIT ON GO
      * TRAINS. IF THE IF STATMENT NEEDS TO BE CHANGED, MAKE SURE
      * THAT THIS BUG DOES NOT RE-OCCUR. - NJB
              IF (ON-DUTY-ASGNMT = P08CA-ASGN-KEY(FUNC-SUB)) AND
                 (WORKING OR
                 (JOB-DEF-COMMUTER-ASGN AND LOCAL-CALL))
                 CONTINUE
              ELSE
                 EVALUATE TRUE
                    WHEN MISSED-CALL
                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                         SET P08CA-TRK-MCALL   (FUNC-SUB) TO TRUE
                    WHEN NOT AVAILABLE
                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                         SET P08CA-TRK-UNAVAIL (FUNC-SUB) TO TRUE
                    WHEN NOT-NOTIFIED
                         IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
                            SET P08CA-ASGN-IS-BOTH(FUNC-SUB)     TO TRUE
                            SET P08CA-TRK-NOT-NOTIFIED(FUNC-SUB) TO TRUE
                         END-IF
                 END-EVALUATE
              END-IF
      *
      *       WESTERN CANADIAN EMPLOYEES (DIVISION CODE '0') ARE TREATED
      *       DIFFERENTLY FOR PERSONAL REST COMPARISONS.
      *
              PERFORM P6100-DETERMINE-DIVN-FLAG

              MOVE SCR08-CC(FUNC-SUB)  TO WS-CRAFT-CODE-CHECK
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE        TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
              MOVE WS-CALL-TIME        TO DE-COMPARE1-TIME
      *** 331E - IF YARDMASTER AND YARDMASTER JOB, MTOD IS IRRELEVANT
              MOVE CRAFT OF WS-MSTR    TO WS-CRAFT-CODE-CHECK
      *CNLD-246 B
      *       IF YARDMASTER-CRAFT AND
              IF (YARDMASTER-CRAFT OR YARDMASTER-TRAINEE) AND
      *CNLD-246 E
                 P08CA-HOS-EXEMPT(FUNC-SUB)
                 MOVE ZERO             TO EMP-MTOD
              END-IF

              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE EMP-MTOD-DATE       TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE
              MOVE EMP-MTOD-TIME       TO DE-COMPARE2-TIME

              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE EMP-US-RSTD-DATE    TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE3-DATE
              MOVE EMP-US-RSTD-TIME    TO DE-COMPARE3-TIME

              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE EMP-PERS-REST-DATE  TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE4-DATE
              MOVE EMP-PERS-REST-TIME  TO DE-COMPARE4-TIME

      *       SET DE-YYMMDD-FORMAT     TO TRUE
      *       MOVE WS-CALL-MINUS-LEAD-DATE TO DE-YYMMDD
      *       PERFORM P8998-DATEEDIT
      *       MOVE DE-YYMMDD-CE        TO WS-CALL-MINUS-LEAD-CENT

      * #1529S
              MOVE ZEROS              TO DATE-CONVERSION-PARMS
              SET PARM-SUBTRACT       TO TRUE
              MOVE WS-CALL-DATE       TO PARM-PRI-DATE-GREG
              MOVE WS-CALL-TIME       TO PARM-PRI-HRMN
              MOVE WS-CALL-DATE-TIME-CENT
                                      TO WS-CHECK-REST-DATE-TIME-CENT
              MOVE SCR08-CC(FUNC-SUB) TO WS-CRAFT-CODE-CHECK
              IF ENGINE-CRAFT
                 MOVE P08CA-EN-LEAD-TIME TO PARM-SEC-HRMN
              ELSE
                 MOVE P08CA-TR-LEAD-TIME TO PARM-SEC-HRMN
              END-IF
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P1010-1' TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-DATE-GREG TO WS-CALL-MINUS-LEAD-DATE
              MOVE PARM-RES-GREG-CENT TO WS-CALL-MINUS-LEAD-CENT
              MOVE PARM-RES-HRMN      TO WS-CALL-MINUS-LEAD-TIME

              PERFORM P1012-DETERMINE-PREP-TIME
              PERFORM P1014-DETERMINE-EARLIEST-CALL
      *C947   IF NOT WS-WESTERN-DIVN
                 PERFORM P1015-DETERMINE-EARLI-US-CALL
      *       END-IF

              IF WS-WESTERN-DIVN
      *CNLD-265-B
                 OR WS-CAN-WRR-NEW
      *CNLD-265-E
                 SET DE-YYMMDD-FORMAT  TO TRUE
                 MOVE SCR08-ORDER-DATE TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD      TO DE-COMPARE5-DATE
                 MOVE SCR08-ORDER-TIME TO DE-COMPARE5-TIME

                 IF P08CA-CALL-MINUS-LEAD(FUNC-SUB)
                    MOVE ZEROS                 TO DATE-CONVERSION-PARMS
                    SET PARM-SUBTRACT          TO TRUE
                    MOVE SCR08-ORDER-DATE      TO PARM-PRI-DATE-GREG
                    MOVE SCR08-ORDER-TIME      TO PARM-PRI-HRMN
                    MOVE SCR08-CC(FUNC-SUB)    TO WS-CRAFT-CODE-CHECK
                    IF PS52-REQ-LEAD-TIME > SPACES
                       AND PS52-REQ-LEAD-TIME NUMERIC
                       AND PS52-REQ-LEAD-TIME > '0000'
                       MOVE PS52-REQ-LEAD-TIME    TO PARM-SEC-HRMN
                    ELSE
                       IF ENGINE-CRAFT
                          MOVE P08CA-EN-LEAD-TIME TO PARM-SEC-HRMN
                       ELSE
                          MOVE P08CA-TR-LEAD-TIME TO PARM-SEC-HRMN
                       END-IF
                    END-IF
      *CNLD-265-B
                    IF WS-CAN-WRR-NEW
                       MOVE WS-SAVE-LEAD-TIME     TO PARM-SEC-HRMN
                    END-IF
      *CNLD-265-E
                    PERFORM P9700-LINK-P903
                    IF NOT SUCCESS
                       MOVE 'P1010-2' TO ERR-PARAGRAPH
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE PARM-RES-DATE-GREG    TO DE-COMPARE6-YYMMDD
                    MOVE PARM-RES-GREG-CENT    TO DE-COMPARE6-CE
                    MOVE PARM-RES-HRMN         TO DE-COMPARE6-TIME
                 END-IF
              END-IF
      *
      *       REQUIRED REST IS A HIGHER PRIORITY TRACKING REASON THAN
      *       UNAVAILABLE, SO IF A PERSON IS BOTH UNAVAILABLE AND NOT
      *       REQUIRED RESTED, CHANGE THE TRACKING REASON TO REQUIRED
      *       REST.
      *
      *MET 08/15/2006 C662
              MOVE ZERO                      TO SCHED-DONE-CODE
                                                SCHED-2ND-CODE
                                                SCHED-LST-CODE
                                                SCHED-FOUND-CODE
      *
      *       DON'T CHECK THE SPLIT SHIFT HOS FLAG IF THE ASSIGNMENT
      *       HAS ALREADY BEEN SET.  WE HAVEN'T READ THE JOB SCHEDULE
      *       WHICH IS WHAT DRIVES PARAGRAPH P3039 AND P3037.  PLUS,
      *       THE RESULTS ARE IRRELEVANT AT THIS POINT ANYWAY - WE'VE
      *       GOT A BODY/VACATED TURN ALREADY.
      *
              IF TRCN-2ND-ROUTE-DESIGNATION > SPACES
              AND TRCN-LOCAL-REC
              AND NOT P08CA-ASGN-SET(FUNC-SUB)
                 PERFORM P3039-GET-CNTL-DIST-SUB-DIST
                 IF NOT CNTL-SPLIT-SHIFT-HOS
                    PERFORM P3037-CHECK-SCHED
                 END-IF
              END-IF
              IF ENGINE-CRAFT
                 IF TRCN-EN-REST-REQ = ('C' OR 'B')
                    OR (TRCN-EN-REST-REQ = 'N'
                    AND EMP-LAST-TOUR-OUT-OF-BOX)
                    IF P08CA-CALL-TIME(FUNC-SUB)
      *                IF EMP-MTOD > WS-CALL-DATE-TIME
      *                IF DE-COMPARE2-DATE-TIME > DE-COMPARE1-DATE-TIME
                       IF WS-EARLIEST-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          IF UFP-CALL
                             CONTINUE
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
      *                      END-IF
                          ELSE
      *
      *                      EMPLOYEE IS ENTITLED TO WORK SECOND SPLIT
      *                      OF A GO-TRAIN IF THEY WORKED 1ST SPLIT,
      *                      REGARDLESS OF HOS/CALL RULES. (AS DICTATED
      *                      BY SUB-DIST CONTROL SETTINGS).
      *
                             IF  SCHED-2ND
                             AND ON-SCHED-1ST
                                 CONTINUE
      *                      ELSE
      *                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                             END-IF
                          END-IF
                          MOVE 'NR'          TO SCR08-ST(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *#1503
                          SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
                       END-IF
                    ELSE
      *CNC0331B-START
      *                IF EMP-MTOD > WS-CALL-MINUS-LEAD
      *                IF DE-COMPARE2-DATE-TIME
      *                            > WS-CALL-MINUS-LEAD
                       IF WS-EARLIEST-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
      *CNC0331B-END
                          IF UFP-CALL
                             CONTINUE
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
      *                      END-IF
                          ELSE
      *
      *                      EMPLOYEE IS ENTITLED TO WORK SECOND SPLIT
      *                      OF A GO-TRAIN IF THEY WORKED 1ST SPLIT,
      *                      REGARDLESS OF HOS/CALL RULES. (AS DICTATED
      *                      BY SUB-DIST CONTROL SETTINGS).
      *
                             IF  SCHED-2ND
                             AND ON-SCHED-1ST
                                 CONTINUE
      *                      ELSE
      *                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                             END-IF
                          END-IF
                          MOVE 'NR'          TO SCR08-ST(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *#1503
                          SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
                       END-IF
                    END-IF
                    IF NOT WORKING IN WS-MSTR
                       MOVE ZERO           TO SCHED-DONE-CODE
                                              SCHED-2ND-CODE
                                              SCHED-LST-CODE
                                              SCHED-FOUND-CODE
      *
      *                HOS-PROCESSED WILL BE SET DURING CALLBACK
      *                PROCESSING.  WE DON'T WANT TO RECALCULATE
      *                THE EMP'S HOS IN THIS CASE, BECAUSE THE
      *                ON-DUTY TIME HAS BEEN OVERLAID WITH THE
      *                EMP'S CALLBACK TIME, AND WE COULD GET
      *                STRANGE RESULTS.
      *
                       IF HOS-NOT-PROCESSED
                          PERFORM P2950-GET-HRS-SVC-INFO
                       END-IF
      *MET 08/15/2006 C662
                       IF TRCN-2ND-ROUTE-DESIGNATION > SPACES
                          AND TRCN-LOCAL-REC
                          PERFORM P3039-GET-CNTL-DIST-SUB-DIST
      *
      *                   P2950 HAS ALREADY PERFORMED P3037-CHECK-SCHED
      *                   SO WE DON'T NEED TO PERFORM IT AGAIN FOR THE
      *                   FOLLOWING LOGIC.
      *
                          IF NOT CNTL-SPLIT-SHIFT-HOS
                             AND SCHED-2ND
                             AND ON-SCHED-1ST
                             SET P925-EMP-STATUS-GREEN TO TRUE
                          END-IF
                       END-IF
      *** 331E - ADD CHECK FOR HOS EXEMPT FLAG
                       IF P925-EMP-STATUS-RED
                          AND NOT P08CA-EN-DHD-HOME
                          AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
                          IF UFP-CALL
      * 04/18/11
                             CONTINUE
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
      *                      END-IF
                          ELSE
RJA   * CNC0600 B
RJA                          IF NOT WS-CAN-WRR-NEW
RJA   * CNC0600 E
                                SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
RJA   * CNC0600 B
RJA                          END-IF
RJA   * CNC0600 E
                          END-IF
                       ELSE
                          IF (P925-EMP-STATUS-YELLOW
                          OR  P925-EMP-STATUS-RED)
                         AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                         AND (   SCR08-FUNC(FUNC-SUB) NOT = 'CBCK'
                             AND SCR08-FUNC(FUNC-SUB) NOT = 'QTIE')
      *CNC0600-CNLD-209
                         AND NOT WS-CAN-WRR-NEW
      * 04/18/11
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
      *                      END-IF
      *
      *C1211 - THIS IS THE HOUR THAT IS MESSING UP CNP937 - NO CHNG HERE
                             MOVE 'HOUR'  TO SCR08-FUNC(FUNC-SUB)
                          END-IF
                       END-IF
                    END-IF
                 END-IF
                 IF TRCN-EN-REST-REQ = ('U' OR 'B')
      *C947         IF WS-US-DOM-YES AND
      *                WS-HS-US-ACTIVATE
                    IF WS-HS-US-ACTIVATE
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          MOVE 'NR'          TO SCR08-ST(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *#1503
                          SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
                          MOVE RED           TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
                    ELSE
      *                IF EMP-US-RSTD           > WS-CALL-DATE-TIME
      *C947-BEG        IF DE-COMPARE3-DATE-TIME > DE-COMPARE1-DATE-TIME
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
      *                   IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                      SET P08CA-ASGN-IS-BOTH(FUNC-SUB)
      *                                       TO TRUE
      *                   END-IF
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *                   SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
      *                   MOVE RED           TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
      *C947-END
                    END-IF
      *CNLD-330-B
      **CNLD-245-B
      *              PERFORM P3300-CHECK-US-UNDIST-REST
      **CNLD-245-E
                    IF TRCN-EN-REST-REQ = 'U'
                       MOVE ZEROS  TO WS-SAVE-UD-DTTM
      *                MOVE SPACES TO WS-REST-US-STATUS-FLAG
                       PERFORM P3300-CHECK-US-UNDIST-REST
                    END-IF
      *CNLD-330-E
                 END-IF
              ELSE
                 IF TRCN-TR-REST-REQ = ('C' OR 'B')
                    OR (TRCN-TR-REST-REQ = 'N'
                    AND EMP-LAST-TOUR-OUT-OF-BOX)
                    IF P08CA-CALL-TIME(FUNC-SUB)
      *                IF EMP-MTOD              > WS-CALL-DATE-TIME
      *                IF DE-COMPARE2-DATE-TIME > DE-COMPARE1-DATE-TIME
                       IF WS-EARLIEST-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          IF UFP-CALL
                             CONTINUE
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
      *                      END-IF
                          ELSE
      *
      *                      EMPLOYEE IS ENTITLED TO WORK SECOND SPLIT
      *                      OF A GO-TRAIN IF THEY WORKED 1ST SPLIT,
      *                      REGARDLESS OF HOS/CALL RULES. (AS DICTATED
      *                      BY SUB-DIST CONTROL SETTINGS).
      *
                             IF  SCHED-2ND
                             AND ON-SCHED-1ST
                                 CONTINUE
      *                      ELSE
      *                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                             END-IF
                          END-IF
                          MOVE 'NR'          TO SCR08-ST(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *#1503
                          SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
                       END-IF
                    ELSE
      *CNC0331B-START
      *                IF EMP-MTOD > WS-CALL-MINUS-LEAD
      *                IF DE-COMPARE2-DATE-TIME
      *                            > WS-CALL-MINUS-LEAD
                       IF WS-EARLIEST-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
      *CNC0331B-END
                          IF UFP-CALL
                             CONTINUE
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
      *                      END-IF
                          ELSE
      *
      *                      EMPLOYEE IS ENTITLED TO WORK SECOND SPLIT
      *                      OF A GO-TRAIN IF THEY WORKED 1ST SPLIT,
      *                      REGARDLESS OF HOS/CALL RULES. (AS DICTATED
      *                      BY SUB-DIST CONTROL SETTINGS).
      *
                             IF  SCHED-2ND
                             AND ON-SCHED-1ST
                                 CONTINUE
      *                      ELSE
      *                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                             END-IF
                          END-IF
                          MOVE 'NR'          TO SCR08-ST(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *#1503
                          SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
                       END-IF
                    END-IF
                    IF NOT WORKING IN WS-MSTR
                       MOVE ZERO           TO SCHED-DONE-CODE
                                              SCHED-2ND-CODE
                                              SCHED-LST-CODE
                                              SCHED-FOUND-CODE
      *
      *                HOS-PROCESSED WILL BE SET DURING CALLBACK
      *                PROCESSING.  WE DON'T WANT TO RECALCULATE
      *                THE EMP'S HOS IN THIS CASE, BECAUSE THE
      *                ON-DUTY TIME HAS BEEN OVERLAID WITH THE
      *                EMP'S CALLBACK TIME, AND WE COULD GET
      *                STRANGE RESULTS.
      *
                       IF HOS-NOT-PROCESSED
                          PERFORM P2950-GET-HRS-SVC-INFO
                       END-IF
      *MET 08/15/2006 C662
                       IF TRCN-2ND-ROUTE-DESIGNATION > SPACES
                          AND TRCN-LOCAL-REC
                          PERFORM P3039-GET-CNTL-DIST-SUB-DIST
      *
      *                   P2950 HAS ALREADY PERFORMED P3037-CHECK-SCHED
      *                   SO WE DON'T NEED TO PERFORM IT AGAIN FOR THE
      *                   FOLLOWING LOGIC.
      *
                          IF NOT CNTL-SPLIT-SHIFT-HOS
                             AND SCHED-2ND
                             AND ON-SCHED-1ST
                             SET P925-EMP-STATUS-GREEN TO TRUE
                          END-IF
                       END-IF
      *** 331E - ADD CHECK FOR HOS EXEMPT FLAG
                       IF P925-EMP-STATUS-RED
                          AND NOT P08CA-TR-DHD-HOME
                          AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
                          IF UFP-CALL
      * 04/18/11
                             CONTINUE
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
      *                      END-IF
                          ELSE
RJA   * CNC0600 B
RJA                          IF NOT WS-CAN-WRR-NEW
RJA   * CNC0600 E
                                SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
RJA   * CNC0600 B
RJA                          END-IF
RJA   * CNC0600 E
                          END-IF
                       ELSE
                          IF (P925-EMP-STATUS-YELLOW
                          OR  P925-EMP-STATUS-RED)
                         AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                         AND (SCR08-FUNC(FUNC-SUB) NOT = 'CBCK'
                             AND  SCR08-FUNC(FUNC-SUB) NOT = 'QTIE')
      *CNC0600-CNLD-209
                         AND NOT WS-CAN-WRR-NEW
      * 04/18/11
      *                      IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                         SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
      *                      END-IF
                             MOVE 'HOUR' TO SCR08-FUNC(FUNC-SUB)
                          END-IF
                       END-IF
                    END-IF
                 END-IF
                 IF TRCN-TR-REST-REQ = ('U' OR 'B')
      *C947         IF WS-US-DOM-YES AND
      *                WS-HS-US-ACTIVATE
                    IF WS-HS-US-ACTIVATE
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          MOVE 'NR'          TO SCR08-ST(FUNC-SUB)
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *#1503
                          SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
                          MOVE RED           TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
                    ELSE
      *                IF EMP-US-RSTD           > WS-CALL-DATE-TIME
      *C947-BEG        IF DE-COMPARE3-DATE-TIME > DE-COMPARE1-DATE-TIME
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
      *                   IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      *                      SET P08CA-ASGN-IS-BOTH(FUNC-SUB)
      *                        TO TRUE
      *                   END-IF
                          SET P08CA-TRK-REQUIRED-REST(FUNC-SUB) TO TRUE
      *                   SET P08CA-NOT-RESTED       (FUNC-SUB) TO TRUE
      *                   MOVE RED           TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
      *C947-END
                    END-IF
      *CNLD-330-B
      **CNLD-245-B
      *              PERFORM P3300-CHECK-US-UNDIST-REST
      **CNLD-245-E
                    IF TRCN-TR-REST-REQ = 'U'
                       MOVE ZEROS  TO WS-SAVE-UD-DTTM
      *                MOVE SPACES TO WS-REST-US-STATUS-FLAG
                       PERFORM P3300-CHECK-US-UNDIST-REST
                    END-IF
      *CNLD-330-E
                 END-IF
              END-IF
      * #1529S
      *       IF P08CA-CALL-TIME(FUNC-SUB)
      *          IF EMP-PERS-REST         > WS-CALL-DATE-TIME
                 IF (DE-COMPARE4-DATE-TIME > DE-COMPARE1-DATE-TIME
                     AND NOT WS-WESTERN-DIVN)
                     OR
                    (DE-COMPARE4-DATE-TIME > DE-COMPARE5-DATE-TIME
                     AND WS-WESTERN-DIVN)
      *07/26/23 RJA B CNC0600 CNLD-269
      **CNLD-265-B
      *               OR
      *              (DE-COMPARE4-DATE-TIME > DE-COMPARE6-DATE-TIME
      *               AND WS-CAN-WRR-NEW)
      **CNLD-265-E
      *07/26/23 RJA E
                    IF UFP-CALL
                       IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***              OR (P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***              AND P08CA-TRK-UNAVAIL (FUNC-SUB))
      *                   SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
                          SET P08CA-TRK-PERS-REST(FUNC-SUB) TO TRUE
                       END-IF
                    ELSE
                       IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***              OR (P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***              AND P08CA-TRK-UNAVAIL (FUNC-SUB))
      *                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                          SET P08CA-TRK-PERS-REST(FUNC-SUB) TO TRUE
                       END-IF
                    END-IF
                    MOVE 'NR'             TO SCR08-ST(FUNC-SUB)
      *#1503
                    SET P08CA-NOT-RESTED(FUNC-SUB) TO TRUE
                 END-IF
      *       ELSE
      *          IF EMP-PERS-REST > WS-CALL-MINUS-LEAD
      *MET C718
                 IF P08CA-CALL-MINUS-LEAD(FUNC-SUB)
      *CNLD-265-B PERS REST SHOULD BE COMPARED WITH ORDER-LEAD
      *             IF DE-COMPARE4-DATE-TIME > WS-CALL-MINUS-LEAD
                    IF DE-COMPARE4-DATE-TIME > DE-COMPARE6-DATE-TIME
      *CNLD-265-E
                       IF UFP-CALL
                          IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***                 OR (P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***                 AND P08CA-TRK-UNAVAIL (FUNC-SUB))
      *                      SET P08CA-ASGN-IS-BOTH(FUNC-SUB) TO TRUE
                             SET P08CA-TRK-PERS-REST(FUNC-SUB) TO TRUE
                          END-IF
                       ELSE
                          IF NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***                 OR (P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***                 AND P08CA-TRK-UNAVAIL (FUNC-SUB))
      *                      SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                             SET P08CA-TRK-PERS-REST(FUNC-SUB) TO TRUE
                          END-IF
                       END-IF
                       MOVE 'NR'          TO SCR08-ST(FUNC-SUB)
      *#1503
                       SET P08CA-NOT-RESTED(FUNC-SUB) TO TRUE
                    END-IF
                 END-IF
      *       END-IF
           END-IF.
      *
       P1011-CHCK-FILLED-US-EMP.
      *    IF THE ONDUTY TIMES ARE CHANGED FOR EMP PRESENTED BY DECISION
      *    FILL PROCESS, PERFORM REST VALIDATIONS
           IF NOT P08CA-ASGN-NO-VCNY(FUNC-SUB)
              PERFORM P6100-DETERMINE-DIVN-FLAG
      *       GET ONDUTY TIME
              MOVE SPACES                   TO WS-EMP-OD-CENT-DATE-TIME
              IF SCR08-OD-DATE(FUNC-SUB) > SPACES OR
                 SCR08-OD-TIME(FUNC-SUB) > SPACES
                 MOVE DEFAULT-ATTR TO SCR08-OD-DATE-HI(FUNC-SUB)
                                      SCR08-OD-TIME-HI(FUNC-SUB)
                 MOVE SCR08-OD-DATE(FUNC-SUB)
                                            TO DE-YYMMDD
                 SET DE-YYMMDD-FORMAT       TO TRUE
                 PERFORM P8998-DATEEDIT
                 IF DE-INVALID-DATE
                    MOVE -1 TO SCR08-OD-DATE-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO TO SCR08-OD-DATE-HI(FUNC-SUB)
      *                  INVALID-DATE-MSG
                    MOVE 'I034' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 MOVE SCR08-OD-DATE(FUNC-SUB) TO DE-YYMMDD
                 SET DE-REFORMAT-ONLY       TO TRUE
                 SET DE-YYMMDD-FORMAT       TO TRUE
                 PERFORM P8998-DATEEDIT
                 MOVE DE-YYMMDD-CE          TO WS-EMP-OD-CENT
                 MOVE DE-YYMMDD             TO WS-EMP-OD-DATE
      *
                 MOVE SCR08-OD-TIME(FUNC-SUB) TO TE-MILITARY-TIME
                 SET TE-MILITARY-FORMAT       TO TRUE
                 PERFORM P8997-TIMEEDIT
                 IF TE-INVALID-TIME
                    MOVE -1 TO SCR08-OD-TIME-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO TO SCR08-OD-TIME-HI(FUNC-SUB)
      *                  INVALID-TIME-MSG
                    MOVE 'I022' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 MOVE SCR08-OD-TIME(FUNC-SUB) TO WS-EMP-OD-TIME
              ELSE
                 MOVE WS-CALL-DATE-TIME-CENT
                                            TO WS-EMP-OD-CENT-DATE-TIME
              END-IF
      *
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE EMP-US-RSTD-DATE    TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE3-DATE
              MOVE EMP-US-RSTD-TIME    TO DE-COMPARE3-TIME
      *
      *C947   IF NOT WS-WESTERN-DIVN
                 PERFORM P1015-DETERMINE-EARLI-US-CALL
      *       END-IF
              MOVE SCR08-CC(FUNC-SUB)       TO WS-CRAFT-CODE-CHECK
              IF ENGINE-CRAFT
                 IF TRCN-EN-REST-REQ = ('U' OR 'B')
      *C947         AND WS-US-DOM-YES
                    AND WS-HS-US-ACTIVATE
                    IF WS-EARLI-US-CENT-DATE-TIME >
                       WS-EMP-OD-CENT-DATE-TIME
                       MOVE 'NR'               TO SCR08-ST(FUNC-SUB)
                       MOVE EMP-US-RSTD-TIME   TO SCR08-USHR(FUNC-SUB)
                       IF EMP-PREV-DUTY IS NUMERIC
                          MOVE EMP-PREV-DUTY   TO SCR08-USPD(FUNC-SUB)
                       END-IF
                       MOVE EMP-HOME-ONLY-FLAG TO SCR08-HOME(FUNC-SUB)
                       MOVE RED TO SCR08-NAME-COL(FUNC-SUB)
                                   SCR08-HOME-COL(FUNC-SUB)
                                   SCR08-USHR-COL(FUNC-SUB)
                                   SCR08-USPD-COL(FUNC-SUB)
                    ELSE
                       MOVE SPACES             TO SCR08-ST(FUNC-SUB)
                                                  SCR08-USHR(FUNC-SUB)
                                                  SCR08-USPD(FUNC-SUB)
                                                  SCR08-HOME(FUNC-SUB)
                    END-IF
      *CNC0496
                    IF DE-COMPARE3-DATE-TIME >
                       WS-EMP-OD-CENT-DATE-TIME
                       SET P08CA-EMP-RESTED-NO(FUNC-SUB) TO TRUE
                    ELSE
                       SET P08CA-EMP-RESTED-YES(FUNC-SUB) TO TRUE
                    END-IF
                 END-IF
              ELSE
                 IF TRCN-TR-REST-REQ = ('U' OR 'B')
      *C947         AND WS-US-DOM-YES
                    AND WS-HS-US-ACTIVATE
                    IF WS-EARLI-US-CENT-DATE-TIME >
                       WS-EMP-OD-CENT-DATE-TIME
                       MOVE 'NR'               TO SCR08-ST(FUNC-SUB)
                       MOVE EMP-US-RSTD-TIME   TO SCR08-USHR(FUNC-SUB)
                       IF EMP-PREV-DUTY IS NUMERIC
                          MOVE EMP-PREV-DUTY   TO SCR08-USPD(FUNC-SUB)
                       END-IF
                       MOVE EMP-HOME-ONLY-FLAG TO SCR08-HOME(FUNC-SUB)
                       MOVE RED TO SCR08-NAME-COL(FUNC-SUB)
                                   SCR08-HOME-COL(FUNC-SUB)
                                   SCR08-USHR-COL(FUNC-SUB)
                                   SCR08-USPD-COL(FUNC-SUB)
                    ELSE
                       MOVE SPACES             TO SCR08-ST(FUNC-SUB)
                                                  SCR08-USHR(FUNC-SUB)
                                                  SCR08-USPD(FUNC-SUB)
                                                  SCR08-HOME(FUNC-SUB)
                    END-IF
      *CNC0496
                    IF DE-COMPARE3-DATE-TIME >
                       WS-EMP-OD-CENT-DATE-TIME
                       SET P08CA-EMP-RESTED-NO(FUNC-SUB) TO TRUE
                    ELSE
                       SET P08CA-EMP-RESTED-YES(FUNC-SUB) TO TRUE
                    END-IF
                 END-IF
              END-IF
           END-IF.
      *=================================================================
       P1012-DETERMINE-PREP-TIME.
      *=================================================================
      *   NOTE:  VALID PREP TIME WILL BE 15 MINUTES OR LESS.
      *
      *   DETERMINE DIFFERENCE BETWEEN EMPLOYEE'S ON DUTY DT/TM AND THE
      *   TRAIN ORDER DT/TM.
      *-----------------------------------------------------------------
           MOVE SPACES                   TO WS-EMP-OD-CENT-DATE-TIME

           IF P08CA-USER-ENTERED-DATE-TIME(FUNC-SUB) > SPACES
              SET DE-REFORMAT-ONLY       TO TRUE
              MOVE P08CA-USER-ENTERED-DATE(FUNC-SUB)
                                         TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-YYMMDD-CE          TO WS-EMP-OD-CENT
              MOVE DE-YYMMDD             TO WS-EMP-OD-DATE
              MOVE P08CA-USER-ENTERED-TIME(FUNC-SUB)
                                         TO WS-EMP-OD-TIME
           ELSE
              MOVE WS-CALL-DATE-TIME-CENT
                                         TO WS-EMP-OD-CENT-DATE-TIME
           END-IF

           MOVE ZEROS                    TO DATE-CONVERSION-PARMS
           SET PARM-DIFF                 TO TRUE
           MOVE WS-CALL-DATE             TO PARM-PRI-DATE-GREG
           MOVE SCR08-ORDER-TIME         TO PARM-PRI-HRMN
           MOVE WS-EMP-OD-DATE           TO PARM-SEC-DATE-GREG
           MOVE WS-EMP-OD-TIME           TO PARM-SEC-HRMN
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P1012-1'             TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MULTIPLY PARM-RES-TOT-DAYS BY 24 GIVING WORK-HR
           ADD PARM-RES-HR               TO WORK-HR
           MOVE PARM-RES-MN              TO WORK-MN
           IF  WORK-HR < 1
           AND WORK-MN < 15
              MOVE PARM-RES-HRMN         TO WS-PREP-TIME
           ELSE
              MOVE 0015                  TO WS-PREP-TIME
           END-IF
      * #1529S
           IF YARD-CALL
              MOVE ZEROES                TO WS-PREP-TIME
           END-IF
           .
      *=================================================================
       P1014-DETERMINE-EARLIEST-CALL.
      *=================================================================
      *  DETERMINE THE EARLIEST ON DUTY DATE/TIME THE EMPLOYEE IS
      *  CONSIDERED RESTED USING THE BELOW FORMULA.
      *
      *  EARLIEST EMPLOYEE OD DT/TM =
      *     MTOD + IF NEEDED (POOL LEAD TIME) - PREP TIME
      *
      *  CNLD-244/251  06/07/23
      *  IF WS-CAN-WRR-NEW, PREP TIME WILL BE INCLUDED IN THE TTOD;
      *  (MTOD + LEAD-TIME) SHOULD BE <= ON-DUTY TIME FOR THE EMP TO BE
      *  CONSIDERED RESTED.
      *-----------------------------------------------------------------
           MOVE SPACES                   TO WS-EARLIEST-CENT-DATE-TIME
      *CNLD-265-B
           MOVE ZEROES                   TO WS-SAVE-LEAD-TIME
      *CNLD-265-E

      *08/01/23 RJA B CNC0600 CNLD-270
      *    IF EMP-MTOD > '0000000000'
      *08/01/23 RJA E CNC0600 CNLD-270

      *CNLD-244-B #3 CNC0600
              IF WS-CAN-WRR-FLAG NOT > SPACE
                 MOVE SPACES                 TO WORK-CNTLKEY
                 MOVE '02'                   TO WK-CNTL-REC-TYPE
                 MOVE DIST OF WS-MSTR        TO WK-CNTL-DIST
                 MOVE SUB-DIST OF WS-MSTR    TO WK-CNTL-SUB-DIST
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P1014-5'           TO ERR-PARAGRAPH
                    MOVE WORK-CNTLKEY        TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE CNTL-CAN-WRR-FLAG      TO WS-CAN-WRR-FLAG
      *CNLD-265-B
                 MOVE CNTL-US-DOM            TO WS-US-DOM-FL
      *CNLD-265-E
              END-IF
      *CNLD-244-E

      *
      *       REGULAR OWNERS OF COMMUTER JOBS DO NOT HAVE LEAD TIME
      *       APPLIED TO THEM.  SEE IF THE EMPLOYEE WE'RE EVALUATING
      *       IS SUCH AN EMPLOYEE.
      *
      *** 331E- ADD CHECK OF TRCN FOR "IGNORE LEAD TIME
      *
              SET WS-INCLUDE-LEAD-TIME   TO TRUE
              MOVE WS-TRCN-FILE          TO SAVE-TRCN-FILE
              MOVE P08CA-PROFILE-KEY  TO TRCNKEY1
              PERFORM P8000-READ-TRCNKEY1
              IF TRCN-IGNORE-LEAD-TIME
                 SET WS-IGNORE-LEAD-TIME       TO TRUE
              ELSE
                 IF UFP-CALL
                    AND WS-INCLUDE-LEAD-TIME
                    MOVE SPACES                TO WORK-CNTLKEY
                    MOVE '3A'                  TO WK-CNTL-REC-TYPE
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO WK-ASGN-KEY
                    MOVE WK-ASGN-KEY-DIST      TO WK-CNTL-DIST
                    MOVE WK-ASGN-KEY-SDIST     TO WK-CNTL-SUB-DIST
                    MOVE WK-ASGN-KEY-POOL      TO WK-CNTL-POOL
                    MOVE 'F'                   TO WK-CNTL-POOL-TYPE
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P1014-3'          TO ERR-PARAGRAPH
                       MOVE CNTLKEY            TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    IF CNTL-POOL-IGNORE-LEAD-TIME
                       SET WS-IGNORE-LEAD-TIME TO TRUE
                    END-IF
                 END-IF
              END-IF
              MOVE TRCN-ASSIGNMENT    TO JOB-DEF-CHECK
              IF LOCAL-CALL
                 AND NOT WS-INCLUDE-LEAD-TIME
      ***        AND NOT P08CA-ASGN-IS-VCNY(FUNC-SUB)
      ***        AND NOT P08CA-ASGN-IS-BOTH(FUNC-SUB)
                 IF JOB-DEF-COMMUTER-ASGN
                    IF TEMPORARY-ASGNMT > SPACES
      * C648
      *        REMOVED COMPARISON OF EMP'S CRAFT AND JOB'S CRAFT.  AS
      *        LONG AS IT'S STILL THE SAME ASSIGNMENT, EMP. DOESN'T NEED
      *        DOESN'T NEED ANY LEAD TIME.
      *
                       IF TEMPORARY-ASGNMT(1:10)
                                     = P08CA-ASGN-KEY(FUNC-SUB)(1:10)
                          SET WS-IGNORE-LEAD-TIME
                                         TO TRUE
                       END-IF
                    ELSE
                       IF NORMAL-ASGNMT > SPACES
      * C648 - SEE ABOVE
                          IF NORMAL-ASGNMT(1:10)
                                     = P08CA-ASGN-KEY(FUNC-SUB)(1:10)
                             SET WS-IGNORE-LEAD-TIME
                                            TO TRUE
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-IF

      *08/01/23 RJA B CNC0600 CNLD-270
      *       WS-SAVE-LEAD IS NEEDED FOR PERS EDIT, MUST BE COMPUTED
      *       EVEN IF EMP-MTOD IS BLANK/ZEROS
              IF WS-INCLUDE-LEAD-TIME
                 IF ENGINE-CRAFT
                    MOVE P08CA-EN-LEAD-TIME TO WS-SAVE-LEAD-TIME
                 ELSE
                    MOVE P08CA-TR-LEAD-TIME TO WS-SAVE-LEAD-TIME
                 END-IF
              END-IF

           IF EMP-MTOD > '0000000000'
      *08/01/23 RJA E CNC0600 CNLD-270
              MOVE SAVE-TRCN-FILE        TO WS-TRCN-FILE
              MOVE ZEROS                 TO DATE-CONVERSION-PARMS
              SET PARM-ADD               TO TRUE
              MOVE EMP-MTOD-DATE         TO PARM-PRI-DATE-GREG
              MOVE EMP-MTOD-TIME         TO PARM-PRI-HRMN
              MOVE SCR08-CC(FUNC-SUB)    TO WS-CRAFT-CODE-CHECK
      *       IF P08CA-CALL-MINUS-LEAD(FUNC-SUB)
      *#1529S
      *       OR P08CA-CALL-TIME(FUNC-SUB)
              IF WS-INCLUDE-LEAD-TIME
      *MET C716
      *CNLD-244-B #3 CNC0600 06/07/2023
      *       PER NEW RULES, LEAD-TM SHOULDN'T BE IGNORED FOR MTOD EDIT
              OR WS-CAN-WRR-NEW
      *CNLD-244-E
                 IF ENGINE-CRAFT
                    MOVE P08CA-EN-LEAD-TIME TO PARM-SEC-HRMN
                 ELSE
                    MOVE P08CA-TR-LEAD-TIME TO PARM-SEC-HRMN
                 END-IF
      *CNLD-265-B
                 IF WS-INCLUDE-LEAD-TIME
                    MOVE PARM-SEC-HRMN      TO WS-SAVE-LEAD-TIME
                 END-IF
      *CNLD-265-E
                 PERFORM P9700-LINK-P903
                 IF NOT SUCCESS
                    MOVE 'P1014-1'       TO ERR-PARAGRAPH
                    MOVE 'P903LINK'      TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE PARM-RES-GREG-CENT TO WS-EARLIEST-CENT
                 MOVE PARM-RES-DATE-GREG TO WS-EARLIEST-DATE
                 MOVE PARM-RES-HRMN      TO WS-EARLIEST-TIME
              ELSE
                 MOVE DE-COMPARE2-DATE-TIME
                                         TO WS-EARLIEST-CENT-DATE-TIME
              END-IF
           END-IF

           IF WS-PREP-TIME > 0 AND
              WS-EARLIEST-DATE > ZEROES
      *CNLD-244-B #3 CNC0600 06/07/2023
      *       PER NEW RULES, PREP-TIME IS PART OF TTOD
              AND NOT WS-CAN-WRR-NEW
      *CNLD-244-E
              MOVE ZEROS                 TO DATE-CONVERSION-PARMS
              SET PARM-SUBTRACT          TO TRUE
              MOVE WS-EARLIEST-DATE      TO PARM-PRI-DATE-GREG
              MOVE WS-EARLIEST-TIME      TO PARM-PRI-HRMN
              MOVE WS-PREP-TIME          TO PARM-SEC-HRMN
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P1014-2'          TO ERR-PARAGRAPH
                 MOVE 'P903LINK'         TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-GREG-CENT    TO WS-EARLIEST-CENT
              MOVE PARM-RES-DATE-GREG    TO WS-EARLIEST-DATE
              MOVE PARM-RES-HRMN         TO WS-EARLIEST-TIME
           END-IF
      *C953 ADJUST SHOT LEAD TIME FROM WSTELE
           MOVE SPACES                   TO WS-TELE-FILE
           MOVE EMP-NBR OF WS-MSTR       TO TELENBRK
                                            TELE-EMP-NBR
           PERFORM P8560-READ-TELE
      *C1020 - BEG
      *    IF TELE-REQ-LEAD-TIME > SPACES AND
      *       WS-EARLIEST-DATE   > ZEROES
      *       MOVE ZEROS                 TO DATE-CONVERSION-PARMS
      *       SET PARM-SUBTRACT          TO TRUE
      *       MOVE WS-EARLIEST-DATE      TO PARM-PRI-DATE-GREG
      *       MOVE WS-EARLIEST-TIME      TO PARM-PRI-HRMN
           IF TELE-REQ-LEAD-TIME > SPACES AND
              WS-EARLIEST-DATE   > ZEROES
      *CNLD-244-B #3 CNC0600 06/07/2023
      *       PER NEW RULES, LEAD TIME CANNOT BE LESS THAN SD LEAD TIME
              AND ((NOT WS-CAN-WRR-NEW) OR
                   (WS-CAN-WRR-NEW
                    AND ((ENGINE-CRAFT AND
                          TELE-REQ-LEAD-TIME > P08CA-EN-LEAD-TIME) OR
                         ((NOT ENGINE-CRAFT) AND
                          TELE-REQ-LEAD-TIME > P08CA-TR-LEAD-TIME))))
      *CNLD-244-E
              MOVE ZEROS                 TO DATE-CONVERSION-PARMS
              SET PARM-ADD               TO TRUE
              MOVE EMP-MTOD-DATE         TO PARM-PRI-DATE-GREG
              MOVE EMP-MTOD-TIME         TO PARM-PRI-HRMN
      *C1020 - END
              MOVE TELE-REQ-LEAD-TIME    TO PARM-SEC-HRMN
      *CNLD-265
                                            WS-SAVE-LEAD-TIME
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P1014-4'          TO ERR-PARAGRAPH
                 MOVE 'P903LINK'         TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-GREG-CENT    TO WS-EARLIEST-CENT
              MOVE PARM-RES-DATE-GREG    TO WS-EARLIEST-DATE
              MOVE PARM-RES-HRMN         TO WS-EARLIEST-TIME
           END-IF
      *
      *08/01/23 RJA B CNC0600 CNLD-270
      *    IF WS-EARLIEST-CENT-DATE-TIME NOT > SPACES
      *       MOVE WS-CALL-MINUS-LEAD    TO WS-EARLIEST-CENT-DATE-TIME
      *    END-IF.
           .
      *08/01/23 RJA E CNC0600 CNLD-270
      *=================================================================
       P1015-DETERMINE-EARLI-US-CALL.
      *=================================================================
           MOVE SPACES                 TO WORK-CNTLKEY
           MOVE '02'                   TO WK-CNTL-REC-TYPE
           MOVE SCR08-DIST             TO WK-CNTL-DIST
           MOVE SCR08-SUB-DIST         TO WK-CNTL-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P1015-1'           TO ERR-PARAGRAPH
              MOVE WORK-CNTLKEY        TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE CNTL-US-DOM            TO WS-US-DOM-FLAG
           MOVE SPACES                 TO WORK-CNTLKEY
           MOVE 'HS'                   TO WK-CNTL-REC-TYPE
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P1015-2'           TO ERR-PARAGRAPH
              MOVE WORK-CNTLKEY        TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE CNTL-HS-US-ACTIVATE-FL TO WS-HS-US-ACTIVATE-FL
      *C947-BEG
      *    IF WS-US-DOM-YES AND
      *       WS-HS-US-ACTIVATE AND
      *       EMP-US-RSTD > '0000000000'
      *C947-END
           IF EMP-US-RSTD > '0000000000'
              MOVE SPACES              TO WS-EARLI-US-CENT-DATE-TIME
              SET WS-INCLUDE-LEAD-TIME TO TRUE
              MOVE WS-TRCN-FILE          TO SAVE-TRCN-FILE
              MOVE P08CA-PROFILE-KEY TO TRCNKEY1
              PERFORM P8000-READ-TRCNKEY1
              IF TRCN-IGNORE-LEAD-TIME
                 SET WS-IGNORE-LEAD-TIME       TO TRUE
              ELSE
                 IF UFP-CALL
                    AND WS-INCLUDE-LEAD-TIME
                    MOVE SPACES                TO WORK-CNTLKEY
                    MOVE '3A'                  TO WK-CNTL-REC-TYPE
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO WK-ASGN-KEY
                    MOVE WK-ASGN-KEY-DIST      TO WK-CNTL-DIST
                    MOVE WK-ASGN-KEY-SDIST     TO WK-CNTL-SUB-DIST
                    MOVE WK-ASGN-KEY-POOL      TO WK-CNTL-POOL
                    MOVE 'F'                   TO WK-CNTL-POOL-TYPE
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P1015-3'          TO ERR-PARAGRAPH
                       MOVE CNTLKEY            TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    IF CNTL-POOL-IGNORE-LEAD-TIME
                       SET WS-IGNORE-LEAD-TIME TO TRUE
                    END-IF
                 END-IF
              END-IF
              MOVE TRCN-ASSIGNMENT TO JOB-DEF-CHECK
              IF LOCAL-CALL
                 AND NOT WS-INCLUDE-LEAD-TIME
                 IF JOB-DEF-COMMUTER-ASGN
                    IF TEMPORARY-ASGNMT > SPACES
                       IF TEMPORARY-ASGNMT(1:10)
                                     = P08CA-ASGN-KEY(FUNC-SUB)(1:10)
                          SET WS-IGNORE-LEAD-TIME
                                         TO TRUE
                       END-IF
                    ELSE
                       IF NORMAL-ASGNMT > SPACES
                          IF NORMAL-ASGNMT(1:10)
                                     = P08CA-ASGN-KEY(FUNC-SUB)(1:10)
                             SET WS-IGNORE-LEAD-TIME
                                            TO TRUE
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-IF
              MOVE SAVE-TRCN-FILE        TO WS-TRCN-FILE
              MOVE ZEROS                 TO DATE-CONVERSION-PARMS
              SET PARM-ADD               TO TRUE
              MOVE EMP-US-RSTD-DATE      TO PARM-PRI-DATE-GREG
              MOVE EMP-US-RSTD-TIME      TO PARM-PRI-HRMN
              MOVE SCR08-CC(FUNC-SUB)    TO WS-CRAFT-CODE-CHECK
      *       IF P08CA-CALL-MINUS-LEAD(FUNC-SUB)
      *#1529S
      *       OR P08CA-CALL-TIME(FUNC-SUB)
              IF WS-INCLUDE-LEAD-TIME
      *CNC0484   INCLUDE SHORT LEAD FUNCTIONALITY
                 MOVE SPACES             TO PS52-COMMAREA-PARMS
                 MOVE EMP-NBR OF WS-MSTR TO PS52-EMP-NBR
                 SET PS52-CMA-MODE       TO TRUE
                 MOVE WS-LOCAL-DATE-TIME TO PS52-INPUT-DATE-TIME
                 PERFORM P8800-LINK-TO-PS52
                 IF NOT SUCCESS
                    MOVE SPACES          TO PS52-REQ-LEAD-TIME
                 END-IF
                 IF PS52-REQ-LEAD-TIME     > SPACES
                    AND PS52-REQ-LEAD-TIME > '0000'
                    MOVE PS52-REQ-LEAD-TIME  TO PARM-SEC-HRMN
                 ELSE
                    IF ENGINE-CRAFT
                       MOVE P08CA-EN-LEAD-TIME TO PARM-SEC-HRMN
                    ELSE
                       MOVE P08CA-TR-LEAD-TIME TO PARM-SEC-HRMN
                    END-IF
                 END-IF
                 PERFORM P9700-LINK-P903
                 IF NOT SUCCESS
                    MOVE 'P1015-4'       TO ERR-PARAGRAPH
                    MOVE 'P903LINK'      TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE PARM-RES-GREG-CENT TO WS-EARLI-US-CENT
                 MOVE PARM-RES-DATE-GREG TO WS-EARLI-US-DATE
                 MOVE PARM-RES-HRMN      TO WS-EARLI-US-TIME
      *CNLD-330-B
                 SET P08CA-SHOW-JOB-NOT(FUNC-SUB) TO TRUE
      *CNLD-330-E
              ELSE
                 MOVE DE-COMPARE3-DATE-TIME
                                         TO WS-EARLI-US-CENT-DATE-TIME
      *CNLD-330-B
      **CNLD-245-B
      *           SET WS-SHOW-JOB         TO TRUE
      **CNLD-245-E
                 SET P08CA-SHOW-JOB(FUNC-SUB) TO TRUE
      *CNLD-330-E
              END-IF
              IF WS-EARLI-US-CENT-DATE-TIME NOT > SPACES
                 MOVE WS-CALL-MINUS-LEAD
                                         TO WS-EARLI-US-CENT-DATE-TIME
              END-IF
           END-IF
           .
      *
       P1020-SET-ASGN-CALL-ATTR.
      *
           SET P08CA-ASGN-SET(FUNC-SUB) TO TRUE
           MOVE AUTOSKIP-MDT      TO SCR08-FUNC-ATTR(FUNC-SUB)
                                     SCR08-NAME-ATTR(FUNC-SUB)
                                     SCR08-ST-ATTR(FUNC-SUB)
                                     SCR08-ECC-ATTR(FUNC-SUB)
                                     SCR08-OD-DATE-ATTR(FUNC-SUB)
                                     SCR08-OD-TIME-ATTR(FUNC-SUB)
                                     SCR08-TAXI-TM-ATTR(FUNC-SUB)
           MOVE REV-VIDEO         TO SCR08-FUNC-HI(FUNC-SUB)
                                     SCR08-NAME-HI(FUNC-SUB)
                                     SCR08-CC-HI(FUNC-SUB)
                                     SCR08-ST-HI(FUNC-SUB)
                                     SCR08-ECC-HI(FUNC-SUB)
      *                                                              PLS
           IF P08CA-ASGN-COLOR(FUNC-SUB) > SPACE
              MOVE P08CA-ASGN-COLOR(FUNC-SUB)
                                  TO SCR08-ST-COL(FUNC-SUB)
                                     SCR08-ECC-COL(FUNC-SUB)
                                     SCR08-MTOD-COL(FUNC-SUB)
                                     SCR08-MTOD-PD-COL(FUNC-SUB)
                                     SCR08-HOME-COL(FUNC-SUB)
                                     SCR08-USHR-COL(FUNC-SUB)
                                     SCR08-USPD-COL(FUNC-SUB)
                                     SCR08-PERS-COL(FUNC-SUB)
                                     SCR08-OD-DATE-COL(FUNC-SUB)
                                     SCR08-OD-TIME-COL(FUNC-SUB)
                                     SCR08-TAXI-TM-COL(FUNC-SUB)
           END-IF

           MOVE SCR08-FUNC(FUNC-SUB) TO WS-FUNCTION-CODE
           .
      *
       P1021-SET-VRU-CALL-ATTR.
      *
      * EMP UNDER VRU CONTROL - PROTECT AND HIGHLIGHT FIELDS
      * EMP RETURNED FROM VRU - UNPROTECT AND BLANK FUNC, HILIGHT FIELDS

      * CHECK IF EMPLOYEE WHO WAS SENT TO VRU FOR CALL HAS BEEN
      * TRANSFERRED
           IF P08CA-TASK-KEY > SPACES
              MOVE P08CA-TASK-KEY   TO TASKTIME
              EXEC CICS READ
                        DATASET(TASK-VIA-EFF-TIME)
                        INTO(WS-TASK)
                        LENGTH(TASKEFTM-RLGTH)
                        RIDFLD(TASKTIME)
                        KEYLENGTH(TASKEFTM-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE                   TO FILE-STATUS
           ELSE
              SET NO-RECORD-FND     TO TRUE
           END-IF
           MOVE SPACES                  TO VRUINFO-FILE
           IF SUCCESS
              MOVE TASK-LOCATION-KEY    TO VRUINFO-TASK-KEY
              PERFORM P9330-READ-VRUINFO
           END-IF

           IF SUCCESS
      *       IF (YARD-CALL OR LOCAL-CALL)
      **         FIND EMP IN VRUINFO
      *          PERFORM VARYING SUBY FROM 1 BY 1
      *             UNTIL SUBY > VRUINFO-CC-MAX
      *             IF P08CA-EMP-NO(FUNC-SUB) = VRUINFO-EMP-NBR(SUBY)
      *                MOVE SUBY           TO VRUINFO-CC-SUB
      *                MOVE VRUINFO-CC-MAX TO SUBY
      *             END-IF
      *          END-PERFORM
      *       ELSE
      *          MOVE FUNC-SUB          TO VRUINFO-CC-SUB
      *       END-IF
              PERFORM VARYING VRUINFO-CC-SUB FROM 1 BY 1
                UNTIL VRUINFO-CC-SUB > VRUINFO-CC-MAX
                 IF VRUINFO-EMP-NBR(VRUINFO-CC-SUB) > SPACES
                    IF EMP-UNDER-VRU-CONTROL(VRUINFO-CC-SUB)
                       SET P08CA-ASGN-IVR-CONTROL(VRUINFO-CC-SUB)
                                        TO TRUE
                    END-IF
                    MOVE SCR08-FUNC(VRUINFO-CC-SUB) TO WS-FUNCTION-CODE
                    IF IVR-CALL-FUNCTION
                       SET P08CA-ASGN-IVR-CONTROL(VRUINFO-CC-SUB)
                                        TO TRUE
                    END-IF
                 END-IF
                 IF VRUINFO-EMP-NBR(VRUINFO-CC-SUB) > SPACES
                 AND NOT NO-CALL-ATTMPT-MADE(VRUINFO-CC-SUB)
                 AND NOT CMA-CALL-SUCCESSFUL(VRUINFO-CC-SUB)
                 AND NOT VRU-CALL-SUCCESSFUL(VRUINFO-CC-SUB)
                 AND NOT CALL-NORMAL
      *#1328
                 AND NOT VRU-SHORT-CALLED(VRUINFO-CC-SUB)
                    MOVE VRUINFO-EMP-NBR(VRUINFO-CC-SUB)
                                           TO IER-EMP-NBR
                    MOVE TASK-LOCATION-KEY TO IER-TASK-KEY
                    INITIALIZE IER-TS-NI
                    PERFORM PSQL-IERSEL16
                    IF IER-TS-NI >= +0
      *                INITIALIZE                   WS-IED-STORAGE
      *                MOVE P08CA-TASK-KEY       TO IED-TASK-KEY
      *                MOVE SCR08-CC(VRUINFO-CC-SUB) TO IED-CRAFT-CD
      *                PERFORM PSQL-IEDSEL02

                       IF REJECT-EMPLOYEE-FUNCTION
                          SET P08CA-ASGN-IVR-XFER(VRUINFO-CC-SUB)
                                           TO TRUE
                          MOVE VRUINFO-DECISION-KEY(VRUINFO-CC-SUB)
                                                TO SCR08-ERRORMSG
      *                   MOVE IED-DEC-KEY      TO SCR08-ERRORMSG
                       ELSE
                          MOVE SPACES
                                      TO SCR08-FUNC(VRUINFO-CC-SUB)
                          MOVE BRIGHT-MDT
                                      TO SCR08-FUNC-ATTR(VRUINFO-CC-SUB)
                          MOVE REV-VIDEO
                                      TO SCR08-FUNC-HI  (VRUINFO-CC-SUB)
                                         SCR08-NAME-HI  (VRUINFO-CC-SUB)
                                         SCR08-CC-HI    (VRUINFO-CC-SUB)
                                         SCR08-ST-HI    (VRUINFO-CC-SUB)
                          SET P08CA-ASGN-IVR-XFER       (VRUINFO-CC-SUB)
                                      TO TRUE
                          MOVE VRUINFO-DECISION-KEY     (VRUINFO-CC-SUB)
                                      TO P08CA-DEC-KEY  (VRUINFO-CC-SUB)
                          MOVE -1
                                    TO SCR08-FUNC-CURSOR(VRUINFO-CC-SUB)
      *                  'EMPLOYEES EXIST WHO WERE TRANSFERRED FROM IVR'
                          MOVE 'E335'       TO MSGLOG-CODE
                       END-IF
                    END-IF
                 END-IF
              END-PERFORM
           END-IF
           .
      *
       P1025-RESET-FUNC-CURSORS.
      *
           MOVE +0                        TO SCR08-FUNC-CURSOR(1)
                                             SCR08-FUNC-CURSOR(2)
                                             SCR08-FUNC-CURSOR(3)
                                             SCR08-FUNC-CURSOR(4)
                                             SCR08-FUNC-CURSOR(5)
                                             SCR08-FUNC-CURSOR(6)
                                             SCR08-FUNC-CURSOR(7)
           .
      *
       P1030-EDIT-CALL-DATE.
      *
           MOVE '0' TO ERRORS-FOUND-CODE
      *
      *    SEE IF ORDER DATE/TIME MORE THAN 16 HOURS AGO - FOR UFP
      *    SEE IF ORDER DATE/TIME MORE THAN 04 HOURS FROM ORIGINALLY
      *    SCHEDULED ON-DUTY TIME FOR AJ
      *
           MOVE ZEROS                     TO DATE-CONVERSION-PARMS
           SET PARM-SUBTRACT              TO TRUE
           IF P08CA-SCH-CALL-DATE-TIME > '0000000000'
              MOVE P08CA-SCH-CALL-DATE    TO PARM-PRI-DATE-GREG
              MOVE P08CA-SCH-CALL-TIME    TO PARM-PRI-HRMN
              MOVE '0600'                 TO PARM-SEC-HRMN
           ELSE
              MOVE WS-LOCAL-DATE          TO PARM-PRI-DATE-GREG
              MOVE WS-LOCAL-TIME          TO PARM-PRI-HRMN
              MOVE '1600'                 TO PARM-SEC-HRMN
           END-IF
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P1030-1'             TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE PARM-RES-DATE-GREG       TO WS-COMPARE-DATE
           MOVE PARM-RES-GREG-CENT       TO WS-COMPARE-CENT
           MOVE PARM-RES-HRMN            TO WS-COMPARE-TIME
           SET DE-YYMMDD-FORMAT     TO TRUE
           MOVE WS-CALL-DATE        TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
           MOVE WS-CALL-TIME        TO DE-COMPARE1-TIME
           IF DE-COMPARE1-DATE-TIME < WS-COMPARE-DATE-TIME-CENT
      *    IF WS-CALL-DATE-TIME     < WS-COMPARE-DATE-TIME
              SET ERRORS-FOUND           TO TRUE
              IF P08CA-SCH-CALL-DATE-TIME > '0000000000'
      *          'ORDER DATE/TIME OVER 4 HOURS FROM SCHEDULED TIME'
                 MOVE 'O018'             TO MSGLOG-CODE
              ELSE
      *          'ORDER DATE/TIME TOO FAR IN THE PAST'
                 MOVE 'O003'             TO MSGLOG-CODE
              END-IF
           END-IF
      *
      *    SEE IF ORDER DATE/TIME MORE THAN 4 HOURS IN FUTURE
      *
           IF NOT ERRORS-FOUND
              MOVE ZEROS TO DATE-CONVERSION-PARMS
              SET PARM-ADD      TO TRUE
              IF P08CA-SCH-CALL-DATE-TIME > '0000000000'
                 MOVE P08CA-SCH-CALL-DATE TO PARM-PRI-DATE-GREG
                 MOVE P08CA-SCH-CALL-TIME TO PARM-PRI-HRMN
              ELSE
                 MOVE WS-LOCAL-DATE       TO PARM-PRI-DATE-GREG
                 MOVE WS-LOCAL-TIME       TO PARM-PRI-HRMN
              END-IF
      *C1009 - BEG
      *       IF DETAIL-CALL-CHECK AND SCR08-FUNC (FUNC-SUB) = 'CSPR'
      *          MOVE '2359'              TO PARM-SEC-HRMN
      *       ELSE
                 MOVE '0600'             TO PARM-SEC-HRMN
      *       END-IF
      *C1009 - END
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P1030-2'           TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-DATE-GREG     TO WS-COMPARE-DATE
              MOVE PARM-RES-GREG-CENT     TO WS-COMPARE-CENT
              MOVE PARM-RES-HRMN          TO WS-COMPARE-TIME
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE        TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
              MOVE WS-CALL-TIME        TO DE-COMPARE1-TIME
              IF DE-COMPARE1-DATE-TIME > WS-COMPARE-DATE-TIME-CENT
      *       IF WS-CALL-DATE-TIME     > WS-COMPARE-DATE-TIME
                 SET ERRORS-FOUND         TO TRUE
                 IF P08CA-SCH-CALL-DATE-TIME > '0000000000'
      *             'ORDER DATE/TIME OVER 4 HOURS FROM SCHEDULED TIME'
                    MOVE 'O018'           TO MSGLOG-CODE
                 ELSE
      *C1009 - BEG
      *             IF DETAIL-CALL-CHECK AND
      *                SCR08-FUNC (FUNC-SUB) = 'CSPR'
      *                'SPREAD TIME MORE THAN 24 HOURS IN FUTURE'
      *                MOVE 'S126' TO MSGLOG-CODE
      *             ELSE
      *                'ORDER DATE/TIME MORE THAN 4 HOURS IN FUTURE'
                       MOVE 'O004'           TO MSGLOG-CODE
      *             END-IF
      *C1009 - END
                 END-IF
              END-IF
           END-IF.
      *
       P1040-SETUP-NAME-LINE.
      *
           MOVE SPACES TO WS-EMP-DISQUALIFIED
      *
      * #1513
           MOVE SPACES TO P08CA-NOT-RESTED-FL(FUNC-SUB)
      * #1503
           MOVE SPACE  TO P08CA-SAVE-CBCK-FLAG(FUNC-SUB)
      *    NOT ON REEDIT
           IF NOT WS-REEDIT-YES
              PERFORM P1060-CLEAR-EMP-LINE
           END-IF
      *    YES ON REEDIT
           PERFORM P8500-READ-MASTER
      *
      *    IF WE DON'T HAVE A MSTR RECORD (DUE TO VACATE LOGIC IN P8500)
      *    DON'T DO ANYTHING ELSE.
      *
           IF WS-MSTR > SPACES
      *** 331E - IF YARDMASTER AND YARDMASTER JOB, MTOD IS IRRELEVANT

              MOVE CRAFT OF WS-MSTR TO WS-CRAFT-CODE-CHECK
      *CNLD-246 B
      *       IF YARDMASTER-CRAFT AND
              IF (YARDMASTER-CRAFT OR YARDMASTER-TRAINEE) AND
      *CNLD-246 E
                 P08CA-HOS-EXEMPT(FUNC-SUB)
                 MOVE ZERO             TO EMP-MTOD
              END-IF
              MOVE EMP-NBR OF WS-MSTR     TO MSTR3NBRK
              PERFORM P8520-READ-MASTER3
              IF DIST OF WS-MSTR NOT = SCR08-DIST
              OR SUB-DIST OF WS-MSTR NOT = SCR08-SUB-DIST
              OR CNTL-REC-TYPE NOT = '02'
                 MOVE SPACES              TO WORK-CNTLKEY
                 MOVE '02'                TO WK-CNTL-REC-TYPE
                 MOVE DIST OF WS-MSTR     TO WK-CNTL-DIST
                 MOVE SUB-DIST OF WS-MSTR TO WK-CNTL-SUB-DIST
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P1040-1'        TO ERR-PARAGRAPH
                    MOVE WORK-CNTLKEY     TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE SPACES              TO TZ-PARAMETERS
                 MOVE CNTL-TIME-ZONE      TO TZ-IN-ZONE
                 MOVE PSTCA-TIME-ZONE     TO TZ-OUT-ZONE

                 IF EMP-MTOD > '0000000000'
                    MOVE EMP-MTOD            TO TZ-IN-DATE-TIME
                    PERFORM P8996-TIMEZONE
                    IF TZ-INVALID-PARAMETERS
                       MOVE '011040' TO ERR-PARAGRAPH
                       PERFORM P8996-TZERROR
                    END-IF
                    MOVE TZ-OUT-DATE-TIME TO EMP-MTOD
                 END-IF

                 IF EMP-US-RSTD > '0000000000'
                    MOVE EMP-US-RSTD         TO TZ-IN-DATE-TIME
                    PERFORM P8996-TIMEZONE
                    IF TZ-INVALID-PARAMETERS
                       MOVE '021040' TO ERR-PARAGRAPH
                       PERFORM P8996-TZERROR
                    END-IF
                    MOVE TZ-OUT-DATE-TIME TO EMP-US-RSTD
                 END-IF

                 IF EMP-PERS-REST > '0000000000'
                    MOVE EMP-PERS-REST       TO TZ-IN-DATE-TIME
                    PERFORM P8996-TIMEZONE
                    IF TZ-INVALID-PARAMETERS
                       MOVE '031040' TO ERR-PARAGRAPH
                       PERFORM P8996-TZERROR
                    END-IF
                    MOVE TZ-OUT-DATE-TIME TO EMP-PERS-REST
                 END-IF
              END-IF
      *#1283
              IF SCR08-TAXI-TM(FUNC-SUB) NOT > SPACES
                 IF UFP-CALL
      *#1466
                    IF P08CA-SAVE-TAXI-TM(FUNC-SUB) = SPACES
                       PERFORM P0305-FIND-TAXI-TIME
                    ELSE
                       MOVE 'SPAC' TO P08CA-SAVE-TAXI-TM(FUNC-SUB)
                    END-IF
                    IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                       MOVE SCR08-TAXI-TM(FUNC-SUB)
                                   TO P08CA-SAVE-TAXI-TM(FUNC-SUB)
                    END-IF
                 END-IF
              END-IF
      *
      *C1139-BEG
              PERFORM P1060-CLEAR-EMP-LINE
      *C1139-END
              MOVE EMP-NAME OF WS-MSTR TO SCR08-NAME(FUNC-SUB)
              MOVE EMP-NBR OF WS-MSTR TO P08CA-EMP-NO(FUNC-SUB)
              IF LAYOFF-CODE OF WS-MSTR NOT = 'A0'
                 MOVE LAYOFF-CODE         TO SCR08-ST(FUNC-SUB)
                 IF LAYOFF-EM-CODE > SPACES
                    MOVE LAYOFF-EM-CODE TO SCR08-ECC(FUNC-SUB)
                 END-IF
              END-IF
              PERFORM P1045-DISPLAY-PHONE-INFO

              MOVE EMP-NBR OF WS-MSTR TO PS52-EMP-NBR
              SET PS52-CMA-MODE       TO TRUE
              MOVE WS-LOCAL-DATE-TIME TO PS52-INPUT-DATE-TIME
              PERFORM P8800-LINK-TO-PS52
              IF NOT SUCCESS
                 MOVE 'P1040-17'      TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE SPACES              TO WORK-CNTLKEY
              MOVE '02'                TO WK-CNTL-REC-TYPE
              MOVE SCR08-DIST          TO WK-CNTL-DIST
              MOVE SCR08-SUB-DIST      TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P1040-2'        TO ERR-PARAGRAPH
                 MOVE WORK-CNTLKEY     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-US-DOM         TO WS-US-DOM-FLAG
      *
              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE        TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-YYMMDD-CE        TO WS-CALL-DATE-CENT
      *
              MOVE ZEROS              TO DATE-CONVERSION-PARMS
              SET PARM-SUBTRACT       TO TRUE
              MOVE WS-CALL-DATE       TO PARM-PRI-DATE-GREG
              MOVE WS-CALL-TIME       TO PARM-PRI-HRMN
              MOVE WS-CALL-DATE-TIME-CENT
                                      TO WS-CHECK-REST-DATE-TIME-CENT
              MOVE SCR08-CC(FUNC-SUB) TO WS-CRAFT-CODE-CHECK
              IF ENGINE-CRAFT
                 MOVE P08CA-EN-LEAD-TIME TO PARM-SEC-HRMN
              ELSE
                 MOVE P08CA-TR-LEAD-TIME TO PARM-SEC-HRMN
              END-IF
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P1040-3' TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-DATE-GREG TO WS-CALL-MINUS-LEAD-DATE
              MOVE PARM-RES-GREG-CENT TO WS-CALL-MINUS-LEAD-CENT
              MOVE PARM-RES-HRMN      TO WS-CALL-MINUS-LEAD-TIME
              IF UFP-CALL
                 IF ENGINE-CRAFT
                    AND EN-GETS-UNDISTURBED-REST
                    PERFORM P1046-COMPUTE-UNDIST-REST
                 ELSE
                    IF TR-GETS-UNDISTURBED-REST
                       PERFORM P1046-COMPUTE-UNDIST-REST
                    END-IF
                 END-IF
              END-IF
      *
      *       WESTERN CANADIAN EMPLOYEES (DIVISION CODE '0') ARE TREATED
      *       DIFFERENTLY FOR PERSONAL REST COMPARISONS.
      *
              PERFORM P6100-DETERMINE-DIVN-FLAG

              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE WS-CALL-DATE        TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE1-DATE
              MOVE WS-CALL-TIME        TO DE-COMPARE1-TIME

              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE EMP-MTOD-DATE       TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE2-DATE
              MOVE EMP-MTOD-TIME       TO DE-COMPARE2-TIME

              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE EMP-US-RSTD-DATE    TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE3-DATE
              MOVE EMP-US-RSTD-TIME    TO DE-COMPARE3-TIME

              SET DE-YYMMDD-FORMAT     TO TRUE
              MOVE EMP-PERS-REST-DATE  TO DE-YYMMDD
              PERFORM P8998-DATEEDIT
              MOVE DE-CCYYMMDD         TO DE-COMPARE4-DATE
              MOVE EMP-PERS-REST-TIME  TO DE-COMPARE4-TIME

              PERFORM P1012-DETERMINE-PREP-TIME
              PERFORM P1014-DETERMINE-EARLIEST-CALL
      *C947   IF NOT WS-WESTERN-DIVN
                 PERFORM P1015-DETERMINE-EARLI-US-CALL
      *       END-IF

              IF WS-WESTERN-DIVN
      *CNLD-265-B
                 OR WS-CAN-WRR-NEW
      *CNLD-265-E
                 SET DE-YYMMDD-FORMAT          TO TRUE
                 MOVE SCR08-ORDER-DATE         TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD              TO DE-COMPARE5-DATE
                 MOVE SCR08-ORDER-TIME         TO DE-COMPARE5-TIME

                 IF P08CA-CALL-MINUS-LEAD(FUNC-SUB)
                    MOVE ZEROS                 TO DATE-CONVERSION-PARMS
                    SET PARM-SUBTRACT          TO TRUE
                    MOVE SCR08-ORDER-DATE      TO PARM-PRI-DATE-GREG
                    MOVE SCR08-ORDER-TIME      TO PARM-PRI-HRMN
                    MOVE SCR08-CC(FUNC-SUB)    TO WS-CRAFT-CODE-CHECK
                    IF  PS52-REQ-LEAD-TIME > SPACES
                    AND PS52-REQ-LEAD-TIME > '0000'
                       MOVE PS52-REQ-LEAD-TIME    TO PARM-SEC-HRMN
                    ELSE
                       IF ENGINE-CRAFT
                          MOVE P08CA-EN-LEAD-TIME TO PARM-SEC-HRMN
                       ELSE
                          MOVE P08CA-TR-LEAD-TIME TO PARM-SEC-HRMN
                       END-IF
                    END-IF
      *CNLD-265-B
                    IF WS-CAN-WRR-NEW
                       MOVE WS-SAVE-LEAD-TIME     TO PARM-SEC-HRMN
                    END-IF
      *CNLD-265-E
                    PERFORM P9700-LINK-P903
                    IF NOT SUCCESS
                       MOVE 'P1040-5' TO ERR-PARAGRAPH
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE PARM-RES-DATE-GREG    TO DE-COMPARE6-YYMMDD
                    MOVE PARM-RES-GREG-CENT    TO DE-COMPARE6-CE
                    MOVE PARM-RES-HRMN         TO DE-COMPARE6-TIME
                 END-IF
              END-IF

      *
      *       IF EMPLOYEE HAS REQUESTED A SHORT LEAD TIME, AND THE
      *       ORDER TIME MINUS EMP LEAD TIME (ADJUSTED FOR PREP) IS
      *       GREATER THAN THE CURRENT TIME, POPULATE THE FUNC FIELD
      *       WITH A 'CBCK' (CALLBACK)
      *
              SET HOS-NOT-PROCESSED           TO TRUE
              MOVE SPACES                     TO WS-OLD-NAME-COL
      *
              IF  PS52-REQ-LEAD-TIME > '0000'
              AND ((((LOCAL-CALL AND P08CA-CALL-SET)
              OR     (UFP-CALL   AND P08CA-CALL-SET))
              AND     P08CA-TURNS-RESET)
              OR   YARD-CALL)
                 SET DE-YYMMDD-FORMAT          TO TRUE
                 MOVE SCR08-ORDER-DATE         TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD              TO DE-COMPARE5-DATE
                 MOVE SCR08-ORDER-TIME         TO DE-COMPARE5-TIME

      *          BYPASS IS SET IN P2600-GET-SENIOR-MAN ROUTINE
                 IF NOT WS-BYPASS-PREP
      *
      *             ADJUST FOR PREP TIME
      *
                    MOVE ZEROS                TO DATE-CONVERSION-PARMS
                    SET PARM-SUBTRACT         TO TRUE
                    MOVE SCR08-ORDER-DATE     TO PARM-PRI-DATE-GREG
                    MOVE SCR08-ORDER-TIME     TO PARM-PRI-HRMN
                    MOVE WS-PREP-TIME         TO PARM-SEC-HRMN
                    PERFORM P9700-LINK-P903
                    IF NOT SUCCESS
                       MOVE 'P1040-6'         TO ERR-PARAGRAPH
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE PARM-RES-GREG-CENT   TO WS-ADJUSTED-CC
                    MOVE PARM-RES-DATE-GREG   TO WS-ADJUSTED-DATE
                    MOVE PARM-RES-TIME        TO WS-ADJUSTED-TIME
                 END-IF
                 IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                    MOVE SCR08-TAXI-TM(FUNC-SUB) TO WS-WK-TAXI-TIME
                    IF SCR08-TAXI-TM(FUNC-SUB) > SCR08-ORDER-TIME
      *                SUBTRACT 1 FROM ORDER-DATE
                       SET PARM-SUBTRACT           TO TRUE
                       MOVE SCR08-ORDER-DATE       TO PARM-PRI-DATE-GREG
                       MOVE SCR08-ORDER-TIME       TO PARM-PRI-HRMN
                       MOVE 1                      TO PARM-SEC-DATE-GREG
                       PERFORM P9700-LINK-P903
                       IF NOT SUCCESS
                          MOVE 'P1040-15'          TO ERR-PARAGRAPH
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                       MOVE PARM-RES-GREG-CENT     TO WS-WK-TAXI-CC
                       MOVE PARM-RES-DATE-GREG     TO WS-WK-TAXI-DATE
                    ELSE
                       MOVE '20'                   TO WS-WK-TAXI-CC
                       MOVE SCR08-ORDER-DATE       TO WS-WK-TAXI-DATE
                    END-IF
                 ELSE
                    MOVE '20'                   TO WS-WK-TAXI-CC
                    MOVE SCR08-ORDER-DATE       TO WS-WK-TAXI-DATE
                    MOVE SCR08-ORDER-TIME       TO WS-WK-TAXI-TIME
                 END-IF
                 IF WS-WK-TAXI-DATE-TIME  < WS-ADJUSTED-DATE-TIME
                    MOVE WS-WK-TAXI-DATE-TIME TO WS-ADJUSTED-DATE-TIME
                 END-IF
      *          DE-COMPARE5-DATE-TIME IS  SCR08-ORDER-DATE AND TIME
                 IF DE-COMPARE5-DATE-TIME < WS-ADJUSTED-DATE-TIME
                    MOVE DE-COMPARE5-DATE-TIME TO WS-ADJUSTED-DATE-TIME
                 END-IF
      *
      *          SUBTRACT THE EMPLOYEE'S REQUESTED LEAD TIME
      *
                 MOVE ZEROS                   TO DATE-CONVERSION-PARMS
                 SET PARM-SUBTRACT            TO TRUE
                 MOVE WS-ADJUSTED-DATE        TO PARM-PRI-DATE-GREG
                 MOVE WS-ADJUSTED-TIME        TO PARM-PRI-HRMN
                 MOVE PS52-REQ-LEAD-TIME      TO PARM-SEC-HRMN
                 PERFORM P9700-LINK-P903
                 IF NOT SUCCESS
                    MOVE 'P1040-7'            TO ERR-PARAGRAPH
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE PARM-RES-GREG-CENT      TO WS-ADJUSTED-CC
                 MOVE PARM-RES-DATE-GREG      TO WS-ADJUSTED-DATE
                 MOVE PARM-RES-TIME           TO WS-ADJUSTED-TIME
                 IF WS-ADJUSTED-DATE-TIME      > WS-LOCAL-DATE-TIME-CENT
      *
      *             IF THE EMPLOYEE IS "RED" FOR THE CALL, DON'T BOTHER
      *             PROMPTING FOR CALLBACK.
      *
                    PERFORM P2950-GET-HRS-SVC-INFO
                    SET HOS-PROCESSED     TO TRUE
                    IF NOT P925-EMP-STATUS-RED
      *
      *                SAVE OFF THE EMPLOYEE'S REST STATUS IN THE COMM
      *                AREA SO THAT WE CAN RE-POPULATED THE FUNC FIELD
      *                WITH 'HOUR', IF NEEDED, AFTER THE CREW CALLER
      *                HAS CREATED THE CALLBACK TASK.
      *
                       IF P925-EMP-STATUS-YELLOW
                          AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                          SET P08CA-REST-YELLOW(FUNC-SUB)
                                           TO TRUE
                          MOVE SCR08-NAME-COL(FUNC-SUB)
                                           TO WS-OLD-NAME-COL
                          MOVE YELLOW      TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
      *C1196 - BEG
                       IF  NOT P08CA-ASGN-SET(FUNC-SUB)
                       AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
      *C1196 - END
                          MOVE SPACES      TO SCR08-PHONE(FUNC-SUB)
                          MOVE 'CBCK'      TO SCR08-FUNC(FUNC-SUB)
                             STRING 'SHORT LEAD REQ: ENT KEY TO CBCK '
                                 'OR TYPE V??? FOR IVR SHORT CALL'
                                 DELIMITED BY SIZE
                                 INTO SCR08-PHONE(FUNC-SUB)
                          MOVE WS-ADJUSTED-DATE
                                           TO SCR08-OD-DATE(FUNC-SUB)
                          MOVE WS-ADJUSTED-TIME
                                           TO SCR08-OD-TIME(FUNC-SUB)
                          MOVE REV-VIDEO   TO SCR08-FUNC-HI(FUNC-SUB)
                                              SCR08-OD-DATE-HI(FUNC-SUB)
                                              SCR08-OD-TIME-HI(FUNC-SUB)
                          MOVE 'Y'     TO P08CA-SAVE-CBCK-FLAG(FUNC-SUB)
      *C1196 - BEG
                       END-IF
      *C1196 - END
                    END-IF
                 END-IF
              END-IF
      *
      *       IF EMPLOYEE HAS REQUESTED A SHORT CALL TIME, AND THE
      *       ORDER TIME MINUS REQ CALL TIME IS GREATER THAN THE CURRENT
      *       TIME, AND GREATER THAN THE SHORT LEAD TIME, POPULATE THE
      *       FUNC FIELD WITH A 'CBCK' (CALLBACK)
      *
              IF  PS52-REQ-CALL-TIME > '0000'
              AND ((((LOCAL-CALL AND P08CA-CALL-SET)
              OR     (UFP-CALL   AND P08CA-CALL-SET))
              AND     P08CA-TURNS-RESET)
              OR   YARD-CALL)
                 IF HOS-NOT-PROCESSED
                    PERFORM P2950-GET-HRS-SVC-INFO
                    SET HOS-PROCESSED     TO TRUE
                 END-IF
                 IF NOT P925-EMP-STATUS-RED
                    IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                       MOVE SCR08-TAXI-TM(FUNC-SUB)
                                                   TO WS-SHORT-CALL-TIME
                       IF SCR08-TAXI-TM(FUNC-SUB) > SCR08-ORDER-TIME
      *                   SUBTRACT 1 FROM ORDER-DATE
                          SET PARM-SUBTRACT        TO TRUE
                          MOVE SCR08-ORDER-DATE    TO PARM-PRI-DATE-GREG
                          MOVE SCR08-ORDER-TIME    TO PARM-PRI-HRMN
                          MOVE 1                   TO PARM-SEC-DATE-GREG
                          PERFORM P9700-LINK-P903
                          IF NOT SUCCESS
                             MOVE 'P1040-16'       TO ERR-PARAGRAPH
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                          MOVE PARM-RES-DATE-GREG  TO WS-SHORT-CALL-DATE
                       ELSE
                          MOVE SCR08-ORDER-DATE    TO WS-SHORT-CALL-DATE
                       END-IF
                    ELSE
                       MOVE SCR08-ORDER-DATE  TO WS-SHORT-CALL-DATE
                       MOVE SCR08-ORDER-TIME  TO WS-SHORT-CALL-TIME
                    END-IF
                    MOVE ZEROS                TO DATE-CONVERSION-PARMS
                    SET PARM-SUBTRACT         TO TRUE
      *             MOVE SCR08-ORDER-DATE     TO PARM-PRI-DATE-GREG
      *             MOVE SCR08-ORDER-TIME     TO PARM-PRI-HRMN
                    MOVE WS-SHORT-CALL-DATE   TO PARM-PRI-DATE-GREG
                    MOVE WS-SHORT-CALL-TIME   TO PARM-PRI-HRMN
                    MOVE PS52-REQ-CALL-TIME   TO PARM-SEC-HRMN
                    PERFORM P9700-LINK-P903
                    IF NOT SUCCESS
                       MOVE 'P1040-14'        TO ERR-PARAGRAPH
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE PARM-RES-GREG-CENT   TO WS-SHORT-CALL-CC
                    MOVE PARM-RES-DATE-GREG   TO WS-SHORT-CALL-DATE
                    MOVE PARM-RES-TIME        TO WS-SHORT-CALL-TIME
                    IF WS-SHORT-CALL-DATE-TIME > WS-LOCAL-DATE-TIME-CENT
                       IF PS52-REQ-LEAD-TIME NOT > SPACES
                       OR PS52-REQ-LEAD-TIME < '0001'
      *
      *                  SAVE OFF THE EMPLOYEE'S REST STATUS IN THE COMM
      *                  AREA SO THAT WE CAN RE-POPULATED THE FUNC FIELD
      *                   WITH 'HOUR', IF NEEDED, AFTER THE CREW CALLER
      *                   HAS CREATED THE CALLBACK TASK.
      *
                          IF P925-EMP-STATUS-YELLOW
                             AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                             SET P08CA-REST-YELLOW(FUNC-SUB)
                                           TO TRUE
                             MOVE SCR08-NAME-COL(FUNC-SUB)
                                           TO WS-OLD-NAME-COL
                             MOVE YELLOW   TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
                          MOVE WS-SHORT-CALL-DATE-TIME
                                           TO WS-ADJUSTED-DATE-TIME
      *C1196 - BEG
                          IF  NOT P08CA-ASGN-SET(FUNC-SUB)
                          AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
                             PERFORM P1048-DISPLAY-SHORT-CALL
                          END-IF
      *C1196 - END
                       ELSE
                          IF WS-SHORT-CALL-DATE-TIME
                                                >= WS-ADJUSTED-DATE-TIME
                             MOVE WS-SHORT-CALL-DATE-TIME
                                           TO WS-ADJUSTED-DATE-TIME
      *C1196 - BEG
                             IF  NOT P08CA-ASGN-SET(FUNC-SUB)
                             AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
                                PERFORM P1048-DISPLAY-SHORT-CALL
                             END-IF
      *C1196 - END
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-IF
      *

              IF ENGINE-CRAFT
                 IF TRCN-EN-REST-REQ = ('C' OR 'B')
                    OR (TRCN-EN-REST-REQ = 'N'
                    AND EMP-LAST-TOUR-OUT-OF-BOX)
                    IF WS-EARLIEST-CENT-DATE-TIME >
                       WS-EMP-OD-CENT-DATE-TIME
      *CNLD-251-B CNC0600 06/07/2023 NEW P1014 CHANGES SHOULD SUFFICE
RJA   * CNC0600 B
RJA   *                OR (YARD-CALL
RJA   *                    AND EMP-MTOD > WS-CALL-MINUS-LEAD-DTTM)
RJA   * CNC0600 E
      *CNLD-251-E
                       MOVE EMP-MTOD-TIME TO SCR08-MTOD(FUNC-SUB)
                    END-IF
      *                                                              PLS
                    IF EMP-PREV-DUTY-MTOD NUMERIC
                       MOVE EMP-PREV-DUTY-MTOD
                                           TO SCR08-MTOD-PD(FUNC-SUB)
                    END-IF
                    IF NOT WORKING IN WS-MSTR
                       MOVE ZERO           TO SCHED-DONE-CODE
                                              SCHED-2ND-CODE
                                              SCHED-LST-CODE
                                              SCHED-FOUND-CODE
      *
      *                HOS-PROCESSED WILL BE SET DURING CALLBACK
      *                PROCESSING.  WE DON'T WANT TO RECALCULATE
      *                THE EMP'S HOS IN THIS CASE, BECAUSE THE
      *                ON-DUTY TIME HAS BEEN OVERLAID WITH THE
      *                EMP'S CALLBACK TIME, AND WE COULD GET
      *                STRANGE RESULTS.
      *
                       IF HOS-NOT-PROCESSED
                          PERFORM P2950-GET-HRS-SVC-INFO
                       END-IF
      *MET 08/15/2006 C662
      *
      *                EMPLOYEE IS ENTITLED TO WORK SECOND SPLIT
      *                OF A GO-TRAIN IF THEY WORKED 1ST SPLIT,
      *                REGARDLESS OF HOS/CALL RULES. (AS DICTATED
      *                BY SUB-DIST CONTROL SETTINGS).
      *
                       IF TRCN-2ND-ROUTE-DESIGNATION > SPACES
                       AND TRCN-LOCAL-REC
                          PERFORM P3039-GET-CNTL-DIST-SUB-DIST
                          IF NOT CNTL-SPLIT-SHIFT-HOS
                             AND SCHED-2ND
                             AND ON-SCHED-1ST
                             SET P925-EMP-STATUS-GREEN TO TRUE
      *
      *                      IF WS-OLD-NAME-COL IS POPULATED, USE
      *                      IT TO RESET THE COLOR OF THE NAME FIELD.
      *                      WE MAY HAVE CHANGED IT TO YELLOW UP
      *                      ABOVE IN CALL-BACK PROCESSING
      *
                             IF WS-OLD-NAME-COL > SPACES
                                MOVE WS-OLD-NAME-COL
                                           TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                          END-IF
                       END-IF
      *** 331E - ADD CHECK FOR HOS EXEMPT FLAG
                       IF P925-EMP-STATUS-RED
                          AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
      *CNC0600-B
                          IF WS-SAVE-REST-STATUS > SPACES
                             IF WS-SAVE-REST-STATUS = 'Y'
                                MOVE YELLOW TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                             IF WS-SAVE-REST-STATUS = 'R'
                                MOVE RED    TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                          ELSE
      *CNC0600-E
      *CNLD-230-B
      *                         MOVE RED    TO SCR08-NAME-COL(FUNC-SUB)
                             EVALUATE TRUE
                                WHEN WS-RFR-7DAY-RND-ERT
                                     CONTINUE
      *CNLD-257-DXC-B
      *                         WHEN WS-RFR-60-192-ERT
                                WHEN WS-RFR-60-ERT
                                WHEN WS-RFR-192-ERT
      *CNLD-257-DXC-E
                                     MOVE YELLOW
                                            TO SCR08-NAME-COL(FUNC-SUB)
                                WHEN OTHER
                                     MOVE RED
                                            TO SCR08-NAME-COL(FUNC-SUB)
                             END-EVALUATE
      *CNLD-230-E
      *CNC0600-B
                          END-IF
      *CNC0600-E
      *CNC0600-CNLD-209
                          IF NOT WS-CAN-WRR-NEW
                             MOVE 'HOUR'      TO SCR08-FUNC(FUNC-SUB)
                          END-IF
                       ELSE
                          IF P925-EMP-STATUS-YELLOW
                             AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                             AND (SCR08-FUNC(FUNC-SUB) NOT = 'CBCK'
                             AND  SCR08-FUNC(FUNC-SUB) NOT = 'QTIE')
                             MOVE YELLOW   TO SCR08-NAME-COL(FUNC-SUB)
                             MOVE 'HOUR'   TO SCR08-FUNC(FUNC-SUB)
                             IF P925-FROZEN-DATE-TIME > SPACES
                                MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
                                STRING 'FROZEN UNTIL - '
                                       P925-FROZEN-DATE '-'
                                       P925-FROZEN-TIME
                                       DELIMITED BY SIZE
                                       INTO SCR08-PHONE(FUNC-SUB)
                                MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
                             END-IF
                          END-IF
                       END-IF
                    END-IF
                 END-IF
                 IF TRCN-EN-REST-REQ = ('U' OR 'B')
                    IF WS-US-DOM-YES AND
                       WS-HS-US-ACTIVATE
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          MOVE EMP-US-RSTD-TIME TO SCR08-USHR(FUNC-SUB)
                          IF EMP-PREV-DUTY IS NUMERIC
                             MOVE EMP-PREV-DUTY TO SCR08-USPD(FUNC-SUB)
                          END-IF
                       END-IF
      *CNC0496
                       IF DE-COMPARE3-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          SET P08CA-EMP-RESTED-NO(FUNC-SUB)  TO TRUE
                       ELSE
                          SET P08CA-EMP-RESTED-YES(FUNC-SUB) TO TRUE
                       END-IF
                    ELSE
      *                IF EMP-US-RSTD > WS-CALL-DATE-TIME
      *C947-BEG        IF DE-COMPARE3-DATE-TIME
      *                                > WS-CHECK-REST-DATE-TIME-CENT
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
      *C947-END
                          MOVE EMP-US-RSTD-TIME TO SCR08-USHR(FUNC-SUB)
                          IF EMP-PREV-DUTY IS NUMERIC
                             MOVE EMP-PREV-DUTY TO SCR08-USPD(FUNC-SUB)
                          END-IF
                       END-IF
                    END-IF
                 END-IF
      *
                 IF (NOT WORKING IN WS-MSTR)
                    AND WS-US-DOM-YES
                    AND (P08CA-EMP-NO(FUNC-SUB) > SPACES)
                    MOVE SPACES            TO PS94-COMMAREA-PARMS
                                              WS-HST-STORAGE
                    SET PS94-HST-FUNC      TO TRUE
                    PERFORM P1042-GET-HST-KEY
                    MOVE P08CA-EMP-NO(FUNC-SUB)
                                           TO PS94-EMP-NBR
                    MOVE SCR08-OD-DATE(FUNC-SUB)
                                           TO PS94-HSL-EVENT-STRT-TS-DT
                    MOVE SCR08-OD-TIME(FUNC-SUB)
                                           TO PS94-HSL-EVENT-STRT-TS-TM
      *
      *             GET THE ASSIGNMENT'S TIME ZONE
      *
                    MOVE SPACES            TO WORK-CNTLKEY
                    MOVE '02'              TO WK-CNTL-REC-TYPE
                    MOVE TRCN-DIST         TO WK-CNTL-DIST
                    MOVE TRCN-SDIST        TO WK-CNTL-SUB-DIST
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P1040-8'      TO ERR-PARAGRAPH
                       MOVE CNTLKEY        TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE CNTL-TIME-ZONE    TO PS94-TIME-ZONE

                    PERFORM P9993-CALL-PS94-PROGRAM
                    EVALUATE TRUE
                       WHEN PS94-HST-LT-ALERT-LIMIT
                       WHEN PS94-HST-LT-ALERT-THRESHOLD
                       WHEN PS94-HST-TT-ALERT-LIMIT
                       WHEN PS94-HST-TT-ALERT-THRESHOLD
                       WHEN PS94-HST-ST-ALERT-THRESHOLD
                            MOVE SCR08-NAME-COL(FUNC-SUB)
                                             TO WS-OLD-NAME-COL
                            MOVE YELLOW      TO SCR08-NAME-COL(FUNC-SUB)
                            MOVE 'HOUR'      TO SCR08-FUNC(FUNC-SUB)
                    END-EVALUATE
                 END-IF
      *
              ELSE
                 IF TRCN-TR-REST-REQ = ('C' OR 'B')
                    OR (TRCN-TR-REST-REQ = 'N'
                    AND EMP-LAST-TOUR-OUT-OF-BOX)
                    IF WS-EARLIEST-CENT-DATE-TIME >
                       WS-EMP-OD-CENT-DATE-TIME
      *CNLD-251-B CNC0600 06/07/2023 NEW P1014 CHANGES SHOULD SUFFICE
RJA   * CNC0600 B
RJA   *                OR (YARD-CALL
RJA   *                    AND EMP-MTOD > WS-CALL-MINUS-LEAD-DTTM)
RJA   * CNC0600 E
      *CNLD-251-E
      *             IF (P08CA-CALL-TIME(FUNC-SUB)
      *                AND EMP-MTOD > WS-CALL-DATE-TIME)
      *                AND DE-COMPARE2-DATE-TIME
      *                             > WS-CHECK-REST-DATE-TIME-CENT)
      *                OR (P08CA-CALL-MINUS-LEAD(FUNC-SUB)
      *                AND EMP-MTOD > WS-CALL-MINUS-LEAD)
      *                AND DE-COMPARE2-DATE-TIME
      *                             > WS-CALL-MINUS-LEAD)
                       MOVE EMP-MTOD-TIME TO SCR08-MTOD(FUNC-SUB)
                    END-IF
      *                                                              PLS
                    IF EMP-PREV-DUTY-MTOD NUMERIC
                       MOVE EMP-PREV-DUTY-MTOD
                                           TO SCR08-MTOD-PD(FUNC-SUB)
                    END-IF
                    IF NOT WORKING IN WS-MSTR
                       MOVE ZERO           TO SCHED-DONE-CODE
                                              SCHED-2ND-CODE
                                              SCHED-LST-CODE
                                              SCHED-FOUND-CODE
      *
      *                HOS-PROCESSED WILL BE SET DURING CALLBACK
      *                PROCESSING.  WE DON'T WANT TO RECALCULATE
      *                THE EMP'S HOS IN THIS CASE, BECAUSE THE
      *                ON-DUTY TIME HAS BEEN OVERLAID WITH THE
      *                EMP'S CALLBACK TIME, AND WE COULD GET
      *                STRANGE RESULTS.
      *
                       IF HOS-NOT-PROCESSED
                          PERFORM P2950-GET-HRS-SVC-INFO
                       END-IF
      *MET 08/15/2006 C662
      *
      *                EMPLOYEE IS ENTITLED TO WORK SECOND SPLIT
      *                OF A GO-TRAIN IF THEY WORKED 1ST SPLIT,
      *                REGARDLESS OF HOS/CALL RULES. (AS DICTATED
      *                BY SUB-DIST CONTROL SETTINGS).
      *
                       IF TRCN-2ND-ROUTE-DESIGNATION > SPACES
                       AND TRCN-LOCAL-REC
                          PERFORM P3039-GET-CNTL-DIST-SUB-DIST
                          IF NOT CNTL-SPLIT-SHIFT-HOS
                             AND SCHED-2ND
                             AND ON-SCHED-1ST
                             SET P925-EMP-STATUS-GREEN TO TRUE
      *
      *                      IF WS-OLD-NAME-COL IS POPULATED, USE
      *                      IT TO RESET THE COLOR OF THE NAME FIELD.
      *                      WE MAY HAVE CHANGED IT TO YELLOW UP
      *                      ABOVE IN CALL-BACK PROCESSING
      *
                             IF WS-OLD-NAME-COL > SPACES
                                MOVE WS-OLD-NAME-COL
                                           TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                          END-IF
                       END-IF
      *** 331E - ADD CHECK FOR HOS EXEMPT FLAG
                       IF P925-EMP-STATUS-RED
                          AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
      *CNC0600-B
                          IF WS-SAVE-REST-STATUS > SPACES
                             IF WS-SAVE-REST-STATUS = 'Y'
                                MOVE YELLOW TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                             IF WS-SAVE-REST-STATUS = 'R'
                                MOVE RED    TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                          ELSE
      *CNC0600-E
      *CNLD-230-B
      *                         MOVE RED    TO SCR08-NAME-COL(FUNC-SUB)
                             EVALUATE TRUE
                                WHEN WS-RFR-7DAY-RND-ERT
                                     CONTINUE
      *CNLD-257-DXC-B
      *                         WHEN WS-RFR-60-192-ERT
                                WHEN WS-RFR-60-ERT
                                WHEN WS-RFR-192-ERT
      *CNLD-257-DXC-E
                                     MOVE YELLOW
                                            TO SCR08-NAME-COL(FUNC-SUB)
                                WHEN OTHER
                                     MOVE RED
                                            TO SCR08-NAME-COL(FUNC-SUB)
                             END-EVALUATE
      *CNLD-230-E
      *CNC0600-B
                          END-IF
      *CNC0600-E
      *CNC0600-CNLD-209
                          IF NOT WS-CAN-WRR-NEW
                             MOVE 'HOUR'   TO SCR08-FUNC(FUNC-SUB)
                          END-IF
                       ELSE
                          IF P925-EMP-STATUS-YELLOW
                             AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                             AND (SCR08-FUNC(FUNC-SUB) NOT = 'CBCK'
                             AND  SCR08-FUNC(FUNC-SUB) NOT = 'QTIE')
                             MOVE YELLOW   TO SCR08-NAME-COL(FUNC-SUB)
      *CNC0600-CNLD-209
                             IF NOT WS-CAN-WRR-NEW
                                MOVE 'HOUR'   TO SCR08-FUNC(FUNC-SUB)
                             END-IF
                             IF P925-FROZEN-DATE-TIME > SPACES
                                MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
                                STRING 'FROZEN UNTIL - '
                                       P925-FROZEN-DATE '-'
                                       P925-FROZEN-TIME
                                       DELIMITED BY SIZE
                                       INTO SCR08-PHONE(FUNC-SUB)
                                MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
                             END-IF
                          END-IF
                       END-IF
                    END-IF
                 END-IF
                 IF TRCN-TR-REST-REQ = ('U' OR 'B')
                    IF WS-US-DOM-YES AND
                       WS-HS-US-ACTIVATE
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          MOVE EMP-US-RSTD-TIME TO SCR08-USHR(FUNC-SUB)
                          IF EMP-PREV-DUTY IS NUMERIC
                             MOVE EMP-PREV-DUTY TO SCR08-USPD(FUNC-SUB)
                          END-IF
                       END-IF
      *CNC0496
                       IF DE-COMPARE3-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
                          SET P08CA-EMP-RESTED-NO(FUNC-SUB)  TO TRUE
                       ELSE
                          SET P08CA-EMP-RESTED-YES(FUNC-SUB) TO TRUE
                       END-IF
                    ELSE
      *                IF EMP-US-RSTD > WS-CALL-DATE-TIME
      *C947-BEG        IF DE-COMPARE3-DATE-TIME
      *                                > WS-CHECK-REST-DATE-TIME-CENT
                       IF WS-EARLI-US-CENT-DATE-TIME >
                          WS-EMP-OD-CENT-DATE-TIME
      *C947-END
                          MOVE EMP-US-RSTD-TIME TO SCR08-USHR(FUNC-SUB)
                          IF EMP-PREV-DUTY IS NUMERIC
                             MOVE EMP-PREV-DUTY TO SCR08-USPD(FUNC-SUB)
                          END-IF
                       END-IF
                    END-IF
                 END-IF
      *
                 IF (NOT WORKING IN WS-MSTR)
                    AND WS-US-DOM-YES
                    AND (P08CA-EMP-NO(FUNC-SUB) > SPACES)
                    MOVE SPACES            TO PS94-COMMAREA-PARMS
                                              WS-HST-STORAGE
                    SET PS94-HST-FUNC      TO TRUE
                    PERFORM P1042-GET-HST-KEY
                    MOVE P08CA-EMP-NO(FUNC-SUB)
                                           TO PS94-EMP-NBR
                    MOVE SCR08-OD-DATE(FUNC-SUB)
                                           TO PS94-HSL-EVENT-STRT-TS-DT
                    MOVE SCR08-OD-TIME(FUNC-SUB)
                                           TO PS94-HSL-EVENT-STRT-TS-TM
      *
      *             GET THE ASSIGNMENT'S TIME ZONE
      *
                    MOVE SPACES            TO WORK-CNTLKEY
                    MOVE '02'              TO WK-CNTL-REC-TYPE
                    MOVE TRCN-DIST         TO WK-CNTL-DIST
                    MOVE TRCN-SDIST        TO WK-CNTL-SUB-DIST
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P1040-9'      TO ERR-PARAGRAPH
                       MOVE CNTLKEY        TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE CNTL-TIME-ZONE    TO PS94-TIME-ZONE

                    PERFORM P9993-CALL-PS94-PROGRAM
                    EVALUATE TRUE
                       WHEN PS94-HST-LT-ALERT-LIMIT
                       WHEN PS94-HST-LT-ALERT-THRESHOLD
                       WHEN PS94-HST-TT-ALERT-LIMIT
                       WHEN PS94-HST-TT-ALERT-THRESHOLD
                       WHEN PS94-HST-ST-ALERT-THRESHOLD
                            MOVE SCR08-NAME-COL(FUNC-SUB)
                                             TO WS-OLD-NAME-COL
                            MOVE YELLOW      TO SCR08-NAME-COL(FUNC-SUB)
                            MOVE 'HOUR'      TO SCR08-FUNC(FUNC-SUB)
                    END-EVALUATE
                 END-IF
      *
              END-IF
              IF (P08CA-CALL-TIME(FUNC-SUB)
      *          AND EMP-PERS-REST > WS-CALL-DATE-TIME)
                 AND ((NOT WS-WESTERN-DIVN AND DE-COMPARE4-DATE-TIME
                     > WS-CHECK-REST-DATE-TIME-CENT)
                     OR (WS-WESTERN-DIVN
                    AND DE-COMPARE4-DATE-TIME > DE-COMPARE5-DATE-TIME)))
                 OR (P08CA-CALL-MINUS-LEAD(FUNC-SUB)
      *MET C716
      *             AND EMP-PERS-REST         > WS-CALL-MINUS-LEAD)
      *CNLD-265-B PERS REST SHOULD BE COMPARED WITH ORDER-LEAD
      *             AND DE-COMPARE4-DATE-TIME > WS-CALL-MINUS-LEAD)
                    AND DE-COMPARE4-DATE-TIME > DE-COMPARE6-DATE-TIME)
      *CNLD-265-E
                 MOVE EMP-PERS-REST-TIME  TO SCR08-PERS(FUNC-SUB)
              END-IF
              IF TEMPORARY-ASGNMT > SPACE
                 MOVE TA-AREA             TO SCR08-NORM-ASG(FUNC-SUB)
              ELSE
                 MOVE NA-AREA             TO SCR08-NORM-ASG(FUNC-SUB)
              END-IF
              IF P08CA-ASGN-QUAL-AREA(FUNC-SUB) > SPACES
                 MOVE EMP-NBR OF WS-MSTR  TO QUAL-EMP-NO
                 PERFORM VARYING SUB1 FROM 1 BY 1
      *CNC0572 - BEG
      ***           UNTIL SUB1 > 6
                    UNTIL SUB1 > 8
      *CNC0572 - END
                    IF P08CA-ASGN-QUAL(FUNC-SUB, SUB1) > SPACES
                       MOVE P08CA-ASGN-QUAL(FUNC-SUB, SUB1)
                          TO QUALIFICATION
                       MOVE QUALEMP-KEY TO QUALEMP
                       EXEC CICS READ
                                DATASET(QUAL-FILE-VIA-QUALEMP)
                                INTO(WS-QUAL-FILE)
                                LENGTH(QUALEMP-RLGTH)
                                RIDFLD(QUALEMP)
                                KEYLENGTH(QUALEMP-KLGTH)
                                RESP(WS-RESPONSE)
                       END-EXEC
                       MOVE WS-RESPONSE TO FILE-STATUS
                       IF SUCCESS
                          IF QUAL-DATE NOT > '000000'
                             MOVE '999999'   TO QUAL-DATE
                          END-IF
                          IF P08CA-ASGN-QUAL-RSTR(FUNC-SUB, SUB1)
      *
      *                   IF THE EMPLOYEE HAS THE QUALIFICATION CODE,
      *                   AND THAT QUALIFICATION IS A "RESTRICTION",
      *                   AND THE QUALIFICATION HAS NOT YET "EXPIRED",
      *                   THE EMPLOYEE CANNOT BE CALLED FOR THE
      *                   ASSIGNMENT
      *
                             SET DE-YYMMDD-FORMAT TO TRUE
                             MOVE QUAL-DATE TO DE-YYMMDD
                             PERFORM P8998-DATEEDIT
                             MOVE DE-CCYYMMDD TO DE-COMPARE1-DATE

                             SET DE-YYMMDD-FORMAT TO TRUE
                             MOVE WS-CALL-DATE TO DE-YYMMDD
                             PERFORM P8998-DATEEDIT
                             IF DE-COMPARE1-DATE > DE-CCYYMMDD
                                SET P08CA-ASGN-IS-BOTH (FUNC-SUB)
                                               TO TRUE
                                IF P08CA-EMP-NO(FUNC-SUB) =
                                   P08CA-REG-EMP-NO(FUNC-SUB)
                                   SET P08CA-TRK-NOT-QUALIFIED(FUNC-SUB)
                                               TO TRUE
                                END-IF
                                MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
                                IF PSTCA-SUB = 2
      *CNC0520-BEG
                                   MOVE 'EMPLOYEE NOT QUALIFIED USE FUNC
      -                                'TION "QUAL" FOR DETAILS'
                                               TO SCR08-PHONE(FUNC-SUB)
      *                            MOVE 'EMPLOYEE NOT QUALIFIED'
      *                                        TO SCR08-PHONE(FUNC-SUB)
                                ELSE
                                  MOVE 'EMPLOYEE NOT QUALIFIED USE FUNCT
      -                                'ION "QUAL" FOR DETAILS'
                                               TO SCR08-PHONE(FUNC-SUB)
      *                           STRING 'EMP NOT QUALIFIED - HAS '
      *                                   'RESTRICTION - ' QUALIFICATION
      *                                   ' - EXPIRES ' QUAL-DATE
      *                                    DELIMITED BY SIZE
      *                                    INTO SCR08-PHONE(FUNC-SUB)
      *CNC0520-END
                                END-IF
                                MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
      *CNC0572 - BEG
      ***                       MOVE 7 TO SUB1
                                MOVE 9 TO SUB1
      *CNC0572 - END
                                SET EMP-DISQUALIFIED TO TRUE
                             END-IF
                          ELSE
      *
      *                   IF THE EMPLOYEE HAS THE QUALIFICATION CODE,
      *                   AND THE QUALIFICATION HAS "EXPIRED", THE
      *                   EMPLOYEE CANNOT BE CALLED FOR THE ASSIGNMENT
      *
                             SET DE-YYMMDD-FORMAT TO TRUE
                             MOVE QUAL-DATE TO DE-YYMMDD
                             PERFORM P8998-DATEEDIT
                             MOVE DE-CCYYMMDD TO DE-COMPARE1-DATE

                             SET DE-YYMMDD-FORMAT TO TRUE
                             MOVE WS-CALL-DATE TO DE-YYMMDD
                             PERFORM P8998-DATEEDIT
                             IF DE-COMPARE1-DATE < DE-CCYYMMDD
                                SET P08CA-ASGN-IS-BOTH (FUNC-SUB)
                                               TO TRUE
                                IF P08CA-EMP-NO(FUNC-SUB) =
                                   P08CA-REG-EMP-NO(FUNC-SUB)
                                   SET P08CA-TRK-NOT-QUALIFIED(FUNC-SUB)
                                               TO TRUE
                                END-IF
                                MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
      *CNC0520-BEG
                                IF PSTCA-SUB = 2
                                   MOVE 'EMPLOYEE NOT QUALIFIED USE FUNC
      -                                'TION "QUAL" FOR DETAILS'
                                               TO SCR08-PHONE(FUNC-SUB)
      *                            MOVE 'EMPLOYEE NOT QUALIFIED'
      *                                        TO SCR08-PHONE(FUNC-SUB)
                                ELSE
                                   MOVE 'EMPLOYEE NOT QUALIFIED USE FUNC
      -                                'TION "QUAL" FOR DETAILS'
                                               TO SCR08-PHONE(FUNC-SUB)
      *                            STRING 'EMPLOYEE NOT QUALIFIED - '
      *                                    QUALIFICATION ' EXPIRED '
      *                                    QUAL-DATE
      *                                    DELIMITED BY SIZE
      *                                    INTO SCR08-PHONE(FUNC-SUB)
                                END-IF
      *CNC0520-END
      *CNC0572 - BEG
      ***                       MOVE 7 TO SUB1
                                MOVE 9 TO SUB1
      *CNC0572 - BEG
                                MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
                                SET EMP-DISQUALIFIED TO TRUE
                             END-IF
                          END-IF
                       ELSE
                          IF (NO-RECORD-FND OR END-OF-FILE)
      *
      *                   IF THE EMPLOYEE DOES NOT HAVE THE
      *                   QUALIFICATION, IF IT IS A "RESTRICTION" THEN
      *                   ALL IS OK, IF IT IS NOT A "RESTRICTION", THE
      *                   EMPLOYEE CANNOT BE CALLED FOR THE ASSIGNMENT
      *
                             IF NOT P08CA-ASGN-QUAL-RSTR(FUNC-SUB, SUB1)
                                SET P08CA-ASGN-IS-BOTH (FUNC-SUB)
                                                   TO TRUE
                                IF P08CA-EMP-NO(FUNC-SUB) =
                                   P08CA-REG-EMP-NO(FUNC-SUB)
                                   SET P08CA-TRK-NOT-QUALIFIED(FUNC-SUB)
                                               TO TRUE
                                END-IF
                                MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
      *CNC0520-BEG
                                IF PSTCA-SUB = 2
                                   MOVE 'EMPLOYEE NOT QUALIFIED USE FUNC
      -                                'TION "QUAL" FOR DETAILS'
                                               TO SCR08-PHONE(FUNC-SUB)
      *                            MOVE 'EMPLOYEE NOT QUALIFIED'
      *                                        TO SCR08-PHONE(FUNC-SUB)
                                ELSE
                                   MOVE 'EMPLOYEE NOT QUALIFIED USE FUNC
      -                               'TION "QUAL" FOR DETAILS'
                                               TO SCR08-PHONE(FUNC-SUB)
      *                            STRING 'EMPLOYEE NOT QUALIFIED - '
      *                                    QUALIFICATION
      *                                    DELIMITED BY SIZE
      *                                    INTO SCR08-PHONE(FUNC-SUB)
                                END-IF
      *CNC0520-END
                                MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
      *CNC0572 - BEG
      ***                       MOVE 7 TO SUB1
                                MOVE 9 TO SUB1
      *CNC0572 - END
                                SET EMP-DISQUALIFIED TO TRUE
                             END-IF
                          ELSE
                             MOVE 'P1040-10'   TO ERR-PARAGRAPH
                             MOVE QUALEMP      TO ERR-KEY
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                       END-IF
                    END-IF
                 END-PERFORM
              END-IF
      *CNC0520-BEG
              IF NOT EMP-DISQUALIFIED
                 MOVE SPACES                      TO WS-QUAL-FLAG
                 PERFORM P4000-CHECK-TERR-QUAL
              END-IF
      *CNC0520-END
      *       NOT ON REEDIT
              IF NOT WS-REEDIT-YES
                 PERFORM P1041-SETUP-NAME-LINE-CONT
              END-IF
           END-IF
           .
      *
       P1041-SETUP-NAME-LINE-CONT.
      *
      *
      *    SEE IF EMPLOYEE IS RESTRICTED FROM OR RESTRICTED TO WORKING
      *    THIS JOB USING THE NEW RESTRICTION CONTROL PROCESSING.(05R)
      *    IF RESTRICTED FROM THE EMPLOYEE CANNOT WORK, IF RESTRICTED
      *    TO THE EMPLOYEE CAN WORK OTHERWISE HE/SHE CANNOT WORK.
      *
              IF NOT EMP-DISQUALIFIED
                 MOVE SPACES                      TO P947-COMMAREA-PARMS
                 SET P947-EMP-RESTR-FUNCTION      TO TRUE
                 MOVE EMP-NBR OF WS-MSTR          TO P947-EMP-NO
                 IF UFP-CALL
                    SET P947-ASGN-UFP             TO TRUE
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO P947-ASGN-PARM
                 ELSE
                    SET P947-ASGN-AJ              TO TRUE
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO P947-ASGN-PARM
                 END-IF
                 SET P947-FROM-WORK               TO TRUE
                 EXEC CICS LINK
                          PROGRAM(P947-PGM)
                          COMMAREA(P947-COMMAREA-PARMS)
                          LENGTH(P947-LGTH)
                          RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE                TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P1040-11'              TO ERR-PARAGRAPH
                    MOVE 'LINK947'               TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 IF P947-RESTRICTED
                    SET P08CA-EMP-RESTRICTED(FUNC-SUB) TO TRUE
                    SET P08CA-ASGN-IS-BOTH (FUNC-SUB)  TO TRUE
                    IF P08CA-EMP-NO(FUNC-SUB) =
                       P08CA-REG-EMP-NO(FUNC-SUB)
                       SET P08CA-TRK-NOT-QUALIFIED(FUNC-SUB)  TO TRUE
                    END-IF
                    MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
                    IF PSTCA-SUB = 2
                       MOVE 'EMPLOYEE NOT QUALIFIED - HAS RESTRICTION'
                                               TO SCR08-PHONE(FUNC-SUB)
                    ELSE
                       MOVE 'EMPLOYEE NOT QUALIFIED - HAS RESTRICTION'
                                               TO SCR08-PHONE(FUNC-SUB)
                    END-IF
                    MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
                 END-IF
              END-IF
      *
      *  SEE IF THE EMPLOYEE HAS ANY OUTSTANDING TIMESLIPS IN THE
      *  SUSPENSE BUCKET, IF SO EMP IS NOT QUALIFIED
      *
              IF NOT P08CA-ASGN-SET(FUNC-SUB)
                 MOVE SPACES                      TO P980-COMMAREA-PARMS
                 SET P980-QUICKTIE-RESTRICT-FUNC  TO TRUE
                 MOVE EMP-NBR OF WS-MSTR          TO P980-EMP-NO
                 EXEC CICS LINK
                          PROGRAM(P980-PGM)
                          COMMAREA(P980-COMMAREA-PARMS)
                          LENGTH(P980-LGTH)
                          RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE                TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P1040-12'              TO ERR-PARAGRAPH
                    MOVE 'LINK980'               TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 IF P980-QUICKTIE-RESTRICTED
                    SET P08CA-EMP-RESTRICTED(FUNC-SUB) TO TRUE
                    SET P08CA-ASGN-IS-BOTH (FUNC-SUB)  TO TRUE
                    IF P08CA-EMP-NO(FUNC-SUB) =
                       P08CA-REG-EMP-NO(FUNC-SUB)
                       SET P08CA-TRK-QUICK-TIE(FUNC-SUB)  TO TRUE
                    END-IF
      *          MOVE 'QTIE'             TO SCR08-FUNC(FUNC-SUB)
      *          MOVE REV-VIDEO          TO SCR08-FUNC-HI(FUNC-SUB)
                 END-IF
              END-IF
      *
      *    SEE IF EMPLOYEE IS NOT QUALIFIED BECAUSE THE EMPLOYEE HAS
      *    MORE THAN 5 STARTS ACCUMULATED IN THE JOB CRAFT TYPE.
      *    ACCUMULATIONS ARE DONE BASED UPON THE COMBINE STARTS FLAG IN
      *    THE SUB-DISTRICT CNTL RECORD.  NOTE:  FOR UNASSIGNED
      *    YARDMASTERS, THE CNTL-OTHER-WORK-OK FLAG IS CHECKED FOR TRUE.
      *    WHEN IT IS TRUE AND THE EMPLOYEE IS NOT WORKING A YARDMASTER
      *    POSITION - STARTS WILL NOT BE EVALUATED.
      *
      *
              IF (NOT EMP-DISQUALIFIED AND
                 P08CA-ASGN-NO-VCNY(FUNC-SUB))
                 OR P08CA-ASGN-IS-BOTH(FUNC-SUB)
                 MOVE SPACES                  TO P931-COMMAREA-PARMS
                 SET P931-INQUIRY-FUN         TO TRUE
                 MOVE EMP-NBR IN WS-MSTR      TO P931-INQ-EMP-NO
                 SET P931-INQ-STARTS          TO TRUE
                 SET P931-CURRENT-PERIOD      TO TRUE
                 MOVE SCR08-CC(FUNC-SUB)      TO P931-INQ-CRAFT
                 EXEC CICS LINK
                          PROGRAM(P931-PGM)
                          COMMAREA(P931-COMMAREA-PARMS)
                          LENGTH(P931-LGTH)
                          RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE             TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P1040-13'           TO ERR-PARAGRAPH
                    MOVE 'P931LINK'           TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
      *       ADD P931-RET-CRAFT-STT, P931-RET-CRAFT-OVT GIVING
      *                                                  WS-STARTS-TOTAL
                 MOVE P931-RET-CRAFT-STT      TO WS-STARTS-TOTAL
                 IF WS-STARTS-TOTAL > WS-STARTS-DISQUALIFY
                    AND CNTL-VERIFY-STARTS-YES
                    MOVE WS-STARTS-TOTAL TO P08CA-STARTS-TOTAL(FUNC-SUB)
                    SET P08CA-STARTS-DISQUALIFIED(FUNC-SUB) TO TRUE
      *          SET EMP-DISQUALIFIED                    TO TRUE
      *          SET P08CA-ASGN-IS-VCNY(FUNC-SUB)        TO TRUE
                    SET P08CA-EMP-RESTRICTED(FUNC-SUB) TO TRUE
                    IF P08CA-ASGN-NO-VCNY(FUNC-SUB)
                       SET P08CA-ASGN-IS-BOTH (FUNC-SUB)  TO TRUE
                       IF P08CA-EMP-NO(FUNC-SUB) =
                          P08CA-REG-EMP-NO(FUNC-SUB)
                          SET P08CA-TRK-STARTS(FUNC-SUB) TO TRUE
                       END-IF
                    END-IF
                    MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
                    IF PSTCA-SUB = 2
                       MOVE '5 START WARNING' TO SCR08-PHONE(FUNC-SUB)
                    ELSE
                       MOVE '5 START WARNING' TO SCR08-PHONE(FUNC-SUB)
                    END-IF
                    MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
                 END-IF
              END-IF

      *    CHECK FOR ASSIGNED XB WARNING WHEN ORDER-TIME DOES NOT FALL
      *    WITHIN THE WINDOW OF AVAILABILITY.
      *
      *
              IF NOT EMP-DISQUALIFIED AND
                 P08CA-ASGN-XB-DISQUALIFIED(FUNC-SUB)
                 SET P08CA-EMP-RESTRICTED(FUNC-SUB) TO TRUE
                 SET P08CA-ASGN-IS-BOTH (FUNC-SUB)  TO TRUE
                 IF P08CA-EMP-NO(FUNC-SUB) =
                    P08CA-REG-EMP-NO(FUNC-SUB)
                    SET P08CA-TRK-ASGN-XB-WINDOW(FUNC-SUB) TO TRUE
                 END-IF
                 MOVE SPACES TO SCR08-PHONE(FUNC-SUB)
                 IF PSTCA-SUB = 2
                    MOVE 'S/B CALLED OUTSIDE WINDOW'
                                      TO SCR08-PHONE(FUNC-SUB)
                 ELSE
                    MOVE 'S/B CALLED OUTSIDE WINDOW'
                                      TO SCR08-PHONE(FUNC-SUB)
                 END-IF
                 MOVE YELLOW TO SCR08-PHONE-COL(FUNC-SUB)
              END-IF
      *
              MOVE SPACE TO WS-PAGER-GRACE-FL
              IF P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
                 MOVE P08CA-EMP-NO(FUNC-SUB) TO IER-EMP-NBR
                 PERFORM PSQL-IERSEL07
                 IF  SQL-SUCCESS
                 AND IER-STAT-CD = 'PG'
                    PERFORM P1047-PAGER-GRACE
                 END-IF
              END-IF
              IF WS-PAGER-GRACE
                 MOVE WS-PAGER-GRACE-LINE
                                      TO SCR08-PHONE(FUNC-SUB)
              END-IF
           .
      *
       P1042-GET-HST-KEY.
      *
           MOVE ZEROES                  TO HST-SEQ
           MOVE SPACES                  TO WS-HST-TABLE
                                           WORK-ASGNKEY2
           MOVE EMP-NBR OF WS-MSTR      TO WK-ASGN-EMP-NO
      *CNC0534 - BEG
      *    PERFORM PXXXX-JOB-OWNED
           PERFORM PXXXX-JOB-OWNED1
      *CNC0534 - END
           IF ASGN-ASSIGNMENT > SPACE
              MOVE ASGN-DIST            TO HST-DIST
              MOVE ASGN-SUB-DIST        TO HST-SUB-DIST
              EVALUATE TRUE
                 WHEN ASGN-JOB-TYPE = 'U'
                    MOVE 'U'            TO HST-ASGN-TYPE
                 WHEN ASGN-JOB-TYPE = 'X'
                    MOVE 'X'            TO HST-ASGN-TYPE
                 WHEN ASGN-JOB-TYPE = 'A'
                    MOVE AJ-JOB-ASSIGNMENT
                                        TO JOB-DEF-CHECK
                    IF JOB-DEF-YARDMASTER-ASGN
                       MOVE 'Y'         TO HST-ASGN-TYPE
                    ELSE
                       MOVE 'O'         TO HST-ASGN-TYPE
                    END-IF
              END-EVALUATE
              MOVE ASGN-AJ-JOB-NO       TO HST-ASGN-ID
           END-IF
           MOVE SPACES                  TO WORK-ASGNKEY2
           MOVE EMP-NBR OF WS-MSTR      TO WK-ASGN-EMP-NO
           PERFORM PXXXX-LATEST-TEMP-JOB
           IF ASGN-ASSIGNMENT > SPACE
              MOVE ASGN-DIST            TO HST-DIST
              MOVE ASGN-SUB-DIST        TO HST-SUB-DIST
              EVALUATE TRUE
                 WHEN ASGN-JOB-TYPE = 'U'
                    MOVE 'U'            TO HST-ASGN-TYPE
                 WHEN ASGN-JOB-TYPE = 'X'
                    MOVE 'X'            TO HST-ASGN-TYPE
                 WHEN ASGN-JOB-TYPE = 'A'
                    MOVE AJ-JOB-ASSIGNMENT
                                        TO JOB-DEF-CHECK
                    IF JOB-DEF-YARDMASTER-ASGN
                       MOVE 'Y'         TO HST-ASGN-TYPE
                    ELSE
                       MOVE 'O'         TO HST-ASGN-TYPE
                    END-IF
              END-EVALUATE
              MOVE ASGN-AJ-JOB-NO       TO HST-ASGN-ID
           END-IF
      *C841
           IF HST-KEY NOT > SPACES
              MOVE DIST      OF WS-MSTR TO HST-DIST
              MOVE SUB-DIST  OF WS-MSTR TO HST-SUB-DIST
           END-IF
      *
           PERFORM PSQL-HSTOPN02
           PERFORM PSQL-HSTFET02
           PERFORM PSQL-HSTCLO02
           IF HST-SEQ > ZERO
              MOVE HST-KEY              TO PS94-HST-KEY
           END-IF.
      *
       P1045-DISPLAY-PHONE-INFO.
      *
           MOVE SPACES             TO WS-TELEPHONE-NBRS
                                      WS-TELEPHONE-NBRS2
                                      PS52-COMMAREA-PARMS
      *#1505
                                      P08CA-NO-PHONE-FL(FUNC-SUB)
                                      SCR08-PHONE(FUNC-SUB)
           MOVE EMP-NBR OF WS-MSTR TO PS52-EMP-NBR
           SET PS52-CMA-MODE       TO TRUE
      *    IF PHONE-FUNCTION
      *       SET PS52-DISPLAY-ONLY TO TRUE
      *    END-IF
           MOVE WS-LOCAL-DATE-TIME TO PS52-INPUT-DATE-TIME
           PERFORM P8800-LINK-TO-PS52
           IF NOT SUCCESS
              MOVE 'P1045-1'       TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF

      *CNC0509
           PERFORM VARYING T FROM 1 BY 1 UNTIL T > 3
             IF PS52-PH-NUMBER(T) > SPACES
               MOVE PS52-PH-NUMBER(T) TO WS-TELEPHONE-NBR(T)
               MOVE WS-TELEPHONE-AREA(T)
                                       TO WS-TELEPHONE-AREA2(T)
               MOVE WS-TELEPHONE-PREFIX(T)
                                       TO WS-TELEPHONE-PREFIX2(T)
               MOVE WS-TELEPHONE-SUFFIX(T)
                                       TO WS-TELEPHONE-SUFFIX2(T)
               MOVE PS52-PH-COMMENT(T) TO WS-TELEPHONE-COMMENTS(T)
                                         WS-TELEPHONE-COMMENTS2(T)
               MOVE PS52-HOME-AWAY-CD(T) TO WS-TELEPHONE-CODE(T)
                                            WS-TELEPHONE-CODE2(T)
             END-IF
           END-PERFORM

           IF PS52-FCLTY-CD         > SPACES
              MOVE PS52-FCLTY-CD              TO WS-AFHT-FAC-CODE
              MOVE PS52-PH-EXT(1)             TO WS-AFHT-ROOM-NBR
      *       MOVE PS52-PH-NUMBER(1)          TO WS-AFHT-FAC-PHONE
              INITIALIZE WS-LVP-TABLE
              MOVE PS52-LDG-STN               TO LVP-LDG-STN
              MOVE PS52-FCLTY-CD              TO LVP-FCLTY-CD
              PERFORM PSQL-LVPSEL01
              IF SQL-SUCCESS
                 MOVE LVP-FCLTY-NM-TEXT       TO WS-AFHT-FAC-NAME
      *          MOVE LVP-SW-BRD-PHN-NBR      TO WS-AFHT-FAC-PHONE
              ELSE
                 MOVE 'UNABLE TO VERIFY AFHT' TO WS-AFHT-FAC-NAME
              END-IF

              IF PSTCA-SUB = 2
                 STRING '<<FCLTY: '
                        WS-AFHT-FAC-CODE '-'
                        WS-AFHT-FAC-NAME
                        ' '
                        PS52-PH-NUMBER(1)
                        ' PIECE:'
                        WS-AFHT-ROOM-NBR
                        ' >>'
                        DELIMITED BY SIZE
                        INTO SCR08-PHONE(FUNC-SUB)
              ELSE
                 STRING '<< FCLTY: '
                        WS-AFHT-FAC-CODE '-'
                        WS-AFHT-FAC-NAME
                        ' '
                        PS52-PH-NUMBER(1)
                        ' RM:'
                        WS-AFHT-ROOM-NBR
                        '>>'
                        DELIMITED BY SIZE
                        INTO SCR08-PHONE(FUNC-SUB)
              END-IF
           ELSE
              IF PS52-PAGER-NO > SPACES
                 IF PSTCA-SUB = 2
                    STRING '<< PIECE '
                           PS52-PAGER-NO
                           ' >>'
                           DELIMITED BY SIZE
                           INTO SCR08-PHONE(FUNC-SUB)
                 ELSE
                    STRING '<< ROOM '
                           PS52-PAGER-NO
                           ' >>'
                           DELIMITED BY SIZE
                           INTO SCR08-PHONE(FUNC-SUB)
                 END-IF
              ELSE
                 PERFORM VARYING T FROM 1 BY 1 UNTIL T > 3
                   IF PS52-PH-NUMBER(T) > SPACES
                     MOVE PS52-PH-NUMBER(T) TO WS-TELEPHONE-NBR(T)
                     MOVE WS-TELEPHONE-AREA(T)
                                             TO WS-TELEPHONE-AREA2(T)
                     MOVE WS-TELEPHONE-PREFIX(T)
                                             TO WS-TELEPHONE-PREFIX2(T)
                     MOVE WS-TELEPHONE-SUFFIX(T)
                                             TO WS-TELEPHONE-SUFFIX2(T)
                     MOVE PS52-PH-COMMENT(T) TO WS-TELEPHONE-COMMENTS(T)
                                               WS-TELEPHONE-COMMENTS2(T)
                     MOVE PS52-HOME-AWAY-CD(T) TO WS-TELEPHONE-CODE(T)
                                                  WS-TELEPHONE-CODE2(T)
                   END-IF
                 END-PERFORM
                 IF WS-TELEPHONE-NBRS2 > SPACES
                    MOVE WS-TELEPHONE-NBRS2 TO SCR08-PHONE(FUNC-SUB)
                 ELSE
                    MOVE 'EMPLOYEE HAS NO PHONE NUMBERS ON FILE'
                                           TO SCR08-PHONE(FUNC-SUB)
      *#1505
                    SET P08CA-NO-PHONE-YES(FUNC-SUB)   TO TRUE
                 END-IF
              END-IF
           END-IF
           .
      *
       P1046-COMPUTE-UNDIST-REST.
      *
           MOVE ZEROS               TO DATE-CONVERSION-PARMS
           SET PARM-SUBTRACT        TO TRUE
           MOVE WS-CALL-DATE        TO PARM-PRI-DATE-GREG
           MOVE WS-CALL-TIME        TO PARM-PRI-HRMN
           MOVE '0400'              TO PARM-SEC-HRMN
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P1046-1' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE PARM-RES-GREG-CENT  TO WS-CHECK-REST-CENT
           MOVE PARM-RES-DATE-GREG  TO WS-CHECK-REST-DATE
           MOVE PARM-RES-HRMN       TO WS-CHECK-REST-TIME.
      *
       P1047-PAGER-GRACE.
      *
      *    READ THE PHONE LOG (IEP) TO FIND THE LAST PAGED DTTM
      *    THE IER RECORD CONTAINS THE PAGER GRACE EXPIRED DTTM
           MOVE IER-EMP-NBR         TO IEP-EMP-NBR
           MOVE IER-TS              TO IEP-TS
      *    MOVE 'P'                 TO IEP-PHONE-NBR-TYP-CD
           MOVE '220'               TO IEP-RESULT-CD
      *    SELECT MAX ITEM FOR ALL = CONDITIONS ABOVE
           PERFORM PSQL-IEPSEL03
           IF SQL-SUCCESS
              SET WS-PAGER-GRACE    TO TRUE
              PERFORM PSQL-IEP-FORMAT-FROM-DB2
              MOVE IEP-CALL-TS-DT   TO WS-PG-LAST-DT
              MOVE IEP-CALL-TS-HR   TO WS-PG-LAST-HR
              MOVE IEP-CALL-TS-MN   TO WS-PG-LAST-MN
      *    THE IER RECORD CONTAINS THE PAGER GRACE EXPIRED DTTM
              MOVE IER-EXP-TS-DT    TO WS-PG-EXP-DT
              MOVE IER-EXP-TS-HR    TO WS-PG-EXP-HR
              MOVE IER-EXP-TS-MN    TO WS-PG-EXP-MN
           END-IF
           .
      *
       P1048-DISPLAY-SHORT-CALL.
      *
           MOVE SPACES                    TO SCR08-PHONE(FUNC-SUB)
      *    IF SCR08-FUNC(FUNC-SUB) NOT = 'QTIE'
              MOVE 'CBCK'                   TO SCR08-FUNC(FUNC-SUB)
              STRING 'SHORT CALL REQ: ENT KEY TO CBCK '
                     'OR TYPE V??? FOR IVR SHORT CALL'
                     DELIMITED BY SIZE
                     INTO SCR08-PHONE(FUNC-SUB)
      *    ELSE
      *       STRING 'SHORT CALL REQ: TYPE "CBCK" IN FUNC '
      *              'AND PRESS ENTER FOR CALLBACK '
      *              DELIMITED BY SIZE
      *              INTO SCR08-PHONE(FUNC-SUB)
      *    END-IF
           MOVE WS-ADJUSTED-DATE          TO SCR08-OD-DATE(FUNC-SUB)
           MOVE WS-ADJUSTED-TIME          TO SCR08-OD-TIME(FUNC-SUB)
           MOVE REV-VIDEO                 TO SCR08-FUNC-HI(FUNC-SUB)
                                             SCR08-OD-DATE-HI(FUNC-SUB)
                                             SCR08-OD-TIME-HI(FUNC-SUB)
           MOVE 'Y'                   TO P08CA-SAVE-CBCK-FLAG(FUNC-SUB)
      *    'SHORT CALL-ENTER KEY TO CALLBACK OR VCLL
      *                                        FOR IVR SHORT
           .
      *
       P1050-SETUP-NAME-LINEB.
      *
           PERFORM P8500-READ-MASTER
           MOVE EMP-NAME OF WS-MSTR TO SCR08-NAMEB(FUNC-SUB)
           IF IS-ON-REST-DAY
              MOVE 'RD'             TO SCR08-STB(FUNC-SUB)
              MOVE '  '             TO SCR08-ECCB(FUNC-SUB)
           ELSE
              MOVE LAYOFF-CODE      TO SCR08-STB(FUNC-SUB)
              MOVE '  '             TO SCR08-ECCB(FUNC-SUB)
              IF LAYOFF-EM-CODE > SPACES
                 MOVE LAYOFF-EM-CODE   TO SCR08-ECCB(FUNC-SUB)
              END-IF
           END-IF.
      *
       P1060-CLEAR-EMP-LINE.
      *
           MOVE SPACES TO SCR08-NAME(FUNC-SUB)
                          SCR08-ST(FUNC-SUB)
                          SCR08-ECC(FUNC-SUB)
                          SCR08-MTOD(FUNC-SUB)
                          SCR08-MTOD-PD(FUNC-SUB)
                          SCR08-HOME(FUNC-SUB)
                          SCR08-USHR(FUNC-SUB)
                          SCR08-USPD(FUNC-SUB)
                          SCR08-PERS(FUNC-SUB)
                          SCR08-PHONE(FUNC-SUB)
                          SCR08-NORM-ASG(FUNC-SUB)
           IF P08CA-ASGN-COLOR(FUNC-SUB) > SPACE
              MOVE P08CA-ASGN-COLOR(FUNC-SUB)
                 TO SCR08-PHONE-COL(FUNC-SUB)
           END-IF.
      *
       P1060-CLEAR-DATA-LINE.
      *
           PERFORM P1060-CLEAR-EMP-LINE
           MOVE SPACES   TO SCR08-TURN(FUNC-SUB)
                            SCR08-NAMEB(FUNC-SUB)
                            SCR08-STB(FUNC-SUB)
                            SCR08-ECCB(FUNC-SUB)
                            SCR08-FUNC(FUNC-SUB)
                            SCR08-SCHD-TYP(FUNC-SUB)
                            P08CA-SCREEN-ARRAY(FUNC-SUB)
                            P08CA-EMP-RESTR-FLAG(FUNC-SUB)
           IF SCR08-CC(FUNC-SUB) = 'CO'
              MOVE SPACE TO P08CA-COND-2BK-FLAG
           END-IF.
      *=================================================================
       P1070-RESET-COLORS.
      *=================================================================
           PERFORM VARYING SUB1 FROM 1 BY 1
              UNTIL SUB1 > ARRAY-MAX
              IF  NOT P08CA-ASGN-SET(SUB1)
              AND NOT P08CA-ASGN-IVR(SUB1)
                 MOVE DEFAULT-ATTR TO SCR08-FUNC-HI(SUB1)
                                      SCR08-NAME-HI(SUB1)
                                      SCR08-CC-HI(SUB1)
                                      SCR08-ST-HI(SUB1)
                                      SCR08-ECC-HI(SUB1)
                                      SCR08-PHONE-HI(SUB1)
              END-IF
              MOVE DEFAULT-ATTR    TO SCR08-OD-DATE-HI(SUB1)
                                      SCR08-OD-DATE-HI(SUB1)
                                      SCR08-TAXI-TM-HI(SUB1)
              IF P08CA-ASGN-COLOR(SUB1) > SPACE
                 MOVE P08CA-ASGN-COLOR(SUB1) TO SCR08-NAME-COL(SUB1)
                                                SCR08-CC-COL(SUB1)
                                                SCR08-NAMEB-COL(SUB1)
                                                SCR08-STB-COL(SUB1)
                                                SCR08-ECCB-COL(SUB1)
              END-IF
           END-PERFORM.
      *=================================================================
       P1080-CALC-EMP-OD-TIME.
      *
      *    SEE IF EMPLOYEES ON DUTY TIME NEEDS TO BE "ALTERED"
      *    BY AN AUTOMATIC INITIAL DEADHEAD TIME
      *
      *08/01/23 RJA B CNC0600 CNLD-270
           IF WS-CAN-WRR-FLAG NOT > SPACE
              MOVE WS-CNTL-FILE        TO WS-CNTL-FILE-HOLD
              MOVE SPACES              TO WORK-CNTLKEY
              MOVE '02'                TO WK-CNTL-REC-TYPE
              MOVE SCR08-DIST            TO WK-CNTL-DIST
              MOVE SCR08-SUB-DIST        TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P1080-2'        TO ERR-PARAGRAPH
                 MOVE WORK-CNTLKEY     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-CAN-WRR-FLAG   TO WS-CAN-WRR-FLAG
              MOVE CNTL-US-DOM         TO WS-US-DOM-FL
              MOVE WS-CNTL-FILE-HOLD   TO WS-CNTL-FILE
              MOVE CNTLKEY-AREA        TO WORK-CNTLKEY
           END-IF
           IF WS-CAN-WRR-NEW
              MOVE ZEROES TO DATE-CONVERSION-PARMS
              PERFORM P6040-GET-PREP-TIME
      *       MUST BE CALCULATED FOR EACH CRAFT AS SCHEDULES CAN VARY
              MOVE WS-CALC-OD-DATE     TO WS-PREP-OD-DATE
              MOVE WS-CALC-OD-TIME     TO WS-PREP-OD-TIME
           END-IF
      *08/01/23 RJA E CNC0600 CNLD-270

      *08/01/23 RJA B CNC0600 CNLD-270
      *    IF TRCN-INIT-DH-TIME > '0000'
           IF WS-TRCN-INIT-DH-TIME > '0000'
      *08/01/23 RJA E CNC0600 CNLD-270
      *08/01/23 RJA B CNC0600 CNLD-270
              IF SCR08-OD-DATE(FUNC-SUB) NOT > SPACES
      *08/01/23 RJA E CNC0600 CNLD-270
                 MOVE ZEROS TO DATE-CONVERSION-PARMS
                 SET PARM-SUBTRACT TO TRUE
      *08/01/23 RJA B CNC0600 CNLD-270
                 IF WS-PREP-OD-DATE  > SPACES AND
                    WS-CAN-WRR-NEW
                    MOVE WS-PREP-OD-DATE   TO PARM-PRI-DATE-GREG
                    MOVE WS-PREP-OD-TIME   TO PARM-PRI-HRMN
                 ELSE
                    MOVE WS-CALL-DATE      TO PARM-PRI-DATE-GREG
                    MOVE WS-CALL-TIME      TO PARM-PRI-HRMN
                 END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
      *08/01/23 RJA B CNC0600 CNLD-270
      *          MOVE TRCN-INIT-DH-TIME    TO PARM-SEC-HRMN
                 MOVE WS-TRCN-INIT-DH-TIME TO PARM-SEC-HRMN
      *08/01/23 RJA E CNC0600 CNLD-270
                 PERFORM P9700-LINK-P903
                 IF NOT SUCCESS
                    MOVE 'P1080-1' TO ERR-PARAGRAPH
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE PARM-RES-DATE-GREG   TO SCR08-OD-DATE(FUNC-SUB)
      *TJR 03/01/2001 SAVE TO THE COMMAREA
                                    P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                              WS-CALL-DATE
                 MOVE PARM-RES-HRMN        TO SCR08-OD-TIME(FUNC-SUB)
                                    P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                              WS-CALL-TIME
      *08/01/23 RJA B CNC0600 CNLD-270
              ELSE
                 MOVE SCR08-OD-DATE(FUNC-SUB)
                              TO P08CA-USER-ENTERED-DATE(FUNC-SUB)
                 MOVE SCR08-OD-TIME(FUNC-SUB)
                              TO P08CA-USER-ENTERED-TIME(FUNC-SUB)
              END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
           ELSE
              IF NOT P08CA-SETBACK-CALL
      *08/01/23 RJA B CNC0600        (13) CNLD-270
                IF SCR08-OD-DATE(FUNC-SUB) NOT > SPACES
      *08/01/23 RJA E CNC0600 CNLD-270
      *CNLD-244 #2 B - RPV1
                  IF WS-PREP-OD-DATE  > SPACES AND
      *08/01/23 RJA B CNC0600 CNLD-270
      *                 SCR08-OD-DATE(FUNC-SUB) NOT > SPACES AND
      *08/01/23 RJA E CNC0600 CNLD-270
                        WS-CAN-WRR-NEW
                    MOVE WS-PREP-OD-DATE  TO SCR08-OD-DATE(FUNC-SUB)
                                    P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
      *08/01/23 RJA B CNC0600 CNLD-270
                                 P08CA-USER-ENTERED-DATE(FUNC-SUB)
      *08/01/23 RJA E CNC0600 CNLD-270
                    MOVE WS-PREP-OD-TIME TO SCR08-OD-TIME(FUNC-SUB)
                                    P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
      *08/01/23 RJA B CNC0600 CNLD-270
                                 P08CA-USER-ENTERED-TIME(FUNC-SUB)
      *08/01/23 RJA E CNC0600 CNLD-270
                  ELSE
      *CNLD-244 #2 E - RPV1
                    MOVE WS-CALL-DATE TO SCR08-OD-DATE(FUNC-SUB)
                                    P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                    MOVE WS-CALL-TIME TO SCR08-OD-TIME(FUNC-SUB)
                                    P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
      *CNLD-244 #2 B - RPV1
                  END-IF
      *CNLD-244 #2 E - RPV1
      *08/01/23 RJA B CNC0600 CNLD-270
                ELSE
                   MOVE SCR08-OD-DATE(FUNC-SUB)
                                TO P08CA-USER-ENTERED-DATE(FUNC-SUB)
                   MOVE SCR08-OD-TIME(FUNC-SUB)
                                TO P08CA-USER-ENTERED-TIME(FUNC-SUB)
                END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
              ELSE
      *08/01/23 RJA B CNC0600 CNLD-270
      *          MOVE SCR08-OD-DATE(FUNC-SUB)
      *                       TO P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
      *                          P08CA-USER-ENTERED-DATE(FUNC-SUB)
      *          MOVE SCR08-OD-TIME(FUNC-SUB)
      *                       TO P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
      *                          P08CA-USER-ENTERED-TIME(FUNC-SUB)
                 IF SCR08-OD-DATE(FUNC-SUB) NOT > SPACES
                    IF WS-PREP-OD-DATE  > SPACES AND
                       WS-CAN-WRR-NEW
                       MOVE WS-PREP-OD-DATE  TO SCR08-OD-DATE(FUNC-SUB)
                                       P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                       P08CA-USER-ENTERED-DATE(FUNC-SUB)
                       MOVE WS-PREP-OD-TIME  TO SCR08-OD-TIME(FUNC-SUB)
                                       P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                       P08CA-USER-ENTERED-TIME(FUNC-SUB)
                    ELSE
                       MOVE WS-CALL-DATE TO SCR08-OD-DATE(FUNC-SUB)
                                       P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                       P08CA-USER-ENTERED-DATE(FUNC-SUB)
                       MOVE WS-CALL-TIME TO SCR08-OD-TIME(FUNC-SUB)
                                       P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                       P08CA-USER-ENTERED-TIME(FUNC-SUB)
                    END-IF
                 ELSE
                    MOVE SCR08-OD-DATE(FUNC-SUB)
                                 TO P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                    P08CA-USER-ENTERED-DATE(FUNC-SUB)
                    MOVE SCR08-OD-TIME(FUNC-SUB)
                                 TO P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                    P08CA-USER-ENTERED-TIME(FUNC-SUB)
                 END-IF
      *08/01/23 RJA E CNC0600 CNLD-270
              END-IF
           END-IF.
      *
       P1090-GET-JOB-QUALIFICATIONS.
      *
      *    SEE IF THE ASSIGNMENT HAS ANY QUALIFICATIONS SPECIFIC TO
      *    TO THE ASSIGNMENT (THIS WILL GET THE FIRST FIVE)
      *
           MOVE SPACES                        TO WORK-CNTLKEY
           MOVE '13'                          TO WK-CNTL-REC-TYPE
           IF UFP-CALL
              MOVE DIST2                      TO WK-CNTL-DIST
              MOVE SUB-DIST2                  TO WK-CNTL-SUB-DIST
              MOVE 'P'                        TO WK-CNTL-ASGN-QUAL-TYPE
              MOVE UFPTURN-5-12               TO WK-CNTL-ASGN-QUAL
              MOVE WK-CNTL-ASGN-QUAL-7-8      TO WS-CRAFT-BEFORE-WILD
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE '**'                    TO WK-CNTL-ASGN-QUAL-5-6
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE '**'                 TO WK-CNTL-ASGN-QUAL-3-4
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE '**'              TO WK-CNTL-ASGN-QUAL-7-8
                       PERFORM P8610-READ-CNTLFILE
                    END-IF
                 END-IF
              END-IF
           ELSE
              MOVE AJ-JOB-DIST                TO WK-CNTL-DIST
              MOVE AJ-JOB-SUB-DIST            TO WK-CNTL-SUB-DIST
              MOVE 'A'                        TO WK-CNTL-ASGN-QUAL-TYPE
              MOVE AJ-JOB-ASSIGNMENT          TO WK-CNTL-ASGN-QUAL
      *C945
              MOVE AJ-JOB-ASGN-CC             TO WS-CRAFT-BEFORE-WILD
      *
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE '**'                    TO WK-CNTL-ASGN-QUAL-5-6
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE '**'                 TO WK-CNTL-ASGN-QUAL-7-8
                    PERFORM P8610-READ-CNTLFILE
                 END-IF
              END-IF
           END-IF
           MOVE SPACES TO P08CA-ASGN-QUAL-AREA(FUNC-SUB)
           IF SUCCESS
              PERFORM VARYING SUB1 FROM 1 BY 1
                 UNTIL SUB1 > 5
                 IF CNTL-QUALIFICATION-TABLE-ENTRY(SUB1) > SPACE
                    MOVE CNTL-QUALIFICATION-TABLE-ENTRY(SUB1)
                      TO P08CA-ASGN-QUAL(FUNC-SUB, SUB1)
                 END-IF
              END-PERFORM
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P1090-1'     TO ERR-PARAGRAPH
                 MOVE WORK-CNTLKEY  TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
      *
      *    HERE WE GET THE "SIXTH" QUALIFICATION FROM THE ASSIGNMENT
      *    PROFILE RECORD
      *
           MOVE WS-TRCN-FILE        TO SAVE-TRCN-FILE
           MOVE P08CA-PROFILE-KEY   TO TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           MOVE WS-CRAFT-BEFORE-WILD  TO WS-HOLD-CC
           IF WS-HOLD-CC = 'FI' OR 'SE'
              MOVE 'SE'               TO WS-HOLD-CC
           END-IF
           IF WS-HOLD-CC = 'S1' OR 'S2'
              MOVE 'SW'               TO WS-HOLD-CC
           END-IF
      *C945
      *    IF WK-CNTL-ASGN-QUAL-7-8 = ('B1' OR 'B2')
           IF WS-HOLD-CC = 'B1' OR 'B2'
      *
              MOVE 'BK'               TO WS-HOLD-CC
           END-IF
      *CNC0572 - BEG
      ***  PERFORM VARYING SUBA FROM 1 BY 1 UNTIL SUBA > 4
      ***     IF WS-HOLD-CC = TRCN-SPCL-QUAL-CC(SUBA)
      ***        MOVE TRCN-SPCL-QUAL(SUBA)
      ***                           TO P08CA-ASGN-QUAL(FUNC-SUB, 6)
      ***     END-IF
      ***  END-PERFORM
      ******************************************************************
      *  EXPANDING P08CA-ASGN-QUAL-AREA TO HOLD '8' QUALIFICATIONS.    *
      *  POSITIONS 6, 7, 8 WILL HOLD ANY SPECIAL QUALIFICATIONS        *
      *  ASSIGNED TO A CRAFT. THE CREW PROFILE (CNP01T) WILL LIMIT 3   *
      *  SPCL QUALS PER CRAFT SO 8 IS THE MAX THE QUAL ARRAY WILL HOLD.*
      ******************************************************************
           MOVE 5                   TO SUBC
           PERFORM VARYING SUBA FROM 1 BY 1 UNTIL SUBA > 4
              IF WS-HOLD-CC = TRCN-SPCL-QUAL-CC(SUBA)
                 ADD 1              TO SUBC
                 IF SUBC < 9
                    MOVE TRCN-SPCL-QUAL(SUBA)
                                    TO P08CA-ASGN-QUAL(FUNC-SUB, SUBC)
                 END-IF
              END-IF
           END-PERFORM
           PERFORM VARYING SUBA FROM 1 BY 1 UNTIL SUBA > 4
              IF WS-HOLD-CC = TRCN-SPCL-QUAL2-CC(SUBA)
                 ADD 1              TO SUBC
                 IF SUBC < 9
                    MOVE TRCN-SPCL-QUAL2(SUBA)
                                    TO P08CA-ASGN-QUAL(FUNC-SUB, SUBC)
                 END-IF
              END-IF
           END-PERFORM
      *CNC0572 - END
           MOVE SAVE-TRCN-FILE      TO WS-TRCN-FILE.
      *
       P2000-PROCESS-FUNCTIONS.
      *
           MOVE SPACE               TO ERRORS-FOUND-CODE
                                       WS-FUNCTION-CODE
                                       WS-GOT-A-FUNC-FL
                                       WS-FROM-P2200-FLAG
      *CNC0520-BEG
           IF NOT YARD-CALL
             IF SCR08-ROUTE-DSGN > SPACES
                PERFORM P0317-EDIT-ROUTE-DSGN
             ELSE
                MOVE P08CA-PROFILE-KEY            TO TRCNKEY1
                PERFORM P8001-READ-TRCNKEY1-ONLY
                IF SUCCESS
                  MOVE TRCN-ROUTE-DESIGNATION    TO SCR08-ROUTE-DSGN
                END-IF
             END-IF
           END-IF
      *CNC0520-END
           MOVE P08CA-PROFILE-KEY   TO TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              MOVE SPACES           TO WS-REEDIT-FLAG
              SET  WS-LOCAL-ERT-NOT-SAVED   TO TRUE
              IF  NOT P08CA-ASGN-SET (FUNC-SUB)
              AND NOT P08CA-ASGN-IVR-CONTROL (FUNC-SUB)
              AND FUNC-SUB NOT = SAVE-SENR-SUB
              AND (   SCR08-FUNC (FUNC-SUB)                 > SPACES
                    OR  (     P08CA-ASGN-KEY (FUNC-SUB)     > SPACES
                          AND P08CA-DEC-KEY  (FUNC-SUB) NOT > SPACES))
                 MOVE SPACES       TO P08CA-SENR-RESTRICT-FLAG(FUNC-SUB)
                 MOVE DEFAULT-ATTR TO SCR08-FUNC-HI(FUNC-SUB)
                                      SCR08-NAME-HI(FUNC-SUB)
                                      SCR08-OD-DATE-HI(FUNC-SUB)
                                      SCR08-OD-TIME-HI(FUNC-SUB)
                                      SCR08-TAXI-TM-HI(FUNC-SUB)
                 MOVE SCR08-ORDER-DATE        TO WS-CALL-DATE
                 MOVE SCR08-ORDER-TIME        TO WS-CALL-TIME

      *          REVALIDATE TAXI TIME IF PRESENT
                 IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                    MOVE SCR08-TAXI-TM(FUNC-SUB)
                                             TO TE-MILITARY-TIME
                    SET TE-MILITARY-FORMAT         TO TRUE
                    PERFORM P8997-TIMEEDIT
                    IF TE-INVALID-TIME
                       MOVE -1        TO SCR08-TAXI-TM-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO
                                TO SCR08-TAXI-TM-HI(FUNC-SUB)
      *                INVALID-TIME-MSG
                       MOVE 'I022'          TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
      *
      *          TEST ONDUTY DATE/TIME AND TAXI TIME FOR CHANGES.
      *          IF CHANGED, SET REEDIT FLAG AND PERFORM P1040 P1011,
      *          AND P1010
                 IF (SCR08-OD-DATE(FUNC-SUB) > SPACES      AND
                     SCR08-OD-TIME(FUNC-SUB) > SPACES)
                     MOVE SCR08-OD-DATE(FUNC-SUB) TO DE-YYMMDD
                     SET DE-YYMMDD-FORMAT         TO TRUE
                     PERFORM P8998-DATEEDIT
                     IF DE-INVALID-DATE
                        MOVE -1 TO SCR08-OD-DATE-CURSOR(FUNC-SUB)
                        MOVE REV-VIDEO TO SCR08-OD-DATE-HI(FUNC-SUB)
      *                      INVALID-DATE-MSG
                        MOVE 'I034' TO MSGLOG-CODE
                        PERFORM P9000-SEND-MAP-AND-RETURN
                     END-IF
                     MOVE SCR08-OD-TIME(FUNC-SUB) TO TE-MILITARY-TIME
                     SET TE-MILITARY-FORMAT       TO TRUE
                     PERFORM P8997-TIMEEDIT
                     IF TE-INVALID-TIME
                        MOVE -1 TO SCR08-OD-TIME-CURSOR(FUNC-SUB)
                        MOVE REV-VIDEO TO SCR08-OD-TIME-HI(FUNC-SUB)
      *                      INVALID-TIME-MSG
                        MOVE 'I022' TO MSGLOG-CODE
                        PERFORM P9000-SEND-MAP-AND-RETURN
                     END-IF

                     MOVE ZEROES              TO DATE-CONVERSION-PARMS
                     SET PARM-DIFF            TO TRUE
                     MOVE SCR08-OD-DATE(FUNC-SUB) TO PARM-PRI-DATE-GREG
                     MOVE SCR08-OD-TIME(FUNC-SUB) TO PARM-PRI-HRMN
                     MOVE SCR08-ORDER-DATE        TO PARM-SEC-DATE-GREG
                     MOVE SCR08-ORDER-TIME        TO PARM-SEC-HRMN
                     PERFORM P9700-LINK-P903
                     IF NOT SUCCESS
                        MOVE 'P2000-1'        TO ERR-PARAGRAPH
                        PERFORM P9999-GOT-PROBLEM
                     END-IF
                     IF PARM-RES-TOT-DAYS > 0
                     OR PARM-RES-HRMN     > '1200'
                        MOVE -1 TO SCR08-OD-DATE-CURSOR(FUNC-SUB)
                        MOVE REV-VIDEO TO SCR08-OD-DATE-HI(FUNC-SUB)
                                          SCR08-OD-TIME-HI(FUNC-SUB)
      *         ILLOGICAL ON DUTY TIME WHEN COMPARED TO TRAIN ORDER TIME
                        MOVE 'I607' TO MSGLOG-CODE
                        PERFORM P9000-SEND-MAP-AND-RETURN
                     END-IF

                     IF (SCR08-OD-DATE(FUNC-SUB) NOT =
                         P08CA-SAVE-OD-DATE(FUNC-SUB) OR
                         SCR08-OD-TIME(FUNC-SUB) NOT =
                         P08CA-SAVE-OD-TIME(FUNC-SUB))

                         MOVE SCR08-FUNC(FUNC-SUB)  TO WS-FUNCTION-CODE
                         IF CALL-FUNCTION
                         OR IVR-CALL-FUNCTION
                         OR FILL-VACANCY-FUNCTION
                         OR CALL-BACK
                         OR REJECT-TURN
                            MOVE SCR08-OD-DATE(FUNC-SUB)
                                 TO P08CA-SAVE-OD-DATE(FUNC-SUB)
      *                             P08CA-USER-ENTERED-DATE(FUNC-SUB)
                            MOVE SCR08-OD-TIME(FUNC-SUB)
                                 TO P08CA-SAVE-OD-TIME(FUNC-SUB)
      *                             P08CA-USER-ENTERED-TIME(FUNC-SUB)
                         END-IF
                         IF P08CA-EMP-NO(FUNC-SUB) > SPACES
                            IF CALL-BACK
                            OR P08CA-SAVE-CBCK-FLAG(FUNC-SUB) = 'Y'
                               CONTINUE
                            ELSE
                               SET WS-REEDIT-YES         TO TRUE
                            END-IF
                         END-IF
                     END-IF
                 END-IF
                 IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                    IF (SCR08-TAXI-TM(FUNC-SUB) =
                                           P08CA-SAVE-TAXI-TM(FUNC-SUB))
      *#1466
                    OR (SCR08-TAXI-TM(FUNC-SUB) = SPACES
                      AND P08CA-SAVE-TAXI-TM(FUNC-SUB) = 'SPAC')
                       CONTINUE
                    ELSE
                       MOVE SCR08-FUNC(FUNC-SUB)  TO WS-FUNCTION-CODE
                       IF CALL-FUNCTION
                       OR IVR-CALL-FUNCTION
                       OR FILL-VACANCY-FUNCTION
                       OR CALL-BACK
                       OR REJECT-TURN
      *#1466
                          IF SCR08-TAXI-TM(FUNC-SUB) > SPACES
                             MOVE SCR08-TAXI-TM(FUNC-SUB)
                                         TO P08CA-SAVE-TAXI-TM(FUNC-SUB)
                          ELSE
                             MOVE 'SPAC' TO P08CA-SAVE-TAXI-TM(FUNC-SUB)
                          END-IF
                       END-IF
                       IF P08CA-EMP-NO(FUNC-SUB) > SPACES
                          IF CALL-BACK
                          OR P08CA-SAVE-CBCK-FLAG(FUNC-SUB) = 'Y'
                             CONTINUE
                          ELSE
                             SET WS-REEDIT-YES         TO TRUE
                          END-IF
                       END-IF
                    END-IF
                 END-IF
                 IF WS-REEDIT-YES
                    MOVE P08CA-EMP-NO(FUNC-SUB) TO EMP-NBR OF WS-MSTR
                                                   MSTRNBRK
                    MOVE SCR08-OD-DATE(FUNC-SUB) TO WS-CALL-DATE
                    MOVE SCR08-OD-TIME(FUNC-SUB) TO WS-CALL-TIME
                    IF CALL-FUNCTION
                    OR IVR-CALL-FUNCTION
      *C904
                       MOVE SCR08-FUNC(FUNC-SUB) TO WS-SAVE-FUNC
      *
                       PERFORM P1040-SETUP-NAME-LINE
                       PERFORM P1011-CHCK-FILLED-US-EMP
                       MOVE P08CA-VCNY-FLAG(FUNC-SUB)   TO WS-VCNY-FLAG
                       SET P08CA-ASGN-NO-VCNY(FUNC-SUB) TO TRUE
                       PERFORM P1010-TEST-OWNER
                       MOVE WS-VCNY-FLAG TO P08CA-VCNY-FLAG(FUNC-SUB)
      *C904
                       IF SCR08-FUNC(FUNC-SUB) = 'HOUR'
                          MOVE WS-SAVE-FUNC TO SCR08-FUNC(FUNC-SUB)
                       END-IF
      *
                    END-IF
                 END-IF
      *
                 IF SCR08-OD-DATE(FUNC-SUB) NOT > SPACES
                    MOVE WS-CALL-DATE         TO SCR08-OD-DATE(FUNC-SUB)
                    MOVE WS-CALL-TIME         TO SCR08-OD-TIME(FUNC-SUB)
                 ELSE
                    IF SCR08-OD-DATE(FUNC-SUB) NOT = WS-CALL-DATE
                    OR SCR08-OD-TIME(FUNC-SUB) NOT = WS-CALL-TIME
                       MOVE SCR08-OD-DATE(FUNC-SUB) TO DE-YYMMDD
                       SET DE-YYMMDD-FORMAT         TO TRUE
                       PERFORM P8998-DATEEDIT
                       IF DE-INVALID-DATE
                          MOVE -1 TO SCR08-OD-DATE-CURSOR(FUNC-SUB)
                          MOVE REV-VIDEO TO SCR08-OD-DATE-HI(FUNC-SUB)
      *                        INVALID-DATE-MSG
                          MOVE 'I034' TO MSGLOG-CODE
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       END-IF
                       MOVE SCR08-OD-TIME(FUNC-SUB) TO TE-MILITARY-TIME
                       SET TE-MILITARY-FORMAT       TO TRUE
                       PERFORM P8997-TIMEEDIT
                       IF TE-INVALID-TIME
                          MOVE -1 TO SCR08-OD-TIME-CURSOR(FUNC-SUB)
                          MOVE REV-VIDEO TO SCR08-OD-TIME-HI(FUNC-SUB)
      *                        INVALID-TIME-MSG
                          MOVE 'I022' TO MSGLOG-CODE
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       END-IF
                       MOVE SCR08-OD-DATE(FUNC-SUB) TO WS-CALL-DATE
                       MOVE SCR08-OD-TIME(FUNC-SUB) TO WS-CALL-TIME
                       SET DETAIL-CALL-CHECK TO TRUE
                       PERFORM P1030-EDIT-CALL-DATE
                       IF ERRORS-FOUND
                          MOVE -1    TO SCR08-OD-DATE-CURSOR(FUNC-SUB)
                          MOVE REV-VIDEO TO SCR08-OD-DATE-HI(FUNC-SUB)
                                            SCR08-OD-TIME-HI(FUNC-SUB)
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       END-IF
                    END-IF

      *TJR 03/01/2001 THIS IS WHERE WE COMPARE THE SCREEN VALUE TO
      *               THE SAVED SCREEN VALUE, AND IF DIFF, THE USER
      *               HAD CHANGED THE SCREEN, OR WE DID IT FOR HIM,
      *               SO SAVE IT IN THE USER ENTERED FIELD FOR LATER

                    IF (SCR08-OD-DATE(FUNC-SUB) > SPACES      AND
                        SCR08-OD-TIME(FUNC-SUB) > SPACES)
                        IF (SCR08-OD-DATE(FUNC-SUB) NOT =
                            P08CA-SCREEN-SAVED-DATE(FUNC-SUB) OR
                            SCR08-OD-TIME(FUNC-SUB) NOT =
                            P08CA-SCREEN-SAVED-TIME(FUNC-SUB))

                            MOVE SCR08-FUNC(FUNC-SUB)    TO
                                 WS-FUNCTION-CODE
                            IF CALL-BACK
                               AND P08CA-EMP-NO(FUNC-SUB) > SPACES
                               PERFORM P2040-CALCULATE-SHORT-LEAD
                            END-IF
                            MOVE SCR08-OD-DATE(FUNC-SUB) TO
                                 P08CA-USER-ENTERED-DATE(FUNC-SUB)
                                 P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                            MOVE SCR08-OD-TIME(FUNC-SUB) TO
                                 P08CA-USER-ENTERED-TIME(FUNC-SUB)
                                 P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                        END-IF
                    END-IF
                 END-IF
              END-IF

              IF  SCR08-FUNC(FUNC-SUB) > SPACES
              AND NOT P08CA-ASGN-SET(FUNC-SUB)
              AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
              AND FUNC-SUB NOT = SAVE-SENR-SUB
                 PERFORM P2010-VALIDATE-FUNCTION
                 SET WS-GOT-A-FUNC TO TRUE
                 IF UFP-CALL
                    IF SCR08-CC(FUNC-SUB) =
                       ('EN' OR 'FI' OR 'SE' OR 'ET')
                       MOVE SPACES                   TO WORK-CNTLKEY
                       MOVE TRCN-EN-FROM-DIST        TO WK-CNTL-DIST
                       MOVE TRCN-EN-FROM-SDIST       TO WK-CNTL-SUB-DIST
                       MOVE TRCN-EN-FROM-POOL        TO WK-CNTL-POOL
                       IF NOT (P08CA-NO-SCHED(FUNC-SUB)
      *CNC0499 - 11/21/16 - BEG
                          OR P08CA-SCHED-BIDPACK(FUNC-SUB)
      *CNC0499 - 11/21/16 - END
                          OR P08CA-SCHED-COMPLETE(FUNC-SUB))
                          IF P08CA-SCHED-ALT(FUNC-SUB)
      *CNC0499 - 02/17/17 - BEG
                          OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
      *CNC0499 - 02/17/17 - END
                             MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                                     TO WK-CNTL-DIST
                             MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                             MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                                     TO WK-CNTL-POOL
                          ELSE
                             MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                                     TO WK-CNTL-DIST
                             MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                             MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                                     TO WK-CNTL-POOL
                          END-IF
                       END-IF
                       PERFORM P0370-SET-EN-MARRIED-FLAGS
                    ELSE
                       MOVE SPACES                TO WORK-CNTLKEY
                       MOVE TRCN-TR-FROM-DIST     TO WK-CNTL-DIST
                       MOVE TRCN-TR-FROM-SDIST    TO WK-CNTL-SUB-DIST
                       MOVE TRCN-TR-FROM-POOL     TO WK-CNTL-POOL
                       IF NOT (P08CA-NO-SCHED(FUNC-SUB)
      *CNC0499 - 11/21/16 - BEG
                       OR P08CA-SCHED-BIDPACK(FUNC-SUB)
      *CNC0499 - 11/21/16 - END
                       OR P08CA-SCHED-COMPLETE(FUNC-SUB))
                          IF P08CA-SCHED-ALT(FUNC-SUB)
      *CNC0499 - 02/17/17 - BEG
                          OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
      *CNC0499 - 02/17/17 - END
                             MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                                     TO WK-CNTL-DIST
                             MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                             MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                                     TO WK-CNTL-POOL
                          ELSE
                             MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                                     TO WK-CNTL-DIST
                             MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                             MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                                     TO WK-CNTL-POOL
                          END-IF
                       END-IF
                       PERFORM P0380-SET-TR-MARRIED-FLAGS
                    END-IF
                    PERFORM P0390-SETUP-ASSOC-CRAFTS
                 END-IF
                 PERFORM P5200-SAVE-ASGN-KEY
                 EVALUATE TRUE
                    WHEN CALL-FUNCTION
                       PERFORM P2100-PROCESS-CALL-FUNCTION
                    WHEN IVR-CALL-FUNCTION
                       PERFORM P5100-PROCESS-IVR-CALL
                    WHEN VACATE-FUNCTION
                       PERFORM P2100-PROCESS-CALL-FUNCTION
                    WHEN REJECT-HRS-SERVICE
                       PERFORM P2960-REJECT-HRS-SVC
                    WHEN FILL-VACANCY-FUNCTION
                       MOVE SPACES           TO P923-COMMAREA-PARMS
                       PERFORM P2200-PROCESS-FILL-FUNCTION
                    WHEN LAYOFF-ON-CALL
                       PERFORM P2300-PROCESS-LAYOFF
                    WHEN DROP-TURN
                       PERFORM P2400-PROCESS-DROP-REJT
                    WHEN REJECT-TURN
                       PERFORM P2400-PROCESS-DROP-REJT
                    WHEN USER-OVERRIDE
                       PERFORM P2500-PROCESS-OVERRIDE
                    WHEN SENIOR-MAN-FUNCTION
                       PERFORM P2600-GET-SENIOR-MAN
                    WHEN DCAN-TURN
                       PERFORM P2700-PROCESS-DCAN
                    WHEN PHONE-FUNCTION
                       PERFORM P2800-DISPLAY-PHONE-NUMBERS
                    WHEN ATTEMPTED-NOTIFY
                       PERFORM P2900-ATTEMPTED-NOTIFY
                    WHEN QTIE-NON-FUNCTION
                          CONTINUE
                    WHEN HOUR-NON-FUNCTION
                          CONTINUE
                    WHEN DISPLAY-HRS-SVC-INFO
                       PERFORM P2970-DISPLAY-HRS-SVC-INFO
                    WHEN CALL-BACK
                       PERFORM P2980-CREATE-CALLBACK-TASK
                    WHEN SET-BACK
                       PERFORM P2990-CREATE-SETBACK-TASK
                    WHEN DISPLAY-HOS-INFO
                       PERFORM P2995-DISPLAY-HOS-INFO
      *CNC0520-BEG
                    WHEN QUAL-FUNC
                       PERFORM P3000-DISPLAY-QUAL-INFO
      *CNC0520-END
      *CNC0600-B
                    WHEN HOS-OVERRIDE-FUNC
                       PERFORM P3100-PROCESS-HOS-OVRD
      *CNC0600-E
                    WHEN OTHER
                       SET ERRORS-FOUND TO TRUE
                       MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                     'FUNCTION NOT YET AVAILABLE'
                       MOVE 'F003' TO MSGLOG-CODE
                       MOVE ARRAY-MAX TO FUNC-SUB
                 END-EVALUATE
                 IF  NOT CALL-FUNCTION
                 AND NOT IVR-CALL-FUNCTION
                    MOVE SPACES        TO P08CA-EMP-RESTR-FLAG(FUNC-SUB)
                 END-IF
              ELSE
                 IF NOT P08CA-ASGN-SET(FUNC-SUB)
                    IF  P08CA-ASGN-KEY(FUNC-SUB)        > SPACES
                    AND (    P08CA-EMP-NO(FUNC-SUB)     > '000000000'
                          OR P08CA-REG-EMP-NO(FUNC-SUB) > '000000000')
                    AND P08CA-DEC-KEY(FUNC-SUB)     NOT > SPACES
                       MOVE SPACES TO P08CA-SENR-RESTRICT-FLAG(FUNC-SUB)
                       IF (     P08CA-ASGN-IS-VCNY(FUNC-SUB)
                            AND SCR08-STB(FUNC-SUB)    =     'NR'   )
                       OR (     P08CA-ASGN-NO-VCNY(FUNC-SUB)
                            AND SCR08-ST(FUNC-SUB)     NOT > SPACES )
                       OR (     P08CA-ASGN-IS-BOTH(FUNC-SUB)
                            AND SCR08-ST(FUNC-SUB)     =     'NR'   )
      *C947-1 START
                       OR (     P08CA-ASGN-IS-BOTH(FUNC-SUB)
                            AND SCR08-ST(FUNC-SUB)     NOT > SPACES )
      *C947-1 END
      *CNC0520-BEG
                       OR (     P08CA-ASGN-NO-VCNY(FUNC-SUB)
                            AND SCR08-ST(FUNC-SUB)     =     'NR'
                            AND PSTCA-FROM-PROGRAM-2   = P08F-PGM   )
                       OR (     P08CA-ASGN-IS-VCNY(FUNC-SUB)
                            AND PSTCA-FROM-PROGRAM-2   = P08F-PGM   )
                       OR (     P08CA-ASGN-IS-BOTH(FUNC-SUB)
                            AND PSTCA-FROM-PROGRAM-2   = P08F-PGM   )
      *CNC0520-END
      *CNC0499 - 12/14/16 - BEG
                          IF UFP-CALL
                             PERFORM P2050-SET-MARRIED-FLAGS
                             IF (WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                             AND ASSOCIATED-OPT-TURN
                             AND NOT P08CA-ASGN-IS-VCNY(FUNC-SUB))
                                CONTINUE
                             ELSE
                                MOVE SPACES TO P08CA-VCNY-FLAG(FUNC-SUB)
                                               SCR08-NAMEB(FUNC-SUB)
                                               SCR08-STB(FUNC-SUB)
                                               SCR08-ECCB(FUNC-SUB)
                             END-IF
                          ELSE
                             MOVE SPACES    TO P08CA-VCNY-FLAG(FUNC-SUB)
                                               SCR08-NAMEB(FUNC-SUB)
                                               SCR08-STB(FUNC-SUB)
                                               SCR08-ECCB(FUNC-SUB)
                          END-IF
      *CNC0499 - 12/14/16 - END
                          IF P08CA-EMP-NO(FUNC-SUB) > '000000000'
                             MOVE P08CA-EMP-NO(FUNC-SUB)
                                              TO MSTRNBRK
                          ELSE
                             MOVE P08CA-REG-EMP-NO(FUNC-SUB)
                                              TO MSTRNBRK
                          END-IF
                          IF P08CA-EMP-NO(FUNC-SUB) =
                             P08CA-REG-EMP-NO(FUNC-SUB)
                             MOVE SPACES   TO P08CA-TRK-REASON(FUNC-SUB)
                          END-IF
      * #1529S
                          IF YARD-CALL
                             PERFORM P8500-READ-MASTER
                             PERFORM P1010-TEST-OWNER
                          ELSE
                             PERFORM P1040-SETUP-NAME-LINE
                             PERFORM P1010-TEST-OWNER
                          END-IF
      * 03/23/11 JES
                          IF P08CA-ASGN-IS-VCNY(FUNC-SUB)
                             MOVE SPACES      TO P08CA-EMP-NO(FUNC-SUB)
                             IF YARD-CALL
                                MOVE EMP-NAME OF WS-MSTR
                                              TO SCR08-NAMEB(FUNC-SUB)
                             ELSE
                                MOVE SCR08-NAME(FUNC-SUB)
                                              TO SCR08-NAMEB(FUNC-SUB)
                             END-IF
                             MOVE SCR08-ST(FUNC-SUB)
                                              TO SCR08-STB(FUNC-SUB)
                             MOVE SCR08-ECC(FUNC-SUB)
                                              TO SCR08-ECCB(FUNC-SUB)
                             PERFORM P1060-CLEAR-EMP-LINE
                             IF UFP-BLANK-TURN
                                MOVE WS-DISCONT-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                             ELSE
                                MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                             END-IF
                          ELSE
                             IF P08CA-NOT-RESTED    (FUNC-SUB) AND
                                P08CA-SAVE-CBCK-FLAG(FUNC-SUB) NOT = 'Y'
                                IF YARD-CALL
                                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                              TO TRUE
                                   MOVE SPACES
                                               TO P08CA-EMP-NO(FUNC-SUB)
                                   MOVE EMP-NAME OF WS-MSTR
                                              TO SCR08-NAMEB(FUNC-SUB)
                                   MOVE SCR08-ST(FUNC-SUB)
                                              TO SCR08-STB(FUNC-SUB)
                                   MOVE SCR08-ECC(FUNC-SUB)
                                              TO SCR08-ECCB(FUNC-SUB)
                                   PERFORM P1060-CLEAR-EMP-LINE
                                   MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                                END-IF
                             ELSE
                                IF YARD-CALL
                                   PERFORM P1040-SETUP-NAME-LINE
                                END-IF
                             END-IF
                          END-IF
                       END-IF
                    ELSE
      *C844
                       IF  P08CA-ASGN-KEY(FUNC-SUB) > SPACES
                       AND P08CA-EMP-NO(FUNC-SUB)   > '000000000'
                       AND P08CA-DEC-KEY(FUNC-SUB)  > SPACES
                       AND NOT P08CA-ASGN-NO-VCNY(FUNC-SUB)
                           MOVE P08CA-EMP-NO(FUNC-SUB) TO MSTRNBRK
                           PERFORM P8500-READ-MASTER
      *CNC0520-BEG
                           MOVE SCR08-ORDER-DATE TO WS-CALL-DATE
                           MOVE SCR08-ORDER-TIME TO WS-CALL-TIME
                           PERFORM P1040-SETUP-NAME-LINE
      *CNC0520-END
                           PERFORM P1011-CHCK-FILLED-US-EMP
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-PERFORM
           IF NOT ERRORS-FOUND
      *    AND P923-ERRORMSG      NOT > SPACES
      *       IF WS-FUNCTION-CODE NOT > SPACES
              IF NOT WS-GOT-A-FUNC
      *               'NO FUNCTION(S) SELECTED'
                 MOVE 'N004' TO MSGLOG-CODE
                 PERFORM VARYING FUNC-SUB FROM 1 BY 1
                    UNTIL FUNC-SUB > ARRAY-MAX
                    IF P08CA-ASGN-KEY(FUNC-SUB) >     SPACES
                    OR (     SCR08-CC(FUNC-SUB) >     SPACES
                         AND SCR08-CC(FUNC-SUB) NOT = 'ET'
                         AND SCR08-CC(FUNC-SUB) NOT = 'TT')
                       IF  NOT P08CA-ASGN-SET(FUNC-SUB)
                       AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
                          MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                          MOVE ARRAY-MAX TO FUNC-SUB
                       END-IF
                    ELSE
                       IF FUNC-SUB = ARRAY-MAX
                          IF YARD-CALL
                             MOVE -1 TO SCR08-FUNC-CURSOR(1)
                          ELSE
                             MOVE -1 TO SCR08-CALL-COMPLETE-CURSOR
                          END-IF
                       END-IF
                    END-IF
                 END-PERFORM
              ELSE
                 IF SCR08-ERRORMSG NOT > SPACES
      *                  'PROCESSING COMPLETE'
                    MOVE 'P005' TO MSGLOG-CODE
                 END-IF
      *CNC0520-BEG
                 PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END
              END-IF
           END-IF
           IF P08CA-SETBACK-CALL
              MOVE SPACES                     TO P08CA-SETBACK-CALL-FLAG
              MOVE P08CA-TASK-KEY             TO TASK-EFF-TIME-KEY
                                                 TOC-TASK-KEY
              PERFORM P8665-DELETE-TASK
              IF NOT (SUCCESS OR NO-RECORD-FND)
                 MOVE 'P2000-D'               TO ERR-PARAGRAPH
                 MOVE TASKTIME                TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              PERFORM PSQL-TOCDEL01
           END-IF
           .
      *
       P2010-VALIDATE-FUNCTION.
      *
           IF P08CA-ASGN-IVR-XFER(FUNC-SUB)
            AND SCR08-FUNC(FUNC-SUB) > SPACES
              MOVE SCR08-FUNC(FUNC-SUB)   TO WS-FUNCTION-CODE
              IF CALL-FUNCTION
              OR REJECT-TURN
              OR DROP-TURN
              OR REJECT-EMPLOYEE-FUNCTION
              OR LAYOFF-ON-CALL
                 SET WS-IVR-CANCEL-ALLOWED TO TRUE
              ELSE
                 IF NOT ATTEMPTED-NOTIFY
                    MOVE -1             TO SCR08-FUNC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO      TO SCR08-FUNC-HI(FUNC-SUB)
      *              'INVALID FUNCTION FOR TURN RETURNED FROM VRU'
                    MOVE 'I596'            TO MSGLOG-CODE
      *             SET PROCESS-ERROR(FUNC-SUB) TO TRUE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 ELSE
                    SET WS-IVR-CANCEL-NOT-ALLOWED TO TRUE
                 END-IF
              END-IF
           ELSE
              SET WS-IVR-CANCEL-NOT-ALLOWED TO TRUE
           END-IF

           PERFORM VARYING SUB1 FROM 1 BY 1
              UNTIL SUB1 > WS-FUNCTION-TABLE-SIZE
              IF WS-FUNC-CODE(SUB1) = SCR08-FUNC(FUNC-SUB)
                 IF  (P08CA-IVR-CALL-ACTIVE
                 AND ((YARD-CALL         AND IVR-YARD-USAGE (SUB1))
                  OR  (LOCAL-CALL        AND IVR-LOCAL-USAGE(SUB1))
                  OR  (UFP-CALL          AND IVR-UFP-USAGE  (SUB1))
                  OR  (ROAD-SERVICE-CALL AND IVR-ROAD-USAGE (SUB1))))
                  OR (YARD-CALL          AND YARD-USAGE     (SUB1))
                  OR (LOCAL-CALL         AND LOCAL-USAGE    (SUB1))
                  OR (UFP-CALL           AND UFP-USAGE      (SUB1))
                  OR (ROAD-SERVICE-CALL  AND ROAD-USAGE     (SUB1))
                    MOVE WS-FUNC-CODE(SUB1) TO WS-FUNCTION-CODE
                    MOVE WS-FUNCTION-TABLE-SIZE TO SUB1
                 ELSE
                    SET ERRORS-FOUND TO TRUE
                 END-IF
              ELSE
                 IF SUB1 = WS-FUNCTION-TABLE-SIZE
                    SET ERRORS-FOUND TO TRUE
                 END-IF
              END-IF
           END-PERFORM
           IF ERRORS-FOUND
              OR REJECT-EMPLOYEE-FUNCTION
              SET FIND-MC-CODE       TO TRUE
              IF REJECT-EMPLOYEE-FUNCTION
      *#1469
                 IF (P08CA-ASGN-IS-VCNY(FUNC-SUB)
                    AND P08CA-EMP-NO(FUNC-SUB) NOT NUMERIC)
                    OR P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
                    MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *                  'IMPROPER FUNCTION FOR A "VACANCY"'
                    MOVE 'I054' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 PERFORM P2015-CHECK-MISSED-CALL-TABLE
              END-IF
              IF FIND-MC-CODE
                 PERFORM VARYING WS-MC-SUB FROM 1 BY 1
                    UNTIL WS-MC-SUB > WS-MC-MAX
                    IF WS-MISS-CALL-CODE(WS-MC-SUB)
                                                = SCR08-FUNC(FUNC-SUB)
                       AND SCR08-FUNC(FUNC-SUB) > SPACE
                       MOVE '0'      TO ERRORS-FOUND-CODE
                       SET MISSING-CALL TO TRUE
                       MOVE WS-MC-MAX TO WS-MC-SUB
                    END-IF
                 END-PERFORM
              END-IF
           END-IF
      *CNC0600-B
           MOVE SPACES                  TO WORK-CNTLKEY
           MOVE '02'                    TO WK-CNTL-REC-TYPE
           MOVE SCR08-DIST              TO WK-CNTL-DIST
           MOVE SCR08-SUB-DIST          TO WK-CNTL-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P2010-1'            TO ERR-PARAGRAPH
              MOVE CNTLKEY              TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE CNTL-CAN-WRR-FLAG       TO WS-CAN-WRR-FLAG
      *CNLD-265-B
           MOVE CNTL-US-DOM             TO WS-US-DOM-FL
      *CNLD-265-E

           IF WS-CAN-WRR-NEW AND SCR08-FUNC(FUNC-SUB) = 'RJHS'
              MOVE -1                   TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO            TO SCR08-FUNC-HI(FUNC-SUB)
      *             'RJHS NOT ALLOWED WITH NEW CANADIAN WORK REST RULES'
              MOVE 'R135'               TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           IF MISSING-CALL AND P08CA-HOSO-ALLOW(FUNC-SUB)
              AND NOT P08CA-HOSO-DONE(FUNC-SUB)
              MOVE -1                   TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO            TO SCR08-FUNC-HI(FUNC-SUB)
      *             'CANNOT COMPLETE MISS CALL, USE FUNC HOSO TO
      *                                      OVERRIDE HOS RULE'
              MOVE 'C330'               TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *CNC0600-E
      *MET
           IF (WS-FUNCTION-CODE = 'CAOT' OR 'VAOT')
           AND NOT YARD-CALL
              MOVE SCR08-CC(FUNC-SUB)   TO WS-CRAFT-CODE-CHECK
              IF (ENGINE-CRAFT          AND NOT TRCN-EN-ROAD-SHFT-OT)
              OR (TRAIN-CRAFT           AND NOT TRCN-TR-ROAD-SHFT-OT)
                 MOVE -1                TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO         TO SCR08-FUNC-HI    (FUNC-SUB)
      *          ENTIRE SHIFT AT OVERTIME IS INVALID ON THIS JOB
                 MOVE 'A140'            TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
      *MET
      *CNC0600-B
      *DECLARE BELOW ERROR MESSAGE
           IF WS-FUNCTION-CODE = 'HOSO'
              AND NOT P08CA-HOSO-ALLOW(FUNC-SUB)
              MOVE -1                   TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO            TO SCR08-FUNC-HI    (FUNC-SUB)
      *       HOS OVERRIDE NOT ALLOWED
              MOVE 'H051'               TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF WS-FUNCTION-CODE = 'HOSO'
              AND P08CA-HOSO-DONE(FUNC-SUB)
              MOVE -1                   TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO            TO SCR08-FUNC-HI    (FUNC-SUB)
      *       HOS OVERRIDE ALREADY COMPLETED
              MOVE 'H052'               TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *CNC0600-E
           IF ERRORS-FOUND
              MOVE SCR08-FUNC(FUNC-SUB) TO WS-FUNCTION-CODE
              IF  P08CA-IVR-CALL-NOT-ACTIVE
              AND IVR-CALL-FUNCTION
                 PERFORM P5111-COMPANY-EDIT
                 IF NOT CNTL-OUTBND-IVR-CALL-ACTIVE
      *     'IVR NOT AVAILABLE-VERIFY "OPTION 16" IF MANUAL INTERVENTION
      *      REQUIRED'
                    MOVE 'I606' TO MSGLOG-CODE
                 ELSE
      *             MOVE 'E338' TO MSGLOG-CODE
      *             'IVR CALLS ARE NOT ACTIVE FOR THIS JOB'
                    MOVE 'I392'          TO MSGLOG-CODE
                 END-IF
              ELSE
      *               INVALID-CODE-MSG
                 MOVE 'I041' TO MSGLOG-CODE
              END-IF
              MOVE -1                     TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO              TO SCR08-FUNC-HI(FUNC-SUB)
              PERFORM P9000-SEND-MAP-AND-RETURN
           ELSE
              IF CREW-CONSIST-VACT
                 SET VACATE-JOB  TO TRUE
              END-IF
           END-IF
      *
           IF CALL-DH-COMBINED-PVT
           OR IVR-CALL-DH-COMBINED-PVT
           OR CALL-DH-COMBINED-CAB
           OR IVR-CALL-DH-COMBINED-CAB
              PERFORM P2020-CHECK-FOR-NEW-HIRE
           END-IF.
      *
       P2015-CHECK-MISSED-CALL-TABLE.
      *
           MOVE P08CA-EMP-NO(FUNC-SUB)       TO MSTRNBRK
           PERFORM P8500-READ-MASTER
           IF (TEMP-ASGN-XB
              OR (NORM-ASGN-XB AND TEMPORARY-ASGNMT NOT > SPACE))
              AND ON-DUTY-ASGNMT NOT > SPACE
              MOVE SPACES                    TO WORK-CNTLKEY
              MOVE '69'                      TO WK-CNTL-REC-TYPE
              MOVE WS-FUNCTION-CODE          TO WK-CNTL-MC-CODE
              IF YARD-CALL
                 MOVE 'YD'                   TO WK-CNTL-MC-TYPE-SVC
              ELSE
                 MOVE 'RD'                   TO WK-CNTL-MC-TYPE-SVC
              END-IF
              IF TEMPORARY-ASGNMT > SPACES
                 MOVE TA-DIST                TO WK-CNTL-MC-DIST
                 MOVE TA-SUB-DIST            TO WK-CNTL-MC-SDIST
                 MOVE TA-CC                  TO WK-CNTL-MC-XB
              ELSE
                 MOVE NA-DIST                TO WK-CNTL-MC-DIST
                 MOVE NA-SUB-DIST            TO WK-CNTL-MC-SDIST
                 MOVE NA-CC                  TO WK-CNTL-MC-XB
              END-IF
              MOVE MSTR-CONS-MISSED-CALLS    TO WK-CNTL-MC-CONS
              PERFORM P2030-READ-MC-CONTROL
              IF NOT SUCCESS
                 MOVE '**'                   TO WK-CNTL-MC-XB
                 PERFORM P2030-READ-MC-CONTROL
                 IF NOT SUCCESS
                    MOVE '**'                TO WK-CNTL-MC-SDIST
                    PERFORM P2030-READ-MC-CONTROL
                    IF NOT SUCCESS
                       MOVE '**'             TO WK-CNTL-MC-DIST
                       PERFORM P2030-READ-MC-CONTROL
                    END-IF
                 END-IF
              END-IF
              IF NOT SUCCESS
                 SET DONT-FIND-MC-CODE       TO TRUE
              END-IF
           ELSE
              SET DONT-FIND-MC-CODE          TO TRUE
           END-IF.
      *
       P2020-CHECK-FOR-NEW-HIRE.
      *
           MOVE SPACES                    TO WS-MSTR2
           MOVE P08CA-EMP-NO(FUNC-SUB)    TO MSTR2-EMP-NBR
           MOVE MSTR2-KEY                 TO MSTR2NBRK
           EXEC CICS READ
                     DATASET(MSTR2-VIA-EMP-NBR)
                     INTO(WS-MSTR2)
                     LENGTH(MSTR2ENBR-RLGTH)
                     RIDFLD(MSTR2NBRK)
                     KEYLENGTH(MSTR2ENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE               TO FILE-STATUS
           IF NOT SUCCESS
              IF NO-RECORD-FND OR END-OF-FILE
      *          'EMPLOYEE NOT FOUND'
                 MOVE 'E002'         TO MSGLOG-CODE
                 MOVE REV-VIDEO      TO SCR08-FUNC-HI(FUNC-SUB)
                 MOVE -1             TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 PERFORM P9000-SEND-MAP-AND-RETURN
              ELSE
                 MOVE 'P2020-1'      TO ERR-PARAGRAPH
                 MOVE MSTR2NBRK      TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
           IF NEW-HIRE-YES
      *       'NEW HIRE, CAN ONLY CALL IN SEPARATE SERVICE'
              MOVE 'H033'            TO MSGLOG-CODE
              MOVE -1                TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO         TO SCR08-FUNC-HI(FUNC-SUB)
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF.
      *
       P2030-READ-MC-CONTROL.
      *
           MOVE WORK-CNTLKEY              TO CNTLKEY
           EXEC CICS READ
                     DATASET(CNTL-FILE-VIA-CNTLKEY)
                     INTO(WS-CNTL-FILE)
                     LENGTH(CNTLFILE-RLGTH)
                     RIDFLD(CNTLKEY)
                     KEYLENGTH(CNTLFILE-KLGTH)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE               TO FILE-STATUS
           IF SUCCESS
              IF CNTL-REC-TYPE NOT = '69'
                 OR CNTL-MC-CODE NOT = WK-CNTL-MC-CODE
                 OR CNTL-MC-TYPE-SVC NOT = WK-CNTL-MC-TYPE-SVC
                 OR CNTL-MC-DIST NOT = WK-CNTL-MC-DIST
                 OR CNTL-MC-SDIST NOT = WK-CNTL-MC-SDIST
                 OR CNTL-MC-XB NOT = WK-CNTL-MC-XB
                 SET NO-RECORD-FND        TO TRUE
              END-IF
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P2030-1'           TO ERR-PARAGRAPH
                 MOVE CNTLKEY             TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P2040-CALCULATE-SHORT-LEAD.
      *
      *    IF THE EMPLOYEE DOES NOT ALREADY HAVE A SHORT LEAD TIME,
      *    CALCULATE THE DIFFERENCE BETWEEN THE ON-DUTY TIME AND THE
      *    CALLBACK TIME JUST ENTERED BY THE CREW CALLER.  WE WILL
      *    UPDATE HIS MSTR3 RECORD WHEN CREATING THE CALLBACK TASK.
      *    IF THE EMPLOYEE ALREADY HAS A SHORT LEAD TIME, CALCULATE
      *    THE DIFFERENCE BETWEEN THE ORDER TIME AND THE CALLBACK
      *    TIME JUST ENTERED BY THE CREW CALLER.  OVERRIDE THE
      *    EXISTING MSTR3-LEAD-TIME WITH THE NEW ONE.
      *
      *CNC0436B JES - REPLACED MSTR3-LEAD-TIME WITH TELE-REQ-LEAD-TIME
      *
      *    MOVE SPACES                        TO WS-MSTR3
      *    MOVE P08CA-EMP-NO(FUNC-SUB)        TO MSTR3NBRK
           MOVE SPACES                        TO PS52-COMMAREA-PARMS
           MOVE P08CA-EMP-NO(FUNC-SUB)        TO PS52-EMP-NBR
           SET PS52-CMA-MODE                  TO TRUE
           MOVE WS-LOCAL-DATE-TIME            TO PS52-INPUT-DATE-TIME
           PERFORM P8800-LINK-TO-PS52
      *    PERFORM P8520-READ-MASTER3
           IF NOT SUCCESS
              OR (SUCCESS AND PS52-REQ-LEAD-TIME <= SPACES)
              MOVE ZEROES                     TO DATE-CONVERSION-PARMS
              SET PARM-DIFF                   TO TRUE
              MOVE SCR08-OD-DATE(FUNC-SUB)    TO PARM-PRI-DATE-GREG
              MOVE SCR08-OD-TIME(FUNC-SUB)    TO PARM-PRI-HRMN
              IF P08CA-SCREEN-SAVED-DATE(FUNC-SUB) > SPACES
                 MOVE P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                                              TO PARM-SEC-DATE-GREG
                 MOVE P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
                                              TO PARM-SEC-HRMN
              ELSE
                 MOVE SCR08-ORDER-DATE        TO PARM-SEC-DATE-GREG
                 MOVE SCR08-ORDER-TIME        TO PARM-SEC-HRMN
              END-IF
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P2040-1'               TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              SET ADD-TELE-LEAD               TO TRUE
              MOVE PARM-RES-HRMN              TO WS-NEW-LEAD-TIME
           ELSE
              MOVE ZEROES                     TO DATE-CONVERSION-PARMS
              SET PARM-DIFF                   TO TRUE
              MOVE SCR08-OD-DATE(FUNC-SUB)    TO PARM-PRI-DATE-GREG
              MOVE SCR08-OD-TIME(FUNC-SUB)    TO PARM-PRI-HRMN
              MOVE SCR08-ORDER-DATE           TO PARM-SEC-DATE-GREG
              MOVE SCR08-ORDER-TIME           TO PARM-SEC-HRMN
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P2040-2'               TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF PARM-RES-HRMN NOT = PS52-REQ-LEAD-TIME
                 SET ADD-TELE-LEAD            TO TRUE
                 MOVE PARM-RES-HRMN           TO WS-NEW-LEAD-TIME
              ELSE
                 SET DONT-ADD-TELE-LEAD       TO TRUE
                 MOVE SPACES                  TO WS-NEW-LEAD-TIME
              END-IF
           END-IF
           .
      *CNC0499 - 12/14/16 - BEG
      *
       P2050-SET-MARRIED-FLAGS.
      *
           MOVE SPACES                               TO WORK-CNTLKEY
           IF SCR08-CC(FUNC-SUB) =
              ('EN' OR 'FI' OR 'SE' OR 'ET')
              MOVE TRCN-EN-FROM-DIST                 TO WK-CNTL-DIST
              MOVE TRCN-EN-FROM-SDIST                TO WK-CNTL-SUB-DIST
              MOVE TRCN-EN-FROM-POOL                 TO WK-CNTL-POOL
              IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                 OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                 OR P08CA-SCHED-COMPLETE(FUNC-SUB))
                 IF P08CA-SCHED-ALT(FUNC-SUB)
                    MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                            TO WK-CNTL-DIST
                    MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                            TO WK-CNTL-SUB-DIST
                    MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                            TO WK-CNTL-POOL
                 ELSE
                    MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                            TO WK-CNTL-DIST
                    MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                            TO WK-CNTL-SUB-DIST
                    MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                            TO WK-CNTL-POOL
                 END-IF
              END-IF
              PERFORM P0370-SET-EN-MARRIED-FLAGS
           ELSE
              MOVE TRCN-TR-FROM-DIST              TO WK-CNTL-DIST
              MOVE TRCN-TR-FROM-SDIST             TO WK-CNTL-SUB-DIST
              MOVE TRCN-TR-FROM-POOL              TO WK-CNTL-POOL
              IF NOT (P08CA-NO-SCHED(FUNC-SUB)
              OR P08CA-SCHED-BIDPACK(FUNC-SUB)
              OR P08CA-SCHED-COMPLETE(FUNC-SUB))
                 IF P08CA-SCHED-ALT(FUNC-SUB)
                    MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                            TO WK-CNTL-DIST
                    MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                            TO WK-CNTL-SUB-DIST
                    MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                            TO WK-CNTL-POOL
                 ELSE
                    MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                            TO WK-CNTL-DIST
                    MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                            TO WK-CNTL-SUB-DIST
                    MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                            TO WK-CNTL-POOL
                 END-IF
              END-IF
              PERFORM P0380-SET-TR-MARRIED-FLAGS
           END-IF
           PERFORM P0390-SETUP-ASSOC-CRAFTS
           .
      *CNC0499 - 12/14/16 - END
      *
       P2100-PROCESS-CALL-FUNCTION.
      *
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
              MOVE 'I049' TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF VACATE-FUNCTION
              IF P08CA-ASGN-IS-VCNY(FUNC-SUB)
              OR P08CA-ASGN-IS-BOTH(FUNC-SUB)
              OR (     P08CA-DEC-KEY(FUNC-SUB) > SPACES
                   AND NOT P08CA-SENR-RESTRICTED(FUNC-SUB))
              OR ANNULL-JOB
                 CONTINUE
              ELSE
                 MOVE -1             TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO      TO SCR08-FUNC-HI(FUNC-SUB)
      *               '"VACATE" REQUIRES ASSIGNMENT TO BE A "VACANCY"'
                 MOVE 'V003' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           ELSE
              IF P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
              OR P08CA-EMP-NO(FUNC-SUB) NOT NUMERIC
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
                 IF P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
      *                  'EMPLOYEES STATUS PROHIBITS CALL'
                    MOVE 'E030' TO MSGLOG-CODE
                 ELSE
      *                  'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                    MOVE 'I050' TO MSGLOG-CODE
                 END-IF
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
      *C983-BEG CLEAR LVE RECORDS FOR EMPLOYEES CALLED ON JOB
      *
           IF NOT VACATE-FUNCTION
              PERFORM P9650-DELETE-HANGING-LVE
      *C1150.2 - BEG
              IF P08CA-EMP-NO(FUNC-SUB) > SPACES
              AND CURR-ASGN-UFP
                 IF (P08CA-ASGN-IVR(FUNC-SUB)
                 AND P08CA-ASGN-KEY(FUNC-SUB) > SPACES
                 AND P08CA-ASGN-KEY(FUNC-SUB) = CURRENT-ASGNMT)
                    IF UFP-HT-CREW-SUPPLY > SPACE
                       MOVE UFP-HT-CREW-SUPPLY
                                       TO P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                    END-IF
                 END-IF
              END-IF
      *C1150.2 - END
           END-IF
      *C983-END
      *CNC0520-BEG
           IF NOT VACATE-FUNCTION
              MOVE SPACES                TO WS-QUAL-FLAG
              PERFORM P4000-CHECK-TERR-QUAL
           END-IF
      *CNC0520-END
      *    IF P08CA-EMP-RESTRICTED(FUNC-SUB)
      *       MOVE -1                 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *       MOVE REV-VIDEO          TO SCR08-FUNC-HI(FUNC-SUB)
      *       MOVE 'EMPLOYEE HAS RESTRICTIONS - CALL INVALID'
      *                               TO SCR08-ERRORMSG
      *       PERFORM P9000-SEND-MAP-AND-RETURN
      *    END-IF
      *
      *    SEE IF ASSIGNMENT HAS ALREADY BEEN CALLED FOR THIS DATE/TIME
      *
           MOVE SPACES                   TO AHM-KEY
           MOVE AHM-FILE                 TO AHM-DATASET
           IF YARD-CALL OR LOCAL-CALL
              MOVE SCR08-DIST            TO AHM-DIST
              MOVE SCR08-SUB-DIST        TO AHM-SUB-DIST
              IF YARD-CALL
                 MOVE JOB-DEF-YARD-POOL  TO AHM-POOL
              ELSE
                 MOVE JOB-DEF-LOCAL-POOL TO AHM-POOL
              END-IF
           ELSE
              IF TRCN-EN-FROM-AREA > SPACES
                 MOVE TRCN-EN-FROM-DIST  TO AHM-DIST
                 MOVE TRCN-EN-FROM-SDIST TO AHM-SUB-DIST
                 MOVE TRCN-EN-FROM-POOL  TO AHM-POOL
              ELSE
                 MOVE TRCN-TR-FROM-DIST  TO AHM-DIST
                 MOVE TRCN-TR-FROM-SDIST TO AHM-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL  TO AHM-POOL
              END-IF
           END-IF
      *-------------------------------------------------------------*
      *           CONVERT  TO CNTL-TIME-ZONE                        *
      *-------------------------------------------------------------*
           IF AHM-DIST        NOT = SCR08-DIST
           OR AHM-SUB-DIST    NOT = SCR08-SUB-DIST
              MOVE SPACES                TO WORK-CNTLKEY
              MOVE '02'                  TO WK-CNTL-REC-TYPE
              MOVE AHM-DIST              TO WK-CNTL-DIST
              MOVE AHM-SUB-DIST          TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P2100-C'          TO ERR-PARAGRAPH
                 MOVE CNTLKEY            TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE SPACES                TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE        TO TZ-OUT-ZONE
              MOVE PSTCA-TIME-ZONE       TO TZ-IN-ZONE
              MOVE SCR08-ORDER-DATE      TO TZ-IN-DATE
              MOVE SCR08-ORDER-TIME      TO TZ-IN-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000024'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME      TO AHM-EFF-DATE-TIME
              MOVE WS-CALL-DATE-TIME     TO TZ-IN-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000024'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME      TO AHM-EMP-OD-DATE-TIME
           ELSE
              MOVE SCR08-ORDER-DATE      TO AHM-EFF-DATE
              MOVE SCR08-ORDER-TIME      TO AHMK1-EFF-TIME
              MOVE WS-CALL-DATE-TIME     TO AHM-EMP-OD-DATE-TIME
           END-IF
      *
           MOVE SCR08-ASGN               TO AHM-TRAIN
           MOVE SCR08-ASGN-TYPE          TO AHM-TRAIN-TYPE
           SET AHM-EMPLOYEE-RECORD       TO TRUE
           SET CT-IND                    TO 1
           SEARCH CRAFT-CODE-TABLE VARYING CT-IND
              AT END CONTINUE
                 MOVE '99'               TO AHM-CRAFT-SEQ
              WHEN CT-CRAFT-CODE(CT-IND) = SCR08-CC(FUNC-SUB)
                 MOVE CT-CRAFT-SEQ(CT-IND)
                                         TO AHM-CRAFT-SEQ
      *    MOVE WS-CALL-DATE-TIME        TO AHM-EMP-OD-DATE-TIME
           MOVE AHM-KEY                  TO AHMKEY
                                            WS-AHM-KEY
      *
           IF WS-IVR-CANCEL-ALLOWED
              PERFORM P5210-PROCESS-IVR-CANCEL
           END-IF
      *
           MOVE WS-AHM-KEY               TO AHMKEY
                                            AHM-KEY
      *CNC0562 - BEG
           PERFORM P8250-READ-AHM
      *CNC0562 - END
           IF SUCCESS
              MOVE -1                 TO SCR08-OD-TIME-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO          TO SCR08-OD-TIME-HI(FUNC-SUB)
      *            'EMPLOYEE ALREADY CALLED FOR THIS ON DUTY TIME'
              MOVE 'E026'             TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           ELSE
      *CNC0562 - BEG
              SET NOT-CROSS-SERVICE      TO TRUE
              IF NO-RECORD-FND
      *C1167 - BEG
              IF YARD-CALL OR LOCAL-CALL
      *C1167 - END
                 MOVE P08CA-ASGN-ID(FUNC-SUB)      TO JOB-DEF-CHECK
                 IF JOB-DEF-RELIEF-ASGN
      *C1167 - BEG
                    IF P08CA-JSKEY1(FUNC-SUB) > SPACES
                       MOVE P08CA-JSKEY1(FUNC-SUB)(5:6) TO JOB-DEF-CHECK
                    END-IF
      *C1167 - END
                    IF LOCAL-CALL AND JOB-DEF-YARD-ASGN
                       MOVE 'YD'         TO WS-AHM-KEY(5:2)
                       SET CROSS-SERVICE TO TRUE
                    ELSE
                       IF YARD-CALL AND NOT JOB-DEF-YARD-ASGN
                          MOVE 'LO'      TO WS-AHM-KEY(5:2)
                          SET CROSS-SERVICE TO TRUE
                       END-IF
                    END-IF
                    IF CROSS-SERVICE
                       MOVE WS-AHM-KEY   TO AHMKEY
                                            AHM-KEY
                       PERFORM P8250-READ-AHM
                       IF SUCCESS
                          MOVE -1      TO SCR08-OD-TIME-CURSOR(FUNC-SUB)
                          MOVE REV-VIDEO TO SCR08-OD-TIME-HI(FUNC-SUB)
      *                  'EMPLOYEE ALREADY CALLED FOR THIS ON DUTY TIME'
                          MOVE 'E026'    TO MSGLOG-CODE
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       ELSE
                          IF NOT NO-RECORD-FND
                             MOVE 'P2100-A'    TO ERR-PARAGRAPH
                             MOVE AHMKEY       TO ERR-KEY
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                       END-IF
                    END-IF
                 END-IF
      *C1167 - BEG
              END-IF
      *C1167 - END
              ELSE
      *CNC0562 - END
                 MOVE 'P2100-1'       TO ERR-PARAGRAPH
                 MOVE AHMKEY          TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
      *CNC0499-BEG
           IF CALL-FUNCTION
           OR IVR-CALL-FUNCTION
              IF UFP-CALL
              AND WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                 PERFORM VARYING SUBA FROM 1 BY 1
                           UNTIL SUBA > 10
                    IF WS-ASSOC-CRAFT(SUBA) > SPACES
                       IF PRIMARY-TURN(SUBA)
                          PERFORM VARYING SUBB FROM 1 BY 1
                                    UNTIL SUBB > ARRAY-MAX
                             IF SCR08-CC(SUBB) = WS-ASSOC-CRAFT(SUBA)
                                MOVE SCR08-FUNC(SUBB)
                                                    TO WS-FUNCTION-CODE
                                IF CALL-FUNCTION
                                OR IVR-CALL-FUNCTION
                                   CONTINUE
                                ELSE
                                   MOVE -1
                                          TO SCR08-FUNC-CURSOR(FUNC-SUB)
                                   MOVE REV-VIDEO
                                          TO SCR08-FUNC-HI(FUNC-SUB)
      *                            'CANNOT CALL A SUBORDINATE MARRIED'
      *                            'TURN UNTIL THE PRIMARY TURN CALLED'
                                   MOVE 'C311' TO MSGLOG-CODE
                                   PERFORM P9000-SEND-MAP-AND-RETURN
                                END-IF
                             END-IF
                          END-PERFORM
                       END-IF
                    ELSE
                       MOVE 10 TO SUBA
                    END-IF
                 END-PERFORM
                 MOVE SCR08-FUNC(FUNC-SUB)  TO WS-FUNCTION-CODE
              END-IF
              IF UFP-CALL
              AND WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                 MOVE P08CA-EMP-NO(FUNC-SUB) TO MSTRNBRK
                 PERFORM P8505-READ-MASTER-ONLY
                 PERFORM P8511-EMP-HOME-AWAY-CHECK
      *
      *    ROAD EMPLOYEES ARE TO BE CONSIDERED AWAY FROM HOME WHEN
      *    THEY'RE IN A WORKING STATUS OR IF THEY HAVE AN ON-DUTY ASGN.
      *    IF AN EMPLOYEE HAS AN ON-DUTY RECORD THAT'S AN ASSIGNED JOB,
      *    THEY'RE ALSO AWAY FROM HOME (THIS INDICATES THEY'VE BEEN
      *    DEADHEADED TO THE JOB, BUT HAVEN'T BEEN CALLED ON DUTY YET).
      *
                 IF WS-EMP-AT-HOME
                    IF CURR-ASGN-UFP
                    AND (WORKING OR ON-DUTY-ASGNMT > SPACES)
                       SET WS-EMP-AT-AWAY        TO TRUE
                    END-IF
                    IF ON-DUTY-AJ
                    AND NOT WORKING
                       SET WS-EMP-AT-AWAY        TO TRUE
                    END-IF
                 END-IF
                 IF WS-EMP-AT-AWAY
                    PERFORM VARYING SUBA FROM 1 BY 1
                              UNTIL SUBA > 10
                       IF WS-ASSOC-CRAFT(SUBA) > SPACES
                          IF OPTIONAL-TURN(SUBA)
                             PERFORM VARYING SUBB FROM 1 BY 1
                                       UNTIL SUBB > ARRAY-MAX
                                IF SCR08-CC(SUBB) = WS-ASSOC-CRAFT(SUBA)
                                   MOVE SCR08-FUNC(SUBB)
                                                     TO WS-FUNCTION-CODE
                                   IF CALL-FUNCTION
                                   OR IVR-CALL-FUNCTION
                                   OR VACATE-FUNCTION
                                      CONTINUE
                                   ELSE
                                      IF P08CA-EMP-NO(SUBB) > SPACES
                                         MOVE -1
                                             TO SCR08-FUNC-CURSOR(SUBB)
                                         MOVE REV-VIDEO
                                             TO SCR08-FUNC-HI(SUBB)
      *                              'MUST CALL THE OPTIONAL MARRIED'
      *                              'TURN WHEN THE PRIMARY TURN CALLED'
                                         MOVE 'M338' TO MSGLOG-CODE
                                         PERFORM
                                               P9000-SEND-MAP-AND-RETURN
                                      END-IF
                                   END-IF
                                END-IF
                             END-PERFORM
                          END-IF
                       ELSE
                          MOVE 10 TO SUBA
                       END-IF
                    END-PERFORM
                    MOVE SCR08-FUNC(FUNC-SUB)  TO WS-FUNCTION-CODE
                 END-IF
              END-IF
           END-IF
      *CNC0499-END
      *
      *    INITIALIZE TRACKING ON THE REGULAR OWNER IF REQUIRED.
      *
           IF P08CA-REG-EMP-NO(FUNC-SUB) > '000000000' AND
              (P08CA-REG-EMP-NO(FUNC-SUB) NOT = P08CA-EMP-NO(FUNC-SUB))
              AND NOT ANNULL-JOB
      *    IF (P08CA-ASGN-IS-VCNY(FUNC-SUB) OR
      *       P08CA-ASGN-IS-BOTH(FUNC-SUB))
              IF P08CA-TRK-REASON(FUNC-SUB) NOT > SPACES
                 SET P08CA-TRK-UNKNOWN(FUNC-SUB) TO TRUE
              END-IF
              IF NOT P08CA-TRK-DONT-TRACK(FUNC-SUB)
                 AND NOT P08CA-TRK-RJH(FUNC-SUB)
                 IF P08CA-REG-EMP-NO(FUNC-SUB)
                    NOT = P08CA-RJHS-EMPNO(FUNC-SUB)
                    PERFORM P8080-INITIATE-TRACKING
                 END-IF
              END-IF
           END-IF
      *
           IF PAY-AS-US
              PERFORM P2150-CHECK-LAST-TIE-UP
           END-IF
      *1499
           MOVE SPACE              TO WS-SAVE-CBCK-FLAG
           IF P08CA-SAVE-CBCK-FLAG(FUNC-SUB) > SPACE
              MOVE P08CA-SAVE-CBCK-FLAG(FUNC-SUB) TO WS-SAVE-CBCK-FLAG
           END-IF

           IF YARD-CALL OR LOCAL-CALL
              PERFORM P2110-PROCESS-ASSIGNED-CALL
           ELSE
              PERFORM P2120-PROCESS-UFP-CALL
           END-IF
      *CNC0520-BEG
           IF NOT VACATE-FUNCTION
              MOVE SPACES                   TO WS-AHIST-MISC
              MOVE WS-AHIST-KEY             TO AHM-AHIST-KEY
              SET  AHM-PAY-RECORD           TO TRUE
              MOVE 01                       TO AHM-PAYROLL-KEY-SEQUENCE
              MOVE AHM-KEY                  TO AHMKEY
              EXEC CICS READ
                        UPDATE
                        DATASET(AHM-DATASET)
                        INTO(WS-AHIST-MISC)
                        LENGTH(AHM-RLGTH)
                        RIDFLD(AHMKEY)
                        KEYLENGTH(AHM-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE           TO FILE-STATUS
              IF SUCCESS
                 MOVE SCR08-ROUTE-DSGN   TO AHM-MISC-ROUTE-DESIGNATION
                 EXEC CICS REWRITE
                           DATASET(AHM-DATASET)
                           FROM(WS-AHIST-MISC)
                           LENGTH(AHM-RLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE                TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P2100-2'               TO ERR-PARAGRAPH
                    MOVE AHMKEY                  TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-IF
      *CNC0520-END
           PERFORM P1020-SET-ASGN-CALL-ATTR
           IF VACATE-FUNCTION
              PERFORM P1060-CLEAR-EMP-LINE
              MOVE WS-VACANT-MSG(PSTCA-SUB)      TO SCR08-NAME(FUNC-SUB)
              IF ANNULL-JOB
                 PERFORM P8070-UPDATE-TRACKING
              END-IF
           ELSE
              MOVE P08CA-EMP-NO(FUNC-SUB) TO MSTRNBRK
              PERFORM P1040-SETUP-NAME-LINE
      *1499
              IF WS-SAVE-CBCK-FLAG > SPACE
                 MOVE WS-SAVE-CBCK-FLAG
                                      TO P08CA-SAVE-CBCK-FLAG(FUNC-SUB)
              END-IF
              MOVE WS-FUNCTION-CODE   TO SCR08-FUNC(FUNC-SUB)
              MOVE FUNC-SUB TO HOLD-FUNC-SUB
              PERFORM VARYING FUNC-SUB FROM 1 BY 1
                 UNTIL FUNC-SUB > ARRAY-MAX
                 IF P08CA-EMP-NO(HOLD-FUNC-SUB) = P08CA-EMP-NO(FUNC-SUB)
                    AND FUNC-SUB NOT = HOLD-FUNC-SUB
                    MOVE P08CA-EMP-NO(FUNC-SUB)
                       TO P08CA-REG-EMP-NO(FUNC-SUB)
                    SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                    SET P08CA-TRK-ON-DUTY(FUNC-SUB) TO TRUE
                    MOVE SPACES               TO P08CA-EMP-NO(FUNC-SUB)
                    MOVE SCR08-NAME(FUNC-SUB) TO SCR08-NAMEB(FUNC-SUB)
                    MOVE SCR08-ST(HOLD-FUNC-SUB) TO SCR08-STB(FUNC-SUB)
                    MOVE SCR08-ECC(HOLD-FUNC-SUB)
                                              TO SCR08-ECCB(FUNC-SUB)
                    MOVE SCR08-ORDER-DATE     TO SCR08-OD-DATE(FUNC-SUB)
      *TJR 03/01/2001 SAVE TO THE COMMAREA
                                       P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
                    MOVE SCR08-ORDER-TIME     TO SCR08-OD-TIME(FUNC-SUB)
                                       P08CA-SCREEN-SAVED-TIME(FUNC-SUB)

                    PERFORM P1060-CLEAR-EMP-LINE
                    IF UFP-BLANK-TURN
                       MOVE WS-DISCONT-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                    ELSE
                       MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                    END-IF
                    MOVE ARRAY-MAX            TO FUNC-SUB
                 END-IF
              END-PERFORM
              MOVE HOLD-FUNC-SUB              TO FUNC-SUB
           END-IF

           IF NOT IVR-CALL-FUNCTION
              PERFORM P9300-READ-TASK-BY-STATION
              IF WS-TASK-FOUND
                 MOVE SPACES                TO VRUINFO-FILE
                 MOVE TASK-LOCATION-KEY     TO VRUINFO-TASK-KEY
                 PERFORM P9330-READ-VRUINFO
                 EVALUATE TRUE
                    WHEN SUCCESS
                         PERFORM P5161-UPDATE-VRUINFO
                    WHEN OTHER
                         CONTINUE
                 END-EVALUATE
              END-IF
           END-IF
           .
      *
       P2110-PROCESS-ASSIGNED-CALL.
      *
      *::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::*
      * ALLOW CALL OF AN EMPLOYEE WHO IS STILL WORKING THE PREV SHIFT
      * AS LONG AS QUICK TIEUP IS ALLOWED IN THE SUB-DIST OF THE PREV
      * ASSIGNMENT AND THE PERSON IS WORKING AN ASSIGNED JOB.
      *::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::*
      *
           MOVE P08CA-EMP-NO(FUNC-SUB)     TO MSTRNBRK
           PERFORM P8500-READ-MASTER

           IF WORKING OF WS-MSTR
              MOVE SPACES                  TO WORK-CNTLKEY
              MOVE '2A'                    TO WK-CNTL-REC-TYPE
              MOVE OD-DIST                 TO WK-CNTL-DIST
              MOVE OD-SUB-DIST             TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P2110-1'            TO ERR-PARAGRAPH
                 MOVE CNTLKEY              TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE CNTL-RESTRICT-TIE-FLAG  TO WS-ALLOW-QUICK-TIE-FLAG

              IF ALLOW-QUICK-TIEUP AND
                 ON-DUTY-ASGNMT > SPACES AND
                 ON-DUTY-AJ AND
                 EMP-TRHIST-KEY > SPACE
                 CONTINUE
              ELSE
                 MOVE -1                  TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO           TO SCR08-FUNC-HI(FUNC-SUB)
      *             'EMPLOYEES STATUS PROHIBITS CALL'
                 MOVE 'E030'              TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
           MOVE SPACES                     TO HOLD-LEAD-TIME
           IF NOT VACATE-FUNCTION
      *MET 08/15/2006 C662
              MOVE ZERO                    TO SCHED-DONE-CODE
                                              SCHED-2ND-CODE
                                              SCHED-LST-CODE
                                              SCHED-FOUND-CODE
              MOVE SCR08-CC(FUNC-SUB)      TO JSK1-ASGN-CC
              PERFORM P2950-GET-HRS-SVC-INFO
              IF TRCN-2ND-ROUTE-DESIGNATION > SPACES
              AND TRCN-LOCAL-REC
                 PERFORM P3039-GET-CNTL-DIST-SUB-DIST
                 IF NOT CNTL-SPLIT-SHIFT-HOS
                    AND SCHED-2ND
                    AND ON-SCHED-1ST
                    SET P925-EMP-STATUS-GREEN TO TRUE
                 END-IF
              END-IF
              MOVE SCR08-CC(FUNC-SUB)     TO WS-CRAFT-CODE-CHECK
      *** 331E - ADD CHECK FOR HOS EXEMPT FLAG
              IF ENGINE-CRAFT
                 IF P925-EMP-STATUS-RED
      *CNLD-259 B CNC0600
      *             AND NOT P08CA-EN-DHD-HOME
                    AND ((NOT P08CA-EN-DHD-HOME)
                         OR WS-RFR-LEAD-IN-SYS-UD
                         OR WS-RFR-OD-IN-SYS-RB)
      *CNLD-259 E CNC0600
                    AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                    MOVE -1               TO SCR08-FUNC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO        TO SCR08-FUNC-HI(FUNC-SUB)
      *CNC0600-B
                    IF P08CA-HOSO-ALLOW(FUNC-SUB)
      *CNLD-230-B
                       EVALUATE TRUE
                          WHEN WS-RFR-7DAY-RND-ERT
                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
      *             'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                             MOVE 'E373'     TO MSGLOG-CODE
                          WHEN WS-RFR-7DAY-ERT
                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
      *             'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                             MOVE 'E374'     TO MSGLOG-CODE
                          WHEN WS-RFR-7DAY-HRS

      *             'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.
      *                                        USE'HOSO'IF REQ'
                             MOVE 'N267'     TO MSGLOG-CODE
      *CNLD-257-DXC-B
      *                   WHEN WS-RFR-60-192-ERT
                          WHEN WS-RFR-60-ERT
      *             'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
                             MOVE 'E375'     TO MSGLOG-CODE
                          WHEN WS-RFR-192-ERT
                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
      *             'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE 'E382'     TO MSGLOG-CODE
      *                   WHEN WS-RFR-60-192-HRS
                          WHEN WS-RFR-60-HRS

      *             'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE 'N269'     TO MSGLOG-CODE
                          WHEN WS-RFR-192-HRS

      *             'NOT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE 'N271'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                          WHEN WS-RFR-MTOD

      *             'EMPLOYEE NOT RESTED; USE'HOSO'IF REQ'
                             MOVE 'E376'     TO MSGLOG-CODE
                          WHEN OTHER
      *CNLD-230-E
      *             'NOT ENOUGH HOURS TO COMPLETE CALL, USE HOSO TO
      *                                      OVERRIDE HOS RULE'
                             MOVE 'N264'     TO MSGLOG-CODE
      *CNLD-230-B
                       END-EVALUATE
      *CNLD-230-E
                    ELSE
      *CNC0600-E
      *                CONTINUE
      *             'EMPLOYEES STATUS PROHIBITS CALL'
      *CNC0600-RPV-B
                       IF NOT WS-CAN-WRR-NEW
      *CNC0600-RPV-E
                          MOVE 'E030'        TO MSGLOG-CODE
      *CNLD-230-B
                       ELSE
                          EVALUATE TRUE
      *CNLD-259 B CNC0600
                             WHEN WS-RFR-LEAD-IN-SYS-UD

      *                'LEAD TIME IS OVERLAPPING WITH SYS RESET UDR.'
                                MOVE 'L050'     TO MSGLOG-CODE
                             WHEN WS-RFR-OD-IN-SYS-RB

      *                'ON-DUTY TIME IS DURING SYS RESET BRK.'
                                MOVE 'O098'     TO MSGLOG-CODE
      *CNLD-259 E
                             WHEN WS-RFR-7DAY-HRS

      *                'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.'
                                MOVE 'N268'     TO MSGLOG-CODE
      *CNLD-257-DXC-B
      *                      WHEN WS-RFR-60-192-HRS
                             WHEN WS-RFR-60-HRS

      *                'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK.'
                                MOVE 'N270'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-HRS

      *                'NOT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK.'
                                MOVE 'N272'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                             WHEN WS-RFR-MTOD
      *CNLD-265
                             WHEN WS-RFR-PERS

      *                'EMPLOYEE NOT RESTED.'
                                MOVE 'E377'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-RND-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                MOVE 'E378'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                MOVE 'E379'     TO MSGLOG-CODE
      *CNLD-DXC-275-B
      *                      WHEN WS-RFR-60-192-ERT
                             WHEN WS-RFR-60-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK.
                                MOVE 'E380'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK.
                                MOVE 'E383'     TO MSGLOG-CODE
      *CNLD-DXC-275-E
                          END-EVALUATE
      *CNLD-230-E
                       END-IF
      *CNC0600-NXA-B
      *                IF EMP-MTOD-NUM > MSTR3-SYSTEM-UD1-TO-NUM
      *                   MOVE EMP-MTOD-TIME(1:2) TO WS-UD-HH
      *                   MOVE EMP-MTOD-TIME(3:2) TO WS-UD-MM
      *                ELSE
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(1:2) TO WS-UD-HH
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(3:2) TO WS-UD-MM
      *                END-IF
      *                MOVE WS-UD-MESG  TO SCR08-PHONE(FUNC-SUB)
      *                MOVE YELLOW      TO SCR08-PHONE-COL(FUNC-SUB)
      *                MOVE RED         TO SCR08-NAME-COL(FUNC-SUB)
      *CNC0600-NXA-E
      *CNC0600-B
                    END-IF
      *CNC0600-E
      *CNC0600-RPV-B - COLOR ISSUE
                    IF WS-CAN-WRR-NEW
      *CNLD-244-B #3 CNC0600
      *                MOVE RED           TO SCR08-NAME-COL(FUNC-SUB)
                       IF WS-SAVE-REST-STATUS > SPACES
                          IF WS-SAVE-REST-STATUS = 'Y'
                             MOVE YELLOW  TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
                          IF WS-SAVE-REST-STATUS = 'R'
                             MOVE RED     TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
                       ELSE
                          MOVE RED        TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
      *CNLD-244-E
                    END-IF
      *CNC0600-RPV-E -
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              ELSE
                 IF P925-EMP-STATUS-RED
      *CNLD-259 B CNC0600
      *             AND NOT P08CA-TR-DHD-HOME
                    AND ((NOT P08CA-TR-DHD-HOME)
                         OR WS-RFR-LEAD-IN-SYS-UD
                         OR WS-RFR-OD-IN-SYS-RB)
      *CNLD-259 E CNC0600
                    AND P08CA-NOT-HOS-EXEMPT(FUNC-SUB)
                    MOVE -1               TO SCR08-FUNC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO        TO SCR08-FUNC-HI(FUNC-SUB)
      *CNC0600-B
                    IF P08CA-HOSO-ALLOW(FUNC-SUB)
      *CNLD-230-B
                       EVALUATE TRUE
                          WHEN WS-RFR-7DAY-RND-ERT

                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
      *             'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                             MOVE 'E373'     TO MSGLOG-CODE
                          WHEN WS-RFR-7DAY-ERT

                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
      *             'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                             MOVE 'E374'     TO MSGLOG-CODE
                          WHEN WS-RFR-7DAY-HRS

      *             'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.
      *                                        USE'HOSO'IF REQ'
                             MOVE 'N267'     TO MSGLOG-CODE
      *CNLD-DXC-257-B
      *                   WHEN WS-RFR-60-192-ERT
                          WHEN WS-RFR-60-ERT
                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
      *             'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE 'E375'     TO MSGLOG-CODE
                          WHEN WS-RFR-192-ERT
                             MOVE P925-RFR-MSG
                                             TO WS-RFR-MSG
      *             'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE 'E382'     TO MSGLOG-CODE
      *                   WHEN WS-RFR-60-192-HRS
                          WHEN WS-RFR-60-HRS

      *             'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE 'N269'     TO MSGLOG-CODE
                          WHEN WS-RFR-192-HRS

      *             'NOT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                             MOVE 'N271'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                          WHEN WS-RFR-MTOD

      *             'EMPLOYEE NOT RESTED; USE'HOSO'IF REQ'
                             MOVE 'E376'     TO MSGLOG-CODE
                          WHEN OTHER
      *CNLD-230-E
      *             'NOT ENOUGH HOURS TO COMPLETE CALL, USE HOSO TO
      *                                      OVERRIDE HOS RULE'
                             MOVE 'N264'     TO MSGLOG-CODE
      *CNLD-230-B
                       END-EVALUATE
      *CNLD-230-E
                    ELSE
      *CNC0600-E
      *             'EMPLOYEES STATUS PROHIBITS CALL'
      *CNC0600-RPV-B
                       IF NOT WS-CAN-WRR-NEW
      *CNC0600-RPV-E
                          MOVE 'E030'           TO MSGLOG-CODE
      *CNLD-230-B
                       ELSE
                          EVALUATE TRUE
      *CNLD-259 B CNC0600
                             WHEN WS-RFR-LEAD-IN-SYS-UD

      *                'LEAD TIME IS OVERLAPPING WITH SYS RESET UDR.'
                                MOVE 'L050'     TO MSGLOG-CODE
                             WHEN WS-RFR-OD-IN-SYS-RB

      *                'ON-DUTY TIME IS DURING SYS RESET BRK.'
                                MOVE 'O098'     TO MSGLOG-CODE
      *CNLD-259 E
                             WHEN WS-RFR-7DAY-HRS

      *                'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.'
                                MOVE 'N268'     TO MSGLOG-CODE
      *CNLD-257-DXC-B
      *                      WHEN WS-RFR-60-192-HRS
                             WHEN WS-RFR-60-HRS

      *                'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK.'
                                MOVE 'N270'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-HRS

      *                'OT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK.'
                                MOVE 'N272'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                             WHEN WS-RFR-MTOD
      *CNLD-265
                             WHEN WS-RFR-PERS

      *                'EMPLOYEE NOT RESTED.'
                                MOVE 'E377'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-RND-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                MOVE 'E378'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                MOVE 'E379'     TO MSGLOG-CODE
      *CNLD-DXC-257-B
      *                      WHEN WS-RFR-60-192-ERT
                             WHEN WS-RFR-60-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK'
                                MOVE 'E380'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK.'
                                MOVE 'E383'     TO MSGLOG-CODE
                          END-EVALUATE
      *CNLD-230-E
                       END-IF
      *CNC0600-NXA-B
      *                IF EMP-MTOD-NUM > MSTR3-SYSTEM-UD1-TO-NUM
      *                   MOVE EMP-MTOD-TIME(1:2) TO WS-UD-HH
      *                   MOVE EMP-MTOD-TIME(3:2) TO WS-UD-MM
      *                ELSE
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(1:2) TO WS-UD-HH
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(3:2) TO WS-UD-MM
      *                END-IF
      *                MOVE WS-UD-MESG  TO SCR08-PHONE(FUNC-SUB)
      *                MOVE YELLOW      TO SCR08-PHONE-COL(FUNC-SUB)
      *                MOVE RED         TO SCR08-NAME-COL(FUNC-SUB)
      *CNC0600-NXA-E
      *CNC0600-B
                    END-IF
      *CNC0600-E
      *CNC0600-RPV-B - COLOR ISSUE
                    IF WS-CAN-WRR-NEW
      *CNLD-244-B #3 CNC0600
      *                MOVE RED              TO SCR08-NAME-COL(FUNC-SUB)
                       IF WS-SAVE-REST-STATUS > SPACES
                          IF WS-SAVE-REST-STATUS = 'Y'
                             MOVE YELLOW  TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
                          IF WS-SAVE-REST-STATUS = 'R'
                             MOVE RED     TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
                       ELSE
                          MOVE RED        TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
      *CNLD-244-E
                    END-IF
      *CNC0600-RPV-E
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              END-IF

      *CNLD-330-B COMMENTING
      **CNLD-245-B
      *        IF WS-EMP-US-STATUS-RED
      **             'EMPLOYEES STATUS PROHIBITS CALL'
      *           MOVE 'E030'           TO MSGLOG-CODE
      *           PERFORM P9000-SEND-MAP-AND-RETURN
      *        END-IF
      **CNLD-245-E
      *CNLD-330-E

      *
      *       GET THE EMPLOYEE'S SHORT LEAD TIME, IF ANY, FOR USE IN
      *       P2130, BELOW.
      *
      *       MOVE SPACES                 TO WS-MSTR3
      *       MOVE EMP-NBR IN WS-MSTR     TO MSTR3NBRK
      *       PERFORM P8520-READ-MASTER3
              MOVE SPACES                    TO PS52-COMMAREA-PARMS
              MOVE EMP-NBR IN WS-MSTR        TO PS52-EMP-NBR
              SET PS52-CMA-MODE              TO TRUE
              MOVE WS-LOCAL-DATE-TIME        TO PS52-INPUT-DATE-TIME
              PERFORM P8800-LINK-TO-PS52
              IF SUCCESS
                 IF PS52-REQ-LEAD-TIME        > SPACES
                    AND PS52-REQ-LEAD-TIME    > '0000'
                    MOVE PS52-REQ-LEAD-TIME  TO HOLD-LEAD-TIME
                 END-IF
              END-IF
           END-IF

           MOVE SPACES                     TO P921-COMMAREA-PARMS
           SET P921-CALL-FUNCTION          TO TRUE
           SET AJ-ASGN                     TO TRUE
           PERFORM P6500-FIND-ASGN-CLASS
           MOVE WS-ASGN-MERG-CLASS         TO P921-ASGN-MERG-CLASS
      *
      *#1377
           IF P08CA-ORDER-VX
           AND CALL-FUNCTION
              IF P08CA-ASGN-KEY(FUNC-SUB) > SPACES
                 MOVE P08CA-ASGN-KEY(FUNC-SUB) TO AJJOBKEY
                 PERFORM P8600-READ-AJJOBKEY
                 IF NO-RECORD-FND
                    MOVE SPACES            TO P922-COMMAREA-PARMS
                    SET P922-ADD-MADEUP-FUNCTION TO TRUE
                    MOVE TRCN-KEY3         TO P922-AJ-PARM
                    MOVE SCR08-CC(FUNC-SUB) TO P922-AJ-CC
                    MOVE SCR08-OD-DATE(FUNC-SUB) TO P922-JOB-OD-DATE
                                                    P922-ADD-EFF-DATE
                    MOVE SCR08-OD-TIME(FUNC-SUB) TO P922-JOB-OD-TIME
                    MOVE PSTCA-TIME-ZONE   TO P922-TIME-ZONE
                    EXEC CICS LINK
                              PROGRAM(P922-PGM)
                              COMMAREA(P922-COMMAREA-PARMS)
                              LENGTH(P922-LGTH)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE TO FILE-STATUS
                    IF NOT SUCCESS
                       MOVE 'P2110-3' TO ERR-PARAGRAPH
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE P922-AJ-PARM      TO AJJOBKEY
                    PERFORM P8600-READ-AJJOBKEY
                    IF NOT SUCCESS
                       MOVE 'P2110-4' TO ERR-PARAGRAPH
                       MOVE AJJOBKEY TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
      *#1394
                    MOVE P922-AJ-PARM TO P08CA-ASGN-KEY(FUNC-SUB)
                 END-IF
              END-IF
           END-IF
      *
           IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
              MOVE P08CA-ASGN-KEY-XB(FUNC-SUB)(2:12)
                                              TO P921-AJ-PARM
           ELSE
              MOVE P08CA-ASGN-KEY(FUNC-SUB)   TO P921-AJ-PARM
           END-IF
           MOVE SCR08-OD-DATE(FUNC-SUB)    TO P921-EFF-DATE
           MOVE SCR08-OD-TIME(FUNC-SUB)    TO P921-EFF-TIME
           MOVE P08CA-JOB-TYPE             TO P921-CALL-JOB-TYPE
           MOVE P08CA-DEP-DIRECTION        TO P921-DEP-DIRECTION
      *    MOVE SCR08-CALL-COMMENTS        TO P921-CALL-COMMENTS
           INITIALIZE WS-TOC-STORAGE
           IF P08CA-TASK-KEY > SPACES
              MOVE P08CA-TASK-KEY          TO TOC-TASK-KEY
           ELSE
              IF P08CA-PRE-CALL-TOC-KEY > SPACES
                 MOVE P08CA-PRE-CALL-TOC-KEY
                                           TO TOC-TASK-KEY
              END-IF
           END-IF
           IF TOC-TASK-KEY > SPACES
              PERFORM PSQL-TOCSEL01
              IF SQL-SUCCESS
                 MOVE TOC-COMMENTS-TEXT    TO P921-CALL-COMMENTS
              ELSE
                 MOVE SPACES               TO P921-CALL-COMMENTS
              END-IF
           END-IF
           MOVE P08CA-RUN-NUMBER           TO P921-CALL-RUN-NUMBER
           MOVE P08CA-FORCE-ROUTE          TO P921-CALL-FORCE-ROUTE
           MOVE P08CA-BUSINESS-AREA        TO P921-CALL-BUSINESS-AREA
           MOVE P08CA-SAVE-CREW-RPT-LOCATION
                                           TO P921-CREW-RPT-LOCATION
           MOVE P08CA-SAVE-ALLOW-VCLL-FL   TO P921-ALLOW-VCLL-FL
           IF P921-EFF-DATE-TIME NOT > ZEROES
              MOVE WS-PRESENT-TIME         TO P921-EFF-DATE-TIME
           END-IF
           MOVE PSTCA-TIME-ZONE            TO P921-TIME-ZONE
           IF YARD-CALL
              MOVE SCR08-ORDER-DATE        TO P921-JOB-DATE
              MOVE SCR08-ORDER-TIME        TO P921-JOB-TIME
              MOVE SCR08-ASGN              TO P921-TRAIN
           ELSE
              MOVE SCR08-ORDER-DATE        TO P921-JOB-DATE
              MOVE SCR08-ORDER-TIME        TO P921-JOB-TIME
              STRING SCR08-ASGN
                     SCR08-ASGN-TYPE
                     DELIMITED BY SIZE
                     INTO P921-TRAIN
           END-IF
           MOVE TRCN-KEY1               TO P921-ASGN-PROFILE-KEY
      *C1211B
      *    MOVE SCR08-FUNC(FUNC-SUB)    TO P921-CALL-FUNC-CODE
           IF  SCR08-FUNC(FUNC-SUB) = 'HOUR'
           AND WS-FUNCTION-CODE NOT = SCR08-FUNC(FUNC-SUB)
              MOVE WS-FUNCTION-CODE     TO P921-CALL-FUNC-CODE
      *--     PROCESSING AS A FILL MIGHT AS WELL LET THE SCREEN KNOW
              MOVE WS-FUNCTION-CODE     TO SCR08-FUNC(FUNC-SUB)
           ELSE
              MOVE SCR08-FUNC(FUNC-SUB) TO P921-CALL-FUNC-CODE
           END-IF
      *C1211E
           MOVE SCR08-CC(FUNC-SUB)      TO P921-CALL-CC
           MOVE SCR08-CC(FUNC-SUB)      TO WS-CRAFT-CODE-CHECK
           IF ENGINE-CRAFT
              MOVE P08CA-EN-LEAD-TIME   TO P921-CALL-LEAD-TIME
           ELSE
              MOVE P08CA-TR-LEAD-TIME   TO P921-CALL-LEAD-TIME
           END-IF
           IF P08CA-EMP-NO(FUNC-SUB) NUMERIC
              AND NOT VACATE-FUNCTION
              MOVE P08CA-EMP-NO(FUNC-SUB) TO P921-EMP-NO
           END-IF
           IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
              MOVE P08CA-DEC-KEY(FUNC-SUB) TO P921-DECKEY
           END-IF
      *-------------------------------------------------------------
      *       FOR FASTSLOW SPAREBOARDS, THE BOARD USED IN THE
      *       SELECTION PROCES IS RETAINED FOR FURTHER PROCESSING.
      *       OTHERWISE, THIS FLAG IS SPACES.
      *----------------------------------------------------------PLS
           MOVE P08CA-FASTSLOW-BOARD(FUNC-SUB)
                                        TO P921-FASTSLOW-BOARD
           MOVE SCR08-DH-RSN            TO P921-DH-RSN
           MOVE P08CA-JSKEY1(FUNC-SUB)  TO P921-CALL-JSKEY1
           IF P08CA-STARTS-DISQUALIFIED(FUNC-SUB)
              MOVE P08CA-STARTS-TOTAL(FUNC-SUB)
                                        TO P921-DISQUALIFIED-STARTS
           ELSE
              MOVE ZEROS                TO P921-DISQUALIFIED-STARTS
           END-IF
           MOVE P08CA-RJHS-EMPNO(FUNC-SUB)
                                        TO P921-RJHS-EMPNO
           MOVE P925-REST-STATUS-FLAG   TO P921-EMP-REST-STATUS
           IF SCR08-USHR(FUNC-SUB)       > SPACES
              AND P08CA-EMP-RESTED-NO(FUNC-SUB)
              SET P921-US-REST-RED      TO TRUE
           ELSE
              SET P921-US-REST-GREEN    TO TRUE
           END-IF

           IF IVR-CALL-FUNCTION
              SET P921-FROM-IVR-CALL    TO TRUE
           END-IF
           MOVE SCR08-TAXI-TM(FUNC-SUB) TO P921-TAXI-TIME
      *CNC0520-BEG
           MOVE SCR08-ROUTE-DSGN        TO P921-ROUTE-DESIGNATION
      *CNC0520-END
      *CNC0534-BEG
           MOVE WS-EMP-AT-FLAG          TO P921-CALLED-FROM-HOME-FL
      *CNC0534-END
      *CNLD-207-DXC-B
           MOVE P925-CAN-WRR-LEAD-TIME  TO P921-CAN-WRR-LEAD-TIME
      *CNLD-207-DXC-E

           EXEC CICS LINK
                     PROGRAM(P921-PGM)
                     COMMAREA(P921-COMMAREA-PARMS)
                     LENGTH(P921-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2110-2'          TO ERR-PARAGRAPH
              MOVE 'P921LINK'         TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
      *    CNC0413 - UPDATE TRACKED EMPLOYEES' HOS REST STATUSES, IF
      *    DEALING WITH AN AWAY-FROM-HOME CALL OR DEADHEAD EMPLOYEE.
      *
           IF (CALL-FUNCTION OR IVR-CALL-FUNCTION)
           AND P08CA-EMP-NO(FUNC-SUB) IS NUMERIC
              PERFORM P2130-CALC-TRKEMP-HOS
           END-IF
           .
      *
       P2120-PROCESS-UFP-CALL.
      *
      *CNC0499 - 11/21/16 - BEG
      ***  IF A MADEUP TURN WAS CREATED FOR MARRIED TURN AND THAT TURN
      ***  IS VACANT - DELETE THE MADEUP TURN...
           MOVE FUNC-SUB TO HOLD-FUNC-SUB
      *
           IF UFP-CALL
           AND WS-ASSOCIATED-CRAFT-ARRAY > SPACES
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                          IF P08CA-ASGN-KEY(SUB1) > SPACES
                             MOVE SUB1            TO FUNC-SUB
                             IF NOT ASSOCIATED-TURN
                                IF  P08CA-ASGN-MU(FUNC-SUB)
                                AND P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                   MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                                              TO UFPTURN
                                   PERFORM P8600-READ-UFPTURN
                                   IF NOT SUCCESS
                                      MOVE 'P2120-4' TO ERR-PARAGRAPH
                                      MOVE UFPTURN TO ERR-KEY
                                      PERFORM P9999-GOT-PROBLEM
                                   END-IF
                                   MOVE ZEROS TO UFP-POSITION-TIME
                                   MOVE UFPPOS-AREA TO WORK-UFPPOS
                                   PERFORM P8040-PROCESS-DELETE
                                END-IF
                             END-IF
                          END-IF
                       END-IF
                    END-PERFORM
                 ELSE
                    MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                 END-IF
              END-PERFORM
           END-IF
           MOVE HOLD-FUNC-SUB TO FUNC-SUB
      *CNC0499 - 11/21/16 - END
           MOVE SPACES                    TO P915-COMMAREA-PARMS

           IF WS-IVR-CANCEL-ALLOWED
      *       MOVE P916-RETURN-SCHED-KEY  TO P915-SCHED-KEY
              MOVE WS-HOLD-SCHED-KEY      TO P915-SCHED-KEY
           END-IF

           SET P915-CALL-FUNCTION         TO TRUE
           SET UFP-ASGN                   TO TRUE
           PERFORM P6500-FIND-ASGN-CLASS
           MOVE WS-ASGN-MERG-CLASS        TO P915-ASGN-MERG-CLASS
           MOVE P08CA-ASGN-KEY(FUNC-SUB)  TO P915-TURN-PARM
           MOVE SCR08-OD-DATE(FUNC-SUB)   TO P915-EFF-DATE
           MOVE SCR08-OD-TIME(FUNC-SUB)   TO P915-EFF-TIME
           MOVE SCR08-TAXI-TM(FUNC-SUB)   TO P915-TAXI-TIME
           MOVE PSTCA-TIME-ZONE           TO P915-TIME-ZONE
           MOVE SCR08-ORDER-DATE          TO P915-TRAIN-DATE
           MOVE SCR08-ORDER-TIME          TO P915-TRAIN-TIME
           MOVE P08CA-JOB-TYPE            TO P915-JOB-TYPE
           MOVE P08CA-DEP-DIRECTION       TO P915-DEP-DIRECTION
      *    MOVE SCR08-CALL-COMMENTS       TO P915-CALL-COMMENTS
           INITIALIZE WS-TOC-STORAGE
           IF P08CA-TASK-KEY > SPACES
              MOVE P08CA-TASK-KEY         TO TOC-TASK-KEY
           ELSE
              IF P08CA-PRE-CALL-TOC-KEY > SPACES
                 MOVE P08CA-PRE-CALL-TOC-KEY
                                          TO TOC-TASK-KEY
              END-IF
           END-IF
           IF TOC-TASK-KEY > SPACES
              PERFORM PSQL-TOCSEL01
              IF SQL-SUCCESS
                 MOVE TOC-COMMENTS-TEXT   TO P915-CALL-COMMENTS
              ELSE
                 MOVE SPACES              TO P915-CALL-COMMENTS
              END-IF
           END-IF
           MOVE P08CA-RUN-NUMBER          TO P915-RUN-NUMBER
           MOVE P08CA-FORCE-ROUTE         TO P915-FORCE-ROUTE
           MOVE P08CA-BUSINESS-AREA       TO P915-BUSINESS-AREA
           MOVE P08CA-SAVE-CREW-RPT-LOCATION
                                           TO P915-CREW-RPT-LOCATION
           MOVE P08CA-SAVE-ALLOW-VCLL-FL   TO P915-ALLOW-VCLL-FL
      *CNC0520-BEG
           MOVE SCR08-ROUTE-DSGN           TO P915-ROUTE-DESIGNATION
      *CNC0520-END
           STRING SCR08-ASGN
                  SCR08-ASGN-TYPE
                  DELIMITED BY SIZE
                  INTO P915-TRAIN
           MOVE TRCN-KEY1                 TO P915-ASGN-PROFILE-KEY
           MOVE SCR08-FUNC(FUNC-SUB)      TO P915-CALL-FUNC-CODE
           IF TRCN-EN-FROM-AREA > SPACES
              MOVE TRCN-EN-FROM-DIST      TO P915-CALL-DIST
              MOVE TRCN-EN-FROM-SDIST     TO P915-CALL-SUB-DIST
              MOVE TRCN-EN-FROM-POOL      TO P915-CALL-POOL
              MOVE TRCN-EN-FROM-TERM      TO P915-CALL-TERM
           ELSE
              MOVE TRCN-TR-FROM-DIST      TO P915-CALL-DIST
              MOVE TRCN-TR-FROM-SDIST     TO P915-CALL-SUB-DIST
              MOVE TRCN-TR-FROM-POOL      TO P915-CALL-POOL
              MOVE TRCN-TR-FROM-TERM      TO P915-CALL-TERM
           END-IF
           MOVE SCR08-CC(FUNC-SUB)        TO P915-CALL-CC
                                             WS-CRAFT-CODE-CHECK
           IF ENGINE-CRAFT
              MOVE P08CA-EN-LEAD-TIME     TO P915-CALL-LEAD-TIME
           ELSE
              MOVE P08CA-TR-LEAD-TIME     TO P915-CALL-LEAD-TIME
           END-IF
           MOVE SPACES                    TO HOLD-LEAD-TIME
           IF P08CA-EMP-NO(FUNC-SUB) IS NUMERIC
              AND NOT VACATE-FUNCTION
              MOVE P08CA-EMP-NO(FUNC-SUB) TO MSTRNBRK
              PERFORM P8500-READ-MASTER
              PERFORM P2950-GET-HRS-SVC-INFO
              IF ENGINE-CRAFT
                 IF P925-EMP-STATUS-RED
568000*CNLD-259 B CNC0600
      *             AND NOT P08CA-EN-DHD-HOME
                    AND ((NOT P08CA-EN-DHD-HOME)
570400                   OR WS-RFR-LEAD-IN-SYS-UD
570400                   OR WS-RFR-OD-IN-SYS-RB)
568000*CNLD-259 E
      *
      *             DOUBLE CHECK DHD-HOME STATUS TO CATCH EMPLOYEES
      *             IN AN ID POOL'S 'AWAY' HOME TERMINAL GOING HOME
      *
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO WK-ASGN-KEY
                    MOVE WK-ASGN-KEY-DIST         TO WK-CNTL-DIST
                    MOVE WK-ASGN-KEY-SDIST        TO WK-CNTL-SUB-DIST
                    MOVE WK-ASGN-KEY-POOL         TO WK-CNTL-POOL
                    MOVE '03'                     TO WK-CNTL-REC-TYPE
                    MOVE 'F'                      TO WK-CNTL-POOL-TYPE
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P2120-1' TO ERR-PARAGRAPH
                       MOVE CNTLKEY   TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    IF WK-TRCN-EN-FNL-STN NOT = CNTL-POOL-HOME-STATION
                       OR SCR08-ASGN(1:2) NOT = 'DH'
568000*CNLD-259 B CNC0600
570400                 OR WS-RFR-LEAD-IN-SYS-UD
570400                 OR WS-RFR-OD-IN-SYS-RB
568000*CNLD-259 E
                       MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO     TO SCR08-FUNC-HI(FUNC-SUB)
      *CNC0600-B
                       IF P08CA-HOSO-ALLOW(FUNC-SUB)
      *CNLD-230-B
                          EVALUATE TRUE
                             WHEN WS-RFR-7DAY-RND-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                                MOVE 'E373'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                                MOVE 'E374'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-HRS

      *                'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.
      *                                        USE'HOSO'IF REQ'
                                MOVE 'N267'     TO MSGLOG-CODE
      *CNLD-DXC-257-B
      *                      WHEN WS-RFR-60-192-ERT
                             WHEN WS-RFR-60-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                                MOVE 'E375'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                                MOVE 'E382'     TO MSGLOG-CODE
      *                      WHEN WS-RFR-60-192-HRS
                             WHEN WS-RFR-60-HRS

      *                'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK;
      *                                           USE'HOSO'IF REQ'
                                MOVE 'N269'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-HRS

      *                'NOT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK;
      *                                           USE'HOSO'IF REQ'
                                MOVE 'N271'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                             WHEN WS-RFR-MTOD

      *                'EMPLOYEE NOT RESTED; USE'HOSO'IF REQ'
                                MOVE 'E376'     TO MSGLOG-CODE
                             WHEN OTHER
      *CNLD-230-E
      *                'NOT ENOUGH HOURS TO COMPLETE CALL, USE HOSO TO
      *                                      OVERRIDE HOS RULE'
                                MOVE 'N264'     TO MSGLOG-CODE
      *CNLD-230-B
                          END-EVALUATE
      *CNLD-230-E
                       ELSE
      *CNC0600-E
      *                    CONTINUE
      *                'EMPLOYEES STATUS PROHIBITS CALL'
      *CNC0600-RPV-B
                          IF NOT WS-CAN-WRR-NEW
      *CNC0600-RPV-E
                             MOVE 'E030'  TO MSGLOG-CODE
      *CNLD-230-B
                          ELSE
                             EVALUATE TRUE
      *CNLD-259 B CNC0600
                                WHEN WS-RFR-LEAD-IN-SYS-UD

      *                   'LEAD TIME IS OVERLAPPING WITH SYS RESET UDR.'
                                   MOVE 'L050'     TO MSGLOG-CODE
                                WHEN WS-RFR-OD-IN-SYS-RB

      *                   'ON-DUTY TIME IS DURING SYS RESET BRK.'
                                   MOVE 'O098'     TO MSGLOG-CODE
      *CNLD-259 E
                                WHEN WS-RFR-7DAY-HRS

      *                   'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.'
                                   MOVE 'N268'     TO MSGLOG-CODE
      *CNLD-257-DXC-B
      *                         WHEN WS-RFR-60-192-HRS
                                WHEN WS-RFR-60-HRS

      *                   'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK.'
                                   MOVE 'N270'     TO MSGLOG-CODE
                                WHEN WS-RFR-192-HRS

      *                   'NOT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK.'
                                   MOVE 'N272'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                                WHEN WS-RFR-MTOD
      *CNLD-265
                                WHEN WS-RFR-PERS

      *                   'EMPLOYEE NOT RESTED.'
                                   MOVE 'E377'     TO MSGLOG-CODE
                                WHEN WS-RFR-7DAY-RND-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                   MOVE 'E378'     TO MSGLOG-CODE
                                WHEN WS-RFR-7DAY-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                   MOVE 'E379'     TO MSGLOG-CODE
      *CNLD-DXC-257-B
      *                         WHEN WS-RFR-60-192-ERT
                                WHEN WS-RFR-60-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK.'
                                   MOVE 'E380'     TO MSGLOG-CODE
                                WHEN WS-RFR-192-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK.'
                                   MOVE 'E383'     TO MSGLOG-CODE
      *CNLD-DXC-257-E
                             END-EVALUATE
      *CNLD-230-E
      *CNC0600-RPV-B
                          END-IF
      *CNC0600-RPV-E
      *                IF EMP-MTOD-NUM > MSTR3-SYSTEM-UD1-TO-NUM
      *                   MOVE EMP-MTOD-TIME(1:2) TO WS-UD-HH
      *                   MOVE EMP-MTOD-TIME(3:2) TO WS-UD-MM
      *                ELSE
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(1:2) TO WS-UD-HH
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(3:2) TO WS-UD-MM
      *                END-IF
      *                MOVE WS-UD-MESG  TO SCR08-PHONE(FUNC-SUB)
      *                MOVE YELLOW      TO SCR08-PHONE-COL(FUNC-SUB)
      *                MOVE RED         TO SCR08-NAME-COL(FUNC-SUB)
      *CNC0600-B
                       END-IF
      *CNC0600-E
      *CNC0600-RPV-B - COLOR ISSUE
                    IF WS-CAN-WRR-NEW
      *CNLD-244-B #3 CNC0600
      *                MOVE RED              TO SCR08-NAME-COL(FUNC-SUB)
                       IF WS-SAVE-REST-STATUS > SPACES
                          IF WS-SAVE-REST-STATUS = 'Y'
                             MOVE YELLOW  TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
                          IF WS-SAVE-REST-STATUS = 'R'
                             MOVE RED     TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
                       ELSE
                          MOVE RED        TO SCR08-NAME-COL(FUNC-SUB)
                       END-IF
      *CNLD-244-E
                    END-IF
      *CNC0600-RPV-E
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
              ELSE
                 IF P925-EMP-STATUS-RED
568000*CNLD-259 B CNC0600
      *          AND NOT P08CA-TR-DHD-HOME
                 AND ((NOT P08CA-TR-DHD-HOME)
570400                OR WS-RFR-LEAD-IN-SYS-UD
570400                OR WS-RFR-OD-IN-SYS-RB)
568000*CNLD-259 E
      *
      *             DOUBLE CHECK DHD-HOME STATUS TO CATCH EMPLOYEES
      *             IN AN ID POOL'S 'AWAY' HOME TERMINAL GOING HOME
      *
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO WK-ASGN-KEY
                    MOVE WK-ASGN-KEY-DIST         TO WK-CNTL-DIST
                    MOVE WK-ASGN-KEY-SDIST        TO WK-CNTL-SUB-DIST
                    MOVE WK-ASGN-KEY-POOL         TO WK-CNTL-POOL
                    MOVE '03'                     TO WK-CNTL-REC-TYPE
                    MOVE 'F'                      TO WK-CNTL-POOL-TYPE
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P2120-2' TO ERR-PARAGRAPH
                       MOVE CNTLKEY   TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    IF WK-TRCN-TR-FNL-STN NOT = CNTL-POOL-HOME-STATION
                    OR SCR08-ASGN(1:2)    NOT = 'DH'
568000*CNLD-259 B CNC0600
570400              OR WS-RFR-LEAD-IN-SYS-UD
570400              OR WS-RFR-OD-IN-SYS-RB
568000*CNLD-259 E
                       MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO     TO SCR08-FUNC-HI(FUNC-SUB)
      *CNC0600-B
                       IF P08CA-HOSO-ALLOW(FUNC-SUB)
      *CNLD-230-B
                          EVALUATE TRUE
                             WHEN WS-RFR-7DAY-RND-ERT

                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                                MOVE 'E373'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-ERT

                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY
      *                             RESET BRK. USE'HOSO'IF REQ'
                                MOVE 'E374'     TO MSGLOG-CODE
                             WHEN WS-RFR-7DAY-HRS

      *                'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.
      *                                        USE'HOSO'IF REQ'
                                MOVE 'N267'     TO MSGLOG-CODE
      *CNLD-257-DXC-B
      *                      WHEN WS-RFR-60-192-ERT
                             WHEN WS-RFR-60-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                                MOVE 'E375'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-ERT
                                MOVE P925-RFR-MSG
                                                TO WS-RFR-MSG
      *                'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK;
      *                                        USE'HOSO'IF REQ'
                                MOVE 'E382'     TO MSGLOG-CODE
      *                      WHEN WS-RFR-60-192-HRS
                             WHEN WS-RFR-60-HRS

      *                'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK;
      *                                           USE'HOSO'IF REQ'
                                MOVE 'N269'     TO MSGLOG-CODE
                             WHEN WS-RFR-192-HRS

      *                'NOT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK;
      *                                           USE'HOSO'IF REQ'
                                MOVE 'N271'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                             WHEN WS-RFR-MTOD

      *                'EMPLOYEE NOT RESTED; USE'HOSO'IF REQ'
                                MOVE 'E376'     TO MSGLOG-CODE
                             WHEN OTHER
      *CNLD-230-E
      *                'NOT ENOUGH HOURS TO COMPLETE CALL, USE HOSO TO
      *                                      OVERRIDE HOS RULE'
                                MOVE 'N264'     TO MSGLOG-CODE
      *CNLD-230-B
                          END-EVALUATE
      *CNLD-230-E
                       ELSE
      *CNC0600-E
      *                'EMPLOYEES STATUS PROHIBITS CALL'
      *CNC0600-RPV-B
                          IF NOT WS-CAN-WRR-NEW
      *CNC0600-RPV-E
                             MOVE 'E030'     TO MSGLOG-CODE
      *CNLD-230-B
                          ELSE
                             EVALUATE TRUE
      *CNLD-259 B CNC0600
                                WHEN WS-RFR-LEAD-IN-SYS-UD

      *                   'LEAD TIME IS OVERLAPPING WITH SYS RESET UDR.'
                                   MOVE 'L050'     TO MSGLOG-CODE
                                WHEN WS-RFR-OD-IN-SYS-RB

      *                   'ON-DUTY TIME IS DURING SYS RESET BRK.'
                                   MOVE 'O098'     TO MSGLOG-CODE
      *CNLD-259 E
                                WHEN WS-RFR-7DAY-HRS

      *                   'NOT ENOUGH HOURS LEFT FOR 7DAY RESET BRK.'
                                   MOVE 'N268'     TO MSGLOG-CODE
      *CNLD-257-DXC-B
      *                         WHEN WS-RFR-60-192-HRS
                                WHEN WS-RFR-60-HRS

      *                   'NOT ENOUGH HOURS LEFT ON 60/7 DAY CLOCK.'
                                   MOVE 'N270'     TO MSGLOG-CODE
                                WHEN WS-RFR-192-HRS

      *                   'NOT ENOUGH HOURS LEFT ON 192/28 DAY CLOCK.'
                                   MOVE 'N272'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                                WHEN WS-RFR-MTOD
      *CNLD-265
                                WHEN WS-RFR-PERS

      *                   'EMPLOYEE NOT RESTED.'
                                   MOVE 'E377'     TO MSGLOG-CODE
                                WHEN WS-RFR-7DAY-RND-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT=XXXX RNDTRIP:NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                   MOVE 'E378'     TO MSGLOG-CODE
                                WHEN WS-RFR-7DAY-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT=XXXX :NOT ENOUGH TIME FOR 7DAY RESET BRK.'
                                   MOVE 'E379'     TO MSGLOG-CODE
      *CNLD-257-DXC-B
      *                         WHEN WS-RFR-60-192-ERT
                                WHEN WS-RFR-60-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 60/7 DAY CLOCK.'
                                   MOVE 'E380'     TO MSGLOG-CODE
                                WHEN WS-RFR-192-ERT
                                   MOVE P925-RFR-MSG
                                                   TO WS-RFR-MSG
      *           'ERT XXXX :NOT ENOUGH HOURS ON 192/28 DAY CLOCK.'
                                   MOVE 'E383'     TO MSGLOG-CODE
      *CNLD-257-DXC-E
                             END-EVALUATE
      *CNLD-230-E
                          END-IF
      *CNC0600-NXA-B
      *                IF EMP-MTOD-NUM > MSTR3-SYSTEM-UD1-TO-NUM
      *                   MOVE EMP-MTOD-TIME(1:2) TO WS-UD-HH
      *                   MOVE EMP-MTOD-TIME(3:2) TO WS-UD-MM
      *                ELSE
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(1:2) TO WS-UD-HH
      *                   MOVE MSTR3-SYSTEM-UD1-TO-TIME(3:2) TO WS-UD-MM
      *                END-IF
      *                MOVE WS-UD-MESG  TO SCR08-PHONE(FUNC-SUB)
      *                MOVE YELLOW      TO SCR08-PHONE-COL(FUNC-SUB)
      *                MOVE RED         TO SCR08-NAME-COL(FUNC-SUB)
      *CNC0600-NXA-E
      *CNC0600-B
                       END-IF
      *CNC0600-E
      *CNC0600-RPV-B - COLOR ISSUE
                       IF WS-CAN-WRR-NEW
      *CNLD-244-B #3 CNC0600
      *                   MOVE RED         TO SCR08-NAME-COL(FUNC-SUB)
                          IF WS-SAVE-REST-STATUS > SPACES
                             IF WS-SAVE-REST-STATUS = 'Y'
                                MOVE YELLOW  TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                             IF WS-SAVE-REST-STATUS = 'R'
                                MOVE RED     TO SCR08-NAME-COL(FUNC-SUB)
                             END-IF
                          ELSE
                             MOVE RED        TO SCR08-NAME-COL(FUNC-SUB)
                          END-IF
      *CNLD-244-E
                       END-IF
      *CNC0600-RPV-E
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
              END-IF

      *CNLD-330-B COMMENTING
      **CNLD-245-B
      *        IF WS-EMP-US-STATUS-RED
      **             'EMPLOYEES STATUS PROHIBITS CALL'
      *           MOVE 'E030'           TO MSGLOG-CODE
      *           PERFORM P9000-SEND-MAP-AND-RETURN
      *        END-IF
      **CNLD-245-E
      *CNLD-330-E

              MOVE P08CA-EMP-NO(FUNC-SUB) TO P915-EMP-NO
              MOVE P925-REST-STATUS-FLAG  TO P915-EMP-REST-STATUS
              IF SCR08-USHR(FUNC-SUB)      > SPACES
                 AND P08CA-EMP-RESTED-NO(FUNC-SUB)
                 SET P915-US-REST-RED     TO TRUE
              ELSE
                 SET P915-US-REST-GREEN   TO TRUE
              END-IF
      *
      *       GET THE EMPLOYEE'S SHORT LEAD TIME, IF ANY, FOR USE IN
      *       P2130, BELOW.
      *
      *       MOVE SPACES                 TO WS-MSTR3
      *       MOVE EMP-NBR IN WS-MSTR     TO MSTR3NBRK
      *       PERFORM P8520-READ-MASTER3
              MOVE SPACES                    TO PS52-COMMAREA-PARMS
              MOVE EMP-NBR IN WS-MSTR        TO PS52-EMP-NBR
              SET PS52-CMA-MODE              TO TRUE
              MOVE WS-LOCAL-DATE-TIME        TO PS52-INPUT-DATE-TIME
              PERFORM P8800-LINK-TO-PS52
              IF SUCCESS
                 IF PS52-REQ-LEAD-TIME        > SPACES
                    AND PS52-REQ-LEAD-TIME    > '0000'
                    MOVE PS52-REQ-LEAD-TIME  TO HOLD-LEAD-TIME
                 END-IF
              END-IF
           END-IF
           IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
              MOVE P08CA-DEC-KEY(FUNC-SUB) TO P915-DECKEY
           END-IF
      *-------------------------------------------------------------
      *       FOR FASTSLOW SPAREBOARDS, THE BOARD USED IN THE
      *       SELECTION PROCES IS RETAINED FOR FURTHER PROCESSING.
      *       OTHERWISE, THIS FLAG IS SPACES.
      *----------------------------------------------------------PLS
           MOVE P08CA-FASTSLOW-BOARD(FUNC-SUB)
                                           TO P915-FASTSLOW-BOARD
           IF P08CA-SCHED-TURN(FUNC-SUB)
              OR P08CA-SCHED-POOL(FUNC-SUB)
              OR P08CA-SCHED-MKUP(FUNC-SUB)
              OR P08CA-SCHED-ALT(FUNC-SUB)
              MOVE P08CA-SCHD-KEY(FUNC-SUB) TO P915-SCHED-KEY
              MOVE P08CA-SCHD-CATCHUP-DATE(FUNC-SUB)
                                            TO P915-CALL-CATCHUP-DATE
      *C1150 - BEG
           ELSE
              IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
              OR  P08CA-SCHED-ALT-BIDPACK(FUNC-SUB))
              AND P08CA-BIDPACK-DATA-AREA(FUNC-SUB) > SPACES
                 MOVE P08CA-START-DATE-TIME(FUNC-SUB)(3:10)
                                            TO P915-HT-SCHEDULE-DTTM
                 MOVE P08CA-CALL-ORDER(FUNC-SUB)
                                            TO P915-HT-SCHED1-CALL-ORDER
      *C1150.1 - BEG

                 MOVE P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                                            TO P915-HT-CREW-SUPPLY
              ELSE
                 IF P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                    MOVE P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                                            TO P915-HT-CREW-SUPPLY
                 ELSE
                    IF NOT P08CA-NO-SCHED(FUNC-SUB)
                       IF P08CA-ASGN-MU(FUNC-SUB)
                          MOVE '9'          TO P915-HT-CREW-SUPPLY
      *C1150.3 - BEG
                       ELSE
                          IF P08CA-NON-BP-WITH-ALT(FUNC-SUB)
                             MOVE P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                                            TO P915-HT-CREW-SUPPLY
                          END-IF
      *C1150.3 - END
                       END-IF
                    END-IF
                 END-IF
      *C1150.1 - END
              END-IF
      *C1150.2 - BEG

              IF (P08CA-ASGN-IVR(FUNC-SUB)
              AND P08CA-HT-CREW-SUPPLY(FUNC-SUB) > SPACES)
                 MOVE P08CA-HT-CREW-SUPPLY(FUNC-SUB)
                                         TO P915-HT-CREW-SUPPLY
              END-IF
      *C1150.2 - END
      *C1150 - END
           END-IF
           MOVE SCR08-DH-RSN              TO P915-DH-RSN
           MOVE P08CA-VCNY-AVLIST-FLAG(FUNC-SUB)
                                          TO P915-VCNY-AVLIST-FLAG
           IF P08CA-STARTS-DISQUALIFIED(FUNC-SUB)
              MOVE P08CA-STARTS-TOTAL(FUNC-SUB)
                                          TO P915-DISQUALIFIED-STARTS
           ELSE
              MOVE ZEROS                  TO P915-DISQUALIFIED-STARTS
           END-IF
           MOVE WS-SAVE-ALT-EN-TK-PROFILE TO P915-ALT-EN-TK-PROFILE
           MOVE WS-SAVE-ALT-TR-TK-PROFILE TO P915-ALT-TR-TK-PROFILE
      *
           IF SCR08-SIDE-TRIP = 'Y'
              MOVE SCR08-SIDE-TRIP            TO P915-SIDE-TRIP
           END-IF
           MOVE P08CA-RJHS-EMPNO(FUNC-SUB)    TO P915-RJHS-EMPNO
      *
           IF IVR-CALL-FUNCTION
              SET P915-FROM-IVR-CALL      TO TRUE
           END-IF
      *CNC0534-BEG
           MOVE WS-EMP-AT-FLAG            TO P915-CALLED-FROM-HOME-FL
      *CNC0534-END
      *CNLD-207-DXC-B
           MOVE P925-CAN-WRR-LEAD-TIME    TO P915-CAN-WRR-LEAD-TIME
      *CNLD-207-DXC-E
      *
           EXEC CICS LINK
                     PROGRAM(P915-PGM)
                     COMMAREA(P915-COMMAREA-PARMS)
                     LENGTH(P915-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2120-3' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF P915-TURN-NOT-FND
              MOVE EIBTRMID              TO P08-TSQ-TERM
              EXEC CICS DELETEQ TS
                        QUEUE(P08-TSQ-ID)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE P915-ERROR-CODE       TO PSTCA-ERROR-CODE
              PERFORM P9100-SETUP-SCR03
           END-IF
      *
      *    CNC0413 - UPDATE TRACKED EMPLOYEES' HOS REST STATUSES, IF
      *    DEALING WITH AN AWAY-FROM-HOME CALL OR DEADHEAD EMPLOYEE.
      *
           IF (CALL-FUNCTION OR IVR-CALL-FUNCTION)
           AND P08CA-EMP-NO(FUNC-SUB) IS NUMERIC
              PERFORM P2130-CALC-TRKEMP-HOS
           END-IF
           MOVE -1                       TO SCR08-FUNC-CURSOR(FUNC-SUB)
           .
      *
       P2130-CALC-TRKEMP-HOS.
      *
      *    BROWSE THROUGH ALL EMPLOYEES BEING TRACKED ON THE ASSIGNMENT
      *
      *    IF THE WORKING EMPLOYEE HAD A SHORT LEAD TIME, PASS
      *    IT ALONG TO CNP925 FOR USE IN THE TRACKED EMPLOYEE'S
      *    HOS CALCULATION.
      *
           SET CALC-TRK-HOS                   TO TRUE

           MOVE SPACES                        TO WS-EMP-TRACK
           IF UFP-CALL
              SET EMPTRK-ASG-UFP              TO TRUE
           ELSE
              SET EMPTRK-ASG-AJ               TO TRUE
           END-IF
           MOVE P08CA-ASGN-KEY(FUNC-SUB)      TO EMPTRK-ASSIGNMENT
           MOVE ZEROES                        TO EMPTRK-ASGN-SEQ-NUM
           SET ETRK-NOT-DONE                  TO TRUE
           PERFORM UNTIL ETRK-DONE
              ADD  1                          TO EMPTRK-ASGN-SEQ-NUM
              MOVE EMPTRKASGNKEY-AREA         TO ETRACK-ASGNKEY
              EXEC CICS READ
                        DATASET(ETRACK-VIA-ASGN)
                        INTO(WS-EMP-TRACK)
                        RIDFLD(ETRACK-ASGNKEY)
                        LENGTH(ETRACK-ASGN-RLGTH)
                        KEYLENGTH(ETRACK-ASGN-KLGTH)
                        GTEQ
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE                TO FILE-STATUS
              IF SUCCESS
                 IF ((EMPTRK-ASG-UFP  AND UFP-CALL)
                    OR (EMPTRK-ASG-AJ AND NOT UFP-CALL))
                    AND EMPTRK-ASSIGNMENT = P08CA-ASGN-KEY(FUNC-SUB)
      *
      *             IF WE'RE DEALING WITH AN AWAY-FROM-HOME CALL, OR
      *             AN EMPLOYEE WHOSE TRACKING INITIATED VIA A DEADHEAD,
      *             GET THEIR REST STATUS.
      *
                    IF P925-TERM = 'A'
                       OR EMPTRK-DHEMP
                       MOVE EMPTRK-EMP-NO     TO MSTRNBRK
                       PERFORM P8505-READ-MASTER-ONLY
                       PERFORM P2950-GET-HRS-SVC-INFO
                       IF P925-REST-STATUS-FLAG
                                           NOT = EMPTRK-REST-STATUS-FLAG
                          AND NOT (P925-EMP-STATUS-UNKNOWN
                          OR P925-EMP-STATUS-NA)
                          PERFORM P2135-UPDATE-HOS-STATUS
                       END-IF
                    END-IF
                 ELSE
                    SET ETRK-DONE             TO TRUE
                 END-IF
              ELSE
                 SET ETRK-DONE                TO TRUE
                 IF NOT (NO-RECORD-FND OR END-OF-FILE)
                    MOVE 'P2130-1'            TO ERR-PARAGRAPH
                    MOVE ETRACK-ASGNKEY       TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-PERFORM
      *
      *    SET CALC-TRK-NOS-NO TO TRUE SO THAT THE NEXT TIME WE LINK TO
      *    CNP925, WE DON'T INADVERTENTLY INCLUDE VIRTUAL HOS RECORDS
      *    IN THE WORKING EMPLOYEE'S HOS CALCULATIONS.
      *
           SET CALC-TRK-HOS-NO             TO TRUE
           .
      *
       P2135-UPDATE-HOS-STATUS.
      *
           MOVE EMPTRKKEY-AREA                TO ETRACK-EMPKEY
           EXEC CICS READ
                     UPDATE
                     DATASET(ETRACK-VIA-EMP)
                     INTO(WS-EMP-TRACK)
                     LENGTH(ETRACK-EMP-RLGTH)
                     RIDFLD(ETRACK-EMPKEY)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF SUCCESS
              MOVE P925-REST-STATUS-FLAG      TO EMPTRK-REST-STATUS-FLAG
              IF NOT EMPTRK-VALID-REST-STATUS
                 SET EMPTRK-EMP-STATUS-GREEN  TO TRUE
              END-IF
              EXEC CICS REWRITE
                        DATASET(ETRACK-VIA-EMP)
                        FROM(WS-EMP-TRACK)
                        LENGTH(ETRACK-EMP-RLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE                TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2135-1'               TO ERR-PARAGRAPH
                 MOVE ETRACK-EMPKEY           TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
              IF NOT NO-RECORD-FND
                 MOVE 'P2135-2'               TO ERR-PARAGRAPH
                 MOVE ETRACK-EMPKEY           TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
           .
      *
       P2150-CHECK-LAST-TIE-UP.
      *
           IF P08CA-EMP-NO(FUNC-SUB) > SPACES
              MOVE P08CA-EMP-NO(FUNC-SUB) TO MSTRNBRK
              PERFORM P8505-READ-MASTER-ONLY
              IF SUCCESS
                 IF WORKING OF WS-MSTR OR
                   ((TUT-DATE > SCR08-OD-DATE(FUNC-SUB)) OR
                    (TUT-DATE = SCR08-OD-DATE(FUNC-SUB) AND
                     TUT-TIME-OF-DAY > SCR08-OD-TIME(FUNC-SUB)))
                    MOVE -1           TO SCR08-OD-TIME-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO    TO SCR08-OD-TIME-HI    (FUNC-SUB)
      *    FRA PROHIBITS CALL PRIOR TO LAST TIE UP OR IF ALREADY ON DUTY
                    MOVE 'C226'       TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              END-IF
           END-IF
           .
      *
       P2200-PROCESS-FILL-FUNCTION.
      *
           IF FILL-VACANCY
              SET P08CA-NOT-CLEARED   TO TRUE
           END-IF
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              IF FILL-VACANCY
                 SET P08CA-CLEARED    TO TRUE
                 MOVE SPACES          TO P08CA-DEC-KEY(FUNC-SUB)
                                         P08CA-LAST-SEN(FUNC-SUB)
                                         P08CA-LAST-POS(FUNC-SUB)
                                         P08CA-PRIORITY-ONLY(FUNC-SUB)
                                         P08CA-REST-CODE(FUNC-SUB)
                                         P08CA-LAST-STARTS(FUNC-SUB)
                                         P08CA-EMP-NO(FUNC-SUB)
                 PERFORM P2210-CREATE-ASSIGNMENT
                 IF P08CA-SCHED-BIDPACK(FUNC-SUB)
                    OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                    OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                    SET P08CA-SCHED-COMPLETE(FUNC-SUB)
                                      TO TRUE
                 END-IF
              ELSE
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *                 'IMPROPER FUNCTION - USE "FILL" TO CREATE '
      *                 'TEMPORARY ASSIGNMENT'
                 MOVE 'I051' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
      *
      *  MAKE SURE CREW CALLER ISN'T TRYING TO REJECT
      *     SOMEONE THEY JUST "HELPED" ON THE JOB.
      *
           IF REJECT-EMPLOYEE-FUNCTION
              AND P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
               MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *               'IMPROPER FUNCTION - EMPLOYEE CANNOT BE REJECTED'
      *               'WHEN HELPED ON THE JOB'
               MOVE 'I047' TO MSGLOG-CODE
               PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           IF REJECT-AND-HOLD
              IF (P08CA-ASGN-IS-VCNY(FUNC-SUB)
                 AND P08CA-EMP-NO(FUNC-SUB) NOT NUMERIC)
                 OR P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *               'IMPROPER FUNCTION FOR A "VACANCY"'
                 MOVE 'I054' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
              IF P08CA-EMP-NO(FUNC-SUB) NOT = P08CA-REG-EMP-NO(FUNC-SUB)
                 MOVE P08CA-TRK-REASON(FUNC-SUB)  TO HOLD-INIT-REASON
              END-IF
              SET P08CA-TRK-RJH(FUNC-SUB) TO TRUE
              IF P08CA-EMP-NO(FUNC-SUB) NUMERIC
                 PERFORM P8080-INITIATE-TRACKING
              END-IF
              SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
              IF P08CA-EMP-NO(FUNC-SUB) NOT = P08CA-REG-EMP-NO(FUNC-SUB)
                 MOVE HOLD-INIT-REASON  TO P08CA-TRK-REASON(FUNC-SUB)
              END-IF
           ELSE
              IF (REJECT-EMPLOYEE-FUNCTION AND NOT REJECT-NOT-RESTED) OR
                 (REJECT-NOT-RESTED AND SCR08-ST(FUNC-SUB) NOT = 'NR'
                  AND SCR08-MTOD(FUNC-SUB) NOT > SPACES
                  AND SCR08-USHR(FUNC-SUB) NOT > SPACES
                  AND SCR08-PERS(FUNC-SUB) NOT > SPACES)
                 IF NOT P08CA-ASGN-IVR-XFER(FUNC-SUB)
                    IF P08CA-DEC-KEY(FUNC-SUB)       NOT  > SPACES
                       OR P08CA-SENR-RESTRICTED(FUNC-SUB)
                       MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *                       '"FILL" IS REQUIRED BEFORE "REJECT" '
      *                       'IS POSSIBLE'
                       MOVE 'F010' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
              ELSE
                 IF REJECT-NOT-RESTED AND
                    (SCR08-ST(FUNC-SUB) = 'NR' OR
                     SCR08-MTOD(FUNC-SUB) > SPACES OR
                     SCR08-USHR(FUNC-SUB) > SPACES OR
                     SCR08-PERS(FUNC-SUB) > SPACES)
                    SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                 END-IF
                 IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES AND
                    P08CA-ASGN-IS-BOTH(FUNC-SUB)
                    MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *                  'ASSIGNMENT IS NOT A "VACANCY"'
                    MOVE 'A003' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF NOT (P08CA-ASGN-IS-VCNY(FUNC-SUB) OR
                         P08CA-ASGN-IS-BOTH(FUNC-SUB))
                    MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *                  'ASSIGNMENT IS NOT A "VACANCY"'
                    MOVE 'A003' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              END-IF
           END-IF
      *CNC0499-BEG
           IF REJECT-EMPLOYEE-FUNCTION
           OR CREW-CONSIST-RJSU
              IF UFP-CALL
              AND WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                 MOVE FUNC-SUB TO HOLD-FUNC-SUB
                 PERFORM VARYING SUBA FROM 1 BY 1
                           UNTIL SUBA > 10
                    IF WS-ASSOC-CRAFT(SUBA) > SPACES
                       IF OPTIONAL-TURN(SUBA)
                          PERFORM VARYING SUBB FROM 1 BY 1
                                    UNTIL SUBB > ARRAY-MAX
                             IF SCR08-CC(SUBB) = WS-ASSOC-CRAFT(SUBA)
                                MOVE SUBB TO FUNC-SUB
      *                        IF (P08CA-ASGN-IS-VCNY(HOLD-FUNC-SUB)
      *                        AND SCR08-NORM-ASG(HOLD-FUNC-SUB)(1:6) =
      *                            SCR08-NORM-ASG(FUNC-SUB)(1:6))
                                IF (P08CA-ASGN-KEY(FUNC-SUB) > SPACES
                                AND P08CA-EMP-NO(FUNC-SUB)   >  SPACES)
                                   IF P08CA-ASGN-MU(FUNC-SUB)
                                      MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                                              TO UFPTURN
                                      PERFORM P8600-READ-UFPTURN
                                      IF NOT SUCCESS
                                         MOVE 'P2200-1' TO ERR-PARAGRAPH
                                         MOVE UFPTURN TO ERR-KEY
                                         PERFORM P9999-GOT-PROBLEM
                                      END-IF
                                      MOVE ZEROS TO UFP-POSITION-TIME
                                      MOVE UFPPOS-AREA TO WORK-UFPPOS
                                      PERFORM P8040-PROCESS-DELETE
                                      MOVE SPACES
                                             TO P08CA-ASGN-KEY(FUNC-SUB)
                                      PERFORM P1060-CLEAR-DATA-LINE
                                   END-IF
                                END-IF
      *                        END-IF
                             END-IF
                          END-PERFORM
                       END-IF
                    ELSE
                       MOVE 10 TO SUBA
                    END-IF
                 END-PERFORM
                 MOVE HOLD-FUNC-SUB TO FUNC-SUB
                 MOVE SCR08-FUNC(FUNC-SUB)  TO WS-FUNCTION-CODE
              END-IF
           END-IF
      *CNC0499-END

           IF FILL-VACANCY
              AND P08CA-NOT-CLEARED
              MOVE SPACES             TO P08CA-DEC-KEY(FUNC-SUB)
                                         P08CA-LAST-SEN(FUNC-SUB)
                                         P08CA-LAST-POS(FUNC-SUB)
                                         P08CA-PRIORITY-ONLY(FUNC-SUB)
                                         P08CA-REST-CODE(FUNC-SUB)
                                         P08CA-LAST-STARTS(FUNC-SUB)
                                         P08CA-EMP-NO(FUNC-SUB)
           END-IF

      *CNC0578-BEG
           IF CREW-CONSIST-RJSU
      *09/26/16 - BEG
      *       PERFORM P2260-WRITE-NO-FUNC-HISTORY
              IF YARD-CALL OR LOCAL-CALL
                 PERFORM P2265-WRITE-NO-FUNC-YARD-LO
              ELSE
                 PERFORM P2260-WRITE-NO-FUNC-HISTORY
              END-IF
      *09/26/16 - END
           END-IF
      *CNC0578-END
           MOVE SCR08-FUNC(FUNC-SUB)           TO P923-FILL-FUNC-CODE
      *
      *    IF WE ARE REJECTING THE EMPLOYEE, AND HE'S BEING TREATED AS
      *    'MISS CALLED', SET THE P923-FILL-FUNC-CODE TO 'MCAL' SO THAT
      *    923 DOESN'T WRITE A SECOND HISTORY RECORD FOR HIM.
      *
           IF NOT REJECT-EMPLOYEE-FUNCTION
              AND P923-REJECT-EMPLOYEE-FUN
              MOVE WS-FUNCTION-CODE            TO P923-FILL-FUNC-CODE
           END-IF
      *
           IF YARD-CALL OR LOCAL-CALL
              SET AJ-VACANCY                   TO TRUE
      *MET 06/08/2006
              IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
                 MOVE P08CA-ASGN-KEY-XB(FUNC-SUB)(2:12)
                                               TO AJJOBKEY-AREA
                                                  P923-CALLED-ASGN
              ELSE
                 MOVE P08CA-ASGN-KEY(FUNC-SUB) TO AJJOBKEY-AREA
                                                  P923-CALLED-ASGN
              END-IF
              MOVE P08CA-JSKEY1(FUNC-SUB)      TO P923-ASSIGNMENT
              MOVE SCR08-DIST                  TO P923-DIST
              MOVE SCR08-SUB-DIST              TO P923-SUB-DIST
              IF YARD-CALL
                 MOVE JOB-DEF-YARD-POOL        TO P923-POOL-SERV
              ELSE
                 MOVE JOB-DEF-LOCAL-POOL       TO P923-POOL-SERV
              END-IF
              MOVE '0'                         TO P923-TERMINAL
              IF YARD-CALL
                 PERFORM P2951-CALC-ERT
                 MOVE WS-HR-MN                 TO P923-AJ-ERT
              END-IF
           ELSE
              SET UFP-VACANCY                  TO TRUE
              MOVE P08CA-ASGN-KEY(FUNC-SUB)    TO UFPTURN
              PERFORM P8600-READ-UFPTURN
              IF NOT SUCCESS
                 MOVE 'P2200-2'    TO ERR-PARAGRAPH
                 MOVE UFPTURN      TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE P08CA-ASGN-KEY(FUNC-SUB)    TO P923-ASSIGNMENT
                                                  P923-CALLED-ASGN
              MOVE DIST OF WS-UFP              TO P923-DIST
              MOVE SUB-DIST OF WS-UFP          TO P923-SUB-DIST
              MOVE POOL-NAME OF WS-UFP         TO P923-POOL-SERV
              MOVE IN-OUT-TERMINAL             TO P923-TERMINAL
           END-IF
      *
           PERFORM P6500-FIND-ASGN-CLASS
           MOVE WS-ASGN-MERG-CLASS             TO P923-ASGN-MERG-CLASS
           MOVE SCR08-CC(FUNC-SUB)             TO WS-CRAFT-CODE-CHECK
           IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
              MOVE P08CA-DEC-KEY(FUNC-SUB)     TO P923-DEC-KEY
              IF P08CA-LAST-SEN(FUNC-SUB) > SPACE
                 MOVE P08CA-LAST-SEN(FUNC-SUB) TO P923-LAST-SEN-DATE
              END-IF
              IF P08CA-LAST-POS(FUNC-SUB) > SPACE
                 MOVE P08CA-LAST-POS(FUNC-SUB) TO P923-LAST-POSITION
              END-IF
              IF P08CA-LAST-STARTS(FUNC-SUB) > SPACE
                 MOVE P08CA-LAST-STARTS(FUNC-SUB) TO P923-LAST-STARTS
              END-IF
              IF FILL-VACANCY-FUNCTION
                 IF P08CA-EMP-NO(FUNC-SUB)   NUMERIC
                    MOVE P08CA-EMP-NO(FUNC-SUB)
                                          TO P923-EMP-NO
                 END-IF
              END-IF
           ELSE
              SET VACANCY-IS-MUST-FILL       TO TRUE
      *
      *       THERE MAY BE TRASH IN THE SVC OVERRIDE FIELDS (LEFT OVER
      *       FROM SOME PREVIOUS USE OF THIS DATA ERROR), SO MAKE SURE
      *       THAT THE OVERRIDE CRAFT CODE IS VALID
      *
              IF TRCN-DEC-CC-OVERRIDE > SPACES
                 MOVE TRCN-DEC-CC-OVERRIDE  TO WS-CRAFT-CODE-CHECK
                 IF NOT VALID-CRAFT
                    MOVE SPACES             TO TRCN-DEC-CC-OVERRIDE
                                               TRCN-DEC-SVC-OVERRIDE
                 END-IF
                 MOVE SCR08-CC(FUNC-SUB)    TO WS-CRAFT-CODE-CHECK
              END-IF
              IF TRCN-DEC-CC-OVERRIDE > SPACES
                 PERFORM P2230-CHECK-SVC-OVERRIDE
              ELSE
                 SET DONT-USE-SVC-OVERRIDE  TO TRUE
              END-IF
              IF USE-SVC-OVERRIDE
                 MOVE TRCN-DEC-SVC-OVERRIDE TO P923-DEC-SVC-CODE
              ELSE
                 PERFORM VARYING SUBA FROM 1 BY 1
                    UNTIL SUBA > 8
                    IF TRCN-DEC-SVC-CC(SUBA) = SCR08-CC(FUNC-SUB)
                       MOVE TRCN-DEC-SVC(SUBA) TO P923-DEC-SVC-CODE
                    END-IF
                 END-PERFORM
                 IF P923-DEC-SVC-CODE NOT > SPACES
                    MOVE SPACES                  TO WS-HOLD-CC
                    EVALUATE TRUE
                    WHEN ENGINEER-CRAFT
                       MOVE ENGINEER-MSTR-CC     TO WS-HOLD-CC
                    WHEN FIREMAN-CRAFT OR 2ND-ENGINEER-CRAFT
                       MOVE 2ND-ENGINEER-MSTR-CC TO WS-HOLD-CC
                    WHEN CONDUCTOR-CRAFT
                       MOVE CONDUCTOR-MSTR-CC    TO WS-HOLD-CC
                    WHEN FOREMAN-CRAFT
                       MOVE FOREMAN-MSTR-CC      TO WS-HOLD-CC
                    WHEN SWITCHMAN-CRAFT
                       MOVE SWITCHMAN-MSTR-CC    TO WS-HOLD-CC
                    WHEN BRAKEMAN-CRAFT
                       MOVE BRAKEMAN-MSTR-CC    TO WS-HOLD-CC
      *CNC0531-BEG
                    WHEN YARDMASTER-CRAFT
                       MOVE YARDMASTER-MSTR-CC  TO WS-HOLD-CC
      *CNC0531-END
                    END-EVALUATE
                    IF WS-HOLD-CC > SPACES
                       PERFORM VARYING SUBA FROM 1 BY 1
                          UNTIL SUBA > 8
                          IF WS-HOLD-CC = TRCN-DEC-SVC-CC(SUBA)
                             MOVE TRCN-DEC-SVC(SUBA)
                                               TO P923-DEC-SVC-CODE
                          END-IF
                       END-PERFORM
                    END-IF
                 END-IF
              END-IF
           END-IF
           IF ENGINE-CRAFT
              MOVE P08CA-EN-LEAD-TIME          TO P923-LEAD-TIME
              IF P08CA-EN-DHD-HOME
                 SET P923-DEADHEAD-HOME        TO TRUE
              END-IF
           ELSE
              MOVE P08CA-TR-LEAD-TIME          TO P923-LEAD-TIME
              IF P08CA-TR-DHD-HOME
                 SET P923-DEADHEAD-HOME        TO TRUE
              END-IF
           END-IF

      *     IF THE OD-DATE-TIME HAS BEEN ADJUSTED FOR DEADHEAD TIME
      *     RETURN THE FIELD TO THE ORIGINAL TIME WHEN LINKING TO 923
      *     AGAIN TO PREVENT DOUBLE REDUCTION OF CALL TIME. CNC0283

      *TJR 03/01/2001 NOW ITS TIME TO USE THE ORIG VALUE SAVED. THE
      *               DEADHEAD COMMENT ABOVE NO LONGER APPLIES. WE WILL
      *               ALWAYS USE THE ORIG VALUE ENTERED/FILLED IN ON THE
      *               SCREEN. THIS WILL TAKE CARE OF THE DEADHEAD
      *               PROBLEM, AND ALSO THE SITUATION WHERE THE USER
      *               ENTERED A DIFF ON DUTY DATE-TIME THAN THE ORDER
      *               DATE-TIME AND WE WERE OVERLAYING IT WITH THE ORDER
      *               DATE-TIME.

           MOVE SPACES                   TO P923-SAVE-CALL-DATE-TIME
           IF  P08CA-USER-ENTERED-DATE-TIME (FUNC-SUB) > SPACES
               MOVE P08CA-USER-ENTERED-DATE(FUNC-SUB)
                 TO P923-CALL-DATE
                    SCR08-OD-DATE(FUNC-SUB)
               MOVE P08CA-USER-ENTERED-TIME(FUNC-SUB)
                 TO P923-CALL-TIME
                    SCR08-OD-TIME(FUNC-SUB)
           ELSE
      *        SHOULD NEVER TAKE THIS PATH, BUT JUST IN CASE
      * #1490  THIS PATH IS TAKEN WHEN PERFORMING ORDER-VX REJECTS
               IF SCR08-OD-DATE(FUNC-SUB) > SPACES
                  MOVE SCR08-OD-DATE(FUNC-SUB)
                                           TO P923-CALL-DATE
               ELSE
                  MOVE SCR08-ORDER-DATE    TO P923-CALL-DATE
                                              SCR08-OD-DATE(FUNC-SUB)
               END-IF
               IF SCR08-OD-TIME(FUNC-SUB) > SPACES
                  MOVE SCR08-OD-TIME(FUNC-SUB)
                                           TO P923-CALL-TIME
               ELSE
                  MOVE SCR08-ORDER-TIME    TO P923-CALL-TIME
                                              SCR08-OD-TIME(FUNC-SUB)
               END-IF
           END-IF

           MOVE SCR08-ORDER-DATE           TO P923-ORDER-DATE
           MOVE SCR08-ORDER-TIME           TO P923-ORDER-TIME

      ***  IF REJECT-EMPLOYEE-FUNCTION
      ***     MOVE SPACES                   TO P923-SAVE-CALL-DATE-TIME
      ***     MOVE SCR08-ORDER-DATE           TO P923-CALL-DATE
      ***                                        SCR08-OD-DATE(FUNC-SUB)
      ***     MOVE SCR08-ORDER-TIME           TO P923-CALL-TIME
      ***                                        SCR08-OD-TIME(FUNC-SUB)
      ***  ELSE
      ***     MOVE SCR08-OD-DATE(FUNC-SUB)     TO P923-CALL-DATE
      ***     MOVE SCR08-OD-TIME(FUNC-SUB)     TO P923-CALL-TIME
      ***  END-IF

           MOVE PSTCA-TIME-ZONE                TO P923-TIME-ZONE
           IF YARD-CALL
              MOVE SCR08-ASGN                  TO P923-TRAIN
           ELSE
              STRING SCR08-ASGN
                     SCR08-ASGN-TYPE
                     DELIMITED BY SIZE
                     INTO P923-TRAIN
           END-IF
           IF REJECT-EMPLOYEE-FUNCTION  OR  LAYOFF-ON-CALL
              MOVE P08CA-EMP-NO(FUNC-SUB) TO P923-EMP-NO
           END-IF
           MOVE P08CA-PROFILE-KEY             TO P923-ASGN-PROFILE-KEY
           MOVE P08CA-REST-CODE(FUNC-SUB)     TO P923-REST-CODE
      *    MOVE PSTCA-SUB                     TO P923-SUB-CODE
           MOVE SCR08-ORDER-TIME              TO P923-ASGN-CALL-TIME
           EXEC CICS LINK
                     PROGRAM(P923-PGM)
                     COMMAREA(P923-COMMAREA-PARMS)
                     LENGTH(P923-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2200-3' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
           MOVE P923-CALL-DATE        TO SCR08-OD-DATE(FUNC-SUB)
      *TJR 03/01/2001 SAVE TO THE COMMAREA
                               P08CA-SCREEN-SAVED-DATE(FUNC-SUB)
           MOVE P923-CALL-TIME        TO SCR08-OD-TIME(FUNC-SUB)
                               P08CA-SCREEN-SAVED-TIME(FUNC-SUB)
      *
           MOVE P923-ERRORMSG      TO SCR08-ERRORMSG
           MOVE SPACES             TO SCR08-FUNC(FUNC-SUB)
      *C749
           MOVE SPACES             TO P08CA-VCNY-AVLIST-FLAG(FUNC-SUB)
           IF GOT-MAN
              MOVE P923-DEC-KEY    TO DECKEY
              PERFORM P8630-READ-DECISION
              IF FROM-AVAIL-LIST
                 SET P08CA-VCNY-AVLIST(FUNC-SUB)
                                   TO TRUE
              END-IF
              MOVE P923-DEC-KEY       TO P08CA-DEC-KEY(FUNC-SUB)
              MOVE P923-LAST-SEN-DATE TO P08CA-LAST-SEN(FUNC-SUB)
              MOVE P923-LAST-POSITION TO P08CA-LAST-POS(FUNC-SUB)
              MOVE P923-LAST-STARTS   TO P08CA-LAST-STARTS(FUNC-SUB)
              MOVE P923-EMP-NO        TO MSTRNBRK
              MOVE P923-REST-CODE     TO P08CA-REST-CODE(FUNC-SUB)
      *-------------------------------------------------------------
      *       FOR FASTSLOW SPAREBOARDS, THE BOARD SIDE USED IN THE
      *       SELECTION PROCESS IS RETAINED.
      *----------------------------------------------------------PLS
              MOVE P923-FASTSLOW-BOARD
                           TO P08CA-FASTSLOW-BOARD(FUNC-SUB)
      * #1328 JES
              SET P08CA-TURNS-RESET   TO TRUE
              PERFORM P1040-SETUP-NAME-LINE
      *CNC0579 - BEG
              MOVE SPACES            TO P08CA-DEC-RPT-LOCATION(FUNC-SUB)
              IF DEC-IVR-RPT-AT-HOME
                 IF DEC-VCNY-RPT-LOCATION > SPACES
                    MOVE DEC-VCNY-RPT-LOCATION
                                     TO P08CA-DEC-RPT-LOCATION(FUNC-SUB)
                 ELSE
                    IF EMP-HOME-TERM-CODE > SPACES
                       MOVE EMP-HOME-TERM-CODE
                                     TO P08CA-DEC-RPT-LOCATION(FUNC-SUB)
                    END-IF
                 END-IF
              END-IF
      *CNC0579 - END
      *#1529S
              SET WS-FROM-P2200       TO TRUE
              PERFORM P1010-TEST-OWNER
              MOVE SPACE                       TO P08CA-TURNS-RESET-FLAG
              IF REJECT-EMPLOYEE-FUNCTION  OR  LAYOFF-ON-CALL
                 SET P08CA-RESUB(FUNC-SUB)     TO TRUE
              END-IF
      *CNC0499-BEG
              IF TEMPORARY-ASGNMT > SPACE
                 MOVE TEMPORARY-ASGNMT-FLAG    TO NORMAL-ASGNMT-FLAG
                 MOVE TEMPORARY-ASGNMT         TO NORMAL-ASGNMT
              END-IF
              IF NORM-ASGN-UFP
      *CNC0499-1-BEG
      *          CREATE TURN FOR ASSOCIATED CRAFT.
                 PERFORM P2250-CREATE-TURN-FOR-TRAINEE
      *CNC0499-1-END
                 MOVE SPACES                   TO WORK-CNTLKEY
                 MOVE NA-DIST                  TO WK-CNTL-DIST
                 MOVE NA-SUB-DIST              TO WK-CNTL-SUB-DIST
                 MOVE NA-POOL                  TO WK-CNTL-POOL
                 IF SCR08-CC(FUNC-SUB) =
                    ('EN' OR 'FI' OR 'SE' OR 'ET')
                    PERFORM P0370-SET-EN-MARRIED-FLAGS
                 ELSE
                    PERFORM P0380-SET-TR-MARRIED-FLAGS
                 END-IF
                 PERFORM P0390-SETUP-ASSOC-CRAFTS
                 IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                    PERFORM P2240-GET-ASSOC-TURNS
                 END-IF
      *12/16/16 - BEG
              ELSE
                 IF REJECT-EMPLOYEE-FUNCTION
                 OR CREW-CONSIST-RJSU
                    IF (UFP-CALL
                    AND WS-ASSOCIATED-CRAFT-ARRAY > SPACES)
                       IF (WS-ASSOC-CRAFT(FUNC-SUB) > SPACES
                       AND OPTIONAL-TURN (FUNC-SUB))
                          PERFORM P2270-CHK-ASSOC-TURNS
                       END-IF
                    END-IF
                 END-IF
      *12/16/16 - END
              END-IF
      *CNC0499-END
           ELSE
              PERFORM P1060-CLEAR-EMP-LINE
              SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
              IF P08CA-TRK-REASON(FUNC-SUB) NOT > SPACES
                 SET P08CA-TRK-UNKNOWN(FUNC-SUB)  TO TRUE
              END-IF
              IF END-OF-DECISIONS
                 MOVE SPACES TO P08CA-DEC-KEY(FUNC-SUB)
                                P08CA-LAST-SEN(FUNC-SUB)
                                P08CA-LAST-POS(FUNC-SUB)
                                P08CA-LAST-STARTS(FUNC-SUB)
                                P08CA-EMP-NO(FUNC-SUB)
                                P08CA-REST-CODE(FUNC-SUB)
              ELSE
                 MOVE P923-DEC-KEY       TO P08CA-DEC-KEY(FUNC-SUB)
                 MOVE P923-LAST-SEN-DATE TO P08CA-LAST-SEN(FUNC-SUB)
                 MOVE P923-LAST-POSITION TO P08CA-LAST-POS(FUNC-SUB)
                 MOVE P923-LAST-STARTS   TO P08CA-LAST-STARTS(FUNC-SUB)
                 MOVE SPACES             TO P08CA-EMP-NO(FUNC-SUB)
              END-IF
              MOVE P923-NAME-AREA     TO SCR08-NAME(FUNC-SUB)
              MOVE YELLOW             TO SCR08-NAME-COL(FUNC-SUB)
           END-IF
           MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB).
           IF REJECT-EMPLOYEE-FUNCTION
           AND WS-IVR-CANCEL-ALLOWED
              PERFORM P5210-PROCESS-IVR-CANCEL
      *12/22/16 - BEG
              SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
      *12/22/16 - END
           END-IF.
      *
       P2210-CREATE-ASSIGNMENT.
      *
           IF UFP-CALL
              MOVE SPACES TO P916-COMMAREA-PARMS
      *
      *       SET THE FUNCTION ON THE "PRIMARY" TURN IF NECESSARY
      *
              IF ASSOCIATED-TURN
                 PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                    UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                    IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                       AND PRIMARY-TURN(CRAFT-SUB)
                       PERFORM VARYING SUB1 FROM 1 BY 1
                          UNTIL SUB1 > ARRAY-MAX
                          IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                             IF ASSOCIATED-OPT-TURN
                                IF P08CA-ASGN-KEY(SUB1) NOT > SPACE
                                   MOVE -1
                                      TO SCR08-FUNC-CURSOR(FUNC-SUB)
                                   MOVE REV-VIDEO
                                      TO SCR08-FUNC-HI(FUNC-SUB)
      *                                   '"PRIMARY" TURN MUST BE '
      *                                   'CREATED BEFORE TURN CAN '
      *                                   'BE "MADE UP"'
                                   MOVE 'P008' TO MSGLOG-CODE
                                   PERFORM P9000-SEND-MAP-AND-RETURN
                                ELSE
                                   MOVE P08CA-ASGN-KEY(SUB1)
                                      TO P916-TURN-PARM
      *MFO - TESTING - BEG

                                   IF  P08CA-ASGN-KEY(FUNC-SUB)    NOT
                                                              > SPACES
                                   AND P08CA-ASGN-KEY-XB(FUNC-SUB) NOT
                                                              > SPACES
                                      MOVE SPACES TO P916-TURN
                                      MOVE P08CA-ASGN-KEY(SUB1)(7:4)
                                            TO P916-TRNEE-MARRY-TURN-NBR
                                   END-IF
      *MFO - TESTING - END
                                   PERFORM P2220-GET-P916-FROM-TERM
                                END-IF
                             ELSE
                                MOVE SCR08-FUNC(FUNC-SUB)
                                   TO SCR08-FUNC(SUB1)
                                MOVE SPACES
                                   TO SCR08-FUNC(FUNC-SUB)
                                MOVE SUB1 TO FUNC-SUB
                                PERFORM P0390-SETUP-ASSOC-CRAFTS
                             END-IF
                             MOVE ARRAY-MAX       TO SUB1
                             MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                          END-IF
                       END-PERFORM
                    END-IF
                 END-PERFORM
              END-IF
              SET P916-ADD-MADEUP-FUNCTION  TO TRUE
              IF P916-TURN-PARM NOT > SPACES
                 IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR 'SE' OR 'ET')
                    MOVE TRCN-EN-FROM-DIST     TO P916-TURN-DIST
                    MOVE TRCN-EN-FROM-SDIST    TO P916-TURN-SUB-DIST
                    MOVE TRCN-EN-FROM-POOL     TO P916-TURN-POOL
                    MOVE TRCN-EN-FROM-TERM     TO P916-FROM-TERM
                    IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                       OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                       OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                       OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                       OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                       OR P08CA-NON-BP-WITH-ALT(FUNC-SUB))
                       IF P08CA-SCHED-ALT(FUNC-SUB)
                          OR P08CA-SCHD-POOL-ID-ALT(FUNC-SUB) > SPACES
                          MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                               TO P916-TURN-DIST
                          MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                               TO P916-TURN-SUB-DIST
                          MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                               TO P916-TURN-POOL
                          MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                               TO P916-FROM-TERM
                       ELSE
                          MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                               TO P916-TURN-DIST
                          MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                               TO P916-TURN-SUB-DIST
                          MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                               TO P916-TURN-POOL
                          MOVE P08CA-SCHD-TERM(FUNC-SUB)
                                               TO P916-FROM-TERM
                       END-IF
      *C1170 - BEG
                    ELSE
                       IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                       OR  P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                       OR  P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                       OR  P08CA-SCHED-COMPLETE(FUNC-SUB)
                       OR  P08CA-NON-BP-WITH-ALT(FUNC-SUB))
                       AND P08CA-SV-ALT-POOL-ID(FUNC-SUB) > SPACES
                          MOVE P08CA-SV-ALT-DIST(FUNC-SUB)
                                               TO P916-TURN-DIST
                          MOVE P08CA-SV-ALT-SDIST(FUNC-SUB)
                                               TO P916-TURN-SUB-DIST
                          MOVE P08CA-SV-ALT-POOL(FUNC-SUB)
                                               TO P916-TURN-POOL
                          MOVE P08CA-SV-ALT-TERM(FUNC-SUB)
                                               TO P916-FROM-TERM
                       END-IF
      *C1170 - END
                    END-IF
                 ELSE
                    MOVE TRCN-TR-FROM-DIST     TO P916-TURN-DIST
                    MOVE TRCN-TR-FROM-SDIST    TO P916-TURN-SUB-DIST
                    MOVE TRCN-TR-FROM-POOL     TO P916-TURN-POOL
                    MOVE TRCN-TR-FROM-TERM     TO P916-FROM-TERM
                    IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                       OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                       OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                       OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                       OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                       OR P08CA-NON-BP-WITH-ALT(FUNC-SUB))
                       IF P08CA-SCHED-ALT(FUNC-SUB)
                          OR P08CA-SCHD-POOL-ID-ALT(FUNC-SUB) > SPACES
                          MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                               TO P916-TURN-DIST
                          MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                               TO P916-TURN-SUB-DIST
                          MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                               TO P916-TURN-POOL
                          MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB)
                                               TO P916-FROM-TERM
                       ELSE
                          MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                               TO P916-TURN-DIST
                          MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                               TO P916-TURN-SUB-DIST
                          MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                               TO P916-TURN-POOL
                          MOVE P08CA-SCHD-TERM(FUNC-SUB)
                                               TO P916-FROM-TERM
                       END-IF
      *C1170 - BEG
                    ELSE
                       IF (P08CA-SCHED-BIDPACK(FUNC-SUB)
                       OR  P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                       OR  P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                       OR  P08CA-SCHED-COMPLETE(FUNC-SUB)
                       OR  P08CA-NON-BP-WITH-ALT(FUNC-SUB))
                       AND P08CA-SV-ALT-POOL-ID(FUNC-SUB) > SPACES
                          MOVE P08CA-SV-ALT-DIST(FUNC-SUB)
                                               TO P916-TURN-DIST
                          MOVE P08CA-SV-ALT-SDIST(FUNC-SUB)
                                               TO P916-TURN-SUB-DIST
                          MOVE P08CA-SV-ALT-POOL(FUNC-SUB)
                                               TO P916-TURN-POOL
                          MOVE P08CA-SV-ALT-TERM(FUNC-SUB)
                                               TO P916-FROM-TERM
                       END-IF
      *C1170 - END
                    END-IF
                 END-IF
              END-IF
              MOVE WS-LOCAL-DATE-TIME          TO P916-EFF-DATE-TIME
              MOVE PSTCA-TIME-ZONE             TO P916-TIME-ZONE
              MOVE SCR08-CC(FUNC-SUB)          TO P916-TURN-CC
              EXEC CICS LINK
                        PROGRAM(P916-PGM)
                        COMMAREA(P916-COMMAREA-PARMS)
                        LENGTH(P916-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2210-1' TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE P916-TURN-PARM     TO UFPTURN-AREA
              MOVE SCR08-CC(FUNC-SUB) TO POOL-CRAFT-CODE2
              MOVE UFPTURN-AREA       TO UFPTURN
              PERFORM P8600-READ-UFPTURN
              IF NOT SUCCESS
                 MOVE 'P2210-2'   TO ERR-PARAGRAPH
                 MOVE UFPTURN     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF NOT FILL-VACANCY
                 SET FILL-VACANCY    TO TRUE
              END-IF
      *---------------------------------------------------------*
      *             CONVERT   UFP TIMES                         *
      *---------------------------------------------------------*
              IF DIST2        NOT = SCR08-DIST
              OR SUB-DIST2    NOT = SCR08-SUB-DIST
                 PERFORM P0400-CONVERT-UFP-TIMES
              END-IF
              MOVE SPACES        TO P08CA-SCREEN-ARRAY(FUNC-SUB)
              PERFORM P0360-SETUP-TRAIN-LINE
              IF NOT ASSOCIATED-OPT-TURN
                 PERFORM P0350-GET-ASSOC-TURNS
              END-IF
           ELSE
              MOVE SPACES                  TO P922-COMMAREA-PARMS
              SET P922-ADD-MADEUP-FUNCTION TO TRUE
              MOVE TRCN-KEY3               TO P922-AJ-PARM
              MOVE SCR08-CC(FUNC-SUB)      TO P922-AJ-CC
              MOVE SCR08-OD-DATE(FUNC-SUB) TO P922-JOB-OD-DATE
                                              P922-ADD-EFF-DATE
              MOVE SCR08-OD-TIME(FUNC-SUB) TO P922-JOB-OD-TIME
              MOVE PSTCA-TIME-ZONE         TO P922-TIME-ZONE
              EXEC CICS LINK
                        PROGRAM(P922-PGM)
                        COMMAREA(P922-COMMAREA-PARMS)
                        LENGTH(P922-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2210-3' TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE P922-AJ-PARM            TO AJJOBKEY
              PERFORM P8600-READ-AJJOBKEY
              IF NOT SUCCESS
                 MOVE 'P2210-4'   TO ERR-PARAGRAPH
                 MOVE AJJOBKEY    TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF NOT FILL-VACANCY
                 SET FILL-VACANCY    TO TRUE
              END-IF
              IF P08CA-SCH-CALL-DATE-TIME > '0000000000'
                  MOVE P08CA-SCH-CALL-DATE-TIME
                                     TO WS-SCH-DATE-TIME
              ELSE
                 MOVE SCR08-ORDER-DATE
                                     TO WS-SCH-DATE
                 MOVE SCR08-ORDER-TIME
                                     TO WS-SCH-TIME
              END-IF
              MOVE SPACE            TO  WS-P0220-OVERRIDE-FLAG
              PERFORM P0220-FIND-SCHEDULE
              IF JSK1-ASSIGNMENT > SPACES
                 PERFORM P0240-SETUP-JOB-LINE
              ELSE
                 MOVE 'P2210-5'     TO ERR-PARAGRAPH
                 MOVE AJJOBKEY      TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P2215-CREATE-XB-ASSIGNMENT.
      *
           MOVE SPACES                 TO HAVE-XB-EMP-FLAG
           IF UFP-CALL
              MOVE P08CA-PROFILE-KEY   TO TRCNKEY1
              PERFORM P8000-READ-TRCNKEY1
              MOVE SPACES TO P916-COMMAREA-PARMS
              SET P916-ADD-MADEUP-FUNCTION  TO TRUE
              IF P916-TURN-PARM NOT > SPACES
                 IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR 'SE' OR 'ET')
                    MOVE TRCN-EN-FROM-DIST     TO P916-TURN-DIST
                    MOVE TRCN-EN-FROM-SDIST    TO P916-TURN-SUB-DIST
                    MOVE TRCN-EN-FROM-POOL     TO P916-TURN-POOL
                    MOVE TRCN-EN-FROM-TERM     TO P916-FROM-TERM
                 ELSE
                    MOVE TRCN-TR-FROM-DIST     TO P916-TURN-DIST
                    MOVE TRCN-TR-FROM-SDIST    TO P916-TURN-SUB-DIST
                    MOVE TRCN-TR-FROM-POOL     TO P916-TURN-POOL
                    MOVE TRCN-TR-FROM-TERM     TO P916-FROM-TERM
                 END-IF
              END-IF
              MOVE WS-LOCAL-DATE-TIME          TO P916-EFF-DATE-TIME
              MOVE PSTCA-TIME-ZONE             TO P916-TIME-ZONE
              MOVE SCR08-CC(FUNC-SUB)          TO P916-TURN-CC
              EXEC CICS LINK
                        PROGRAM(P916-PGM)
                        COMMAREA(P916-COMMAREA-PARMS)
                        LENGTH(P916-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2215-1' TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE P916-TURN-PARM     TO UFPTURN-AREA
              MOVE SCR08-CC(FUNC-SUB) TO POOL-CRAFT-CODE2
              MOVE UFPTURN-AREA       TO UFPTURN
              PERFORM P8600-READ-UFPTURN
              IF NOT SUCCESS
                 MOVE 'P2215-2'   TO ERR-PARAGRAPH
                 MOVE UFPTURN     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
      *---------------------------------------------------------*
      *             CONVERT   UFP TIMES                         *
      *---------------------------------------------------------*
              IF DIST2        NOT = SCR08-DIST
              OR SUB-DIST2    NOT = SCR08-SUB-DIST
                 PERFORM P0400-CONVERT-UFP-TIMES
              END-IF
              SET HAVE-XB-EMP TO TRUE
              PERFORM P0360-SETUP-TRAIN-LINE
              IF NOT ASSOCIATED-OPT-TURN
                 PERFORM P0350-GET-ASSOC-TURNS
              END-IF
           ELSE
              MOVE SPACES                  TO P922-COMMAREA-PARMS
              SET P922-ADD-MADEUP-FUNCTION TO TRUE
              MOVE TRCN-KEY3               TO P922-AJ-PARM
              MOVE SCR08-CC(FUNC-SUB)      TO P922-AJ-CC
              MOVE SCR08-OD-DATE(FUNC-SUB) TO P922-JOB-OD-DATE
                                              P922-ADD-EFF-DATE
              MOVE SCR08-OD-TIME(FUNC-SUB) TO P922-JOB-OD-TIME
              MOVE PSTCA-TIME-ZONE         TO P922-TIME-ZONE
              EXEC CICS LINK
                        PROGRAM(P922-PGM)
                        COMMAREA(P922-COMMAREA-PARMS)
                        LENGTH(P922-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2215-3' TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE P922-AJ-PARM            TO AJJOBKEY
              PERFORM P8600-READ-AJJOBKEY
              IF NOT SUCCESS
                 MOVE 'P2215-4'   TO ERR-PARAGRAPH
                 MOVE AJJOBKEY    TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF P08CA-SCH-CALL-DATE-TIME > '0000000000'
                  MOVE P08CA-SCH-CALL-DATE-TIME
                                     TO WS-SCH-DATE-TIME
              ELSE
                 MOVE SCR08-ORDER-DATE
                                     TO WS-SCH-DATE
                 MOVE SCR08-ORDER-TIME
                                     TO WS-SCH-TIME
              END-IF
              MOVE SPACE            TO  WS-P0220-OVERRIDE-FLAG
              PERFORM P0220-FIND-SCHEDULE
              IF JSK1-ASSIGNMENT > SPACES
                 SET HAVE-XB-EMP TO TRUE
                 PERFORM P0240-SETUP-JOB-LINE
              ELSE
                 MOVE 'P2215-5'     TO ERR-PARAGRAPH
                 MOVE AJJOBKEY      TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P2220-GET-P916-FROM-TERM.
      *
           IF SCR08-CC(FUNC-SUB) = ('EN' OR 'FI' OR 'SE' OR 'ET')
              MOVE TRCN-EN-FROM-TERM                TO P916-FROM-TERM
           ELSE
              MOVE TRCN-TR-FROM-TERM                TO P916-FROM-TERM
           END-IF

           IF NOT (P08CA-NO-SCHED(FUNC-SUB)
              OR P08CA-SCHED-COMPLETE(FUNC-SUB))
              IF P08CA-SCHED-ALT(FUNC-SUB)
      *CNC0499 - 11/21/16 - BEG
              OR P08CA-SCHED-BIDPACK(FUNC-SUB)
      *02/17/17 - BEG
              OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
      *02/17/17 - END
      *CNC0499 - 11/21/16 - END
                 MOVE P08CA-SCHD-TERM-ALT(FUNC-SUB) TO P916-FROM-TERM
              ELSE
                 MOVE P08CA-SCHD-TERM(FUNC-SUB)     TO P916-FROM-TERM
              END-IF
           END-IF.
      *
       P2230-CHECK-SVC-OVERRIDE.
      *
      *    USE THE SVC-OVERRIDE UNLESS THERE IS AN EFFECTIVE JOB
      *    SCHEDULE RECORD FOR THE SPECIFIED CRAFT CODE.
      *
           SET USE-SVC-OVERRIDE       TO TRUE
           SET SVC-OVERRIDE-CHECK     TO TRUE
           MOVE TRCN-DEC-CC-OVERRIDE  TO WS-JS-CRAFT
           IF WS-JS-CRAFT = 'SW'
              MOVE 'S1'               TO WS-JS-CRAFT
           ELSE
              IF WS-JS-CRAFT = 'BK'
                 MOVE 'B1'            TO WS-JS-CRAFT
              END-IF
           END-IF
           MOVE SPACE                 TO  WS-P0220-OVERRIDE-FLAG
           PERFORM P0220-FIND-SCHEDULE
           IF JSK2-ASSIGNMENT NOT > SPACES
              IF WS-JS-CRAFT = 'S1' OR
                 WS-JS-CRAFT = 'B1'
                 IF WS-JS-CRAFT = 'S1'
                    MOVE 'S2'         TO WS-JS-CRAFT
                 ELSE
                    MOVE 'B2'         TO WS-JS-CRAFT
                 END-IF
                 PERFORM P0220-FIND-SCHEDULE
              END-IF
           END-IF
           MOVE SPACES                TO WS-SVC-OVERRIDE-CHECK-FLAG

           IF JSK2-ASSIGNMENT > SPACES
              MOVE JSK2-ASGN-DIST     TO AJ-JOB-DIST
              MOVE JSK2-ASGN-SUB-DIST TO AJ-JOB-SUB-DIST
              MOVE JSK2-ASGN          TO AJ-JOB-ASGN-ID
              MOVE JSK2-ASGN-CC       TO AJ-JOB-ASGN-CC
              MOVE AJJOBKEY-AREA      TO AJJOBKEY
              PERFORM P8600-READ-AJJOBKEY
              IF SUCCESS
      *----------------------------------------------------------------*
      *                CONVERT TO CNTL-TIME-ZONE                       *
      *----------------------------------------------------------------*
                 IF JSK2-ASGN-DIST       NOT = SCR08-DIST
                 OR JSK2-ASGN-SUB-DIST   NOT = SCR08-SUB-DIST
                    MOVE SPACES          TO WORK-CNTLKEY
                    MOVE '02'            TO WK-CNTL-REC-TYPE
                    MOVE JSK2-ASGN-DIST  TO WK-CNTL-DIST
                    MOVE JSK2-ASGN-SUB-DIST TO WK-CNTL-SUB-DIST
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P2230-1'    TO ERR-PARAGRAPH
                       MOVE CNTLKEY      TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE SPACES          TO TZ-PARAMETERS
                    MOVE PSTCA-TIME-ZONE TO TZ-IN-ZONE
                    MOVE WS-LOCAL-DATE-TIME TO TZ-IN-DATE-TIME
                    MOVE CNTL-TIME-ZONE  TO TZ-OUT-ZONE
                    PERFORM P8996-TIMEZONE
                    IF TZ-INVALID-PARAMETERS
                       MOVE '131000'     TO ERR-PARAGRAPH
                       PERFORM P8996-TZERROR
                    END-IF
                 ELSE
                    MOVE WS-LOCAL-DATE-CENT TO TZ-OUT-DATE-CENT
                 END-IF
      *
                 SET DE-YYMMDD-FORMAT        TO TRUE
                 MOVE AJ-EFF-DATE            TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD            TO DE-COMPARE1-DATE
      *
      *Y2K       IF AJ-EFF-DATE NOT > TZ-OUT-DATE
                 IF DE-COMPARE1-DATE NOT > TZ-OUT-DATE-CENT
                    SET DONT-USE-SVC-OVERRIDE TO TRUE
                 END-IF
              END-IF
           END-IF.
      *CNC0499-BEG
      *
       P2240-GET-ASSOC-TURNS.
      *
           MOVE FUNC-SUB TO HOLD-FUNC-SUB
           PERFORM VARYING CRAFT-SUB FROM 1 BY 1
              UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
              IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACES
                 PERFORM VARYING FUNC-SUB FROM 1 BY 1
                    UNTIL FUNC-SUB > ARRAY-MAX
                    IF SCR08-CC(FUNC-SUB) = WS-ASSOC-CRAFT(CRAFT-SUB)
                    AND OPTIONAL-TURN(CRAFT-SUB)
      *12/20/16 - BEG
                    AND NOT P08CA-ASGN-SET(FUNC-SUB)
                    AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
      *12/20/16 - END
                       PERFORM P1060-CLEAR-EMP-LINE
                       IF SCR08-FUNC(FUNC-SUB) > SPACES
                          MOVE SPACES TO SCR08-FUNC(FUNC-SUB)
                       END-IF
                       IF (REJECT-TURN OR DROP-TURN OR DCAN-TURN)
                          MOVE WS-NO-MORE-MSG(PSTCA-SUB)
                                         TO SCR08-NAME(FUNC-SUB)
                       ELSE
                          MOVE WS-NO-AVL-MSG(PSTCA-SUB)
                                         TO SCR08-NAME(FUNC-SUB)
                       END-IF
                       MOVE P08CA-SCHD-TYP(HOLD-FUNC-SUB)
                                TO P08CA-SCHD-TYP(FUNC-SUB)
                       IF P08CA-ASGN-KEY(HOLD-FUNC-SUB) > SPACES
      *                   IF THE PRIMARY TURN IS NOT WORKING ITS NORMAL
      *                   ASSIGNMENT, SAVE FOR MARRIED TURN CHANGE LATER
                          MOVE SPACE TO WS-NOT-NORMAL-FLAG
                          IF P08CA-ASGN-ID(HOLD-FUNC-SUB) NOT =
                               SCR08-NORM-ASG(HOLD-FUNC-SUB)(1:6)
                             SET NOT-NORMAL TO TRUE
                          END-IF
                          MOVE SCR08-NORM-ASG(HOLD-FUNC-SUB)
                                                       TO UFPTURN-5-12
                          MOVE SCR08-CC(FUNC-SUB)      TO
                                                       POOL-CRAFT-CODE2
                          MOVE UFPTURN-AREA            TO UFPTURN
                          PERFORM P8600-READ-UFPTURN
                          IF NOT SUCCESS
                             IF NOT-NORMAL
                             AND OPTIONAL-TURN(CRAFT-SUB)
                             AND P08CA-ASGN-KEY(FUNC-SUB) > SPACES
      ** IF WE ARE BOOSTING A POOL AND THE ORIGINAL PRIMARY TURN IS
      ** NOT AVAILABLE BUT THE ASSOCIATED TURN IS, PRESENT THE
      ** ASSOCIATED TURN TO WORK THEIR REGULAR TURN IF THE OPTIONAL
      ** TURN IS VACANT (CURRENT PRIMARY TURN DOESN'T HAVE MARRIED TURN)
                                MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                                          TO UFPTURN-1-6
                                MOVE UFPTURN-AREA         TO UFPTURN
                                PERFORM P8600-READ-UFPTURN
                                IF SUCCESS
      *------------------------------------------------------------*
      *                    CONVERT UFP TIMES                       *
      *------------------------------------------------------------*
                                   IF DIST2       NOT = SCR08-DIST
                                   OR SUB-DIST2   NOT = SCR08-SUB-DIST
                                      PERFORM P0400-CONVERT-UFP-TIMES
                                   END-IF
                                   MOVE 'U'     TO WK-ASGN-JOB-TYPE
                                   MOVE UFPTURN-AREA
                                                TO WK-ASGN-ASSIGNMENT
                                   PERFORM P8020-GET-ASGN-EMPS
                                   MOVE SPACES  TO MSTRNBRK
                                   MOVE ZERO    TO EMP-STATUS-FLAG
                                   IF HAVE-ASGN-TEMPORARY-EMP
                                      MOVE ASGN-TEMPORARY-EMP
                                                TO MSTRNBRK
                                      PERFORM P2245-CHECK-EMP-STATUS
                                   ELSE
                                      IF HAVE-ASGN-OWNER
                                         MOVE ASGN-OWNER TO MSTRNBRK
                                         PERFORM P2245-CHECK-EMP-STATUS
                                      END-IF
                                   END-IF
                                   IF MSTRNBRK NOT > SPACES
                                   OR EMP-STATUS-UNAVAIL
                                      SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                                         TO TRUE
                                      MOVE SPACES
                                           TO P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
      *EMERGENCY FIX<<
                                   ELSE
                                      SET P08CA-ASGN-NO-VCNY(FUNC-SUB)
                                                         TO TRUE
      *EMERGENCY FIX>>
                                   END-IF
                                ELSE
                                   SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                             TO TRUE
                                   MOVE SPACES TO P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
                                   IF NOT (NO-RECORD-FND OR END-OF-FILE)
                                      OR NOT OPTIONAL-TURN(CRAFT-SUB)
                                      MOVE 'P2240-1' TO ERR-PARAGRAPH
                                      MOVE UFPTURN   TO ERR-KEY
                                      PERFORM P9999-GOT-PROBLEM
                                   END-IF
                                END-IF
                             ELSE
                                SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                                MOVE SPACES    TO P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
                                IF NOT (NO-RECORD-FND OR END-OF-FILE)
                                   OR NOT OPTIONAL-TURN(CRAFT-SUB)
                                   MOVE 'P2240-1' TO ERR-PARAGRAPH
                                   MOVE UFPTURN   TO ERR-KEY
                                   PERFORM P9999-GOT-PROBLEM
                                END-IF
                             END-IF
                          ELSE
      *------------------------------------------------------------*
      *                    CONVERT UFP TIMES                       *
      *------------------------------------------------------------*
                             IF DIST2             NOT = SCR08-DIST
                             OR SUB-DIST2         NOT = SCR08-SUB-DIST
                                PERFORM P0400-CONVERT-UFP-TIMES
                             END-IF
                             MOVE 'U'           TO WK-ASGN-JOB-TYPE
                             MOVE UFPTURN-AREA  TO WK-ASGN-ASSIGNMENT
                             PERFORM P8020-GET-ASGN-EMPS
                             MOVE SPACES        TO MSTRNBRK
                             MOVE ZERO          TO EMP-STATUS-FLAG
                             IF HAVE-ASGN-TEMPORARY-EMP
                                MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                                PERFORM P2245-CHECK-EMP-STATUS
                             ELSE
                                IF HAVE-ASGN-OWNER
                                   MOVE ASGN-OWNER      TO MSTRNBRK
                                   PERFORM P2245-CHECK-EMP-STATUS
                                END-IF
                             END-IF
                             IF MSTRNBRK NOT > SPACES
      *12/20/16 - BEG
      *                      OR EMP-STATUS-UNAVAIL
      *12/20/16 - END
                                SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                                MOVE SPACES TO P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
      *12/20/16 - BEG
                             ELSE
                                IF EMP-STATUS-UNAVAIL
                                   IF NOT-NORMAL
                                   AND OPTIONAL-TURN(CRAFT-SUB)
                                   AND P08CA-ASGN-KEY(FUNC-SUB) > SPACES
      ** IF WE ARE BOOSTING A POOL AND THE ORIGINAL PRIMARY TURN IS
      ** NOT AVAILABLE BUT THE ASSOCIATED TURN IS, PRESENT THE
      ** ASSOCIATED TURN TO WORK THEIR REGULAR TURN IF THE EMPLOYEE
      ** WORKING THE MARRIED TURN IS UNAVAILABLE
                                      MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                                          TO UFPTURN-1-6
                                      MOVE UFPTURN-AREA   TO UFPTURN
                                      PERFORM P8600-READ-UFPTURN
                                      IF SUCCESS
                                         IF DIST2 NOT = SCR08-DIST
                                       OR SUB-DIST2 NOT = SCR08-SUB-DIST
                                         PERFORM P0400-CONVERT-UFP-TIMES
                                         END-IF
                                         MOVE 'U' TO WK-ASGN-JOB-TYPE
                                         MOVE UFPTURN-AREA
                                                   TO WK-ASGN-ASSIGNMENT
                                         PERFORM P8020-GET-ASGN-EMPS
                                         MOVE SPACES TO MSTRNBRK
                                         MOVE ZERO TO EMP-STATUS-FLAG
                                         IF HAVE-ASGN-TEMPORARY-EMP
                                            MOVE ASGN-TEMPORARY-EMP
                                                      TO MSTRNBRK
                                          PERFORM P2245-CHECK-EMP-STATUS
                                         ELSE
                                            IF HAVE-ASGN-OWNER
                                             MOVE ASGN-OWNER TO MSTRNBRK
                                          PERFORM P2245-CHECK-EMP-STATUS
                                            END-IF
                                         END-IF
                                         IF MSTRNBRK NOT > SPACES
                                         OR EMP-STATUS-UNAVAIL
                                        SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                                               TO TRUE
                                           MOVE SPACES
                                               TO P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
      *EMERGENCY FIX<<
                                         ELSE
                                        SET P08CA-ASGN-NO-VCNY(FUNC-SUB)
                                                         TO TRUE
      *EMERGENCY FIX>>
                                         END-IF
                                      ELSE
                                        SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                                                 TO TRUE
                                         MOVE SPACES TO
                                                  P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
                                      END-IF
                                   ELSE
                                      SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                                                 TO TRUE
                                       MOVE SPACES TO
                                                  P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
                                   END-IF
      *EMERGENCY FIX<<
                                ELSE
                                   SET P08CA-ASGN-NO-VCNY(FUNC-SUB)
                                                                 TO TRUE
      *EMERGENCY FIX>>
                                END-IF
      *12/20/16 - END

                             END-IF
                          END-IF
                       END-IF
                       MOVE ARRAY-MAX TO FUNC-SUB
                    END-IF
                 END-PERFORM
              END-IF
           END-PERFORM
           MOVE HOLD-FUNC-SUB TO FUNC-SUB
           .
      *
       P2245-CHECK-EMP-STATUS.
      *
           PERFORM P8505-READ-MASTER-ONLY
           MOVE SPACES                 TO WS-ASGN-FILE
           MOVE EMP-NBR OF WS-MSTR     TO ASGN-EMP-NO
                                          WK-ASGN-EMP-NO
           PERFORM PXXXX-JOB-ON-DUTY
           IF ASGN-ASSIGNMENT = SPACES
           AND AVAILABLE
      *       MOVE SPACES TO P08CA-SCREEN-ARRAY(FUNC-SUB)
              SET P08CA-TURNS-RESET   TO TRUE
      *CNC0499-1    PERFORM P1060-CLEAR-DATA-LINE
      *MFO - TESTING - BEG
              IF NOT P08CA-ASGN-MU(FUNC-SUB)
      *MFO - TESTING - END
              MOVE UFPTURN-AREA          TO P08CA-ASGN-KEY(FUNC-SUB)
                                            SCR08-TURN(FUNC-SUB)
      *       IF PRIMARY TURN IS WORKING ANOTHER TURN
              IF NOT-NORMAL
                 MOVE P08CA-ASGN-ID(HOLD-FUNC-SUB)
                                           TO SCR08-TURN(FUNC-SUB)(5:6)
                 MOVE SCR08-TURN(FUNC-SUB) TO P08CA-ASGN-KEY(FUNC-SUB)
              END-IF
      *MFO - TESTING - BEG
              END-IF
      *MFO - TESTING - END
              PERFORM P1040-SETUP-NAME-LINE
              SET WS-FROM-P2200       TO TRUE
              PERFORM P1010-TEST-OWNER
              MOVE SPACE        TO P08CA-TURNS-RESET-FLAG
      *       PERFORM P0360-SETUP-TRAIN-LINE
      *MFO - #8 BEG
           ELSE
              SET EMP-STATUS-UNAVAIL TO TRUE
      *MFO - #8 END
           END-IF
           .
      *CNC0499-END
      *CNC0499-1-BEG
      *
       P2250-CREATE-TURN-FOR-TRAINEE.
      *
           IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
           AND UFP-CALL
              MOVE FUNC-SUB                    TO HOLD-FUNC-SUB
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACES
                    PERFORM VARYING FUNC-SUB FROM 1 BY 1
                       UNTIL FUNC-SUB > ARRAY-MAX
                       IF SCR08-CC(FUNC-SUB) =
                          WS-ASSOC-CRAFT(CRAFT-SUB)
                          MOVE SPACES          TO WORK-CNTLKEY
                          MOVE NA-DIST         TO WK-CNTL-DIST
                          MOVE NA-SUB-DIST     TO WK-CNTL-SUB-DIST
                          MOVE NA-POOL         TO WK-CNTL-POOL
                          IF SCR08-CC(FUNC-SUB) =
                             ('EN' OR 'FI' OR 'SE' OR 'ET')
                             PERFORM P0370-SET-EN-MARRIED-FLAGS
                          ELSE
                             PERFORM P0380-SET-TR-MARRIED-FLAGS
                          END-IF
                          PERFORM P0390-SETUP-ASSOC-CRAFTS
                          IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES AND
                             P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
      *MFO - TESTING         IF FILL-VACANCY
                                SET P08CA-CLEARED TO TRUE
                                MOVE SPACES TO P08CA-DEC-KEY(FUNC-SUB)
                                               P08CA-LAST-SEN(FUNC-SUB)
                                               P08CA-LAST-POS(FUNC-SUB)
                                           P08CA-PRIORITY-ONLY(FUNC-SUB)
                                               P08CA-REST-CODE(FUNC-SUB)
                                             P08CA-LAST-STARTS(FUNC-SUB)
                                               P08CA-EMP-NO(FUNC-SUB)
                                PERFORM P2210-CREATE-ASSIGNMENT
      *
                                SET P08CA-ASGN-MU(FUNC-SUB) TO TRUE
      *
                                IF P08CA-SCHED-BIDPACK(FUNC-SUB)
                                   OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                                   OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
                                   SET P08CA-SCHED-COMPLETE(FUNC-SUB)
                                                  TO TRUE
                                END-IF
      *MFO - TESTING         ELSE
      *MFO - TESTING            MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *                      'IMPROPER FUNCTION - USE "FILL" TO CREATE '
      *                             'TEMPORARY ASSIGNMENT'
      *MFO - TESTING            MOVE 'I051' TO MSGLOG-CODE
      *MFO - TESTING            PERFORM P9000-SEND-MAP-AND-RETURN
      *MFO - TESTING          END-IF
                          END-IF
                          MOVE ARRAY-MAX TO FUNC-SUB
                       END-IF
                    END-PERFORM
                 END-IF
              END-PERFORM
              MOVE HOLD-FUNC-SUB TO FUNC-SUB
           END-IF
           .
      *CNC0499-1-END
      *CNC0578-BEG
      *
       P2260-WRITE-NO-FUNC-HISTORY.
      *
           SET UFP-VACANCY                TO TRUE
           MOVE P08CA-ASGN-KEY(FUNC-SUB)  TO UFPTURN
           PERFORM P8600-READ-UFPTURN
           IF NOT SUCCESS
              MOVE 'P2260-1'              TO ERR-PARAGRAPH
              MOVE UFPTURN                TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE SPACES                    TO P943-COMMAREA-PARMS
           MOVE POOL-NAME OF WS-UFP       TO P943-POOL-ASG
           IF P08CA-EMP-NO(FUNC-SUB) NUMERIC
              MOVE P08CA-EMP-NO(FUNC-SUB) TO P943-EMP-NBR
                                             MSTRNBRK
              PERFORM P8500-READ-MASTER
              IF TEMPORARY-ASGNMT       > SPACE
                 MOVE TEMPORARY-ASGNMT    TO P943-NORM-ASGN
              ELSE
                 IF NORMAL-ASGNMT       > SPACE
                    MOVE NORMAL-ASGNMT    TO P943-NORM-ASGN
                 END-IF
              END-IF
           ELSE
              MOVE '999999997'            TO P943-EMP-NBR
              MOVE UFPTURN-AREA           TO P943-NORM-ASGN
           END-IF
           SET P943-REJECT-CODE-NO        TO TRUE
           MOVE UFPTURN-AREA              TO P943-FUN26-ASGN
           MOVE DIST     OF WS-UFP        TO P943-DIST
           MOVE SUB-DIST OF WS-UFP        TO P943-SDIST
           MOVE CRAFT OF WS-MSTR          TO P943-CRAFT
           MOVE LAYOFF-CODE OF WS-MSTR    TO P943-LO
           MOVE IN-OUT-TERMINAL           TO P943-IN-OUT
           MOVE WS-FORMAT-TRAIN           TO P943-TEMP-ASGN-TRAIN
           MOVE SCR08-CC(FUNC-SUB)        TO P943-TEMP-ASGN-CC
           MOVE SCR08-FUNC(FUNC-SUB)      TO P943-FUN26-TYPE
           IF P943-DIST                   NOT = PSTCA-DIST
           OR P943-SDIST                  NOT = PSTCA-SUB-DIST
              PERFORM P8994-CONVERT-HIST-TIMEZONE
           ELSE
              MOVE WS-LOCAL-DATE-TIME     TO P943-EFF-DATE-TIME
           END-IF
      *CNC0578-01 - BEG
           IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
              MOVE P08CA-DEC-KEY(FUNC-SUB)(17:2)
                                          TO P943-FUN26-RULE-NO
           END-IF
      *CNC0578-01 - END
           PERFORM P8900-WRITE-HISTORY
           .
      *
       P2265-WRITE-NO-FUNC-YARD-LO.
      *
           MOVE SPACES                    TO P943-COMMAREA-PARMS
           IF YARD-CALL
              MOVE JOB-DEF-YARD-POOL      TO P943-POOL-ASG
           ELSE
              MOVE JOB-DEF-LOCAL-POOL     TO P943-POOL-ASG
           END-IF
           IF P08CA-EMP-NO(FUNC-SUB) NUMERIC
              MOVE P08CA-EMP-NO(FUNC-SUB) TO P943-EMP-NBR
                                             MSTRNBRK
              PERFORM P8500-READ-MASTER
              IF TEMPORARY-ASGNMT       > SPACE
                 MOVE TEMPORARY-ASGNMT    TO P943-NORM-ASGN
              ELSE
                 IF NORMAL-ASGNMT       > SPACE
                    MOVE NORMAL-ASGNMT    TO P943-NORM-ASGN
                 END-IF
              END-IF
              SET P943-REJECT-CODE-NO     TO TRUE
              MOVE P943-NORM-ASGN         TO P943-FUN26-ASGN
              MOVE DIST OF WS-MSTR        TO P943-DIST
              MOVE SUB-DIST OF WS-MSTR    TO P943-SDIST
              MOVE CRAFT OF WS-MSTR       TO P943-CRAFT
              MOVE LAYOFF-CODE OF WS-MSTR TO P943-LO
              MOVE '0'                    TO P943-IN-OUT
              IF YARD-CALL
                 MOVE SCR08-ASGN          TO P943-TEMP-ASGN-TRAIN
              ELSE
                 MOVE WS-FORMAT-TRAIN     TO P943-TEMP-ASGN-TRAIN
              END-IF
              MOVE SCR08-CC(FUNC-SUB)     TO P943-TEMP-ASGN-CC
              MOVE SCR08-FUNC(FUNC-SUB)   TO P943-FUN26-TYPE
              IF P943-DIST                NOT = PSTCA-DIST
              OR P943-SDIST               NOT = PSTCA-SUB-DIST
                 PERFORM P8994-CONVERT-HIST-TIMEZONE
              ELSE
                 MOVE WS-LOCAL-DATE-TIME    TO P943-EFF-DATE-TIME
              END-IF
              IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
                 MOVE P08CA-DEC-KEY(FUNC-SUB)(17:2)
                                             TO P943-FUN26-RULE-NO
              END-IF
              PERFORM P8900-WRITE-HISTORY
           END-IF
           .
      *CNC0578-END
      *CNC0499 - 12/16/16 - BEG
      *
       P2270-CHK-ASSOC-TURNS.
      *
           MOVE FUNC-SUB TO HOLD-FUNC-SUB
      *
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
                     UNTIL FUNC-SUB > ARRAY-MAX
              IF SCR08-CC(FUNC-SUB) = WS-ASSOC-CRAFT(HOLD-FUNC-SUB)
      *12/20/16 - BEG
              AND NOT P08CA-ASGN-SET(FUNC-SUB)
              AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
      *12/20/16 - END
                 PERFORM P1060-CLEAR-EMP-LINE
                 IF SCR08-FUNC(FUNC-SUB) > SPACES
                    MOVE SPACES              TO SCR08-FUNC(FUNC-SUB)
                 END-IF
                 IF (REJECT-TURN OR DROP-TURN OR DCAN-TURN)
                     MOVE WS-NO-MORE-MSG(PSTCA-SUB)
                                             TO SCR08-NAME(FUNC-SUB)
                 ELSE
                    MOVE WS-NO-AVL-MSG(PSTCA-SUB)
                                             TO SCR08-NAME(FUNC-SUB)
                 END-IF
                 MOVE P08CA-SCHD-TYP(HOLD-FUNC-SUB)
                                             TO P08CA-SCHD-TYP(FUNC-SUB)
                 IF P08CA-ASGN-KEY(HOLD-FUNC-SUB) > SPACES
                    MOVE SPACE               TO WS-NOT-NORMAL-FLAG
                    IF P08CA-ASGN-ID(HOLD-FUNC-SUB) NOT =
                       SCR08-NORM-ASG(HOLD-FUNC-SUB)(1:6)
                       SET NOT-NORMAL TO TRUE
                    END-IF
                    IF (NOT-NORMAL
                    AND OPTIONAL-TURN(HOLD-FUNC-SUB)
                    AND P08CA-ASGN-KEY(FUNC-SUB) > SPACES
                    AND NOT P08CA-ASGN-IS-VCNY(FUNC-SUB))
                       MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN-1-6
                       MOVE UFPTURN-AREA             TO UFPTURN
                       PERFORM P8600-READ-UFPTURN
                       IF SUCCESS
                          IF DIST2           NOT = SCR08-DIST
                          OR SUB-DIST2       NOT = SCR08-SUB-DIST
                             PERFORM P0400-CONVERT-UFP-TIMES
                          END-IF
                          MOVE 'U'           TO WK-ASGN-JOB-TYPE
                          MOVE UFPTURN-AREA  TO WK-ASGN-ASSIGNMENT
                          PERFORM P8020-GET-ASGN-EMPS
                          MOVE SPACES        TO MSTRNBRK
                          MOVE ZERO          TO EMP-STATUS-FLAG
                          IF HAVE-ASGN-TEMPORARY-EMP
                             MOVE ASGN-TEMPORARY-EMP TO MSTRNBRK
                             PERFORM P2245-CHECK-EMP-STATUS
                          ELSE
                             IF HAVE-ASGN-OWNER
                                MOVE ASGN-OWNER TO MSTRNBRK
                                PERFORM P2245-CHECK-EMP-STATUS
                             END-IF
                          END-IF
                          IF MSTRNBRK NOT > SPACES
                          OR EMP-STATUS-UNAVAIL
                             SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                             MOVE SPACES   TO P08CA-EMP-NO(FUNC-SUB)
                                              P08CA-TRK-REASON(FUNC-SUB)
                          END-IF
                       END-IF
                    END-IF
                 END-IF
                 MOVE ARRAY-MAX TO FUNC-SUB
              END-IF
           END-PERFORM
      *
           MOVE HOLD-FUNC-SUB TO FUNC-SUB
           .
      *CNC0499 - 12/16/16 - END
      *
       P2300-PROCESS-LAYOFF.
      *
           IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
              OR P08CA-EMP-NO(FUNC-SUB) NOT > SPACES
              OR P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
      *               'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
                 MOVE 'I049' TO MSGLOG-CODE
              ELSE
                 IF P08CA-EMP-NO(FUNC-SUB) NOT > SPACE
      *                  'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                    MOVE 'I050' TO MSGLOG-CODE
                 ELSE
      *             MOVE 'EMPLOYEES STATUS PROHIBITS BOOKOFF'
                    MOVE 'E031' TO MSGLOG-CODE
                 END-IF
              END-IF
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           IF WS-IVR-CANCEL-ALLOWED
              PERFORM P5210-PROCESS-IVR-CANCEL
           END-IF

           MOVE SPACES                         TO P917-COMMAREA-PARMS
           MOVE P08CA-EMP-NO(FUNC-SUB)         TO P917-EMP-NO
           IF NOT MISSING-CALL
              MOVE SCR08-ST(FUNC-SUB)          TO P917-STATUS-CODE1
              IF P917-STATUS-CODE1 NOT > SPACES
                 MOVE -1                   TO SCR08-ST-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO            TO SCR08-ST-HI(FUNC-SUB)
      *               'STATUS CODE IS REQUIRED'
                 MOVE 'S004' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
      *       IF P917-STATUS-CODE1           = 'N'
      *          AND SCR08-ECC(FUNC-SUB) NOT > SPACES
      *          MOVE -1                 TO SCR08-ECC-CURSOR(FUNC-SUB)
      *          MOVE REV-VIDEO          TO SCR08-ECC-HI(FUNC-SUB)
      *               'ECC CODE IS REQUIRED'
      *          MOVE 'V105' TO MSGLOG-CODE
      *          PERFORM P9000-SEND-MAP-AND-RETURN
      *       END-IF
              MOVE P917-STATUS-CODE            TO SCR08-ST(FUNC-SUB)
              MOVE SCR08-ECC(FUNC-SUB)         TO P917-EDB-CODE
           END-IF
           SET P917-ON-CALL                    TO TRUE
           MOVE PSTCA-TIME-ZONE                TO P917-TIME-ZONE
           MOVE WS-CALL-DATE-TIME              TO P917-EFF-DATE-TIME
           IF YARD-CALL
              MOVE SCR08-ASGN                  TO P917-TRAIN
           ELSE
              MOVE WS-FORMAT-TRAIN             TO P917-TRAIN
           END-IF
           MOVE SCR08-CC(FUNC-SUB)             TO P917-TRAIN-CC
      *
      *    CALL DATE/TIME IS THE ORDERED TIME OF THE TRAIN
      *
           MOVE SCR08-ORDER-DATE               TO P917-CALL-DATE
           MOVE SCR08-ORDER-TIME               TO P917-CALL-TIME
      *
      *    COMPUTE THE ACTION TIME = ORDER - LEAD
      *
           MOVE ZEROS                          TO DATE-CONVERSION-PARMS
           SET PARM-SUBTRACT                   TO TRUE
           MOVE SCR08-ORDER-DATE               TO PARM-PRI-DATE-GREG
           MOVE SCR08-ORDER-TIME               TO PARM-PRI-HRMN
           MOVE SCR08-CC(FUNC-SUB)             TO WS-CRAFT-CODE-CHECK
           IF ENGINE-CRAFT
              MOVE P08CA-EN-LEAD-TIME          TO PARM-SEC-HRMN
                                                  P917-CALL-LEAD-TIME
           ELSE
              MOVE P08CA-TR-LEAD-TIME          TO PARM-SEC-HRMN
                                                  P917-CALL-LEAD-TIME
           END-IF
           IF PARM-SEC-HRMN > ZERO
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P2300-1'                TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-DATE-GREG          TO P917-ACTION-DATE
              MOVE PARM-RES-HRMN               TO P917-ACTION-TIME
           ELSE
              MOVE SCR08-ORDER-DATE            TO P917-ACTION-DATE
              MOVE SCR08-ORDER-TIME            TO P917-ACTION-TIME
           END-IF
      *
           IF MISSING-CALL
              MOVE SCR08-FUNC(FUNC-SUB)        TO P917-MISSED-CALL-FUNC
              SET  P08CA-RESUB(FUNC-SUB)       TO TRUE
           END-IF
      *-------------------------------------------------------------
      *    FOR FASTSLOW SPAREBOARDS, THE BOARD SIDE USED TO DECIDE
      *    ROAD VS. YARD.
      *----------------------------------------------------------PLS
           IF P08CA-FASTSLOW-BOARD(FUNC-SUB) = 'F'
              SET P917-YARD                    TO TRUE
           ELSE
              IF P08CA-FASTSLOW-BOARD(FUNC-SUB) = 'S'
                 SET P917-ROAD                 TO TRUE
              ELSE
                 IF YARD-CALL
                    SET P917-YARD              TO TRUE
                 ELSE
                    SET P917-ROAD              TO TRUE
                 END-IF
              END-IF
           END-IF
           IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
              MOVE P08CA-DEC-KEY(FUNC-SUB)     TO P917-DECKEY
           END-IF
           IF YARD-CALL OR LOCAL-CALL
              MOVE 'A'                         TO P917-OC-ASGN-TYPE
           ELSE
              MOVE 'U'                         TO P917-OC-ASGN-TYPE
           END-IF
           MOVE P08CA-ASGN-KEY(FUNC-SUB)       TO P917-OC-ASGN
           MOVE PSTCA-SUB                      TO P917-SUB-CODE
      *
           EXEC CICS LINK
                     PROGRAM(P917-PGM)
                     COMMAREA(P917-COMMAREA-PARMS)
                     LENGTH(P917-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2300-2' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF P917-ERROR-FOUND
              IF P917-STATUS-CODE-ERROR
                 MOVE -1 TO SCR08-ST-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-ST-HI(FUNC-SUB)
              ELSE
                 IF P917-EDB-CODE-ERROR
                    MOVE -1           TO SCR08-ECC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO    TO SCR08-ECC-HI(FUNC-SUB)
                 ELSE
                    MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 END-IF
              END-IF
              MOVE P917-ERRORMSG TO SCR08-ERRORMSG
              PERFORM P9000-SEND-MAP-AND-RETURN
           ELSE
              IF P917-EMP-WAS-TRACKED
                 AND P08CA-ASGN-MU(FUNC-SUB)
                 MOVE ' '   TO P08CA-ASGN-STAT-CODE(FUNC-SUB)
                 IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                    PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                       UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                          PERFORM VARYING SUB1 FROM 1 BY 1
                             UNTIL SUB1 > ARRAY-MAX
                             IF WS-ASSOC-CRAFT(CRAFT-SUB)
                                = SCR08-CC(SUB1)
                                IF P08CA-ASGN-MU(SUB1)
                                   MOVE ' '
                                        TO P08CA-ASGN-STAT-CODE(SUB1)
                                END-IF
                                MOVE ARRAY-MAX       TO SUB1
                             END-IF
                          END-PERFORM
                       END-IF
                    END-PERFORM
                 END-IF
              END-IF
              IF NOT (P08CA-ASGN-IS-VCNY(FUNC-SUB)
                 OR P08CA-ASGN-IS-BOTH(FUNC-SUB))
                 SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                 SET P08CA-TRK-DONT-TRACK(FUNC-SUB) TO TRUE
                 IF (YARD-CALL OR LOCAL-CALL)
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO AJJOBKEY
                    PERFORM P8600-READ-AJJOBKEY
      *-------------------------------------------------------------*
      *              CONVERT  TO PSTCA-TIME-ZONE                    *
      *-------------------------------------------------------------*
                    IF AJ-JOB-DIST                NOT = SCR08-DIST
                    OR AJ-JOB-SUB-DIST            NOT = SCR08-SUB-DIST
                       MOVE SPACES                TO WORK-CNTLKEY
                       MOVE '02'                  TO WK-CNTL-REC-TYPE
                       MOVE AJ-JOB-DIST           TO WK-CNTL-DIST
                       MOVE AJ-JOB-SUB-DIST       TO WK-CNTL-SUB-DIST
                       PERFORM P8610-READ-CNTLFILE
                       IF NOT SUCCESS
                          MOVE 'P2300-C'          TO ERR-PARAGRAPH
                          MOVE CNTLKEY            TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
      *
                       END-IF
                       MOVE SPACES                TO TZ-PARAMETERS
                       MOVE CNTL-TIME-ZONE        TO TZ-IN-ZONE
                       MOVE PSTCA-TIME-ZONE       TO TZ-OUT-ZONE
                       MOVE AJ-JOB-ON-DUTY-TIME   TO TZ-IN-DATE-TIME
                       PERFORM P8996-TIMEZONE
                       IF TZ-INVALID-PARAMETERS
                          MOVE '000025'           TO ERR-PARAGRAPH
                          PERFORM P8996-TZERROR
                       END-IF
                       MOVE TZ-OUT-DATE-TIME      TO AJ-JOB-ON-DUTY-TIME
      *
                       MOVE SPACES                TO TZ-PARAMETERS
                       MOVE CNTL-TIME-ZONE        TO TZ-IN-ZONE
                       MOVE PSTCA-TIME-ZONE       TO TZ-OUT-ZONE
                       MOVE AJ-ON-DUTY-TIME       TO TZ-IN-DATE-TIME
                       PERFORM P8996-TIMEZONE
                       IF TZ-INVALID-PARAMETERS
                          MOVE '000025'           TO ERR-PARAGRAPH
                          PERFORM P8996-TZERROR
                       END-IF
                       MOVE TZ-OUT-DATE-TIME      TO AJ-ON-DUTY-TIME
      *
                       IF AJ-OPEN-DATE-TIME > SPACES
                          MOVE SPACES             TO TZ-PARAMETERS
                          MOVE CNTL-TIME-ZONE     TO TZ-IN-ZONE
                          MOVE PSTCA-TIME-ZONE    TO TZ-OUT-ZONE
                          MOVE AJ-OPEN-DATE-TIME  TO TZ-IN-DATE-TIME
                          PERFORM P8996-TIMEZONE
                          IF TZ-INVALID-PARAMETERS
                             MOVE '000025'        TO ERR-PARAGRAPH
                             PERFORM P8996-TZERROR
                          END-IF
                          MOVE TZ-OUT-DATE-TIME   TO AJ-OPEN-DATE-TIME
                       END-IF
                    END-IF
                 ELSE
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN
                    PERFORM P8600-READ-UFPTURN
                    IF DIST2            NOT = SCR08-DIST
                    OR SUB-DIST2        NOT = SCR08-SUB-DIST
                       PERFORM P0400-CONVERT-UFP-TIMES
                    END-IF
                 END-IF
                 IF NOT SUCCESS
                    MOVE 'P2300-2'                TO ERR-PARAGRAPH
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE P08CA-EMP-NO(FUNC-SUB)  TO MSTRNBRK
                 PERFORM P1060-CLEAR-EMP-LINE
                 PERFORM P1050-SETUP-NAME-LINEB
                 IF UFP-BLANK-TURN
                    MOVE WS-DISCONT-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                 ELSE
                    MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                 END-IF
                 MOVE SPACES               TO P08CA-EMP-NO(FUNC-SUB)
                                              SCR08-FUNC(FUNC-SUB)
              ELSE
                 MOVE SPACES               TO P923-COMMAREA-PARMS
                 PERFORM P2200-PROCESS-FILL-FUNCTION
              END-IF
           END-IF
           MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB).
      *
       P2400-PROCESS-DROP-REJT.
      *
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
              MOVE 'I049' TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *
      *    MAKE SURE THE OTHER TURNS IN THE "SET" HAVE NOT BEEN CALLED
      *
           IF ASSOCIATED-TURN
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                          IF (P08CA-ASGN-SET(SUB1)
                          OR  P08CA-ASGN-IVR-CONTROL(SUB1))
                             MOVE ARRAY-MAX TO SUB1
                             MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                             MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO TO SCR08-NAME-HI(FUNC-SUB)
                                               SCR08-FUNC-HI(FUNC-SUB)
                             IF DROP-TURN
      *                                'CANNOT "DROP" TURN ONCE IT '
      *                                'HAS BEEN PARTIALLY CALLED'
                                MOVE 'C004' TO MSGLOG-CODE
                             ELSE
      *                                'CANNOT "REJECT" TURN ONCE IT '
      *                                'HAS BEEN PARTIALLY CALLED'
                                MOVE 'C005' TO MSGLOG-CODE
                             END-IF
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                       END-IF
                    END-PERFORM
                 ELSE
                    MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                 END-IF
              END-PERFORM
           END-IF
           IF DROP-TURN
              IF P08CA-ASGN-MU(FUNC-SUB)
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *             'IMPROPER FUNCTION - CANNOT "DROP" A MADE UP TURN'
                 MOVE 'I044' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
              IF MINE-TURN-SVC
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *             IMPROPER FUNCTION - CANNOT "DROP" A MINE TURN
                 MOVE 'I422'          TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
      *
      *    SET THE FUNCTION ON THE "PRIMARY" TURN IF NECESSARY
      *
           IF ASSOCIATED-TURN
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                    AND PRIMARY-TURN(CRAFT-SUB)
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                          MOVE SCR08-FUNC(FUNC-SUB) TO SCR08-FUNC(SUB1)
                          MOVE SPACES
                             TO SCR08-FUNC(FUNC-SUB)
                          MOVE P08CA-ASGN-KEY(SUB1) TO UFPTURN
                          MOVE SUB1 TO FUNC-SUB
                          PERFORM P0390-SETUP-ASSOC-CRAFTS
                          MOVE ARRAY-MAX       TO SUB1
                          MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                       END-IF
                    END-PERFORM
                 END-IF
              END-PERFORM
           END-IF
      *
      *    IF A B1 TURN IS BEING REJECTED AND THIS IS A POOL WHERE THE
      *    CONDUCTOR GETS 2 "B1" TURNS, DO NOT LET THE USER REJECT OR
      *    DROP THE "1ST B1" IF THEY HAVE ALREADY CALLED THE OTHER B1
      *    THE REASON FOR THIS IS IF IT WERE ALLOWED, WHEN THE TURNS
      *    TIE UP AT THE NEXT STATION THEIR ORDER WOULD BE REVERSED
      *    WHICH WOULD CAUSE A PERMANENT RUNAROUND
      *
           IF SCR08-CC(FUNC-SUB) = 'B1'
              AND P08CA-COND-GETS-2BK
              MOVE FUNC-SUB                    TO SUB1
              ADD 1                            TO SUB1
              IF P08CA-ASGN-SET(SUB1)
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
                 IF REJECT-TURN
      *                    'IMPROPER FUNCTION - '
      *                    'CANNOT "REJT" ONCE 2ND BRAKEMAN '
      *                    'HAS BEEN CALLED'
                    MOVE 'I046' TO MSGLOG-CODE
                 ELSE
      *                    'IMPROPER FUNCTION - '
      *                    'CANNOT "DROP" ONCE 2ND BRAKEMAN '
      *                    'HAS BEEN CALLED'
                    MOVE 'I045' TO MSGLOG-CODE
                 END-IF
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
      *
      *  C513 9/25/03  GER  ADDED RELEASE OF TRACKING.
      *    RELEASE ANY TRACKING THAT MAY HAVE BEEN INITIATED
      *    ON THIS TURN
      *
           PERFORM P8070-UPDATE-TRACKING
           MOVE FUNC-SUB                    TO HOLD-FUNC-SUB

           IF WS-IVR-CANCEL-ALLOWED
              PERFORM P5210-PROCESS-IVR-CANCEL
           END-IF

      *
      *    RELEASE ANY ASSOCIATED TURNS AS WELL
      *
           IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                          IF P08CA-ASGN-KEY(SUB1) > SPACES
                             MOVE SUB1            TO FUNC-SUB
                             PERFORM P8070-UPDATE-TRACKING
                             IF P08CA-EMP-NO(FUNC-SUB) > SPACES
                               IF WS-IVR-CANCEL-ALLOWED
                                  MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                        TO WS-HOLD-IVR-CANCEL-ASGN-KEY
                                  PERFORM P5210-PROCESS-IVR-CANCEL
                               END-IF
                             END-IF
      *CNC0499 - 11/21/16 - BEG
                             IF NOT ASSOCIATED-TURN
                                IF P08CA-ASGN-MU(FUNC-SUB)
                                   MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                                              TO UFPTURN
                                   PERFORM P8600-READ-UFPTURN
                                   IF NOT SUCCESS
                                      MOVE 'P2400-1' TO ERR-PARAGRAPH
                                      MOVE UFPTURN TO ERR-KEY
                                      PERFORM P9999-GOT-PROBLEM
                                   END-IF
                                   MOVE ZEROS TO UFP-POSITION-TIME
                                   MOVE UFPPOS-AREA TO WORK-UFPPOS
                                   PERFORM P8040-PROCESS-DELETE
                                END-IF
      *11/23/16 - BEG
      ***  IF THE PRIMARY TURN IS REJECTED AND AN ASSOCIATED TURN
      ***  EXISTS, REMOVE THE MARRIED TURN AS WELL...
                                IF P08CA-EMP-NO(FUNC-SUB) > SPACES
                                 MOVE SPACES TO P08CA-ASGN-KEY(FUNC-SUB)
                                 PERFORM P1060-CLEAR-DATA-LINE
                                END-IF
      *11/23/16 - END
                             END-IF
      *CNC0499 - 11/21/16 - END
                          END-IF
                       END-IF
                    END-PERFORM
                 ELSE
                    MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                 END-IF
              END-PERFORM
           END-IF
           MOVE HOLD-FUNC-SUB                     TO FUNC-SUB
      * C513  END

           IF P08CA-ASGN-KEY(FUNC-SUB) > SPACES
              PERFORM P2410-COMPLETE-DR-ASGN
           ELSE
              IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
                 PERFORM P2420-COMPLETE-DR-ASGN-XB
              END-IF
           END-IF

           MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB).

      *
       P2410-COMPLETE-DR-ASGN.
      *
           MOVE P08CA-ASGN-KEY(FUNC-SUB)          TO UFPTURN
           PERFORM P8600-READ-UFPTURN
           IF NOT SUCCESS
              MOVE 'P2410-1'                      TO ERR-PARAGRAPH
              MOVE UFPTURN                        TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF P08CA-ASGN-MU(FUNC-SUB)
              IF WS-IVR-CANCEL-ALLOWED
              AND NOT IN-TOWN
      *          CONTINUE
      *#1284
                 MOVE HIGH-VALUES TO UFP-POS-TIE-BREAKER
                 MOVE UFPPOS-AREA                 TO WORK-UFPPOS
              ELSE
                 MOVE ZEROS TO UFP-POSITION-TIME
                 MOVE UFPPOS-AREA                 TO WORK-UFPPOS
                 PERFORM P8040-PROCESS-DELETE
              END-IF
           ELSE
              MOVE UFPPOS-AREA                    TO WORK-UFPPOS
              IF REJECT-TURN
                 ADD 1                            TO WK-UFPPOS-TIE-NUM
                 SET P08CA-BYPASS-POINTER(FUNC-SUB) TO TRUE
              ELSE
                 MOVE SPACES                      TO P916-COMMAREA-PARMS
                 SET P916-REALIGN-FUNCTION        TO TRUE
                 MOVE P08CA-ASGN-KEY(FUNC-SUB)    TO P916-TURN-PARM
                 MOVE SCR08-CC(FUNC-SUB)          TO WS-CRAFT-CODE-CHECK
                 MOVE WS-LOCAL-DATE-TIME          TO P916-EFF-DATE-TIME
                 MOVE PSTCA-TIME-ZONE             TO P916-TIME-ZONE
                 EXEC CICS LINK
                           PROGRAM(P916-PGM)
                           COMMAREA(P916-COMMAREA-PARMS)
                           LENGTH(P916-LGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P2410-2' TO ERR-PARAGRAPH
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              MOVE SPACES                    TO P943-COMMAREA-PARMS
              IF P08CA-REG-EMP-NO(FUNC-SUB) NUMERIC
                 MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO P943-EMP-NBR
                                                    MSTRNBRK
                 PERFORM P8500-READ-MASTER
                 MOVE CRAFT OF WS-MSTR       TO P943-CRAFT
                 IF TEMPORARY-ASGNMT > SPACE
                    MOVE TEMPORARY-ASGNMT    TO P943-NORM-ASGN
                 ELSE
                    IF NORMAL-ASGNMT > SPACE
                       MOVE NORMAL-ASGNMT    TO P943-NORM-ASGN
                    END-IF
                 END-IF
                 MOVE LAYOFF-CODE OF WS-MSTR TO P943-LO
              ELSE
      *
      *C1021     THIS CHANGE IS BEING ADDED TO CATER EMPLOYEE CALLED ON
      *          INTERDIVISIONAL POOL. IN THIS CASE EMP IS WORKING AT
      *          AWAY BUT TURN IS AT ITS HOME AND WHEN CALLER REJT
      *          THE WORK HISTORY WILL BE UPDATED FOR EMP WORKING ON
      *          ASSIGNMENT RATHER THAN TEMP EMP 999999997.
      *C1023-BEG
      *          ADDED BELOW IF CONDITION TO ACCOMODATE REJT ON
      *          VACANT TURNS WHERE EMP NUMBER IS SPACES/BLANK.
      *
                 IF  P08CA-EMP-NO(FUNC-SUB) IS NUMERIC
                 AND P08CA-EMP-NO(FUNC-SUB)  > ZEROS
      *C1023-END
                    MOVE P08CA-EMP-NO(FUNC-SUB) TO MSTRNBRK
                    PERFORM P8500-READ-MASTER
                    IF EMP-HOME-TERM-CODE  NOT = SCR08-ORG-STATION
                       MOVE P08CA-EMP-NO(FUNC-SUB)
                                             TO P943-EMP-NBR
                    ELSE
                       MOVE '999999997'      TO P943-EMP-NBR
                    END-IF
      *C1023-BEG
                 ELSE
                    MOVE '999999997'         TO P943-EMP-NBR
                 END-IF
      *C1023 - END
      *C1021 - END
                 MOVE UFPTURN-AREA           TO P943-NORM-ASGN
              END-IF
              IF REJECT-TURN
                 SET P943-REJECT-TURN-FUN    TO TRUE
                 MOVE UFPTURN-AREA           TO P943-FUN24-ASGN
                 IF REJECT-MARK
                    MOVE 'M'                 TO P943-FUN24-MARK
                 ELSE
                    MOVE 'T'                 TO P943-FUN24-MARK
                 END-IF
              ELSE
                 SET P943-DROP-TURN-FUN      TO TRUE
                 MOVE UFPTURN-AREA           TO P943-FUN42-ASGN
              END-IF
              MOVE DIST OF WS-UFP            TO P943-DIST
              MOVE SUB-DIST OF WS-UFP        TO P943-SDIST
              MOVE POOL-NAME OF WS-UFP       TO P943-POOL-ASG
              MOVE IN-OUT-TERMINAL           TO P943-IN-OUT
              IF P943-DIST                   NOT = PSTCA-DIST
              OR P943-SDIST                  NOT = PSTCA-SUB-DIST
                 PERFORM P8994-CONVERT-HIST-TIMEZONE
              ELSE
                 MOVE WS-LOCAL-DATE-TIME     TO P943-EFF-DATE-TIME
              END-IF
              MOVE WS-FORMAT-TRAIN           TO P943-TEMP-ASGN-TRAIN
              MOVE POOL-CRAFT-CODE2          TO P943-TEMP-ASGN-CC
              PERFORM P8900-WRITE-HISTORY
           END-IF

           IF REJECT-MARK
              IF P08CA-SCHD-DLY (FUNC-SUB) NOT = SPACES AND
                 NOT P08CA-SCHED-ALT(FUNC-SUB)
                 MOVE P08CA-SCHD-KEY(FUNC-SUB)  TO WORK-CNTL-76-KEY
                 PERFORM P2710-ADVANCE-POINTER
              ELSE
                 IF P08CA-SCHED-BIDPACK(FUNC-SUB)
                    OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                    PERFORM P2750-REJECT-MARK-SCHEDULE
                 END-IF
              END-IF
           END-IF

      * #1328 JES
           SET P08CA-TURNS-RESET            TO TRUE

           MOVE SPACES                       TO SCR08-FUNC(FUNC-SUB)
           IF SCR08-CC(FUNC-SUB) = 'CO'
      *
      *       HERE THE CONDUCTOR WE ARE REJECTING GET 2 "B1" BRAKEMAN
      *       SO AFTER WE HAVE REJECTED THAT TURN, SEE IF THE CONDUCTOR
      *       WE FOUND ALSO GETS 2 "B1" BRAKEMAN, IF NOT CLEAR OUT THE
      *       SECOND BRAKEMAN AREA IF IT HAS NOT BEEN CALLED
      *
              IF P08CA-COND-GETS-2BK
                 PERFORM P0340-GET-NEXT-TURN
                 IF NOT P08CA-COND-GETS-2BK
                    MOVE FUNC-SUB               TO HOLD-FUNC-SUB
                    PERFORM VARYING FUNC-SUB FROM HOLD-FUNC-SUB BY 1
                       UNTIL FUNC-SUB > ARRAY-MAX
                       OR SCR08-CC(FUNC-SUB) = 'B2'
                    END-PERFORM
                    IF FUNC-SUB NOT > ARRAY-MAX
                       IF NOT P08CA-ASGN-SET(FUNC-SUB)
      *#1224 BEGIN
                       AND NOT P08CA-ASGN-IVR(FUNC-SUB)
      *#1224 END
                          IF P08CA-ASGN-MU(FUNC-SUB)
                             PERFORM P8040-PROCESS-DELETE
                          END-IF
                          PERFORM P1060-CLEAR-DATA-LINE
                       END-IF
                    END-IF
                    MOVE HOLD-FUNC-SUB          TO FUNC-SUB
                 END-IF
              ELSE
      *
      *          HERE THE CONDUCTOR WE ARE REJECTING DOES NOT GET 2 "B1"
      *          BRAKEMAN, SO AFTER WE HAVE REJECTED THAT TURN, SEE IF
      *          IF THE "NEW" CONDUCTOR GETS 2 "B1" BRAKEMAN, AND IF SO
      *          AND IF WE DO NOT ALREADY HAVE A 2ND "B1", GO GET ONE
      *
                 PERFORM P0340-GET-NEXT-TURN
                 IF P08CA-COND-GETS-2BK
                    MOVE FUNC-SUB               TO HOLD-FUNC-SUB
                    PERFORM VARYING FUNC-SUB FROM HOLD-FUNC-SUB BY 1
                       UNTIL FUNC-SUB > ARRAY-MAX
                       OR SCR08-CC(FUNC-SUB) = 'B2'
                    END-PERFORM
                    IF FUNC-SUB NOT > ARRAY-MAX
                       IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACE
                          MOVE SPACES           TO SCR08-FUNC(FUNC-SUB)
                          PERFORM P0345-GET-NEXT-B1
                       END-IF
                    END-IF
                    MOVE HOLD-FUNC-SUB          TO FUNC-SUB
                 END-IF
              END-IF
           ELSE
              IF SCR08-CC(FUNC-SUB) = 'B1'
                 AND P08CA-COND-GETS-2BK
      *
      *          ONCE WE HAVE REJECTED THE CURRENT "B1", MAKE SURE THE
      *          TURN WE DISPLAYED IN THE "B1" SLOT IS NOT THE SAME TURN
      *          WE PREVIOUSLY DISPLAYED IN THE "B2" SLOT, IF IT IS, GO
      *          AND GET A NEW SECOND "B1"
      *
                 PERFORM P0340-GET-NEXT-TURN
                 MOVE FUNC-SUB                  TO SUB1
                 ADD 1                          TO FUNC-SUB
                 IF P08CA-ASGN-KEY(SUB1) = P08CA-ASGN-KEY(FUNC-SUB)
                    AND P08CA-ASGN-KEY(SUB1) > SPACES
                    MOVE SPACES                 TO SCR08-FUNC(FUNC-SUB)
                    PERFORM P0345-GET-NEXT-B1
                 ELSE
                    SUBTRACT 1                FROM FUNC-SUB
                 END-IF
              ELSE
                 PERFORM P0340-GET-NEXT-TURN
              END-IF
           END-IF
           IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
              IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                 OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                 OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                 OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                 OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
      *11/1/17 - BEG
                 OR P08CA-NON-BP-WITH-ALT(FUNC-SUB))
      *11/1/17 - END
                 PERFORM P0355-ADVANCE-SCHEDULE
              END-IF
           ELSE
              IF P08CA-SCHD-DLY(FUNC-SUB) NOT = SPACES
                 PERFORM P0359-SET-SCHD-TYP
              END-IF
           END-IF

      * #1328 JES
           MOVE SPACE                     TO P08CA-TURNS-RESET-FLAG
           .

      *
       P2420-COMPLETE-DR-ASGN-XB.
      *
           MOVE SPACES                    TO P943-COMMAREA-PARMS
           IF P08CA-EMP-NO(FUNC-SUB) NUMERIC
              MOVE P08CA-EMP-NO(FUNC-SUB) TO P943-EMP-NBR
                                             MSTRNBRK
              PERFORM P8500-READ-MASTER
              MOVE CRAFT OF WS-MSTR       TO P943-CRAFT
              IF TEMPORARY-ASGNMT > SPACE
                 MOVE TEMPORARY-ASGNMT    TO P943-NORM-ASGN
              ELSE
                 IF NORMAL-ASGNMT > SPACE
                    MOVE NORMAL-ASGNMT    TO P943-NORM-ASGN
                 END-IF
              END-IF
              MOVE LAYOFF-CODE OF WS-MSTR TO P943-LO
           ELSE
              MOVE '999999997'            TO P943-EMP-NBR
              MOVE UFPTURN-AREA           TO P943-NORM-ASGN
           END-IF
           IF REJECT-TURN
              SET P943-REJECT-TURN-FUN    TO TRUE
              MOVE P08CA-SCHD-TURN(FUNC-SUB)
                                          TO P943-FUN24-ASGN(1:10)
              MOVE SCR08-CC(FUNC-SUB)     TO P943-FUN24-ASGN(11:2)
              IF REJECT-MARK
                 MOVE 'M'                 TO P943-FUN24-MARK
              ELSE
                 MOVE 'T'                 TO P943-FUN24-MARK
              END-IF
           ELSE
              SET P943-DROP-TURN-FUN      TO TRUE
              MOVE UFPTURN-AREA           TO P943-FUN42-ASGN
           END-IF
           MOVE DIST OF WS-MSTR           TO P943-DIST
           MOVE SUB-DIST OF WS-MSTR       TO P943-SDIST
           MOVE P08CA-SCHD-TURN(FUNC-SUB)(5:2)
                                          TO P943-POOL-ASG
           MOVE IN-OUT-TERMINAL           TO P943-IN-OUT
           IF P943-DIST                   NOT = PSTCA-DIST
           OR P943-SDIST                  NOT = PSTCA-SUB-DIST
              PERFORM P8994-CONVERT-HIST-TIMEZONE
           ELSE
              MOVE WS-LOCAL-DATE-TIME     TO P943-EFF-DATE-TIME
           END-IF
           MOVE WS-FORMAT-TRAIN           TO P943-TEMP-ASGN-TRAIN
           MOVE SCR08-CC(FUNC-SUB)        TO P943-TEMP-ASGN-CC
           PERFORM P8900-WRITE-HISTORY

           IF REJECT-MARK AND
              P08CA-SCHD-DLY (FUNC-SUB) NOT = SPACES AND
              NOT P08CA-SCHED-ALT(FUNC-SUB)
              MOVE P08CA-SCHD-KEY(FUNC-SUB)  TO WORK-CNTL-76-KEY
              PERFORM P2710-ADVANCE-POINTER
           END-IF

           MOVE SPACES                       TO SCR08-FUNC(FUNC-SUB)
           IF NOT (P08CA-NO-SCHED(FUNC-SUB)
              OR P08CA-SCHED-COMPLETE(FUNC-SUB)
              OR P08CA-SCHED-BIDPACK(FUNC-SUB)
              OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
              OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
      *11/1/17 - BEG
              OR P08CA-NON-BP-WITH-ALT(FUNC-SUB))
      *11/1/17 - END
              PERFORM P0355-ADVANCE-SCHEDULE
           END-IF.
      *
      ******************************************************************
       P2500-PROCESS-OVERRIDE.
      ******************************************************************
      *    CHECK IF USER HAS HIGH-LEVEL AUTHORITY TO REQUEST OVERRIDE
      *-----------------------------------------------------------------
           MOVE SPACES                        TO WS-AUTHORITY
           MOVE SCR08-DIST                    TO USERID-DIST-1
           MOVE SCR08-SUB-DIST                TO USERID-SDIST-1
           EXEC CICS LINK
                     PROGRAM(P902-PGM)
                     COMMAREA(WS-AUTHORITY)
                     LENGTH(P902-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2500-S'                  TO ERR-PARAGRAPH
              MOVE 'SECURITY'                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF NOT HIGH-LEVEL-AUTHORIZED
              MOVE -1                     TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO              TO SCR08-FUNC-HI    (FUNC-SUB)
              MOVE 'U003'                 TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
              MOVE 'I049' TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF SCR08-NAME(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-NAME-CURSOR(FUNC-SUB)
      *            'ENTER FULL OR PARTIAL NAME TO BEGIN '
              MOVE 'E033' TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           MOVE SPACES               TO EMP-NAME-NBR-KEY
           MOVE SCR08-NAME(FUNC-SUB) TO EMP-NAME OF WS-MSTR
           IF P08CA-EMP-NO(FUNC-SUB) NUMERIC
              MOVE P08CA-EMP-NO(FUNC-SUB) TO EMP-NBR OF WS-MSTR
           END-IF
           MOVE EMP-NAME-NBR-KEY          TO MSTREMPK
           EXEC CICS STARTBR
                     DATASET(MSTR-VIA-EMP-NAME)
                     RIDFLD(MSTREMPK)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           IF SUCCESS
              MOVE '0' TO WS-DONE-CODE
              PERFORM UNTIL DONE
                 EXEC CICS READNEXT
                           DATASET(MSTR-VIA-EMP-NAME)
                           INTO(WS-MSTR)
                           LENGTH(MSTRENAM-RLGTH)
                           RIDFLD(MSTREMPK)
                           KEYLENGTH(MSTRENAM-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS
                    IF EMP-NBR OF WS-MSTR > P08CA-EMP-NO(FUNC-SUB)
                       SET DONE TO TRUE
                       EXEC CICS ENDBR
                                 DATASET(MSTR-VIA-EMP-NAME)
                                 RESP(WS-RESPONSE)
                       END-EXEC
                       SET P08CA-ASGN-IS-VCNY(FUNC-SUB) TO TRUE
                       MOVE EMP-NBR OF WS-MSTR TO MSTRNBRK
                       SET P08CA-USER-OVERRIDE(FUNC-SUB)         TO TRUE
                       PERFORM P1040-SETUP-NAME-LINE
      *#1503
                       PERFORM P1010-TEST-OWNER
                       MOVE SPACES TO P08CA-DEC-KEY(FUNC-SUB)
                                      P08CA-SENR-RESTRICT-FLAG(FUNC-SUB)
                       IF WORKING
                          SET P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB) TO TRUE
                       END-IF
                       IF UFP-CALL
                          MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN
                          PERFORM P8600-READ-UFPTURN
                          IF NOT SUCCESS
                             MOVE 'P2500-1'           TO ERR-PARAGRAPH
                             MOVE UFPTURN             TO ERR-KEY
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                       ELSE
                          MOVE P08CA-ASGN-KEY(FUNC-SUB) TO AJJOBKEY
                          PERFORM P8600-READ-AJJOBKEY
                          IF NOT SUCCESS
                             MOVE 'P2500-2'           TO ERR-PARAGRAPH
                             MOVE AJJOBKEY            TO ERR-KEY
                             PERFORM P9999-GOT-PROBLEM
                          END-IF
                       END-IF
                       MOVE SPACES                TO P943-COMMAREA-PARMS
                       MOVE EMP-NBR OF WS-MSTR     TO P943-EMP-NBR
                       MOVE CRAFT OF WS-MSTR       TO P943-CRAFT
                       IF TEMPORARY-ASGNMT > SPACE
                          MOVE TEMPORARY-ASGNMT    TO P943-NORM-ASGN
                       ELSE
                          IF NORMAL-ASGNMT > SPACE
                             MOVE NORMAL-ASGNMT    TO P943-NORM-ASGN
                          END-IF
                       END-IF
                       MOVE LAYOFF-CODE OF WS-MSTR TO P943-LO
                       SET P943-OVERRIDE-FUN       TO TRUE
                       IF UFP-CALL
                          MOVE DIST OF WS-UFP      TO P943-DIST
                          MOVE SUB-DIST OF WS-UFP  TO P943-SDIST
                          MOVE POOL-NAME OF WS-UFP TO P943-POOL-ASG
                          MOVE IN-OUT-TERMINAL     TO P943-IN-OUT
                          MOVE WS-FORMAT-TRAIN     TO
                                                   P943-TEMP-ASGN-TRAIN
                          MOVE POOL-CRAFT-CODE2    TO
                                                      P943-TEMP-ASGN-CC
                       ELSE
                          MOVE AJ-JOB-DIST         TO P943-DIST
                          MOVE AJ-JOB-SUB-DIST     TO P943-SDIST
                          MOVE '0'                 TO P943-IN-OUT
                          IF YARD-CALL
                             MOVE SCR08-ASGN       TO
                                                   P943-TEMP-ASGN-TRAIN
                          ELSE
                             MOVE WS-FORMAT-TRAIN     TO
                                                   P943-TEMP-ASGN-TRAIN
                          END-IF
                          MOVE AJ-JOB-ASGN-CC         TO
                                                      P943-TEMP-ASGN-CC
                       END-IF
                       IF P943-DIST     NOT = PSTCA-DIST
                       OR P943-SDIST    NOT = PSTCA-SUB-DIST
                          PERFORM P8994-CONVERT-HIST-TIMEZONE
                       ELSE
                          MOVE WS-LOCAL-DATE-TIME TO P943-EFF-DATE-TIME
                       END-IF
                       IF P08CA-REG-EMP-NO(FUNC-SUB) IS NUMERIC
                          MOVE P08CA-REG-EMP-NO(FUNC-SUB)
                                              TO P943-EMP-NBR-AFFECTED
      *C1192 - BEG
                          IF UFP-CALL
                             MOVE SPACES        TO WS-ASGN-FILE
                             MOVE P08CA-REG-EMP-NO(FUNC-SUB)
                                                TO ASGN-EMP-NO
                                                   WK-ASGN-EMP-NO
                             PERFORM PXXXX-LATEST-TEMP-JOB
                             IF ASGN-ASSIGNMENT > SPACES
                                IF ASGN-ASSIGNMENT NOT = UFPTURN-AREA
                                   MOVE '999999998'
                                                TO P943-EMP-NBR-AFFECTED
                                END-IF
                             END-IF
                          END-IF
      *C1192 - END
                       ELSE
                          MOVE '999999998'    TO P943-EMP-NBR-AFFECTED
                       END-IF
                       PERFORM P8900-WRITE-HISTORY
                    END-IF
                 ELSE
                    SET DONE TO TRUE
                    IF NOT (NO-RECORD-FND OR END-OF-FILE)
                       MOVE 'P2500-2'    TO ERR-PARAGRAPH
                       MOVE MSTREMPK     TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    EXEC CICS ENDBR
                              DATASET(MSTR-VIA-EMP-NAME)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-END-FILE-MSG(PSTCA-SUB)
                                  TO SCR08-NAME(FUNC-SUB)
                 END-IF
              END-PERFORM
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P2500-3'    TO ERR-PARAGRAPH
                 MOVE MSTREMPK     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
           IF SCR08-FUNC(FUNC-SUB) NOT = 'HOUR'
              MOVE SPACES TO SCR08-FUNC(FUNC-SUB)
           END-IF
           MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB).
      *
       P2600-GET-SENIOR-MAN.
      *
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
              MOVE 'I049' TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF P08CA-ASGN-IS-VCNY(FUNC-SUB)
              OR P08CA-ASGN-IS-BOTH(FUNC-SUB)
              OR P08CA-DEC-KEY(FUNC-SUB) > SPACES
              IF P08CA-EMP-NO(FUNC-SUB) IS NUMERIC
                 MOVE P08CA-EMP-NO(FUNC-SUB) TO WS-SENIOR-EMP-NO
              ELSE
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
                 IF P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
      *                  'EMPLOYEES STATUS PROHIBITS CALL'
                    MOVE 'E030' TO MSGLOG-CODE
                 ELSE
      *                  'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                    MOVE 'I050' TO MSGLOG-CODE
                 END-IF
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           ELSE
              IF P08CA-REG-EMP-NO(FUNC-SUB) NOT > '000000000'
                 AND P08CA-EMP-NO(FUNC-SUB) NOT > '000000000'
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
                 IF P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
      *                  'EMPLOYEES STATUS PROHIBITS CALL'
                    MOVE 'E030' TO MSGLOG-CODE
                 ELSE
      *                  'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                    MOVE 'I050' TO MSGLOG-CODE
                 END-IF
                 PERFORM P9000-SEND-MAP-AND-RETURN
              ELSE
                 IF P08CA-EMP-NO(FUNC-SUB)       > '000000000'
                    MOVE P08CA-EMP-NO(FUNC-SUB) TO WS-SENIOR-EMP-NO
                 ELSE
                    MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO WS-SENIOR-EMP-NO
                    MOVE SPACES                TO P08CA-EMP-NO(FUNC-SUB)
                 END-IF
              END-IF
           END-IF
      *
      *    GET THE SENIORITY OF THE EMPLOYEE CURRENTLY ON THE JOB
      *
           IF P08CA-EMP-NO(FUNC-SUB) IS NUMERIC
              MOVE P08CA-EMP-NO(FUNC-SUB)    TO WS-SENIOR-EMP-NO
              MOVE SPACES                    TO P942-COMMAREA-PARMS
              SET P942-EMP-SEN-FUNCTION      TO TRUE
              MOVE P08CA-ASGN-KEY(FUNC-SUB)  TO P942-ASGN-PARM
              IF UFP-CALL
                 SET P942-ASGN-UFP              TO TRUE
              ELSE
                 SET P942-ASGN-AJ               TO TRUE
              END-IF
              MOVE P942-ASSIGNMENT           TO WS-HOLD-SENR-ASGN
              MOVE P08CA-EMP-NO(FUNC-SUB)    TO P942-EMP-NO
              PERFORM P8090-LINK-942-SEN-ANAL
              IF P942-EMP-SEN-LEVEL > SPACES
                 MOVE P942-EMP-SEN-LEVEL        TO WS-SENIOR-LVL
                 MOVE P942-EMP-SENIORITY        TO WS-SENIOR-SEN-DATE
              ELSE
                 MOVE HIGH-VALUES               TO WS-SENIOR-LVL
                                                   WS-SENIOR-SEN-DATE
              END-IF
           ELSE
              MOVE HIGH-VALUES                  TO WS-SENIOR-LVL
                                                   WS-SENIOR-SEN-DATE
           END-IF
      *
           MOVE SPACES                    TO SCR08-FUNC(FUNC-SUB)
           MOVE FUNC-SUB                  TO HOLD-FUNC-SUB
                                             WS-SENIOR-FUNC-SUB
           ADD 1                          TO FUNC-SUB
           PERFORM UNTIL FUNC-SUB > ARRAY-MAX
              MOVE SCR08-FUNC(FUNC-SUB)   TO WS-FUNCTION-CODE
              IF SENIOR-MAN-FUNCTION
                 IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
                    P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
                    MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
                    MOVE 'I049' TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
                 IF P08CA-ASGN-IS-VCNY(FUNC-SUB)
                    OR P08CA-ASGN-IS-BOTH(FUNC-SUB)
                    OR P08CA-DEC-KEY(FUNC-SUB) > SPACES
                    IF P08CA-EMP-NO(FUNC-SUB) IS NUMERIC
                       MOVE P08CA-EMP-NO(FUNC-SUB) TO WS-COMPARE-EMP-NO
                    ELSE
                       MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
                       IF P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
      *                  'EMPLOYEES STATUS PROHIBITS CALL'
                          MOVE 'E030' TO MSGLOG-CODE
                       ELSE
      *                  'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                          MOVE 'I050' TO MSGLOG-CODE
                       END-IF
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 ELSE
                    IF P08CA-REG-EMP-NO(FUNC-SUB) NOT > '000000000'
                       AND P08CA-EMP-NO(FUNC-SUB) NOT > '000000000'
                       MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
                       IF P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
      *                   'EMPLOYEES STATUS PROHIBITS CALL'
                          MOVE 'E030' TO MSGLOG-CODE
                       ELSE
      *                  'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                          MOVE 'I050' TO MSGLOG-CODE
                       END-IF
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    ELSE
                       IF P08CA-EMP-NO(FUNC-SUB) > '000000000'
                          MOVE P08CA-EMP-NO(FUNC-SUB)
                                            TO WS-COMPARE-EMP-NO
                       ELSE
                          MOVE P08CA-REG-EMP-NO(FUNC-SUB)
                                            TO WS-COMPARE-EMP-NO
                          MOVE SPACES       TO P08CA-EMP-NO(FUNC-SUB)
                       END-IF
                    END-IF
                 END-IF
                 IF WS-COMPARE-EMP-NO IS NUMERIC
                    MOVE SPACES                 TO P942-COMMAREA-PARMS
                    SET P942-EMP-SEN-FUNCTION   TO TRUE
                    MOVE WS-HOLD-SENR-ASGN      TO P942-ASSIGNMENT
                    MOVE WS-COMPARE-EMP-NO      TO P942-EMP-NO
                    PERFORM P8090-LINK-942-SEN-ANAL
                    IF P942-EMP-SEN-LEVEL > SPACES
                       MOVE P942-EMP-SEN-LEVEL   TO WS-COMPARE-LVL
                       MOVE P942-EMP-SENIORITY   TO WS-COMPARE-SEN-DATE
                    ELSE
                       MOVE HIGH-VALUES          TO WS-COMPARE-LVL
                                                    WS-COMPARE-SEN-DATE
                    END-IF
                 ELSE
                    MOVE HIGH-VALUES             TO WS-COMPARE-LVL
                                                    WS-COMPARE-SEN-DATE
                 END-IF




                 MOVE SPACES              TO SCR08-FUNC(FUNC-SUB)
                 IF WS-COMPARE-SEN < WS-SENIOR-SEN
                    MOVE WS-COMPARE-SEN   TO WS-SENIOR-SEN
                    MOVE FUNC-SUB         TO WS-SENIOR-FUNC-SUB
                    MOVE WS-COMPARE-EMP-NO
                                          TO WS-SENIOR-EMP-NO
                    END-IF
              END-IF
              ADD 1                       TO FUNC-SUB
           END-PERFORM
           IF WS-SENIOR-FUNC-SUB      NOT  = HOLD-FUNC-SUB
              MOVE WS-SENIOR-FUNC-SUB     TO FUNC-SUB
              IF P08CA-EMP-NO(HOLD-FUNC-SUB) NUMERIC
                 MOVE P08CA-EMP-NO(HOLD-FUNC-SUB)
                                             TO P08CA-EMP-NO(FUNC-SUB)
                                                MSTRNBRK
              ELSE
                 MOVE P08CA-REG-EMP-NO(HOLD-FUNC-SUB)
                                             TO P08CA-EMP-NO(FUNC-SUB)
                                                MSTRNBRK
              END-IF
              MOVE P08CA-DEC-KEY(FUNC-SUB)   TO WS-SENIOR-DEC-KEY
              MOVE P08CA-DEC-KEY(HOLD-FUNC-SUB)
                                             TO P08CA-DEC-KEY(FUNC-SUB)
              SET  P08CA-SENR-RESTRICTED(FUNC-SUB)
                                             TO TRUE
              MOVE FUNC-SUB                  TO SAVE-SENR-SUB
              SET WS-BYPASS-PREP             TO TRUE
              PERFORM P1040-SETUP-NAME-LINE
              MOVE HOLD-FUNC-SUB             TO FUNC-SUB
              MOVE WS-SENIOR-EMP-NO          TO P08CA-EMP-NO(FUNC-SUB)
                                                MSTRNBRK
              PERFORM P1040-SETUP-NAME-LINE
              MOVE SPACE                     TO WS-BYPASS-PREP-FLAG
              MOVE WS-SENIOR-DEC-KEY         TO P08CA-DEC-KEY(FUNC-SUB)
              SET  P08CA-SENR-RESTRICTED(FUNC-SUB)
                                             TO TRUE
              MOVE SPACES                TO P943-COMMAREA-PARMS
              MOVE EMP-NBR IN WS-MSTR    TO P943-EMP-NBR
              MOVE CRAFT IN WS-MSTR      TO P943-CRAFT
              IF TEMPORARY-ASGNMT > SPACE
                 MOVE TEMPORARY-ASGNMT   TO P943-NORM-ASGN
              ELSE
                 IF NORMAL-ASGNMT > SPACE
                    MOVE NORMAL-ASGNMT   TO P943-NORM-ASGN
                 END-IF
              END-IF
              MOVE LAYOFF-CODE           TO P943-LO
              SET P943-OVERRIDE-SENIOR-FUN  TO TRUE
              IF UFP-CALL
                 MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN
                 PERFORM P8600-READ-UFPTURN
                 IF NOT SUCCESS
                    MOVE 'P2600-1'         TO ERR-PARAGRAPH
                    MOVE UFPTURN           TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE DIST IN WS-UFP     TO P943-DIST
                 MOVE SUB-DIST IN WS-UFP TO P943-SDIST
                 MOVE POOL-NAME IN WS-UFP
                                         TO P943-POOL-ASG
                 MOVE IN-OUT-TERMINAL    TO P943-IN-OUT
                 MOVE WS-FORMAT-TRAIN    TO P943-TEMP-ASGN-TRAIN
                 MOVE POOL-CRAFT-CODE2   TO P943-TEMP-ASGN-CC
              ELSE
                 MOVE P08CA-ASGN-KEY(FUNC-SUB) TO AJJOBKEY
                 PERFORM P8600-READ-AJJOBKEY
                 IF NOT SUCCESS
                    MOVE 'P2600-2'         TO ERR-PARAGRAPH
                    MOVE AJJOBKEY          TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE AJ-JOB-DIST        TO P943-DIST
                 MOVE AJ-JOB-SUB-DIST    TO P943-SDIST
                 MOVE '0'                TO P943-IN-OUT
                 IF YARD-CALL
                    MOVE SCR08-ASGN      TO P943-TEMP-ASGN-TRAIN
                 ELSE
                    MOVE WS-FORMAT-TRAIN TO P943-TEMP-ASGN-TRAIN
                 END-IF
                 MOVE AJ-JOB-ASGN-CC     TO  P943-TEMP-ASGN-CC
              END-IF
              IF P943-DIST    NOT = PSTCA-DIST
              OR P943-SDIST    NOT = PSTCA-SUB-DIST
                 PERFORM P8994-CONVERT-HIST-TIMEZONE
              ELSE
                 MOVE WS-LOCAL-DATE-TIME    TO P943-EFF-DATE-TIME
              END-IF
              MOVE WS-SENIOR-FUNC-SUB    TO FUNC-SUB
              MOVE P08CA-EMP-NO(FUNC-SUB)
                                         TO P943-EMP-NBR-AFFECTED
              PERFORM P8900-WRITE-HISTORY
           END-IF
           MOVE HOLD-FUNC-SUB            TO FUNC-SUB
           SET SENIOR-MAN-FUNCTION       TO TRUE
           MOVE -1                       TO SCR08-FUNC-CURSOR(FUNC-SUB).
      *
       P2700-PROCESS-DCAN.
      *
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              MOVE -1        TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
              MOVE 'I049'    TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *
      *    MAKE SURE THE OTHER TURNS IN THE "SET" HAVE NOT BEEN CALLED
      *
           IF ASSOCIATED-TURN
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                          IF P08CA-ASGN-SET(SUB1)
                             MOVE ARRAY-MAX TO SUB1
                             MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                             MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO TO SCR08-NAME-HI(FUNC-SUB)
                                               SCR08-FUNC-HI(FUNC-SUB)
      *                      'CANNOT "DCAN" TURN ONCE IT '
      *                      'HAS BEEN PARTIALLY CALLED'
                             MOVE 'C088' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                       END-IF
                    END-PERFORM
                 ELSE
                    MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                 END-IF
              END-PERFORM
           END-IF
           IF P08CA-ASGN-MU(FUNC-SUB)
              MOVE -1        TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *       MOVE 'IMPROPER FUNCTION - CANNOT "DCAN" A MADE UP TURN'
              MOVE 'I277'    TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *
      *    IF A B1 TURN IS BEING REJECTED AND THIS IS A POOL WHERE THE
      *    CONDUCTOR GETS 2 "B1" TURNS, DO NOT LET THE USER REJECT OR
      *    DROP THE "1ST B1" IF THEY HAVE ALREADY CALLED THE OTHER B1
      *    THE REASON FOR THIS IS IF IT WERE ALLOWED, WHEN THE TURNS
      *    TIE UP AT THE NEXT STATION THEIR ORDER WOULD BE REVERSED
      *    WHICH WOULD CAUSE A PERMANENT RUNAROUND
      *
           IF SCR08-CC(FUNC-SUB) = 'B1'
              AND P08CA-COND-GETS-2BK
              MOVE FUNC-SUB                    TO SUB1
              ADD 1                            TO SUB1
              IF P08CA-ASGN-SET(SUB1)
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *          'IMPROPER FUNCTION - '
      *          'CANNOT "DCAN" ONCE 2ND BRAKEMAN '
      *          'HAS BEEN CALLED'
                 MOVE 'I288' TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF

      *
      *    SET THE FUNCTION ON THE "PRIMARY" TURN IF NECESSARY
      *
           IF ASSOCIATED-TURN
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                    AND PRIMARY-TURN(CRAFT-SUB)
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                          MOVE SCR08-FUNC(FUNC-SUB) TO SCR08-FUNC(SUB1)
                          MOVE SPACES
                             TO SCR08-FUNC(FUNC-SUB)
                          MOVE P08CA-ASGN-KEY(SUB1) TO UFPTURN
                          MOVE SUB1 TO FUNC-SUB
                          PERFORM P0390-SETUP-ASSOC-CRAFTS
                          MOVE ARRAY-MAX       TO SUB1
                          MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                       END-IF
                    END-PERFORM
                 END-IF
              END-PERFORM
           END-IF
      *
      *  C513 9/25/03  GER  ADDED RELEASE OF TRACKING.
      *    RELEASE ANY TRACKING THAT MAY HAVE BEEN INITIATED
      *    ON THIS TURN
      *
           PERFORM P8070-UPDATE-TRACKING
           MOVE FUNC-SUB                    TO HOLD-FUNC-SUB
      *
      *    RELEASE ANY ASSOCIATED TURNS AS WELL
      *
           IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
              PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                 UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1 > ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                          IF P08CA-ASGN-KEY(SUB1) > SPACES
                             MOVE SUB1            TO FUNC-SUB
                             PERFORM P8070-UPDATE-TRACKING
                          END-IF
                       END-IF
                    END-PERFORM
                 ELSE
                    MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                 END-IF
              END-PERFORM
           END-IF
           MOVE HOLD-FUNC-SUB                     TO FUNC-SUB
      * C513  END
      *
           MOVE P08CA-ASGN-KEY(FUNC-SUB)          TO UFPTURN
           PERFORM P8600-READ-UFPTURN
           IF NOT SUCCESS
              MOVE 'P2700-1'                      TO ERR-PARAGRAPH
              MOVE UFPTURN                        TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF

           MOVE UFPPOS-AREA                       TO WORK-UFPPOS
           MOVE SPACES                            TO WORK-CNTLKEY
           MOVE '77'                              TO WK-CNTL-REC-TYPE
           MOVE DIST2                             TO WK-CNTL-DIST
           MOVE SUB-DIST2                         TO WK-CNTL-SUB-DIST
           MOVE POOL-NAME2                        TO WK-CNTL-77-POOL
           MOVE IN-OUT-TERMINAL                   TO WK-CNTL-77-TERM
           IF ENGINE-POOL-CRAFT
              MOVE 'EN'                           TO WK-CNTL-77-CREW
           ELSE
              MOVE 'TR'                           TO WK-CNTL-77-CREW
           END-IF
           IF P08CA-TRAIN > SPACE
              MOVE P08CA-TRAIN                    TO WK-CNTL-77-TRAIN
                                                     WS-UFP-TRAIN
           ELSE
              MOVE P08CA-TRAIN-PROFILE           TO WK-CNTL-77-TRAIN
                                                    WS-UFP-TRAIN
           END-IF
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE ALL '*'                        TO WK-CNTL-77-TRAIN
              PERFORM P8610-READ-CNTLFILE
           END-IF
           IF SUCCESS
      **
      **      DCAN IS NOT ALLOWED OUTSIDE THE DCAN FROM/TO WINDOW.
      **                                                             PLS
              IF CNTL-77-CREW-FROM-TIME > CNTL-77-CREW-TO-TIME
                 IF WS-LOCAL-TIME < CNTL-77-CREW-FROM-TIME AND
                    WS-LOCAL-TIME > CNTL-77-CREW-TO-TIME
                    MOVE -1    TO SCR08-FUNC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      **           DCAN FUNCTION CANNOT BE PERFORMED OUTSIDE
      **           OF FROM / TO PERIOD
                    MOVE 'D046'        TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              ELSE
                 IF WS-LOCAL-TIME < CNTL-77-CREW-FROM-TIME OR
                    WS-LOCAL-TIME > CNTL-77-CREW-TO-TIME
                    MOVE -1    TO SCR08-FUNC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      **           DCAN FUNCTION CANNOT BE PERFORMED OUTSIDE
      **           OF FROM / TO PERIOD
                    MOVE 'D046'        TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 END-IF
              END-IF
      **
      **      CHECK FOR CARRTURN DUPLICATE KEY
      **
              MOVE SPACES                      TO WS-CARRIED-TURN
              MOVE P08CA-ASGN-KEY(FUNC-SUB) TO CARRIED-TURN-KEY
              MOVE CARRIED-TURN-KEY            TO CARRTURN
              EXEC CICS READ
                        DATASET(CARRTURN-DATASET)
                        INTO(WS-CARRIED-TURN)
                        LENGTH(CARRTURN-RLGTH)
                        KEYLENGTH(CARRTURN-KLGTH)
                        RIDFLD(CARRTURN)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE                 TO FILE-STATUS
              IF SUCCESS
      **         DCAN FUNCTION CANNOT BE PERFORMED - DUPLICATE KEY
                 MOVE 'D049'           TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF

              IF CNTL-77-ADVANCE-POINTER
                 MOVE P08CA-PROFILE-KEY           TO TRCNKEY1
                 PERFORM P8000-READ-TRCNKEY1
                 IF SUCCESS
                    IF ENGINE-POOL-CRAFT
                       IF TRCN-EN-SCH-PROFILE > SPACES
                          IF P08CA-NO-SCHED(FUNC-SUB)
                             OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                             CONTINUE
                          ELSE
                             MOVE P08CA-SCHD-KEY(FUNC-SUB)
                                               TO WORK-CNTL-76-KEY
                             PERFORM P2710-ADVANCE-POINTER
                          END-IF
                       END-IF
                    ELSE
                       IF TRCN-TR-SCH-PROFILE > SPACES
                          IF P08CA-NO-SCHED(FUNC-SUB)
                             OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                             CONTINUE
                          ELSE
                             MOVE P08CA-SCHD-KEY(FUNC-SUB)
                                               TO WORK-CNTL-76-KEY
                             PERFORM P2710-ADVANCE-POINTER
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-IF
              IF CNTL-77-CREW-DIST > SPACES
                 MOVE SPACES              TO WS-ASSOCIATED-DCAN-FLAG
                 PERFORM P2720-CREW-PLACEMENT
                 IF WS-ASSOCIATED-CRAFT-ARRAY > SPACES
                    MOVE FUNC-SUB         TO SAVE-FUNC-SUB
                    PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                       UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                       IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                          MOVE WS-ASSOC-CRAFT(CRAFT-SUB)
                                          TO POOL-CRAFT-CODE2
                          PERFORM P2715-CHECK-ASSOC-TURN
                       ELSE
                          MOVE CRAFT-ARRAY-MAX TO CRAFT-SUB
                       END-IF
                    END-PERFORM
                    MOVE SAVE-FUNC-SUB    TO FUNC-SUB
                 END-IF
              ELSE
                 MOVE -1                  TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO           TO SCR08-FUNC-HI    (FUNC-SUB)
      *             'IMPRPR FUNC - DCAN PLACEMENT INFO NOT SET UP'
                 MOVE 'I301'              TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           ELSE
              MOVE -1                     TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO              TO SCR08-FUNC-HI    (FUNC-SUB)
      *           'IMPROPER FUNCTION - DCAN CONTROL TABLE NOT SET UP'
              MOVE 'I300'                 TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           ADD 1                          TO WK-UFPPOS-TIE-NUM
           MOVE SPACES                    TO SCR08-FUNC(FUNC-SUB)

           IF SCR08-CC(FUNC-SUB) = 'CO'
      *
      *       HERE THE CONDUCTOR WE ARE REJECTING GET 2 "B1" BRAKEMAN
      *       SO AFTER WE HAVE REJECTED THAT TURN, SEE IF THE CONDUCTOR
      *       WE FOUND ALSO GETS 2 "B1" BRAKEMAN, IF NOT CLEAR OUT THE
      *       SECOND BRAKEMAN AREA IF IT HAS NOT BEEN CALLED
      *
              IF P08CA-COND-GETS-2BK
                 PERFORM P0340-GET-NEXT-TURN
                 IF NOT P08CA-COND-GETS-2BK
                    MOVE FUNC-SUB               TO HOLD-FUNC-SUB
                    PERFORM VARYING FUNC-SUB FROM HOLD-FUNC-SUB BY 1
                       UNTIL FUNC-SUB > ARRAY-MAX
                       OR SCR08-CC(FUNC-SUB) = 'B2'
                    END-PERFORM
                    IF FUNC-SUB NOT > ARRAY-MAX
                       IF NOT P08CA-ASGN-SET(FUNC-SUB)
                          IF P08CA-ASGN-MU(FUNC-SUB)
                             PERFORM P8040-PROCESS-DELETE
                          END-IF
                          PERFORM P1060-CLEAR-DATA-LINE
                       END-IF
                    END-IF
                    MOVE HOLD-FUNC-SUB          TO FUNC-SUB
                 END-IF
              ELSE
      *
      *          HERE THE CONDUCTOR WE ARE REJECTING DOES NOT GET 2 "B1"
      *          BRAKEMAN, SO AFTER WE HAVE REJECTED THAT TURN, SEE IF
      *          IF THE "NEW" CONDUCTOR GETS 2 "B1" BRAKEMAN, AND IF SO
      *          AND IF WE DO NOT ALREADY HAVE A 2ND "B1", GO GET ONE
      *
                 PERFORM P0340-GET-NEXT-TURN
                 IF P08CA-COND-GETS-2BK
                    MOVE FUNC-SUB               TO HOLD-FUNC-SUB
                    PERFORM VARYING FUNC-SUB FROM HOLD-FUNC-SUB BY 1
                       UNTIL FUNC-SUB > ARRAY-MAX
                       OR SCR08-CC(FUNC-SUB) = 'B2'
                    END-PERFORM
                    IF FUNC-SUB NOT > ARRAY-MAX
                       IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACE
                          MOVE SPACES           TO SCR08-FUNC(FUNC-SUB)
                          PERFORM P0345-GET-NEXT-B1
                       END-IF
                    END-IF
                    MOVE HOLD-FUNC-SUB          TO FUNC-SUB
                 END-IF
              END-IF
           ELSE
              IF SCR08-CC(FUNC-SUB) = 'B1'
                 AND P08CA-COND-GETS-2BK
      *
      *          ONCE WE HAVE REJECTED THE CURRENT "B1", MAKE SURE THE
      *          TURN WE DISPLAYED IN THE "B1" SLOT IS NOT THE SAME TURN
      *          WE PREVIOUSLY DISPLAYED IN THE "B2" SLOT, IF IT IS, GO
      *          AND GET A NEW SECOND "B1"
      *
                 PERFORM P0340-GET-NEXT-TURN
                 MOVE FUNC-SUB                  TO SUB1
                 ADD 1                          TO FUNC-SUB
                 IF P08CA-ASGN-KEY(SUB1) = P08CA-ASGN-KEY(FUNC-SUB)
                    AND P08CA-ASGN-KEY(SUB1) > SPACES
                    MOVE SPACES                 TO SCR08-FUNC(FUNC-SUB)
                    PERFORM P0345-GET-NEXT-B1
                 ELSE
                    SUBTRACT 1                FROM FUNC-SUB
                 END-IF
              ELSE
                 PERFORM P0340-GET-NEXT-TURN
              END-IF
           END-IF
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              IF NOT (P08CA-NO-SCHED(FUNC-SUB)
                 OR P08CA-SCHED-COMPLETE(FUNC-SUB)
                 OR P08CA-SCHED-BIDPACK(FUNC-SUB)
                 OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
                 OR P08CA-SCHED-BIDPACK-FIFO(FUNC-SUB)
      *11/1/17 - BEG
                 OR P08CA-NON-BP-WITH-ALT(FUNC-SUB))
      *11/1/17 - END
                 PERFORM P0355-ADVANCE-SCHEDULE
              END-IF
           ELSE
              IF P08CA-SCHD-DLY(FUNC-SUB) NOT = SPACES
                 PERFORM P0359-SET-SCHD-TYP
              END-IF
           END-IF
           MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB).
      *
       P2710-ADVANCE-POINTER.
      *
           MOVE WORK-CNTL-76-KEY       TO CNTLKEY-AREA
           SET CNTL-76-STATS           TO TRUE
           MOVE CNTLKEY-AREA TO CNTLKEY
           EXEC CICS READ
                     UPDATE
                     DATASET(CNTL-FILE-VIA-CNTLKEY)
                     INTO(WS-CNTL-FILE)
                     LENGTH(CNTLFILE-RLGTH)
                     RIDFLD(CNTLKEY)
                     KEYLENGTH(CNTLFILE-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
      *
      *    IF NOT SUCCESS
      *       SET REJECT-TURN          TO TRUE
      *    ELSE
      *
           IF SUCCESS
              IF WS-UFP-TRAIN = CNTL-76-LU-TRAIN
                 AND WS-LOCAL-DATE-TIME  = CNTL-76-LU-DATE-TIME
                 EXEC CICS UNLOCK
                           DATASET(CNTL-FILE-VIA-CNTLKEY)
                           RESP(WS-RESPONSE)
                 END-EXEC
              ELSE
                 MOVE CNTL-76-POINTER  TO CNTL-76-LAST-POINTER
                 MOVE WK-CNTL-76-SEQ   TO CNTL-76-POINTER
                 MOVE WS-UFP-TRAIN     TO CNTL-76-LU-TRAIN
                 MOVE WS-LOCAL-DATE-TIME
                                       TO CNTL-76-LU-DATE-TIME
                 EXEC CICS REWRITE
                           DATASET(CNTL-FILE-VIA-CNTLKEY)
                           FROM(WS-CNTL-FILE)
                           LENGTH(CNTLFILE-RLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 IF NOT SUCCESS
                    MOVE 'P2710-1'     TO ERR-PARAGRAPH
                    MOVE CNTLKEY       TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              IF WK-CNTL-76-CREW > SPACES
                 MOVE SPACES              TO CNTLKEY-AREA
                 SET SCH-POOL-PROFILE-REC TO TRUE
                 MOVE WK-CNTL-76-PROF     TO CNTL-75-PROFILE
                 MOVE WK-CNTL-76-CREW     TO CNTL-75-CREW-UNIT
                 MOVE CNTLKEY-AREA TO CNTLKEY
                 EXEC CICS READ
                           DATASET(CNTL-FILE-VIA-CNTLKEY)
                           INTO(WS-CNTL-FILE)
                           LENGTH(CNTLFILE-RLGTH)
                           RIDFLD(CNTLKEY)
                           KEYLENGTH(CNTLFILE-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS AND
                    CNTL-75-SCHEDULE-DAILY
                    MOVE WORK-CNTL-76-KEY TO CNTLKEY-AREA
                    MOVE CNTLKEY-AREA TO CNTLKEY
                    EXEC CICS READ
                              UPDATE
                              DATASET(CNTL-FILE-VIA-CNTLKEY)
                              INTO(WS-CNTL-FILE)
                              LENGTH(CNTLFILE-RLGTH)
                              RIDFLD(CNTLKEY)
                              KEYLENGTH(CNTLFILE-KLGTH)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE TO FILE-STATUS
                    IF SUCCESS
                       MOVE WS-UFP-TRAIN     TO CNTL-76-LU-TRAIN
                       MOVE WS-LOCAL-DATE-TIME
                                             TO CNTL-76-LU-DATE-TIME
                       EXEC CICS REWRITE
                                 DATASET(CNTL-FILE-VIA-CNTLKEY)
                                 FROM(WS-CNTL-FILE)
                                 LENGTH(CNTLFILE-RLGTH)
                                 RESP(WS-RESPONSE)
                       END-EXEC
                       IF NOT SUCCESS
                          MOVE 'P2710-2'     TO ERR-PARAGRAPH
                          MOVE CNTLKEY       TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-IF

           IF NOT REJECT-MARK
              PERFORM P8610-READ-CNTLFILE
           END-IF.
      *
       P2715-CHECK-ASSOC-TURN.
      *
           MOVE UFPTURN-AREA              TO UFPTURN
           PERFORM P8600-READ-UFPTURN
           IF SUCCESS
              SET ASSOCIATED-DCAN         TO TRUE
              PERFORM VARYING SUB1 FROM 1 BY 1
                 UNTIL SUB1 > ARRAY-MAX
                 IF WS-ASSOC-CRAFT(CRAFT-SUB) = SCR08-CC(SUB1)
                    MOVE SUB1             TO FUNC-SUB
                    MOVE ARRAY-MAX        TO SUB1
                 END-IF
              END-PERFORM
              PERFORM P2720-CREW-PLACEMENT
           ELSE
              IF NO-RECORD-FND
                 IF OPTIONAL-TURN(CRAFT-SUB)
                    CONTINUE
                 ELSE
                    MOVE 'P2715-1'        TO ERR-PARAGRAPH
                    MOVE UFPTURN          TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              ELSE
                 MOVE 'P2715-2'           TO ERR-PARAGRAPH
                 MOVE UFPTURN             TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P2720-CREW-PLACEMENT.
      *
           MOVE DIST      OF WS-UFP       TO WS-SAVE-DIST
           MOVE SUB-DIST  OF WS-UFP       TO WS-SAVE-SDIST
           MOVE POOL-NAME OF WS-UFP       TO WS-SAVE-POOL
           MOVE IN-OUT-TERMINAL           TO WS-SAVE-IO-TOWN
           MOVE CNTL-77-CREW-DIST         TO DIST      OF WS-UFP
           MOVE CNTL-77-CREW-SDIST        TO SUB-DIST  OF WS-UFP
           MOVE CNTL-77-CREW-POOL         TO POOL-NAME OF WS-UFP
           MOVE CNTL-77-CREW-TERM         TO IN-OUT-TERMINAL
           IF NOT ASSOCIATED-DCAN
              IF CNTL-77-CREW-ROTATION = '1'
                 MOVE '0000000001'        TO UFP-POS-DATE-TIME
              ELSE
                 MOVE WS-LOCAL-DATE-TIME  TO UFP-POS-DATE-TIME
              END-IF
              MOVE ZEROS                  TO UFP-POS-TIE-BREAKER
              MOVE SPACES                 TO P909-POSITION-PARMS
              MOVE UFPPOS-AREA            TO P909-POS-KEY
              SET P909-BREAK-TIE-BY-ORDERED TO TRUE
              IF P08CA-REG-EMP-NO(FUNC-SUB)  NUMERIC
                 AND P08CA-REG-EMP-NO(FUNC-SUB) = P08CA-EMP-NO(FUNC-SUB)
                 MOVE P08CA-REG-EMP-NO(FUNC-SUB)
                                          TO P909-EMP-NO
              END-IF
              IF HT-ORDERED-TIME > ZEROES
                 MOVE HT-ORDERED-TIME     TO P909-HT-ORDERED-TIME
              ELSE
                 MOVE HT-ON-DUTY-TIME     TO P909-HT-ORDERED-TIME
              END-IF
              MOVE UFP-HT-POSITION-TIME   TO P909-HT-POSITION-TIME
      *C1150.1 - BEG
              MOVE UFP-HT-CREW-SUPPLY     TO P909-HT-CREW-SUPPLY
      *C1150.1 - END
              EXEC CICS LINK
                        PROGRAM(P909-PGM)
                        COMMAREA(P909-POSITION-PARMS)
                        LENGTH(P909-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2720-1'           TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
           MOVE UFPTURN-AREA              TO UFPTURN
           PERFORM P8650-READ-UFPTURN-UPDATE
           IF NOT ASSOCIATED-DCAN
              MOVE P909-POS-KEY           TO UFPPOS-AREA
           ELSE
              MOVE CNTL-77-CREW-DIST      TO DIST      OF WS-UFP
              MOVE CNTL-77-CREW-SDIST     TO SUB-DIST  OF WS-UFP
              MOVE CNTL-77-CREW-POOL      TO POOL-NAME OF WS-UFP
              MOVE CNTL-77-CREW-TERM      TO IN-OUT-TERMINAL
           END-IF
           PERFORM P8640-REWRITE-UFPTURN

           MOVE SPACES                   TO WS-CARRIED-TURN
           SET CARRIED-DCAN-PLACEMENT    TO TRUE
           MOVE UFPTURN-AREA             TO CARRIED-TURN-DCAN-FROM-KEY
                                            CARRIED-TURN-KEY
                                            WS-DCAN-FROM-TURNKEY
           MOVE CNTL-77-CREW-DIST        TO CARRIED-DCAN-TO-DIST
           MOVE CNTL-77-CREW-SDIST       TO CARRIED-DCAN-TO-SUB-DIST
           MOVE CNTL-77-CREW-POOL        TO CARRIED-DCAN-TO-POOL
           MOVE TURN-NBR OF WS-UFP       TO CARRIED-DCAN-TO-TURN
           MOVE POOL-CRAFT-CODE2         TO CARRIED-DCAN-TO-CC
           MOVE WS-SYSTEM-DATE           TO CARRIED-TURN-DCAN-SYS-DATE
           MOVE WS-SYS-HR                TO CARRIED-DCAN-SYS-HR
           MOVE WS-SYS-MN                TO CARRIED-DCAN-SYS-MN
           MOVE CNTL-77-CREW-FROM-TIME   TO CARRIED-DCAN-FROM-TIME
           MOVE CNTL-77-CREW-TO-TIME     TO CARRIED-DCAN-TO-TIME
           MOVE WS-SAVE-IO-TOWN          TO CARRIED-DCAN-FROM-TERM
           MOVE CNTL-77-CREW-TERM        TO CARRIED-DCAN-TO-TERM
           MOVE CARRIED-TURN-DCAN-TO-KEY TO WS-DCAN-TO-TURNKEY
           MOVE CARRIED-TURN-KEY         TO CARRTURN
           EXEC CICS WRITE
                     DATASET(CARRTURN-DATASET)
                     FROM(WS-CARRIED-TURN)
                     LENGTH(CARRTURN-RLGTH)
                     KEYLENGTH(CARRTURN-KLGTH)
                     RIDFLD(CARRTURN)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2720-2'          TO ERR-PARAGRAPH
              MOVE CARRTURN           TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF

           IF DIST              OF WS-UFP = DIST2
              AND SUB-DIST      OF WS-UFP = SUB-DIST2
              AND POOL-NAME     OF WS-UFP = POOL-NAME2
              AND IN-OUT-TOWN-FLAG        = '00'
              PERFORM P2730-DELETE-ON-DUTY-RECORD
           ELSE
              IF P08CA-REG-EMP-NO(FUNC-SUB) > '000000000'
                 PERFORM P2740-WRITE-ON-DUTY-RECORD
              END-IF
           END-IF

           MOVE SPACES                    TO P943-COMMAREA-PARMS
           IF P08CA-REG-EMP-NO(FUNC-SUB)  NUMERIC
              AND P08CA-REG-EMP-NO(FUNC-SUB)
                                         = P08CA-EMP-NO(FUNC-SUB)
              MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO P943-EMP-NBR
                                                 MSTRNBRK
              PERFORM P8500-READ-MASTER
              MOVE CRAFT OF WS-MSTR       TO P943-CRAFT
              IF TEMPORARY-ASGNMT > SPACE
                 MOVE TEMPORARY-ASGNMT    TO P943-NORM-ASGN
              ELSE
                 IF NORMAL-ASGNMT > SPACE
                    MOVE NORMAL-ASGNMT    TO P943-NORM-ASGN
                 END-IF
              END-IF
              MOVE LAYOFF-CODE OF WS-MSTR TO P943-LO
           ELSE
              MOVE '999999997'            TO P943-EMP-NBR
              MOVE UFPTURN-AREA           TO P943-NORM-ASGN
           END-IF
           SET P943-DCAN-TURN-FUN         TO TRUE
           MOVE WS-DCAN-FROM-TURNKEY      TO P943-FUN59-FROM-ASGN
           MOVE WS-DCAN-TO-TURNKEY        TO P943-FUN59-TO-ASGN
           MOVE DIST OF WS-UFP            TO P943-DIST
           MOVE SUB-DIST OF WS-UFP        TO P943-SDIST
           MOVE POOL-NAME OF WS-UFP       TO P943-POOL-ASG
           MOVE IN-OUT-TERMINAL           TO P943-IN-OUT
           IF DCAN-TURN
              STRING SCR08-ORDER-DATE DELIMITED BY SIZE,
                     SCR08-ORDER-TIME DELIMITED BY SIZE
                                          INTO P943-EFF-DATE-TIME
           ELSE
              IF P943-DIST            NOT  = PSTCA-DIST
                 OR P943-SDIST        NOT  = PSTCA-SUB-DIST
                 PERFORM P8994-CONVERT-HIST-TIMEZONE
              ELSE
                 MOVE WS-LOCAL-DATE-TIME  TO P943-EFF-DATE-TIME
              END-IF
           END-IF
           MOVE WS-FORMAT-TRAIN           TO P943-TEMP-ASGN-TRAIN
           MOVE POOL-CRAFT-CODE2          TO P943-TEMP-ASGN-CC
           PERFORM P8900-WRITE-HISTORY.
      *
       P2730-DELETE-ON-DUTY-RECORD.
      *
           MOVE 'U'                       TO WK-ASGN-JOB-TYPE
           MOVE DIST2 OF WS-UFP           TO WK-ASGN-DIST
           MOVE SUB-DIST2 OF WS-UFP       TO WK-ASGN-SUB-DIST
           MOVE POOL-NAME2 OF WS-UFP      TO WK-ASGN-POOL
           MOVE TURN-NBR OF WS-UFP        TO WK-ASGN-TURN
           MOVE POOL-CRAFT-CODE2          TO WK-ASGN-CC
           MOVE ZEROS                     TO WK-ASGN-DATE-TIME
           MOVE WORK-ASGNKEY1             TO ASGNKEY1
           SET ASGN-ON-DUTY-REC           TO TRUE
           MOVE ASGNKEY1                  TO ASGNJOB
           EXEC CICS DELETE
                     DATASET(ASGN-VIA-ASGNJOB)
                     RIDFLD(ASGNJOB)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE               TO FILE-STATUS
           IF NOT SUCCESS
              IF NOT NO-RECORD-FND
                 MOVE 'P2730-1'           TO ERR-PARAGRAPH
                 MOVE ASGNJOB             TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P2740-WRITE-ON-DUTY-RECORD.
      *
           MOVE 'U'                       TO WK-ASGN-JOB-TYPE
           MOVE DIST2 OF WS-UFP           TO WK-ASGN-DIST
           MOVE SUB-DIST2 OF WS-UFP       TO WK-ASGN-SUB-DIST
           MOVE POOL-NAME2 OF WS-UFP      TO WK-ASGN-POOL
           MOVE TURN-NBR OF WS-UFP        TO WK-ASGN-TURN
           MOVE POOL-CRAFT-CODE2          TO WK-ASGN-CC
           MOVE ZEROS                     TO WK-ASGN-DATE-TIME
           PERFORM PXXXX-ON-DUTY-EMP
           IF ASGN-EMP-NO NOT > ZERO
              AND P08CA-REG-EMP-NO(FUNC-SUB) = P08CA-EMP-NO(FUNC-SUB)
      *C983-BEG
              MOVE SPACE                  TO WS-ASGN-FILE
      *C983-END
              MOVE P08CA-REG-EMP-NO(FUNC-SUB)
                                          TO WK-ASGN-EMP-NO
              PERFORM PXXXX-JOB-ON-DUTY
              IF ASGN-ASSIGNMENT > SPACES
                 MOVE ASGNKEY1 TO ASGNJOB
                 EXEC CICS DELETE
                           DATASET(ASGN-VIA-ASGNJOB)
                           RIDFLD(ASGNJOB)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P2740-1'        TO ERR-PARAGRAPH
                    MOVE ASGNJOB          TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              MOVE SPACES                 TO WS-ASGN-FILE
              MOVE 'U'                    TO ASGN-JOB-TYPE
              MOVE DIST2 OF WS-UFP        TO ASGN-DIST
              MOVE SUB-DIST2 OF WS-UFP    TO ASGN-SUB-DIST
              MOVE POOL-NAME2 OF WS-UFP   TO ASGN-UFP-POOL
              MOVE TURN-NBR OF WS-UFP     TO ASGN-UFP-TURN
              MOVE POOL-CRAFT-CODE2       TO ASGN-UFP-CC
              MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO ASGN-EMP-NO
              MOVE '3'                    TO ASGN-REC-TYPE
                                             ASGN-EMP-NO-REC-TYPE
              MOVE ZEROS TO ASGN-DATE-TIME
                            ASGN-EMP-DATE-TIME
              MOVE WS-LOCAL-DATE-TIME     TO ASGN-ON-DUTY-DATE-TIME
              MOVE WS-SAVE-HOME-BOARD     TO ASGN-HOME-BOARD
              MOVE ASGNKEY1               TO ASGNJOB
              EXEC CICS WRITE
                        DATASET(ASGN-VIA-ASGNJOB)
                        FROM(WS-ASGN-FILE)
                        LENGTH(ASGNJOB-RLGTH)
                        RIDFLD(ASGNJOB)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE            TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2740-2'           TO ERR-PARAGRAPH
                 MOVE ASGNJOB             TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
              MOVE ASGNKEY1               TO WORK-ASGNKEY1
              IF P08CA-REG-EMP-NO(FUNC-SUB) NOT = ASGN-EMP-NO
                 AND P08CA-REG-EMP-NO(FUNC-SUB) = P08CA-EMP-NO(FUNC-SUB)
      *C983-BEG
                 MOVE SPACE                      TO WS-ASGN-FILE
      *C983-END
                 MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO WK-ASGN-EMP-NO
                 PERFORM PXXXX-JOB-ON-DUTY
                 IF ASGN-ASSIGNMENT > SPACES
                    MOVE ASGNKEY1         TO ASGNJOB
                    EXEC CICS DELETE
                              DATASET(ASGN-VIA-ASGNJOB)
                              RIDFLD(ASGNJOB)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE      TO FILE-STATUS
                    IF NOT SUCCESS
                       MOVE 'P2740-3'     TO ERR-PARAGRAPH
                       MOVE ASGNJOB       TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 END-IF
              END-IF
              MOVE WORK-ASGNKEY1          TO ASGNJOB
              EXEC CICS READ
                        UPDATE
                        DATASET(ASGN-VIA-ASGNJOB)
                        INTO(WS-ASGN-FILE)
                        LENGTH(ASGNJOB-RLGTH)
                        RIDFLD(ASGNJOB)
                        KEYLENGTH(ASGNJOB-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE            TO FILE-STATUS
              IF NOT SUCCESS
                 IF NOT NO-RECORD-FND
                    MOVE 'P2740-4'           TO ERR-PARAGRAPH
                    MOVE ASGNJOB             TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              IF SUCCESS
                 MOVE WS-LOCAL-DATE-TIME     TO ASGN-ON-DUTY-DATE-TIME
      *          MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO ASGN-EMP-NO
                 EXEC CICS REWRITE
                           DATASET(ASGN-VIA-ASGNJOB)
                           FROM(WS-ASGN-FILE)
                           LENGTH(ASGNJOB-RLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE            TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P2740-5'           TO ERR-PARAGRAPH
                    MOVE ASGNJOB             TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-IF.
      *
       P2750-REJECT-MARK-SCHEDULE.
      *
           MOVE SPACES                       TO WS-SCHED
           MOVE DIST OF WS-UFP               TO SCHED1-DIST
           MOVE SUB-DIST OF WS-UFP           TO SCHED1-SUB-DIST
           MOVE POOL-NAME OF WS-UFP          TO SCHED1-BOARD-ID
           MOVE P08CA-DATA-TURN-ID(FUNC-SUB) TO SCHED1-TURN-ID
           MOVE SCR08-CC(FUNC-SUB)           TO SCHED1-CC
           MOVE P08CA-START-DATE-TIME(FUNC-SUB)
                                             TO SCHED1-START-DATE-TIME
           MOVE P08CA-CALL-ORDER(FUNC-SUB)   TO SCHED1-CALL-ORDER
           MOVE P08CA-SEQ(FUNC-SUB)          TO SCHED1-SEQ
           MOVE P08CA-EFF-DATE(FUNC-SUB)     TO SCHED1-EFF-DATE
           MOVE SCHED-KEY1                   TO SCHEDKEY1
           EXEC CICS READ
                     UPDATE
                     DATASET(SJ-VIA-SCHEDKEY1)
                     INTO(WS-SCHED)
                     LENGTH(SCHEDKEY1-RLGTH)
                     RIDFLD(SCHEDKEY1)
                     KEYLENGTH(SCHEDKEY1-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2750-1'                 TO ERR-PARAGRAPH
              MOVE SCHEDKEY1                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF

           SET SCHED-REJECT-MARKED           TO TRUE

           EXEC CICS REWRITE
                     DATASET(SJ-VIA-SCHEDKEY1)
                     FROM(WS-SCHED)
                     LENGTH(SCHEDKEY1-RLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2750-2'                  TO ERR-PARAGRAPH
              MOVE SCHEDKEY1                  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P2800-DISPLAY-PHONE-NUMBERS.
      *
           IF P08CA-EMP-NO(FUNC-SUB) NOT > SPACES
              MOVE -1                     TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO              TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
              MOVE 'I050'                 TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           MOVE P08CA-EMP-NO(FUNC-SUB)    TO MSTRNBRK
           PERFORM P8505-READ-MASTER-ONLY
           PERFORM P1045-DISPLAY-PHONE-INFO
           IF WS-TELEPHONE-NBRS > SPACES
              MOVE WS-TELEPHONE-NBRS TO SCR08-ERRORMSG
           ELSE
              MOVE 'EMPLOYEE HAS NO PHONE NUMBERS ON FILE'
                                     TO SCR08-ERRORMSG
           END-IF
           MOVE SPACES                    TO SCR08-FUNC(FUNC-SUB)
           MOVE -1                        TO SCR08-FUNC-CURSOR(FUNC-SUB)
           PERFORM P9000-SEND-MAP-AND-RETURN.
      *
      *
       P2900-ATTEMPTED-NOTIFY.
      *
           IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
              MOVE 'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
                 TO SCR08-ERRORMSG
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           IF P08CA-EMP-NO(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
              MOVE 'NO EMPLOYEE TO NOTIFY' TO SCR08-ERRORMSG
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           MOVE SPACES                    TO P943-COMMAREA-PARMS
           MOVE P08CA-EMP-NO(FUNC-SUB)    TO P943-EMP-NBR
           SET P943-ATTEMPT-NTFY-FUN      TO TRUE
           MOVE SCR08-DIST                TO P943-DIST
           MOVE SCR08-SUB-DIST            TO P943-SDIST
           MOVE SCR08-CC(FUNC-SUB)        TO P943-CRAFT
           MOVE WS-CALL-DATE-TIME         TO P943-EFF-DATE-TIME
           MOVE PSTCA-TIME-ZONE           TO P943-EMP-TIME-ZONE
           MOVE SCR08-FUNC(FUNC-SUB)      TO P943-ATTEMPT-TYPE
      *
           IF P08CA-REG-EMP-NO(FUNC-SUB) NUMERIC
              MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO MSTRNBRK
              PERFORM P8500-READ-MASTER
              MOVE CRAFT OF WS-MSTR       TO P943-CRAFT
              IF TEMPORARY-ASGNMT > SPACE
                 MOVE TEMPORARY-ASGNMT    TO P943-NORM-ASGN
              ELSE
                 IF NORMAL-ASGNMT > SPACE
                    MOVE NORMAL-ASGNMT    TO P943-NORM-ASGN
                 END-IF
              END-IF
              MOVE SCR08-ST(FUNC-SUB)     TO P943-LO
           END-IF
           MOVE WS-FORMAT-TRAIN           TO P943-TEMP-ASGN-TRAIN
           MOVE SCR08-CC(FUNC-SUB)        TO P943-TEMP-ASGN-CC
           PERFORM P8900-WRITE-HISTORY
      *
      *C1009 - BEG
      *    IF SCR08-FUNC(FUNC-SUB) = 'CSPR'
      *       MOVE 'EMPLOYEE SPREAD CALL COMPLETED'
      *                                   TO SCR08-ERRORMSG
      *       MOVE SPACES                 TO TZ-PARAMETERS
      *       MOVE PSTCA-TIME-ZONE        TO TZ-IN-ZONE
      *       MOVE WS-CALL-DATE-TIME      TO TZ-IN-DATE-TIME
      *       MOVE TZ-SYSTEM-TIME-ZONE    TO TZ-OUT-ZONE
      *       PERFORM P8996-TIMEZONE
      *       IF TZ-INVALID-PARAMETERS
      *          MOVE 'P2900-1'           TO ERR-PARAGRAPH
      *          PERFORM P8996-TZERROR
      *       END-IF
      *
      *       MOVE SPACES                 TO WS-MSTR
      *       MOVE P08CA-EMP-NO(FUNC-SUB) TO EMP-NBR OF WS-MSTR
      *       MOVE EMP-NBR-KEY            TO MSTRNBRK
      *       EXEC CICS READ
      *                 UPDATE
      *                 DATASET(MSTR-VIA-EMP-NBR)
      *                 INTO(WS-MSTR)
      *                 LENGTH(MSTRENBR-RLGTH)
      *                 RIDFLD(MSTRNBRK)
      *                 KEYLENGTH(MSTRENBR-KLGTH)
      *                 RESP(WS-RESPONSE)
      *       END-EXEC
      *       MOVE WS-RESPONSE            TO FILE-STATUS
      *       IF NOT SUCCESS
      *          MOVE 'P2900-2'           TO ERR-PARAGRAPH
      *          MOVE MSTRNBRK            TO ERR-KEY
      *          PERFORM P9999-GOT-PROBLEM
      *       END-IF
      *       MOVE TZ-OUT-DATE-TIME       TO MSTR-SPRD-CALL-DATE-TIME
      *       MOVE WS-FORMAT-TRAIN        TO MSTR-SPRD-CALL-ASGN
      *       EXEC CICS REWRITE
      *                 DATASET(MSTR-VIA-EMP-NBR)
      *                 FROM(WS-MSTR)
      *                 LENGTH(MSTRENBR-RLGTH)
      *                 RESP(WS-RESPONSE)
      *       END-EXEC
      *       MOVE WS-RESPONSE            TO FILE-STATUS
      *       IF NOT SUCCESS
      *          MOVE 'P2900-3'           TO ERR-PARAGRAPH
      *          MOVE MSTRNBRK            TO ERR-KEY
      *          PERFORM P9999-GOT-PROBLEM
      *       END-IF
      *    ELSE
              MOVE 'EMPLOYEE "ATTEMPT" NOTIFICATION COMPLETED'
                                          TO SCR08-ERRORMSG
      *    END-IF
      *C1009 - END
           MOVE '****'    TO SCR08-FUNC       (FUNC-SUB)
           MOVE -1        TO SCR08-FUNC-CURSOR(FUNC-SUB).

      *================================================================*
       P2950-GET-HRS-SVC-INFO.
      *================================================================*
      *    DETERMINE THE ACTUAL TIME BY CALLING 925
      *    THE PSTCA-TIME-ZONE SHOULD BE THE SAME AS THE EMP TIME ZONE

           MOVE SPACES                    TO P925-COMMAREA-PARMS
           SET P925-CALC-ACTUAL-TIME      TO TRUE
           MOVE EMP-NBR IN WS-MSTR        TO P925-EMP-NO
           MOVE SCR08-CC(FUNC-SUB)        TO P925-ASGN-CC
           MOVE PSTCA-TIME-ZONE           TO P925-TIME-ZONE
           MOVE SCR08-ORDER-DATE          TO P925-ORDER-DATE
           MOVE SCR08-ORDER-TIME          TO P925-ORDER-TIME
           IF SCR08-OD-DATE(FUNC-SUB) > SPACES
              MOVE SCR08-OD-DATE(FUNC-SUB) TO P925-OD-DATE
           ELSE
              MOVE SCR08-ORDER-DATE        TO P925-OD-DATE
           END-IF
           IF SCR08-OD-TIME(FUNC-SUB) > SPACES
              MOVE SCR08-OD-TIME(FUNC-SUB) TO P925-OD-TIME
           ELSE
              MOVE SCR08-ORDER-TIME        TO P925-OD-TIME
           END-IF
           MOVE TRCN-JOB-TYPE             TO P925-JOB-TYPE
           MOVE TRCN-KEY1                 TO P925-TRCNKEY1

           IF TRCN-ASSIGNED-REC
              MOVE 'H'                        TO P925-TERM
              IF TRCN-LOCAL-REC
                 SET P925-TIE-UP-ROAD         TO TRUE
                 MOVE TRCN-TRAIN-ASGN         TO JOB-DEF-CHECK
                 IF JOB-DEF-COMMUTER-ASGN
                    SET P925-LOCAL-COMMUTER   TO TRUE
                 ELSE
                    SET P925-LOCAL-JOB        TO TRUE
                 END-IF
              ELSE
                 SET P925-TIE-UP-YARD         TO TRUE
              END-IF
           ELSE
              SET P925-TIE-UP-ROAD            TO TRUE
              IF TRCN-POOL-REC
                 MOVE SCR08-CC(FUNC-SUB)      TO WS-CRAFT-CODE-CHECK
      *
      *          IF WE'VE GONE TO THE ALTERNATE CREW SOURCE, AS
      *          INDICATED BY TOPC, USE THE 'AWAY FROM HOME' FLAG
      *          TO DECIDE IF THE EMPLOYEE IS HOME OR AWAY.
      *          (C641-1/23/07-JES) - IF NOT TOPC, AND CREWING FROM
      *          A '0' TERMINAL, CHECK THE CNTL-POOL-HOME-AWAY FLAG.
      *
                 IF (WS-SAVE-ALT-EN-AWAY-FND AND BLE-CRAFT)
                 OR (WS-SAVE-ALT-TR-AWAY-FND AND UTU-CRAFT)
                    IF BLE-CRAFT
                       IF WS-SAVE-ALT-EN-AWAY-YES
                          MOVE 'A'            TO P925-TERM
                       ELSE
                          MOVE 'H'            TO P925-TERM
                       END-IF
                    ELSE
                       IF WS-SAVE-ALT-TR-AWAY-YES
                          MOVE 'A'            TO P925-TERM
                       ELSE
                          MOVE 'H'            TO P925-TERM
                       END-IF
                    END-IF
                 ELSE
                    MOVE SPACES               TO WORK-CNTLKEY
                    IF BLE-CRAFT
                       MOVE TRCN-EN-FROM-DIST TO WK-CNTL-DIST
                       MOVE TRCN-EN-FROM-SDIST TO WK-CNTL-SUB-DIST
                       MOVE TRCN-EN-FROM-POOL TO WK-CNTL-POOL
                       MOVE TRCN-EN-FROM-TERM TO CREW-FROM-TERM
                    ELSE
                       MOVE TRCN-TR-FROM-DIST TO WK-CNTL-DIST
                       MOVE TRCN-TR-FROM-SDIST TO WK-CNTL-SUB-DIST
                       MOVE TRCN-TR-FROM-POOL TO WK-CNTL-POOL
                       MOVE TRCN-TR-FROM-TERM TO CREW-FROM-TERM
                    END-IF
      *
      *             IF CREWING FROM A 'HOME' TERMINAL, READ THE '3A'
      *             CONTROL REC TO GET THE HOME/AWAY FLAG.  OTHERWISE,
      *             READ THE '03' CONTROL REC TO GET THE POOL'S HOME
      *             TERMINAL.
      *
                    IF CREW-FROM-TERM = '0'
                       MOVE '3A'              TO WK-CNTL-REC-TYPE
                    ELSE
                       MOVE '03'              TO WK-CNTL-REC-TYPE
                    END-IF
                    MOVE 'F'                  TO WK-CNTL-POOL-TYPE
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P2950-1'         TO ERR-PARAGRAPH
                       MOVE WORK-CNTLKEY      TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    IF CREW-FROM-TERM = '0'
                       IF CNTL-POOL-IS-AWAY
                          MOVE 'A'            TO P925-TERM
                       ELSE
                          MOVE 'H'            TO P925-TERM
                       END-IF
                    ELSE
                       IF CNTL-POOL-HOME-STATION = TRCN-ORIGIN-STN
                          MOVE 'H'            TO P925-TERM
                       ELSE
                          MOVE 'A'            TO P925-TERM
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 MOVE 'A'                     TO P925-TERM
              END-IF
           END-IF

           EXEC CICS LINK
                     PROGRAM(P925-PGM)
                     COMMAREA(P925-COMMAREA-PARMS)
                     LENGTH(P925-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2950-2'                  TO ERR-PARAGRAPH
              MOVE 'P925LINK'                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF

      *    CONVERT THE ON DUTY TIME BACK TO THE PSTCA ZONE
      *    MOVE THE ORDER DATE/TIME BACK TO THE P925 COMM AREA

      *    IF DIST OF WS-MSTR NOT > SPACES
              MOVE EMP-NBR IN WS-MSTR     TO MSTRNBRK
              PERFORM P8505-READ-MASTER-ONLY
      *    END-IF

           MOVE SPACES                    TO WORK-CNTLKEY
           MOVE '02'                      TO WK-CNTL-REC-TYPE
           MOVE DIST OF WS-MSTR           TO WK-CNTL-DIST
           MOVE SUB-DIST OF WS-MSTR       TO WK-CNTL-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P2950-3'              TO ERR-PARAGRAPH
              MOVE WORK-CNTLKEY           TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE CNTL-TIME-ZONE            TO WS-EMPLOYEE-ZONE
      *CNC0598-B
           MOVE CNTL-CAN-WRR-FLAG         TO WS-CAN-WRR-FLAG
      *CNLD-265-B
           MOVE CNTL-US-DOM               TO WS-US-DOM-FL
      *CNLD-265-E
      *CNC0598-E

           MOVE SPACES                    TO TZ-PARAMETERS
           MOVE WS-EMPLOYEE-ZONE          TO TZ-IN-ZONE
           MOVE PSTCA-TIME-ZONE           TO TZ-OUT-ZONE
           MOVE P925-OD-DATE-TIME         TO TZ-IN-DATE-TIME
           PERFORM P8996-TIMEZONE
           IF TZ-INVALID-PARAMETERS
              MOVE 'P2950-4' TO ERR-PARAGRAPH
              PERFORM P8996-TZERROR
           END-IF
           MOVE TZ-OUT-DATE-TIME          TO P925-OD-DATE-TIME
           MOVE SCR08-ORDER-DATE          TO P925-ORDER-DATE
           MOVE SCR08-ORDER-TIME          TO P925-ORDER-TIME
      *
      *C783 NOW CONVERT THE EMPLOYEE'S MTOD, US REST, & PERS REST TO
      *     THE PROFILE'S TIMEZONE, SO WE DON'T MESS UP THE REST EDITS
      *     LATER ON...
      *
           IF EMP-MTOD > '0000000000'
              MOVE EMP-MTOD               TO TZ-IN-DATE-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE 'P2950-A'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME       TO EMP-MTOD
           END-IF

           IF EMP-US-RSTD > '0000000000'
              MOVE EMP-US-RSTD            TO TZ-IN-DATE-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE 'P2950-B'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME       TO EMP-US-RSTD
           END-IF

           IF EMP-PERS-REST > '0000000000'
              MOVE EMP-PERS-REST          TO TZ-IN-DATE-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE 'P2950-C'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME       TO EMP-PERS-REST
           END-IF

           MOVE SPACE                  TO P925-FUNCTION-10
           SET P925-CALC-REST-STATUS   TO TRUE
      *
      *    CNC0413 - IF WE'RE RECALCULATING A TRACKED EMPLOYEE'S REST
      *    STATUS, WE WANT TO PASS THE WORKING EMPLOYEES SHORT LEAD
      *    TIME, IF ANY, TO CNP925, AND INCLUDE ANY VIRTUAL TOD RECS
      *    IN THE CALCULATION, AS WELL.
      *
           IF CALC-TRK-HOS
              IF HOLD-LEAD-TIME            > SPACES
                 AND HOLD-LEAD-TIME NUMERIC
                 MOVE HOLD-LEAD-TIME      TO P925-LEAD-TIME
              END-IF
              SET P925-INCLUDE-VIRTUALS   TO TRUE
           END-IF

           IF P08CA-ASGN-CC(FUNC-SUB) > SPACES
              MOVE P08CA-ASGN-CC(FUNC-SUB)
                                       TO WS-CRAFT-CODE-CHECK
           ELSE
              MOVE POOL-CRAFT-CODE     TO WS-CRAFT-CODE-CHECK
           END-IF
           IF ENGINE-CRAFT
              IF TRCN-EN-REST-REQ = ('C' OR 'B')
                 CONTINUE
              ELSE
                 SET P925-EMP-STATUS-NA
                                       TO TRUE
              END-IF
           ELSE
              IF TRCN-TR-REST-REQ = ('C' OR 'B')
                 CONTINUE
              ELSE
                 SET P925-EMP-STATUS-NA
                                       TO TRUE
              END-IF
           END-IF

           IF P925-EMP-STATUS-NA
              MOVE 'N/A'               TO P925-REST-STATUS-TTA
                                          P925-REST-STATUS-TTW
                                          P925-REST-STATUS-TTR
                                          P925-REST-STATUS-ERT
                                          P925-REST-STATUS-TWT
           ELSE
              MOVE TRCN-ORIGIN-STN     TO P925-STATION
              MOVE TRCN-FNL-STN        TO P925-FINAL-STATION
              IF TRCN-2ND-ROUTE-DESIGNATION > SPACES
                 AND TRCN-2ND-ROUTE-DESIGNATION
                                    NOT = TRCN-ROUTE-DESIGNATION
                 AND TRCN-LOCAL-REC
                 PERFORM P3037-CHECK-SCHED
                 IF SCHED-2ND
                    MOVE TRCN-2ND-ROUTE-DESIGNATION TO P925-ROUTE-DESGN
                 ELSE
                    MOVE TRCN-ROUTE-DESIGNATION     TO P925-ROUTE-DESGN
                 END-IF
              ELSE
                 MOVE TRCN-ROUTE-DESIGNATION        TO P925-ROUTE-DESGN
              END-IF
              IF YARD-CALL
                 PERFORM P2951-CALC-ERT
                 MOVE WS-HR-MN             TO P925-AJ-ERT
              END-IF

      ***     IF P925-EMP-NO = P923-EMP-NO
      ***        AND P923-DEC-KEY > SPACES
              IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
                 OR P08CA-USER-OVERRIDE(FUNC-SUB)
                 SET P925-VACANCY-FILLED     TO TRUE
      *07/26/23 RJA B CNC0600 CNLD-269
                 MOVE SPACES TO P925-PROMOTING-EMP-FLAG
                 IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
                    MOVE P08CA-DEC-KEY(FUNC-SUB) TO DECKEY
                    MOVE SPACES TO DEC-REQ-1
                                   DEC-REQ-2
                    PERFORM P8630-READ-DECISION
                    IF ON-TURN OF WORK-DEC-TABLE
                    OR ON-JOB  OF WORK-DEC-TABLE
                       SET P925-PROMOTING-EMP TO TRUE
                    END-IF
                 END-IF
      *07/26/23 RJA E
              END-IF

      *** 331E
              MOVE P08CA-ASGN-ID(FUNC-SUB)   TO P925-ASGN

      *CNC0544-BEG
              IF TRCN-CHECK-TOPC-STA-FLAG        = 'Y'
                 IF ENGINE-CRAFT
      *C1207 - BEG
      ***        AND WS-SAVE-ALT-EST-RUN-TM       > '0000'
                 AND (EN-FROM-ALT-SOURCE OR BOTH-FROM-ALT-SOURCE)
                    SET P925-ALT-CREW-SRC-USED  TO TRUE
                    IF WS-SAVE-ALT-EST-RUN-TM     > '0000'
                       MOVE WS-SAVE-ALT-EST-RUN-TM TO
                                                P925-ALT-CREW-EST-RUN-TM
                    END-IF
                    IF P925-LEAD-TIME NOT > SPACES
                       IF P08CA-EN-LEAD-TIME > '0000'
                          MOVE P08CA-EN-LEAD-TIME TO P925-LEAD-TIME
                       END-IF
                    END-IF
      *C1207 - END
                 ELSE
                    IF TRAIN-CRAFT
      *C1207 - BEG
      ***           AND WS-SAVE-ALT-EST-RUN-TM    > '0000'
      *C1207 - END
                    AND (TR-FROM-ALT-SOURCE OR BOTH-FROM-ALT-SOURCE)
                       SET P925-ALT-CREW-SRC-USED  TO TRUE
                       IF WS-SAVE-ALT-EST-RUN-TM  > '0000'
                          MOVE WS-SAVE-ALT-EST-RUN-TM TO
                                                P925-ALT-CREW-EST-RUN-TM
                       END-IF
                       IF P925-LEAD-TIME NOT > SPACES
                          IF P08CA-TR-LEAD-TIME > '0000'
                             MOVE P08CA-TR-LEAD-TIME TO P925-LEAD-TIME
                          END-IF
                       END-IF
                    ELSE
                       MOVE SPACES           TO P925-ALT-CREW-SOURCE-FL
                                                P925-ALT-CREW-EST-RUN-TM
                    END-IF
                 END-IF
              END-IF
      *CNC0544-END
              EXEC CICS LINK
                        PROGRAM(P925-PGM)
                        COMMAREA(P925-COMMAREA-PARMS)
                        LENGTH(P925-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE         TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2950-5'        TO ERR-PARAGRAPH
                 MOVE 'P925LINK'       TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
      *CNC0600-B
              IF P925-EMP-STATUS-RED
                 MOVE P925-OVERRIDE-ALLOW-FLAG
                                       TO P08CA-HOSO-ALLOW-FL(FUNC-SUB)
      *CNLD-230-B
                 MOVE P925-REASON-FOR-RED
                                       TO WS-REASON-FOR-RED
      *CNLD-230-E
                 IF P08CA-HOSO-DONE(FUNC-SUB)
                    SET P925-EMP-STATUS-YELLOW
                                       TO TRUE
                 END-IF
      *CNC0600 - RJA - B
              END-IF
              MOVE SPACES              TO WS-SAVE-REST-STATUS
              IF P925-LOCAL-TM-REST-COND > SPACE
                 EVALUATE TRUE
                 WHEN P925-MTOD-GT-LOCAL
      *CNLD-330-B
                    MOVE SPACES        TO WS-EMP-UNDST-REST-FLAG
                    MOVE ZEROS         TO WS-SAVE-UD-DTTM
      *CNLD-330-E
                    PERFORM P3200-CHECK-EMP-UNDST-REST
                    IF WS-EMP-UNDST-REST

      *    NOTE:       WS-UD-MESG IS DISPLAYED AND CALL IS PROHIBITED WHEN
      *                MTOD > LOCAL-TIME OR
      *                SYSTEM-UD1-TO >= LOCAL-TIME OR
      *                SYSTEM-UD2-TO >= LOCAL-TIME
      *
                       MOVE WS-UD-MESG TO SCR08-PHONE(FUNC-SUB)
                       MOVE YELLOW     TO SCR08-PHONE-COL(FUNC-SUB)
                       MOVE P925-REST-STATUS-FLAG
                                       TO WS-SAVE-REST-STATUS
                       SET P925-EMP-STATUS-RED
                                       TO TRUE
                       SET P925-OVERRIDE-DENY
                                       TO TRUE
                       MOVE P925-OVERRIDE-ALLOW-FLAG
                                       TO P08CA-HOSO-ALLOW-FL(FUNC-SUB)
                    END-IF

      *CNLD-207-DXC-B
      *CNLD-259 B CNC0600
      *          WHEN P925-LOCAL-LT-RESET
                 WHEN P925-LOCAL-LE-UDR2
      *CNLD-259 E CNC0600
                    MOVE P925-RB-MSG-1-HRMN(1:2)
                                       TO WS-RB-1-HH
                    MOVE P925-RB-MSG-1-HRMN(3:2)
                                       TO WS-RB-1-MM
                    MOVE WS-RB-1-MESG  TO SCR08-PHONE(FUNC-SUB)
                    MOVE YELLOW        TO SCR08-PHONE-COL(FUNC-SUB)
                    MOVE P925-REST-STATUS-FLAG
                                       TO WS-SAVE-REST-STATUS
                    SET P925-EMP-STATUS-RED
                                       TO TRUE
                    SET P925-OVERRIDE-DENY
                                       TO TRUE
                    MOVE P925-OVERRIDE-ALLOW-FLAG
                                       TO P08CA-HOSO-ALLOW-FL(FUNC-SUB)

      *CNLD-244-B #3 CNC0600
      *          WHEN P925-ORDR-LT-RESET
                 WHEN P925-RESET-IN-LT-1HR
      *CNLD-244-E
                       MOVE P925-RB-MSG-2-MN
                                       TO WS-RB-2-MM
                                          WS-RB-2-MM-1
                       MOVE WS-RB-2-MESG
                                       TO SCR08-PHONE(FUNC-SUB)
                       MOVE YELLOW     TO SCR08-PHONE-COL(FUNC-SUB)
                 END-EVALUATE
      *CNLD-207-DXC-E
      *
      *CNC0600 - RJA - E
              END-IF
      *CNC0600-E
      *C1193 - BEG
      *** PER KEVIN,
      *** "REMOVE THE CODE THAT CAUSES THE SYSTEM TO FLAG SOMEONE WHO IS
      ***  CLOSE TO THE 64/7 CAP AS YELLOW. THIS IS CODE THAT WAS ADDED
      ***  WITH THE INITIAL ENHANCEMENT, BUT IS NOT REQUIRED ANY MORE."
      ***     IF NOT P925-EMP-STATUS-RED
      ***        PERFORM P2952-EXPECTED-ASGN-LENGTH
      ***     END-IF
      *C1193 - END

      *CNLD-330-B
      *    END-IF.
           END-IF

           IF (ENGINE-CRAFT
               AND TRCN-EN-REST-REQ = ('U' OR 'B'))
              OR (TRAIN-CRAFT
                  AND TRCN-TR-REST-REQ = ('U' OR 'B'))

              IF (ENGINE-CRAFT
                  AND TRCN-EN-REST-REQ = 'U')
                 OR (TRAIN-CRAFT
                     AND TRCN-TR-REST-REQ = 'U')
                 MOVE ZEROS  TO WS-SAVE-UD-DTTM
              END-IF

      *       MOVE SPACES TO WS-REST-US-STATUS-FLAG
              PERFORM P3300-CHECK-US-UNDIST-REST

           END-IF
           .
      *CNLD-330-E
      *================================================================*
       P2951-CALC-ERT.
      *================================================================*
           MOVE P08CA-JSKEY1(FUNC-SUB)     TO JSKEY1
           EXEC CICS READ
                     DATASET(JS-VIA-JSKEY1)
                     INTO(WS-JOB-SCHEDULE)
                     LENGTH(JSKEY1-RLGTH)
                     RIDFLD(JSKEY1)
                     KEYLENGTH(JSKEY1-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2951-1'               TO ERR-PARAGRAPH
              MOVE JSKEY1                  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE JSK1-ASGN-START-TIME       TO WS-HR-MN
           MULTIPLY WS-HR BY 60        GIVING WS-MIN1
           ADD WS-MN                       TO WS-MIN1
           MOVE JOB-SCHED-END-TIME         TO WS-HR-MN
           MULTIPLY WS-HR BY 60        GIVING WS-MIN2
           ADD WS-MN                       TO WS-MIN2
           IF WS-MIN2 < WS-MIN1
              ADD 1440                     TO WS-MIN2
           END-IF
           SUBTRACT WS-MIN1              FROM WS-MIN2
           DIVIDE WS-MIN2 BY 60        GIVING WS-HR
                                    REMAINDER WS-MN.
      *================================================================*
       P2952-EXPECTED-ASGN-LENGTH.
      *================================================================*
           MOVE P925-REST-STATUS-TWT     TO WORK-TIME
           MOVE WORK-HR                  TO WS-TOTAL-HOURS
           MOVE WORK-MN                  TO WS-TOTAL-MINUTES
           IF LOCAL-CALL
              IF WS-LOCAL-ERT-SAVED
                 MOVE WS-SAVE-LOCAL-ERT-HR-MN TO WORK-TIME
              ELSE
                 PERFORM P2951-CALC-ERT
                 MOVE WS-HR-MN           TO WORK-TIME
              END-IF
           ELSE
              IF YARD-CALL
                 MOVE P925-AJ-ERT        TO WORK-TIME
              ELSE
      *CNC0544-BEG
      *          WHEN THE CREW SOURCE IS DETERMINED VIA THE ALT CREW
      *          SOURCE, IF POPULATED, EST RUN TIME ON ALT CREW SRC WILL
      *          BE USED. ELSE TAKE IT FROM RUN MILE TABLE.
      *
                 IF TRCN-CHECK-TOPC-STA-FLAG        = 'Y'
                    IF ENGINE-CRAFT
                    AND WS-SAVE-ALT-EST-RUN-TM    > '0000'
                    AND (EN-FROM-ALT-SOURCE OR BOTH-FROM-ALT-SOURCE)
                       MOVE WS-SAVE-ALT-EST-RUN-TM TO WORK-TIME
                    ELSE
                       IF TRAIN-CRAFT
                       AND WS-SAVE-ALT-EST-RUN-TM > '0000'
                       AND (EN-FROM-ALT-SOURCE OR BOTH-FROM-ALT-SOURCE)
                          MOVE WS-SAVE-ALT-EST-RUN-TM TO WORK-TIME
                       ELSE
                          PERFORM P2953-GET-RUN-MILES-TIME
                       END-IF
                    END-IF
                 ELSE
                    PERFORM P2953-GET-RUN-MILES-TIME
                 END-IF
      *CNC0544-END
              END-IF
           END-IF
           ADD WORK-HR                   TO WS-TOTAL-HOURS
           ADD WORK-MN                   TO WS-TOTAL-MINUTES
           PERFORM P2954-CALCULATE-64-TIME
      *** 331E - YELLOW IF > 6400, NOT >= 6400
           IF WS-64-TOT-TIME-ON-DUTY >  6400
              SET P925-EMP-STATUS-YELLOW      TO TRUE
           END-IF.
      *================================================================*
       P2953-GET-RUN-MILES-TIME.
      *================================================================*
      *   IF A VALID RECORD CANNOT BE FOUND, THE RUN MILES ESTIMATED
      *   TIME WILL DEFAULT TO 8 HOURS.
      *-----------------------------------------------------------------
           MOVE SPACES                   TO TKCRKEY-AREA
           SET  RUN-MILES-REC            TO TRUE
           MOVE TRCN-ORIGIN-STN          TO TKCR-FROM-LOCATION
           MOVE TRCN-FNL-STN             TO TKCR-TO-LOCATION
           MOVE TRCN-ROUTE-DESIGNATION   TO TKCR-ROUTE-DESIGNATION
           IF SCR08-OD-DATE(FUNC-SUB) > SPACES
              MOVE SCR08-OD-DATE(FUNC-SUB)
                                         TO TKCR-EXP-DATE
           ELSE
              MOVE SCR08-ORDER-DATE      TO TKCR-EXP-DATE
           END-IF
           SET DE-REFORMAT-ONLY          TO TRUE
           SET DE-YYMMDD-FORMAT          TO TRUE
           MOVE TKCR-EXP-DATE            TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD              TO TKCR-EXP-DATE-CENT
           MOVE TKCRKEY-AREA             TO TKCRKEY
           EXEC CICS READ
                     GTEQ
                     DATASET(TKCR-FILE-VIA-TKCRKEY)
                     INTO(WS-TKCR-FILE)
                     LENGTH(TKCRFILE-RLGTH)
                     RIDFLD(TKCRKEY)
                     KEYLENGTH(TKCRFILE-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF  SUCCESS
           AND RUN-MILES-REC
           AND TRCN-ORIGIN-STN        = TKCR-FROM-LOCATION
           AND TRCN-FNL-STN           = TKCR-TO-LOCATION
           AND TRCN-ROUTE-DESIGNATION = TKCR-ROUTE-DESIGNATION
              MOVE TKCR-36-EST-RUN-TIME  TO WORK-TIME
           ELSE
              MOVE 0800                  TO WORK-TIME
           END-IF.
      *================================================================*
       P2954-CALCULATE-64-TIME.
      *================================================================*
           SET TIME-NOT-DONE             TO TRUE
           PERFORM UNTIL TIME-DONE
              IF WS-TOTAL-MINUTES > 59
                 SUBTRACT 60           FROM WS-TOTAL-MINUTES
                 ADD 1                   TO WS-TOTAL-HOURS
              ELSE
                SET TIME-DONE            TO TRUE
              END-IF
           END-PERFORM
           MOVE WS-TOTAL-HOURS           TO WS-64-TOT-HRS-ON-DUTY
           MOVE WS-TOTAL-MINUTES         TO WS-64-TOT-MNS-ON-DUTY.
      *================================================================*
       P2960-REJECT-HRS-SVC.
      *================================================================*
      *
           IF P08CA-ASGN-KEY(FUNC-SUB)    NOT > SPACES AND
              P08CA-ASGN-KEY-XB(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *              'IMPROPER FUNCTION - USE "FILL" TO CREATE '
      *              'TEMPORARY ASSIGNMENT'
              MOVE 'I051' TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF UFP-CALL
              MOVE P08CA-ASGN-KEY(FUNC-SUB)    TO UFPTURN
              PERFORM P8600-READ-UFPTURN
              IF NOT SUCCESS
                 MOVE 'P2960-1'    TO ERR-PARAGRAPH
                 MOVE UFPTURN      TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
      *
      *    MAKE SURE CREW CALLER ISN'T TRYING TO REJECT
      *    SOMEONE THEY JUST "HELPED" ON THE JOB.
      *
           IF P08CA-ASGN-IS-DSPLY-ONLY(FUNC-SUB)
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *              'IMPROPER FUNCTION - EMPLOYEE CANNOT BE REJECTED'
      *              'WHEN HELPED ON THE JOB'
              MOVE 'I047' TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           IF P08CA-EMP-NO(FUNC-SUB) NOT > SPACES
              MOVE -1                     TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO              TO SCR08-FUNC-HI(FUNC-SUB)
      *            'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
              MOVE 'I050'                 TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           MOVE P08CA-EMP-NO(FUNC-SUB)   TO EMP-NBR IN WS-MSTR
                                            MSTRNBRK
           PERFORM P8500-READ-MASTER
           PERFORM P2950-GET-HRS-SVC-INFO
           IF NOT P925-EMP-STATUS-YELLOW
      *            EMPLOYEE STATUS NOT YELLOW - RJHS NOT ALLOWED
              MOVE 'E238'        TO MSGLOG-CODE
              MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO     TO SCR08-FUNC-HI(FUNC-SUB)
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           MOVE SPACES           TO P923-COMMAREA-PARMS
           IF P08CA-RJHS-EMPNO(FUNC-SUB) NOT > SPACES
              IF UFP-CALL
                 AND (OUT-OF-TOWN
                  OR DIST IN WS-UFP NOT = DIST2
                  OR SUB-DIST IN WS-UFP NOT = SUB-DIST2
                  OR POOL-NAME IN WS-UFP NOT = POOL-NAME2)
                  PERFORM P2961-WRITE-RJHS-HISTORY
                  IF WS-ASSOCIATED-CRAFT-ARRAY NOT > SPACES
                     MOVE 'REJT'   TO WS-FUNCTION-CODE
                     PERFORM P2400-PROCESS-DROP-REJT
                  ELSE
                     PERFORM P1060-CLEAR-EMP-LINE
                     PERFORM P1050-SETUP-NAME-LINEB
                     IF UFP-BLANK-TURN
                        MOVE WS-DISCONT-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                     ELSE
                        MOVE WS-VACANCY-MSG(PSTCA-SUB)
                                              TO SCR08-NAME(FUNC-SUB)
                     END-IF
                     MOVE SPACES           TO P08CA-EMP-NO(FUNC-SUB)
                                              SCR08-FUNC(FUNC-SUB)
                  END-IF
              ELSE
                 MOVE SPACES          TO WORK-CNTLKEY
                 MOVE '01'            TO WK-CNTL-REC-TYPE
                 MOVE DIST IN WS-MSTR TO WK-CNTL-DIST
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P2960-2'    TO ERR-PARAGRAPH
                    MOVE WORK-CNTLKEY TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 IF YARD-CALL
                    IF RUN-BY-PAY-YD-APPLICABLE
                       MOVE P08CA-EMP-NO(FUNC-SUB)
                                 TO P08CA-RJHS-EMPNO(FUNC-SUB)
                    END-IF
                 ELSE
                    IF RUN-BY-PAY-RD-APPLICABLE
                       MOVE P08CA-EMP-NO(FUNC-SUB)
                                 TO P08CA-RJHS-EMPNO(FUNC-SUB)
                    END-IF
                 END-IF
                 IF UFP-CALL
                    MOVE SPACES              TO WORK-CNTLKEY
                    MOVE '03'                TO WK-CNTL-REC-TYPE
                    MOVE DIST IN WS-UFP      TO WK-CNTL-DIST
                    MOVE SUB-DIST IN WS-UFP  TO WK-CNTL-SUB-DIST
                    MOVE POOL-NAME IN WS-UFP TO WK-CNTL-POOL
                    MOVE 'F'                 TO WK-CNTL-POOL-TYPE
                    PERFORM P8610-READ-CNTLFILE
                    IF NOT SUCCESS
                       MOVE 'P2960-3' TO ERR-PARAGRAPH
                       MOVE WORK-CNTLKEY TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 END-IF
                 IF UFP-CALL
                    AND CNTL-POOL-ASGN-POOL NOT = 'Y'
                    AND P08CA-EMP-NO(FUNC-SUB)
                        = P08CA-REG-EMP-NO(FUNC-SUB)
                    AND WS-ASSOCIATED-CRAFT-ARRAY NOT > SPACES
                    PERFORM P2961-WRITE-RJHS-HISTORY
                    MOVE 'REJT'     TO WS-FUNCTION-CODE
                    PERFORM P2400-PROCESS-DROP-REJT
                 ELSE
                    IF P08CA-DEC-KEY(FUNC-SUB) NOT > SPACES
                       PERFORM P2961-WRITE-RJHS-HISTORY
                       SET FILL-VACANCY
                                    TO TRUE
                       MOVE WS-FUNCTION-CODE
                                    TO SCR08-FUNC(FUNC-SUB)
                    ELSE
                       IF P08CA-EMP-NO(FUNC-SUB)
                          = P08CA-RJHS-EMPNO(FUNC-SUB)
                          MOVE 'Y'  TO P923-RJHS-PAY-FLAG
                       ELSE
                          MOVE 'N'  TO P923-RJHS-PAY-FLAG
                       END-IF
                    END-IF
                    PERFORM P2200-PROCESS-FILL-FUNCTION
                 END-IF
              END-IF
           ELSE
              IF UFP-CALL
                 MOVE SPACES                 TO WORK-CNTLKEY
                 MOVE '03'                   TO WK-CNTL-REC-TYPE
                 MOVE DIST IN WS-UFP         TO WK-CNTL-DIST
                 MOVE SUB-DIST IN WS-UFP     TO WK-CNTL-SUB-DIST
                 MOVE POOL-NAME IN WS-UFP    TO WK-CNTL-POOL
                 MOVE 'F'                    TO WK-CNTL-POOL-TYPE
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P2960-4'    TO ERR-PARAGRAPH
                    MOVE WORK-CNTLKEY TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              IF UFP-CALL
                 AND CNTL-POOL-ASGN-POOL NOT = 'Y'
                 AND P08CA-EMP-NO(FUNC-SUB) = P08CA-REG-EMP-NO(FUNC-SUB)
                 AND WS-ASSOCIATED-CRAFT-ARRAY NOT > SPACES
                 PERFORM P2961-WRITE-RJHS-HISTORY
                 MOVE 'REJT'     TO WS-FUNCTION-CODE
                 PERFORM P2400-PROCESS-DROP-REJT
              ELSE
                 MOVE 'N'        TO P923-RJHS-PAY-FLAG
                 PERFORM P2200-PROCESS-FILL-FUNCTION
              END-IF
           END-IF.
      *
      *================================================================*
       P2961-WRITE-RJHS-HISTORY.
      *================================================================*
           MOVE SPACES                      TO P943-COMMAREA-PARMS
           MOVE P08CA-EMP-NO(FUNC-SUB)      TO P943-EMP-NBR
           MOVE PSTCA-TIME-ZONE             TO P943-EMP-TIME-ZONE
           SET P943-REJECT-EMPLOYEE-FUN     TO TRUE
           IF UFP-CALL
              MOVE DIST IN WS-UFP           TO P943-DIST
              MOVE SUB-DIST IN WS-UFP       TO P943-SDIST
              MOVE POOL-NAME IN WS-UFP      TO P943-POOL-ASG
              MOVE IN-OUT-TERMINAL          TO P943-IN-OUT
           ELSE
              MOVE DIST IN WS-MSTR          TO P943-DIST
              MOVE SUB-DIST IN WS-MSTR      TO P943-SDIST
              IF YARD-CALL
                 MOVE JOB-DEF-YARD-POOL     TO P943-POOL-ASG
              ELSE
                 MOVE JOB-DEF-LOCAL-POOL    TO P943-POOL-ASG
              END-IF
              MOVE '0'                      TO P943-IN-OUT
           END-IF
           MOVE CRAFT IN WS-MSTR            TO P943-CRAFT
           IF TEMPORARY-ASGNMT > SPACE
              MOVE TEMPORARY-ASGNMT         TO P943-NORM-ASGN
           ELSE
              MOVE NORMAL-ASGNMT            TO P943-NORM-ASGN
           END-IF
           MOVE LAYOFF-CODE                 TO P943-LO
           STRING SCR08-ASGN
                  SCR08-ASGN-TYPE
                  DELIMITED BY SIZE
                  INTO P943-TEMP-ASGN-TRAIN
           MOVE SCR08-CC(FUNC-SUB)          TO P943-TEMP-ASGN-CC
           MOVE WS-FUNCTION-CODE            TO P943-FUN16-TYPE
           MOVE WS-CALL-DATE-TIME           TO P943-FUN16-CALL-DATE-TIME
                                               P943-EFF-DATE-TIME
      *    MOVE WS-LOCAL-DATE-TIME          TO P943-EFF-DATE-TIME
           IF P08CA-EMP-NO(FUNC-SUB) = P08CA-RJHS-EMPNO(FUNC-SUB)
              MOVE 'Y'                      TO P943-FUN16-RJHS-PAY-FLAG
           ELSE
              MOVE 'N'                      TO P943-FUN16-RJHS-PAY-FLAG
           END-IF
           PERFORM P8900-WRITE-HISTORY.
      *================================================================*
       P2970-DISPLAY-HRS-SVC-INFO.
      *================================================================*
      *
           IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
              MOVE 'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
                 TO SCR08-ERRORMSG
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           IF P08CA-EMP-NO(FUNC-SUB) NOT > SPACES
              IF P08CA-REG-EMP-NO(FUNC-SUB) NOT > SPACES
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *               'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                 MOVE 'I050'     TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF


           IF P08CA-EMP-NO(FUNC-SUB) > SPACES
              MOVE P08CA-EMP-NO(FUNC-SUB)        TO MSTRNBRK
           ELSE
              MOVE P08CA-REG-EMP-NO(FUNC-SUB)    TO MSTRNBRK
           END-IF
           PERFORM P8500-READ-MASTER
           PERFORM P2950-GET-HRS-SVC-INFO

           IF P925-EMP-STATUS-NA
      *            'HOURS OF SERVICE NOT APPLICABLE'
              MOVE 'H032'                 TO MSGLOG-CODE
           ELSE
              MOVE SPACES              TO MSGLOG-CODE
              IF SCR08-PERS(FUNC-SUB) > SPACES
                 MOVE EMP-PERS-REST-TIME      TO WS-PERS-REST-TIME
                 MOVE EMP-PERS-REST-DATE(5:2) TO WS-PERS-REST-DAY
              ELSE
                 MOVE ZEROS                   TO WS-PERS-REST-TIME
                                                 WS-PERS-REST-DAY
              END-IF
      *CNC0598-B
      *CNLD-309 B   COMMENTING
      *       IF WS-CAN-WRR-NEW
      *CNLD-309 E
                 STRING 'STATUS=' P925-REST-STATUS-FLAG ' '
                        'TTA=' P925-REST-STATUS-TTA ' '
                        'ERT=' P925-REST-STATUS-ERT ' '
                        'TTW=' P925-REST-STATUS-TTW ' '
                        'TWT=' P925-REST-STATUS-TWT ' '
                        'PR='  WS-PERS-REST
                        DELIMITED BY SIZE
                        INTO SCR08-ERRORMSG
      *CNLD-309 B   COMMENTING
      *       ELSE
      *CNLD-309 E
      *CNC0598-E

      *CNLD-309 B   COMMENTING
      *          IF P925-TIE-UP-YARD
      *             STRING 'YD MTOY=(' EMP-MTOY ') '
      *                 'STATUS=' P925-REST-STATUS-FLAG ' '
      *                 'TTA=' P925-REST-STATUS-TTA ' '
      *                 'ERT=' P925-REST-STATUS-ERT ' '
      *                 'TTW=' P925-REST-STATUS-TTW ' '
      *                 'TWT=' P925-REST-STATUS-TWT ' '
      *                 'PR='  WS-PERS-REST
      *                 DELIMITED BY SIZE
      *                 INTO SCR08-ERRORMSG
      *          ELSE
      *             STRING 'RD MTOR=(' EMP-MTOR ') '
      *                 'STATUS=' P925-REST-STATUS-FLAG ' '
      *                 'TTA=' P925-REST-STATUS-TTA ' '
      *                 'ERT=' P925-REST-STATUS-ERT ' '
      *                 'TTW=' P925-REST-STATUS-TTW ' '
      *                 'TWT=' P925-REST-STATUS-TWT ' '
      *                 'PR='  WS-PERS-REST
      *                 DELIMITED BY SIZE
      *                 INTO SCR08-ERRORMSG
      *          END-IF
      **CNC0598-B
      *       END-IF
      **CNC0598-E
      *CNLD-309 E
           END-IF
           MOVE -1                     TO SCR08-FUNC-CURSOR(FUNC-SUB)
           PERFORM P9000-SEND-MAP-AND-RETURN.
      ******************************************************************
       P2980-CREATE-CALLBACK-TASK.
      ******************************************************************
           MOVE FUNC-SUB                      TO J
           IF P08CA-EMP-NO(J) NOT > '000000000'
      *            'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
              MOVE 'I050'                     TO MSGLOG-CODE
              MOVE -1                         TO SCR08-FUNC-CURSOR(J)
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *
      *    MAKE SURE NO CALLBACK ALREADY EXISTS FOR THE EMPLOYEE
      *
           MOVE SPACES                        TO WS-TASK
           MOVE P08CA-EMP-NO(J)               TO EMP-NBR OF WS-TASK
           SET TASK-CALL-BACK                 TO TRUE
           MOVE TASK-EMPLOYEE-KEY             TO TASKEMPK
           EXEC CICS READ
                     DATASET(TASK-VIA-EMP-NBR)
                     INTO(WS-TASK)
                     LENGTH(TASKENBR-RLGTH)
                     RIDFLD(TASKEMPK)
                     KEYLENGTH(TASKENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              IF NOT NO-RECORD-FND
                 MOVE 'P2980-1'               TO ERR-PARAGRAPH
                 MOVE TASKEMPK                TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
      *            'A CALLBACK TASK ALREADY EXISTS FOR THIS EMPLOYEE'
              MOVE 'A149'                     TO MSGLOG-CODE
              MOVE -1                         TO SCR08-FUNC-CURSOR(J)
              MOVE REV-VIDEO                  TO SCR08-FUNC-HI(J)
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
           MOVE SPACES                        TO WS-MSTR
           MOVE P08CA-EMP-NO(J)               TO MSTRNBRK
           PERFORM P8505-READ-MASTER-ONLY

           MOVE SPACES                        TO P927-COMMAREA-PARMS
           SET P927-CALLBACK-FUNCTION         TO TRUE
           MOVE SCR08-OD-DATE(J)              TO P927-EFF-DATE
           MOVE SCR08-OD-TIME(J)              TO P927-EFF-TIME
           MOVE PSTCA-TIME-ZONE               TO P927-TIME-ZONE
           MOVE TRCN-DIST                     TO P927-DIST
           MOVE TRCN-SDIST                    TO P927-SUB-DIST
           MOVE P08CA-EMP-NO(J)               TO P927-CB-EMP-NBR
           MOVE TRCN-ORIGIN-STN               TO P927-CB-ORG-STATION
           MOVE SCR08-ASGN                    TO P927-CB-TRAIN-SYM
           MOVE SCR08-ASGN-TYPE               TO P927-CB-TRAIN-CODE
           MOVE SCR08-ORDER-DATE              TO P927-CB-ORDER-DATE
           MOVE SCR08-ORDER-TIME              TO P927-CB-ORDER-TIME
           EXEC CICS LINK
                     PROGRAM(P927-PGM)
                     COMMAREA(P927-COMMAREA-PARMS)
                     LENGTH(P927-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2980-2'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
           MOVE 'CALLBACK LOGGED - PLEASE PUT EMPLOYEE ON DUTY'
                                              TO SCR08-ERRORMSG
           MOVE 'C228'                        TO MSGLOG-CODE
           MOVE -1                            TO SCR08-FUNC-CURSOR(J)
           MOVE REV-VIDEO                     TO SCR08-FUNC-HI(J)
      *
      *    IF THE EMPLOYEE IS NOT RESTED, DISPLAY 'HOUR' IN THE FUNC FLD
      *
           IF P08CA-REST-YELLOW(J)
              MOVE YELLOW                     TO SCR08-NAME-COL(J)
      *CNC0600-CNLD-209 NEED TO KNOW HERE WHY EMP WAS IN YELLOW
              IF NOT WS-CAN-WRR-NEW
                 MOVE 'HOUR'                  TO SCR08-FUNC(J)
              END-IF
           END-IF
           MOVE SPACES                        TO P08CA-REST-STATUS(J)
      *
      *    WRITE WORK HISTORY FOR CALLBACK
      *
           MOVE SPACES                        TO P943-COMMAREA-PARMS
           SET P943-EMPLOYEE-FUNCTION         TO TRUE
           SET P943-CALLBACK-FUN              TO TRUE
           MOVE P08CA-EMP-NO(J)               TO P943-EMP-NBR
           MOVE DIST      OF WS-MSTR          TO P943-DIST
           MOVE SUB-DIST  OF WS-MSTR          TO P943-SDIST
           MOVE CRAFT     OF WS-MSTR          TO P943-CRAFT
           MOVE SCR08-ASGN                    TO P943-NORM-ASGN
           MOVE SCR08-CC(J)                   TO P943-NORM-ASGN-CC
           MOVE P927-EFF-DATE-TIME            TO P943-EFF-DATE-TIME
           MOVE PSTCA-TIME-ZONE               TO P943-EMP-TIME-ZONE

           EXEC CICS ASSIGN
                     USERID(P943-USERID)
           END-EXEC

           EXEC CICS LINK
                     PROGRAM(P943-PGM)
                     COMMAREA(P943-COMMAREA-PARMS)
                     LENGTH(P943-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2980-3'                  TO ERR-PARAGRAPH
              MOVE 'P943'                     TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
      *    IF CREW CALLER INITIATED THE SHORT CALL, STAMP THE SHORT LEAD
      *    TIME IN THE EMPLOYEE'S MSTR3 RECORD.
      *
      * CNC0436B JES
      *  LEAD TIME NOW RESIDES ON WSTELE FILE
      *
           IF ADD-TELE-LEAD
              MOVE SPACES                     TO WS-TELE-FILE
              MOVE P08CA-EMP-NO(J)            TO TELENBRK
                                                 TELE-EMP-NBR
              PERFORM P8530-READ-TELE-UPDATE
              IF SUCCESS
                 MOVE TELE-REQ-LEAD-TIME      TO WS-LEAD-TIME-WAS
                 MOVE WS-NEW-LEAD-TIME        TO TELE-REQ-LEAD-TIME
                                                 WS-LEAD-TIME-IS
                 PERFORM P8540-REWRITE-TELE
              ELSE
                 MOVE SPACES                  TO WS-LEAD-TIME-WAS
                 MOVE WS-NEW-LEAD-TIME        TO TELE-REQ-LEAD-TIME
                                                 WS-LEAD-TIME-IS
                 PERFORM P8550-WRITE-TELE
              END-IF
      *
      *AJK1   WRITE EMPLOYEE HISTORY RECORD
      *
              MOVE SPACES                     TO P943-COMMAREA-PARMS
              SET P943-EMPLOYEE-FUNCTION      TO TRUE
              MOVE PSTCA-TIME-ZONE            TO P943-EMP-TIME-ZONE
              MOVE WS-LOCAL-DATE-TIME         TO P943-EFF-DATE-TIME

              SET P943-MASTER-RC-FUN          TO TRUE
              MOVE 'LEAD TIME'                TO P943-MSTR-RC-FIELD
              MOVE EMP-NBR OF WS-MSTR         TO P943-EMP-NBR
              MOVE WS-SYSTEM-DATE-TIME(1:14)  TO PRESENT-TIME-X
              ADD 1                           TO PRESENT-TOD
              MOVE PRESENT-TIME-X             TO P943-CLOCK-TIME
              MOVE DIST OF WS-MSTR            TO P943-DIST
              MOVE SUB-DIST OF WS-MSTR        TO P943-SDIST
              MOVE CRAFT OF WS-MSTR           TO P943-CRAFT
              MOVE LAYOFF-CODE                TO P943-LO
              EXEC CICS ASSIGN
                        USERID(P943-USERID)
              END-EXEC
              MOVE WS-LEAD-TIME-WAS           TO P943-MSTR-RC-LEAD-WAS
              MOVE WS-LEAD-TIME-IS            TO P943-MSTR-RC-LEAD-IS
              IF WS-LEAD-TIME-WAS > SPACES
                 MOVE 'CHANGE'                TO P943-MSTR-RC-FUNC
              ELSE
                 MOVE 'ADD'                   TO P943-MSTR-RC-FUNC
              END-IF

              EXEC CICS LINK
                        PROGRAM(P943-PGM)
                        COMMAREA(P943-COMMAREA-PARMS)
                        LENGTH(P943-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE                TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P2980-4'               TO ERR-PARAGRAPH
                 MOVE 'P943'                  TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
      *#1526
           PERFORM P1045-DISPLAY-PHONE-INFO
           .
      ******************************************************************
       P2990-CREATE-SETBACK-TASK.
      ******************************************************************
           MOVE FUNC-SUB                      TO J
           IF P08CA-ASGN-KEY(J) NOT > SPACES
      *            'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
              MOVE 'I049'                     TO MSGLOG-CODE
              MOVE -1                         TO SCR08-FUNC-CURSOR(J)
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

      ***  IF P08CA-EMP-NO(J) NOT > '000000000'
      **           'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
      *       MOVE 'I050'                     TO MSGLOG-CODE
      *       MOVE -1                         TO SCR08-FUNC-CURSOR(J)
      *       PERFORM P9000-SEND-MAP-AND-RETURN
      ***  END-IF

      *
      *    MAKE SURE THE SETBACK TIME IS IN THE FUTURE
      *
           SET DE-YYMMDD-FORMAT               TO TRUE
           MOVE SCR08-OD-DATE(J)              TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD                   TO DE-COMPARE1-DATE
           MOVE SCR08-OD-TIME(J)              TO DE-COMPARE1-TIME
           IF DE-COMPARE1-DATE-TIME <= WS-LOCAL-DATE-TIME-CENT
      *            'SETBACK DATE MUST BE IN THE FUTURE'
              MOVE 'S131'                     TO MSGLOG-CODE
              MOVE -1                         TO SCR08-OD-TIME-CURSOR(J)
              MOVE REV-VIDEO                  TO SCR08-OD-DATE-HI(J)
                                                 SCR08-OD-TIME-HI(J)
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *
      *    MAKE SURE THE SETBACK TIME IS LATER THAN THE ORDER TIME
      *
           SET DE-YYMMDD-FORMAT               TO TRUE
           MOVE SCR08-ORDER-DATE              TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD                   TO DE-COMPARE2-DATE
           MOVE SCR08-ORDER-TIME              TO DE-COMPARE2-TIME
           IF DE-COMPARE1-DATE-TIME <= DE-COMPARE2-DATE-TIME
      *            'SETBACK DATE MUST LATER THAN ORDER DATE/TIME'
              MOVE 'S132'                     TO MSGLOG-CODE
              MOVE -1                         TO SCR08-OD-TIME-CURSOR(J)
              MOVE REV-VIDEO                  TO SCR08-OD-DATE-HI(J)
                                                 SCR08-OD-TIME-HI(J)
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *
      *    MAKE SURE NO SETBACK ALREADY EXISTS FOR THE ASSIGNMENT
      *
           MOVE SPACES                        TO WS-TASK
           STRING SCR08-ASGN SCR08-ASGN-TYPE
                  DELIMITED BY SIZE
                  INTO TASK-CALL-TRAIN
           SET TASK-SET-BACK                  TO TRUE
           MOVE TASK-EMPLOYEE-KEY             TO TASKEMPK
           EXEC CICS STARTBR
                     DATASET(TASK-VIA-EMP-NBR)
                     RIDFLD(TASKEMPK)
                     KEYLENGTH(TASKENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF SUCCESS
              SET TASK-NOT-DONE               TO TRUE
              PERFORM UNTIL TASK-DONE
                 EXEC CICS READNEXT
                           DATASET(TASK-VIA-EMP-NBR)
                           INTO(WS-TASK)
                           LENGTH(TASKENBR-RLGTH)
                           RIDFLD(TASKEMPK)
                           KEYLENGTH(TASKENBR-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE             TO FILE-STATUS
                 IF NOT SUCCESS
                    SET TASK-DONE             TO TRUE
                    IF NOT (NO-RECORD-FND OR END-OF-FILE)
                       MOVE 'P2990-1'         TO ERR-PARAGRAPH
                       MOVE TASKEMPK          TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 ELSE
                    IF TASK-SET-BACK
                       AND TASK-CALL-TRAIN(1:8)  = SCR08-ASGN
                       AND TASK-CALL-TRAIN(9:2)  = SCR08-ASGN-TYPE
                       MOVE TASK-INFO         TO WS-CALL-INFO
                       IF WS-CALL-INFO-CC      = P08CA-ASGN-CC(J)
                          SET TASK-DONE       TO TRUE
      *                      A SETBACK TASK ALREADY EXISTS FOR THIS ASGN
                          MOVE 'A150'         TO MSGLOG-CODE
                          MOVE -1             TO SCR08-FUNC-CURSOR(J)
                          MOVE REV-VIDEO      TO SCR08-FUNC-HI(J)
                          PERFORM P9000-SEND-MAP-AND-RETURN
                       END-IF
                    ELSE
                       SET TASK-DONE          TO TRUE
                    END-IF
                 END-IF
              END-PERFORM
              EXEC CICS ENDBR
                        DATASET(TASK-VIA-EMP-NBR)
                        RESP(WS-RESPONSE)
              END-EXEC
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P2990-2'               TO ERR-PARAGRAPH
                 MOVE TASKEMPK                TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF

           MOVE SPACES                        TO P927-COMMAREA-PARMS
           SET P927-SETBACK-FUNCTION          TO TRUE
           MOVE SCR08-OD-DATE(J)              TO P927-EFF-DATE
           MOVE SCR08-OD-TIME(J)              TO P927-EFF-TIME
           MOVE SCR08-ORDER-DATE              TO P927-CALL-DATE
           MOVE SCR08-ORDER-TIME              TO P927-CALL-TIME
           MOVE PSTCA-TIME-ZONE               TO P927-TIME-ZONE
           MOVE PSTCA-DIST                    TO P927-DIST
           MOVE PSTCA-SUB-DIST                TO P927-SUB-DIST
           MOVE SCR08-ORG-STATION             TO P927-CALL-ORG-STATION
           MOVE SCR08-PROFILE                 TO P927-TRCN-TRAIN-ASGN
           MOVE TRCN-DEP-DIR                  TO P927-DIRECTION
           MOVE SCR08-ASGN                    TO P927-TRAIN-SYM
           MOVE SCR08-ASGN-TYPE               TO P927-TRAIN-CODE
           SET P927-CREATE-CALL               TO TRUE
           MOVE 'O'                           TO P927-CALL-TYPE
           MOVE SCR08-DH-RSN                  TO P927-CALL-DH-RSN
           MOVE 'N'                           TO P927-TRAIN-DELAYED
           MOVE P08CA-ASGN-KEY(J)(1:10)       TO WS-CALL-INFO-ASGN
           MOVE P08CA-ASGN-CC(J)              TO WS-CALL-INFO-CC
           MOVE WS-CALL-INFO                  TO P927-CALL-INFO
           MOVE TRCN-ASGN-TYPE                TO P927-CALL-ASGN-TYPE
           MOVE TRCN-FNL-STN                  TO P927-CALL-FNL-STATION
           EXEC CICS LINK
                     PROGRAM(P927-PGM)
                     COMMAREA(P927-COMMAREA-PARMS)
                     LENGTH(P927-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P2990-3'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *
           MOVE 'SETBACK TASK HAS BEEN CREATED'
                                              TO SCR08-ERRORMSG
           MOVE 'S130'                        TO MSGLOG-CODE
           MOVE -1                            TO SCR08-FUNC-CURSOR(J)
           PERFORM P1020-SET-ASGN-CALL-ATTR
      *
      *    WRITE JOB HISTORY RECORD
      *
           MOVE SPACES                        TO WS-JOB-HIST
           EVALUATE TRUE
              WHEN YARD-CALL
                 MOVE 'Y'                     TO JHIST-JOB-TYPE
                                                 JHIST-JOB-TYPE2
              WHEN LOCAL-CALL
                 MOVE 'L'                     TO JHIST-JOB-TYPE
                                                 JHIST-JOB-TYPE2
              WHEN OTHER
                 MOVE 'U'                     TO JHIST-JOB-TYPE
                                                 JHIST-JOB-TYPE2
           END-EVALUATE
           MOVE P08CA-ASGN-KEY(J)(1:2)        TO JHIST-JOB-DIST
                                                 JHIST-JOB-DIST2
           MOVE P08CA-ASGN-KEY(J)(3:2)        TO JHIST-JOB-SUB-DIST
                                                 JHIST-JOB-SUB-DIST2
           MOVE P08CA-ASGN-ID(J)(1:2)         TO JHIST-JOB-POOL
                                                 JHIST-JOB-POOL2
           MOVE P08CA-ASGN-ID(J)(3:4)         TO JHIST-JOB-TURN
                                                 JHIST-JOB-TURN2
           MOVE P08CA-ASGN-CC(J)              TO JHIST-JOB-CRAFT
                                                 JHIST-JOB-CRAFT2
           EXEC CICS ASSIGN
                     USERID(JHIST-USERID)
           END-EXEC
           MOVE '07'                       TO JHIST-FUNCTION
           MOVE SCR08-OD-DATE(J)           TO JHIST-EFF-DATE-TIME(1:6)
           MOVE SCR08-OD-TIME(J)           TO JHIST-EFF-DATE-TIME(7:4)
           SET JOB-HIST-NOT-DONE           TO TRUE
           MOVE WS-SYSTEM-DATE-TIME-CENT   TO WS-HIST-CLOCK-TIME
           PERFORM UNTIL JOB-HIST-DONE
              MOVE WS-HIST-CLOCK-TIME       TO JHIST-CLOCK-TIME
                                               JHIST-CLOCK-KEY-TIME-CENT
              MOVE JHIST-JOB-KEY            TO JHISTJOB
              PERFORM P8300-READ-JOB-HIST
              IF SUCCESS
                 ADD 1                      TO WS-HIST-DATE-TIME-TIE
                 IF WS-HIST-DATE-TIME-TIE > 90
                    SET JOB-HIST-DONE       TO TRUE
                    MOVE 'P2990-4'          TO ERR-PARAGRAPH
                    MOVE JHISTJOB           TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              ELSE
                 IF NO-RECORD-FND
                    SET JOB-HIST-DONE       TO TRUE
                    MOVE WS-HIST-CLOCK-TIME TO JHIST-CLOCK-TIME
                                               JHIST-CLOCK-KEY-TIME-CENT
                    PERFORM P8310-WRITE-JOB-HIST
                    IF NOT SUCCESS
                       MOVE 'P2990-5'       TO ERR-PARAGRAPH
                       MOVE JHISTJOB        TO ERR-KEY
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 ELSE
                    MOVE 'P2990-6'          TO ERR-PARAGRAPH
                    MOVE JHISTJOB           TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-PERFORM
           .
      *================================================================*
       P2995-DISPLAY-HOS-INFO.
      *================================================================*
      *
           IF P08CA-ASGN-KEY(FUNC-SUB) NOT > SPACES
              MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
              MOVE 'IMPROPER FUNCTION - NO ASSIGNMENT PRESENT'
                 TO SCR08-ERRORMSG
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

           IF P08CA-EMP-NO(FUNC-SUB) NOT > SPACES
              IF P08CA-REG-EMP-NO(FUNC-SUB) NOT > SPACES
                 MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *               'IMPROPER FUNCTION - NO EMPLOYEE PRESENT'
                 MOVE 'I050'     TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
      *
           INITIALIZE PS94-COMMAREA-PARMS
           SET PS94-SUM-FUNC           TO TRUE
           IF P08CA-EMP-NO(FUNC-SUB) > SPACES
              MOVE P08CA-EMP-NO(FUNC-SUB)        TO PS94-EMP-NBR
           ELSE
              MOVE P08CA-REG-EMP-NO(FUNC-SUB)    TO PS94-EMP-NBR
           END-IF
           MOVE WS-LOCAL-DATE-TIME     TO PS94-HSL-EVENT-STRT-TS-DTTM
                                          PS94-HSL-EVENT-END-TS-DTTM
           MOVE PSTCA-TIME-ZONE        TO PS94-TIME-ZONE
           PERFORM P9993-CALL-PS94-PROGRAM
           MOVE PS94-MTD-TOTAL-TM      TO WS-MISC-TOT-TM
           MOVE PS94-MTD-LIMBO-TM      TO WS-MISC-LIMBO-TM
           MOVE PS94-CONSECUTIVE-STARTS TO
                                          WS-MISC-CONSEC-STARTS
           IF P925-EMP-STATUS-NA
      *            'HOURS OF SERVICE NOT APPLICABLE'
              MOVE 'H032'                 TO MSGLOG-CODE
           ELSE
              MOVE SPACES              TO MSGLOG-CODE
              STRING 'HOS INFO : '
                     'TOTAL(' WS-TOT-TM2(1:3) ':' WS-TOT-TM2(4:2) ') '
                     'LIMBO(' WS-LIMBO-TM2(1:3) ':' WS-LIMBO-TM2(4:2)')'
                     ' STARTS(' WS-CONSEC-STARTS ')'
                      DELIMITED BY SIZE
                      INTO SCR08-ERRORMSG
           END-IF
           MOVE -1                     TO SCR08-FUNC-CURSOR(FUNC-SUB)
           PERFORM P9000-SEND-MAP-AND-RETURN.
      *CNC0520-BEG
      *
       P3000-DISPLAY-QUAL-INFO.
      *
           IF P08CA-EMP-NO(FUNC-SUB) > SPACES
              MOVE SPACES                  TO SCR08-FUNC(FUNC-SUB)
              MOVE PSTS08                  TO P08-TSQ-DATA
      *       WRITE TSQ BEFORE POPULATING P08DCOMM BECAUSE P08COMM AND
      *       P08DCOMM OVERLAPS
              PERFORM P9550-REWRITE-TSQUEUE
              MOVE TRCN-DESCRIPTION        TO P08DCA-TRN-DESC
              MOVE P08CA-EMP-NO(FUNC-SUB)  TO P08DCA-EMP-NBR
              MOVE TRCN-ORIGIN-STN         TO P08DCA-ORIGIN-STN
              MOVE TRCN-TRAIN-ASGN         TO P08DCA-TRAIN-ASGN
              MOVE SCR08-ROUTE-DSGN        TO P08DCA-ROUTE-DSGN
              MOVE P08CA-ASGN-CC(FUNC-SUB) TO WS-CRAFT-CODE-CHECK
              PERFORM PXXXX-GET-MASTER-CRAFT
              IF WS-CRAFT-CODE-CHECK > SPACES
                 MOVE WS-CRAFT-CODE-CHECK  TO P08DCA-CRAFT
              ELSE
                 MOVE P08CA-ASGN-CC(FUNC-SUB) TO P08DCA-CRAFT
              END-IF
              MOVE WS-CALL-DATE            TO P08DCA-CALL-DATE
              PERFORM VARYING QUAL FROM 1 BY 1
      *CNC0572 - BEG
      ***                            UNTIL QUAL > 6
                                     UNTIL QUAL > 8
      *CNC0572 - END
                 MOVE P08CA-ASGN-QUAL(FUNC-SUB, QUAL)
                                           TO P08DCA-QUAL(QUAL)
              END-PERFORM
              MOVE P08-PGM                 TO PSTCA-FROM-PROGRAM
              EXEC CICS XCTL
                       PROGRAM(P08D-PGM)
                       COMMAREA(PSTCOMM-AREA)
                       LENGTH(PSTCOMM-LGTH)
                       RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE  TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P3000-1' TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
      *       'FUNCTION NOT YET AVAILABLE'
              MOVE 'F003'       TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF.
      *CNC0520-END
      *CNC0600-B
      *
       P3100-PROCESS-HOS-OVRD.
      *
           IF P08CA-EMP-NO(FUNC-SUB) > SPACES
              MOVE SPACES                  TO SCR08-FUNC(FUNC-SUB)
              MOVE PSTS08                  TO P08-TSQ-DATA
              MOVE FUNC-SUB                TO P08-TSQ-FUNC-SUB
              PERFORM P9550-REWRITE-TSQUEUE
              MOVE P08CA-EMP-NO(FUNC-SUB)  TO MSTRNBRK
              PERFORM P8505-READ-MASTER-ONLY

              MOVE P08-PGM                 TO PSTCA-FROM-PROGRAM
              MOVE DIST      OF WS-MSTR    TO PSTCA-DIST
              MOVE SUB-DIST  OF WS-MSTR    TO PSTCA-SUB-DIST
              MOVE P08CA-EMP-NO(FUNC-SUB)  TO PSTCA-EMP-NBR
              SET P18CCA-HOS-OVRD          TO TRUE
      *CNC0600-DXC-B
              MOVE WS-FORMAT-TRAIN         TO P18CCA-TRN-ASSN(1:10)
              MOVE SCR08-CC(FUNC-SUB)      TO P18CCA-TRN-ASSN(11:2)
              MOVE TRCN-EN-FROM-POOL       TO P18CCA-POOL
      *CNC0600-DXC-E
              EXEC CICS XCTL
                     PROGRAM (P18C-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH  (PSTCOMM-LGTH)
                     RESP    (WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE             TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P3100-1'            TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
      *       'FUNCTION NOT YET AVAILABLE'
              MOVE 'F003'       TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF.
      *CNC0600-E
      *=================================================================
       P3037-CHECK-SCHED.
      *=================================================================
           MOVE WS-JOB-SCHEDULE               TO WS-HOLD-JOB-SCHED
           MOVE JS-KEY1                       TO WORK-JS-KEY1
           MOVE WK-JSK1-ASGN-START-TIME       TO SAVE-JOB-OD-TIME
           MOVE SPACES                        TO WK-JSK1-ASGN-START-TIME
           MOVE WORK-JS-KEY1                  TO JSKEY1

           EXEC CICS STARTBR
                     DATASET(JS-VIA-JSKEY1)
                     RIDFLD(JSKEY1)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS

           IF NOT SUCCESS
              SET  SCHED-DONE                 TO TRUE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P3037-1'               TO ERR-PARAGRAPH
                 MOVE JSKEY1                  TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF

           PERFORM UNTIL SCHED-DONE
              EXEC CICS READNEXT
                        DATASET(JS-VIA-JSKEY1)
                        INTO(WS-JOB-SCHEDULE)
                        LENGTH(JSKEY1-RLGTH)
                        RIDFLD(JSKEY1)
                        KEYLENGTH(JSKEY1-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE                TO FILE-STATUS
              IF SUCCESS
                 SET  DE-YYMMDD-FORMAT        TO TRUE
                 MOVE WK-JSK1-EXP-DATE        TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 MOVE DE-CCYYMMDD             TO HOLD-WK-JSK1-EXP-DATE

                 SET  DE-YYMMDD-FORMAT        TO TRUE
                 MOVE JSK1-EXP-DATE           TO DE-YYMMDD
                 PERFORM P8998-DATEEDIT
                 IF  JSK1-ASGN-DIST            = WK-JSK1-ASGN-DIST
                 AND JSK1-ASGN-SUB-DIST        = WK-JSK1-ASGN-SUB-DIST
                 AND JSK1-ASSIGNMENT           = WK-JSK1-ASSIGNMENT
                 AND DE-CCYYMMDD          NOT  < HOLD-WK-JSK1-EXP-DATE
                    IF JSK1-ASGN-DAY           < WK-JSK1-ASGN-DAY
                       CONTINUE
                    ELSE
                      IF JSK1-ASGN-DAY         = WK-JSK1-ASGN-DAY
                         MOVE ZEROES          TO SCHED-LST-CODE
                         IF SAVE-JOB-OD-TIME   < JSK1-ASGN-START-TIME
                            SET  SCHED-DONE     TO TRUE
                         ELSE
                            IF SAVE-JOB-OD-TIME   > JOB-SCHED-END-TIME
                           AND JOB-SCHED-END-TIME > JSK1-ASGN-START-TIME
                               SET  SCHED-2ND   TO TRUE
                            ELSE
                               SET  SCHED-FOUND TO TRUE
                               SET  SCHED-LST   TO TRUE
                            END-IF
                         END-IF
                      ELSE
                         SET  SCHED-DONE      TO TRUE
                      END-IF
                   END-IF
                ELSE
                   SET  SCHED-DONE            TO TRUE
                END-IF
              ELSE
                 SET  SCHED-DONE              TO TRUE
                 IF NOT (NO-RECORD-FND OR END-OF-FILE)
                    MOVE 'P3037-2'            TO ERR-PARAGRAPH
                    MOVE JSKEY1               TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-PERFORM

           EXEC CICS ENDBR
                     DATASET(JS-VIA-JSKEY1)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-HOLD-JOB-SCHED             TO WS-JOB-SCHEDULE
      *MET 08/15/2006 C662

           IF SCHED-2ND
              SET  ON-SCHED-1ST               TO TRUE
              MOVE SPACES                     TO WS-AHIST
              MOVE JSK1-ASGN                  TO AHK2-ASSIGNMENT
              MOVE WS-CALL-DATE               TO AHK2-EFF-DATE
              MOVE AH-KEY-2                   TO AH2KEY
              MOVE AH-FILE-VIA-K2             TO AH-DATASET

              EXEC CICS READ
                        DATASET  (AH-DATASET)
                        INTO     (WS-AHIST)
                        LENGTH   (AH2-RLGTH)
                        RIDFLD   (AH2KEY)
                        KEYLENGTH(AH2-KLGTH)
                        RESP     (WS-RESPONSE)
                        GTEQ
              END-EXEC

              MOVE WS-RESPONSE                TO FILE-STATUS

              IF  SUCCESS
              AND AHK2-ASSIGNMENT              = JSK1-ASGN
              AND AHK2-EFF-DATE                = WS-CALL-DATE
              AND AHK2-EFF-TIME                < WS-CALL-TIME
                 MOVE SPACES                  TO WS-AHIST-MISC
                 MOVE AH-KEY-1                TO AHM-AHIST-KEY
                 SET  AHM-EMPLOYEE-RECORD     TO TRUE
                 SET CT-IND                   TO 1
                 SEARCH CRAFT-CODE-TABLE VARYING CT-IND
                    AT END CONTINUE
                       WHEN CT-CRAFT-CODE(CT-IND) = WK-JSK1-ASGN-CC
                          MOVE CT-CRAFT-SEQ(CT-IND)
                                              TO AHM-CRAFT-SEQ
                 END-SEARCH
                 MOVE AHM-KEY                 TO AHMKEY
                 MOVE AHM-FILE                TO AHM-DATASET
                 EXEC CICS READ
                           DATASET  (AHM-DATASET)
                           INTO     (WS-AHIST-MISC)
                           LENGTH   (AHM-RLGTH)
                           RIDFLD   (AHMKEY)
                           KEYLENGTH(AHM-KLGTH)
                           RESP     (WS-RESPONSE)
                           GTEQ
                 END-EXEC
                 MOVE WS-RESPONSE             TO FILE-STATUS
                 IF  SUCCESS
                 AND AHM-EMPLOYEE-RECORD
                 AND AHM-AHIST-KEY             = AH-KEY-1
                 AND AHM-EMPLOYEE-NUMBER  NOT  = EMP-NBR OF WS-MSTR
                    SET  NOT-ON-SCHED-1ST     TO TRUE
                 END-IF
              END-IF
           END-IF
           .
      *MET 08/15/2006 C662
       P3039-GET-CNTL-DIST-SUB-DIST.
           MOVE SPACES                TO WORK-CNTLKEY
           MOVE '2A'                  TO WK-CNTL-REC-TYPE
           IF JS-KEY1 > SPACES
              MOVE JSK1-ASGN-DIST     TO WK-CNTL-DIST
              MOVE JSK1-ASGN-SUB-DIST TO WK-CNTL-SUB-DIST
           ELSE
              MOVE P08CA-ASGN-KEY(FUNC-SUB)(1:2)
                                      TO WK-CNTL-DIST
              MOVE P08CA-ASGN-KEY(FUNC-SUB)(3:2)
                                      TO WK-CNTL-SUB-DIST
           END-IF
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P3039-1'          TO ERR-PARAGRAPH
              MOVE CNTLKEY            TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
      *CNC0600-NXA-B
       P3200-CHECK-EMP-UNDST-REST.
           MOVE P08CA-EMP-NO(FUNC-SUB)   TO MSTR3NBRK
           PERFORM P8520-READ-MASTER3
           MOVE P08CA-EMP-NO(FUNC-SUB)   TO MSTRNBRK
           PERFORM P8505-READ-MASTER-ONLY
      *
      *CNC0600 - RJA - B
      *    IF CNTL-CAN-WRR-NEW
           IF WS-CAN-WRR-NEW
      *CNC0600 - RJA - E
              IF EMP-MTOD-NUM > WS-LOCAL-DATE-TIME
                 MOVE EMP-MTOD-TIME(1:2) TO WS-UD-HH
                 MOVE EMP-MTOD-TIME(3:2) TO WS-UD-MM
                 SET WS-EMP-UNDST-REST         TO TRUE
      *CNLD-245-B
                 MOVE EMP-MTOD-NUM       TO WS-SAVE-UD-DTTM
      *CNLD-245-E
              END-IF
              IF WS-MSTR3-REC-FOUND
                 IF WS-LOCAL-DATE-TIME >= MSTR3-SYSTEM-UD1-FROM-NUM
                 AND WS-LOCAL-DATE-TIME <= MSTR3-SYSTEM-UD1-TO-NUM
                    IF EMP-MTOD-NUM > MSTR3-SYSTEM-UD1-TO-NUM
                       CONTINUE
                    ELSE
                       MOVE MSTR3-SYSTEM-UD1-TO-TIME(1:2) TO WS-UD-HH
                       MOVE MSTR3-SYSTEM-UD1-TO-TIME(3:2) TO WS-UD-MM
                       SET WS-EMP-UNDST-REST         TO TRUE
      *CNLD-245-B
                       MOVE MSTR3-SYSTEM-UD1-TO-NUM
                                         TO WS-SAVE-UD-DTTM
      *CNLD-245-E
                    END-IF
                 ELSE
                    IF  WS-LOCAL-DATE-TIME >= MSTR3-SYSTEM-UD2-FROM-NUM
                     AND WS-LOCAL-DATE-TIME <= MSTR3-SYSTEM-UD2-TO-NUM
                        MOVE MSTR3-SYSTEM-UD2-TO-TIME(1:2) TO WS-UD-HH
                        MOVE MSTR3-SYSTEM-UD2-TO-TIME(3:2) TO WS-UD-MM
                        SET WS-EMP-UNDST-REST         TO TRUE
      *CNLD-245-B
                        MOVE MSTR3-SYSTEM-UD2-TO-NUM
                                         TO WS-SAVE-UD-DTTM
      *CNLD-245-E
                    END-IF
                 END-IF
              END-IF
           END-IF.
      *CNC0600-NXA-E
      *
      *CNLD-245-B
       P3300-CHECK-US-UNDIST-REST.
      *
      *07/26/23 RJA B CNC0600 CNLD-269
           SET DONT-CHECK-LOCAL-TM TO TRUE
      *CNLD-330-B
      *    IF WS-SHOW-JOB
           IF P08CA-SHOW-JOB(FUNC-SUB)
      *CNLD-330-E
              IF P08CA-DEC-KEY(FUNC-SUB) > SPACES OR
                 P08CA-USER-OVERRIDE(FUNC-SUB)
      *          EMPLOYEE WAS FILLED/HELPED (IS NOT THE REG OWNER)
                 SET CHECK-LOCAL-TM TO TRUE
              END-IF
              IF P08CA-DEC-KEY(FUNC-SUB) > SPACES
                 MOVE P08CA-DEC-KEY(FUNC-SUB) TO DECKEY
                 MOVE SPACES TO DEC-REQ-1
                                DEC-REQ-2
                 PERFORM P8630-READ-DECISION
                 IF ON-TURN OF WORK-DEC-TABLE
                 OR ON-JOB  OF WORK-DEC-TABLE
      *             THE DECISION RULE USED IS PROMOTING ANOTHER EMP FROM
      *             THE SAME JOB OR TURN TO FILL THE VACANCY
      *             (EX: S1 OF THE SAME JOB WILL FILL FO VACANCY,
      *              B1 OF THE SAME POOL-TURN WILL FILL CO VACANCY ETC.)
                    SET DONT-CHECK-LOCAL-TM TO TRUE
                 END-IF
              END-IF
           ELSE
              SET CHECK-LOCAL-TM TO TRUE
           END-IF
      *07/26/23 RJA E

           IF (EMP-US-RSTD-NUM > WS-LOCAL-DATE-TIME
              AND WS-SAVE-UD-DTTM <= EMP-US-RSTD-NUM)
      *07/26/23 RJA B CNC0600 CNLD-269
              AND CHECK-LOCAL-TM
      *       AND ((NOT WS-SHOW-JOB)
      *       OR (WS-SHOW-JOB AND (P08CA-DEC-KEY(FUNC-SUB) > SPACES
      *       OR P08CA-USER-OVERRIDE(FUNC-SUB))))
      *07/26/23 RJA E

      *CNLD-330 NOTE : WHEN US-REST > LOCAL-TIME,
      * (07/24/24)     WS-UD-MESG IS SHOWN BUT CALL IS NOT PROHIBITED.

              MOVE EMP-US-RSTD-TIME(1:2) TO WS-UD-HH
              MOVE EMP-US-RSTD-TIME(3:2) TO WS-UD-MM
      *CNLD-330-B COMMENTING
      *       SET WS-EMP-UNDST-REST         TO TRUE
      *CNLD-330-E
              MOVE WS-UD-MESG            TO SCR08-PHONE(FUNC-SUB)
              MOVE YELLOW                TO SCR08-PHONE-COL(FUNC-SUB)
      *CNLD-330-B COMMENTING
      *       SET WS-EMP-US-STATUS-RED   TO TRUE
      *CNLD-330-E
           END-IF

           .
      *CNLD-245-E
      *CNC0520-BEG
      *
       P4000-CHECK-TERR-QUAL.
      *
           IF P08CA-EMP-NO(FUNC-SUB) > SPACES
              SET QUAL-MSG-NO            TO TRUE
              MOVE 0                     TO COUNT3
              MOVE SPACES                TO WS-DATA-ARRAY
              PERFORM P4001-GET-QUAL-LSP-LSD
      *       IF QUAL-MSG-NO
      *          PERFORM P4002-GET-ALL-EXPIRED-QUAL
      *       END-IF
      *       IF QUAL-MSG-NO
      *          PERFORM P4003-GET-NO-OF-TRIPS
      *       END-IF
              IF QUAL-MSG-YES
                 IF PSTCA-SUB = 2
                    MOVE 'EMPLOYEE NOT QUALIFIED USE FUNCTION "QUAL"
      -                  'FOR DETAIILS'
                                         TO SCR08-PHONE(FUNC-SUB)
                 ELSE
                    MOVE 'EMPLOYEE NOT QUALIFIED USE FUNCTION "QUAL"
      -                  'FOR DETAILS'
                                         TO SCR08-PHONE(FUNC-SUB)
                 END-IF
                 MOVE YELLOW             TO SCR08-PHONE-COL(FUNC-SUB)
                 SET EMP-DISQUALIFIED    TO TRUE
                 MOVE 7                  TO SUB1
                 IF WS-CALL-NO
                    SET P08CA-EMP-RESTRICTED(FUNC-SUB) TO TRUE
                 ELSE
                    MOVE SPACES        TO P08CA-EMP-RESTR-FLAG(FUNC-SUB)
                 END-IF
              END-IF
           END-IF.
      *
       P4001-GET-QUAL-LSP-LSD.
      *
           MOVE SPACES                TO  WS-TRR-STORAGE
           MOVE TRCN-ORIGIN-STN       TO  TRR-FROM-LOC
           MOVE TRCN-FNL-STN          TO  TRR-TO-LOC
           MOVE SCR08-ROUTE-DSGN      TO  TRR-ROUTE-DSGN
           PERFORM PSQL-TRROPN06
           IF SQL-SUCCESS
              MOVE 0                  TO COUNT1
              PERFORM UNTIL NO-ROW-FND
                 PERFORM PSQL-TRRFET06
                 IF SQL-SUCCESS
                    ADD 1             TO COUNT1
                    MOVE TRR-LINE-SEG TO WS-LINE-SEG(COUNT1)
                 ELSE
                    IF NO-ROW-FND
                       MOVE COUNT1    TO COUNTMAX
                    END-IF
                 END-IF
              END-PERFORM
              MOVE 0 TO COUNT2 COUNT1
              PERFORM UNTIL COUNT1 >= COUNTMAX
                 ADD 1                TO COUNT1
                 IF WS-LINE-SEG(COUNT1) > SPACES
                    MOVE WS-LINE-SEG(COUNT1) TO LSP-LINE-SEG
                    MOVE WS-CALL-DATE        TO LSP-EXP-TS-DT
                    PERFORM PSQL-LSPSEL04
                    IF SQL-SUCCESS
                       IF LSP-EXP-TS = C-MAX-TS
                          ADD 1              TO COUNT2
                          MOVE LSP-LINE-SEG  TO WK-LINE-SEG(COUNT2)
                          MOVE LSP-EXP-TS    TO WK-EXP-TS(COUNT2)
                       ELSE
                          SET DE-YYMMDD-FORMAT TO TRUE
                          MOVE LSP-EXP-TS-DT TO DE-YYMMDD
                          PERFORM P8998-DATEEDIT
                          MOVE DE-CCYYMMDD   TO DE-COMPARE1-DATE

                          SET DE-YYMMDD-FORMAT TO TRUE
                          MOVE WS-CALL-DATE  TO DE-YYMMDD
                          PERFORM P8998-DATEEDIT
      *                   IF LSP-EXP-TS-DTTM > WS-SYSTEM-DATE-TIME
                          IF DE-COMPARE1-DATE > DE-CCYYMMDD
                             ADD 1           TO COUNT2
                             MOVE LSP-LINE-SEG TO WK-LINE-SEG(COUNT2)
                             MOVE LSP-EXP-TS TO WK-EXP-TS(COUNT2)
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              END-PERFORM
              MOVE COUNT2                    TO COUNTMAX
              MOVE 0                         TO COUNT2
              PERFORM UNTIL COUNT2 >= COUNTMAX
                 ADD 1 TO COUNT2
                 IF WK-LINE-SEG(COUNT2) > SPACES
                    MOVE WK-LINE-SEG(COUNT2) TO LSD-LINE-SEG
                    MOVE WK-EXP-TS(COUNT2)   TO LSD-EXP-TS
                    MOVE P08CA-ASGN-CC(FUNC-SUB) TO WS-CRAFT-CODE-CHECK
                    PERFORM PXXXX-GET-MASTER-CRAFT
                    IF WS-CRAFT-CODE-CHECK > SPACES
                       MOVE WS-CRAFT-CODE-CHECK  TO LSD-CRFT-CD
                    ELSE
                       MOVE P08CA-ASGN-CC(FUNC-SUB) TO LSD-CRFT-CD
                    END-IF
                    PERFORM PSQL-LSDOPN02
                    PERFORM UNTIL NO-ROW-FND
                       ADD 1 TO COUNT3
                       PERFORM PSQL-LSDFET02
                       IF SQL-SUCCESS
                          MOVE LSD-QUAL-CD      TO WS-QUAL-CODE(COUNT3)
                          MOVE LSD-INIT-TRIPS   TO WS-LSD-TRIPS(COUNT3)
                          MOVE LSD-INIT-DAYS    TO
                               WS-LSD-INIT-DAYS(COUNT3)
                       END-IF
                    END-PERFORM
                    PERFORM PSQL-LSDCLO02
                    COMPUTE COUNT3 = COUNT3 - 1
                 END-IF
              END-PERFORM
              PERFORM PSQL-TRRCLO06
           END-IF
           MOVE 'N'                          TO DONE-CODE1
           SET WS-CALL-NO                    TO TRUE
           PERFORM VARYING SUB6 FROM 1 BY 1 UNTIL DONE1
              IF WS-QUAL-CODE(SUB6) > SPACES
                 MOVE SPACES                 TO WS-QUAL-FILE
                 MOVE P08CA-EMP-NO(FUNC-SUB) TO QUAL-EMP-NO
                 MOVE WS-QUAL-CODE(SUB6)     TO QUALIFICATION
                                                WS-TEMP-QUAL
                 MOVE QUALEMP-KEY            TO QUALEMP
                 EXEC CICS READ
                           DATASET(QUAL-FILE-VIA-QUALEMP)
                           INTO(WS-QUAL-FILE)
                           LENGTH(QUALEMP-RLGTH)
                           RIDFLD(QUALEMP)
                           KEYLENGTH(QUALEMP-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE            TO FILE-STATUS
                 IF SUCCESS
                    SET WS-CALL-YES          TO TRUE
      *C1047-BEG
                    IF QUAL-DATE IS NOT > WS-SYSTEM-DATE
                       SET WS-CALL-NO        TO TRUE
                       SET QUAL-MSG-YES      TO TRUE
                    END-IF
      *C1047-END
      *             CONTINUE
      *          ELSE
      *             SET DONE1                TO TRUE
      *             SET QUAL-MSG-YES         TO TRUE
      *             MOVE SPACES              TO WS-CALL-FLAG
      *             MOVE SPACES              TO WS-CNTL-FILE
      *             SET QUAL-CODE-TYPE-REC   TO TRUE
      *             MOVE WS-QUAL-CODE(SUB6)  TO CNTL-QUAL-CODE
      *             MOVE CNTLKEY-AREA        TO CNTLKEY
      *             EXEC CICS READ
      *                       DATASET(CNTL-FILE-VIA-CNTLKEY)
      *                       INTO(WS-CNTL-FILE)
      *                       LENGTH(CNTLFILE-RLGTH)
      *                       RIDFLD(CNTLKEY)
      *                       KEYLENGTH(CNTLFILE-KLGTH)
      *                       RESP(WS-RESPONSE)
      *             END-EXEC
      *             MOVE WS-RESPONSE         TO FILE-STATUS
      *             IF SUCCESS
      *                IF TERR-QUAL-Y
      *                   SET WS-CALL-NO     TO TRUE
      *                   IF TERR-QUAL-W-PILOT
      *                      PERFORM P4005-CHECK-OTHER-CRAFTS
      *                   END-IF
      *                ELSE
      *                   SET WS-CALL-YES    TO TRUE
      *                END-IF
      *             END-IF
                 ELSE
                    SET QUAL-MSG-YES         TO TRUE
                 END-IF
              ELSE
                 SET DONE1                   TO TRUE
              END-IF
           END-PERFORM.
      *
      *P4002-GET-ALL-EXPIRED-QUAL.
      *
      *    MOVE SPACES                  TO WS-CALL-FLAG
      *    MOVE SPACES                  TO WS-QUAL-FILE
      *    MOVE P08CA-EMP-NO(FUNC-SUB)  TO QUAL-EMP-NO
      *    MOVE QUALEMP-KEY             TO QUALEMP
      *    EXEC CICS STARTBR
      *              DATASET(QUAL-FILE-VIA-QUALEMP)
      *              RIDFLD(QUALEMP)
      *              GTEQ
      *              RESP(WS-RESPONSE)
      *    END-EXEC
      *    MOVE WS-RESPONSE             TO FILE-STATUS
      *    IF SUCCESS
      *       MOVE 'N'                  TO DONE-CODE1
      *       PERFORM UNTIL DONE1
      *          EXEC CICS READNEXT
      *                    DATASET(QUAL-FILE-VIA-QUALEMP)
      *                    INTO(WS-QUAL-FILE)
      *                    LENGTH(QUALEMP-RLGTH)
      *                    RIDFLD(QUALEMP)
      *                    KEYLENGTH(QUALEMP-KLGTH)
      *                    RESP(WS-RESPONSE)
      *          END-EXEC
      *          MOVE WS-RESPONSE       TO FILE-STATUS
      *          IF SUCCESS
      *             IF QUAL-EMP-NO = P08CA-EMP-NO(FUNC-SUB)
      *                IF QUAL-DATE IS NOT > WS-SYSTEM-DATE
      *                   SET QUAL-MSG-YES   TO TRUE
      *                   SET DONE1          TO TRUE
      *                   MOVE SPACES              TO WS-CNTL-FILE
      *                   SET QUAL-CODE-TYPE-REC   TO TRUE
      *                   MOVE QUALIFICATION       TO CNTL-QUAL-CODE
      *                                               WS-TEMP-QUAL
      *                   MOVE CNTLKEY-AREA        TO CNTLKEY
      *                   EXEC CICS READ
      *                             DATASET(CNTL-FILE-VIA-CNTLKEY)
      *                             INTO(WS-CNTL-FILE)
      *                             LENGTH(CNTLFILE-RLGTH)
      *                             RIDFLD(CNTLKEY)
      *                             KEYLENGTH(CNTLFILE-KLGTH)
      *                             RESP(WS-RESPONSE)
      *                   END-EXEC
      *                   MOVE WS-RESPONSE         TO FILE-STATUS
      *                   IF SUCCESS
      *                      IF TERR-QUAL-Y
      *                         SET WS-CALL-NO     TO TRUE
      *                         IF TERR-QUAL-W-PILOT
      *                            PERFORM P4005-CHECK-OTHER-CRAFTS
      *                         END-IF
      *                      ELSE
      *                         SET WS-CALL-YES    TO TRUE
      *                      END-IF
      *                   END-IF
      *                END-IF
      *             ELSE
      *                SET DONE1             TO TRUE
      *             END-IF
      *          ELSE
      *             SET DONE1                TO TRUE
      *          END-IF
      *       END-PERFORM
      *       EXEC CICS ENDBR
      *                 DATASET(QUAL-FILE-VIA-QUALEMP)
      *                 RESP(WS-RESPONSE)
      *       END-EXEC
      *    END-IF.
      *
      *P4003-GET-NO-OF-TRIPS.
      *
      *    MOVE 'N'                           TO DONE-CODE1
      *    PERFORM VARYING SUB6 FROM 1 BY 1 UNTIL DONE1
      *       IF WS-QUAL-CODE(SUB6) > SPACES
      *          MOVE SPACES                  TO P931-COMMAREA-PARMS
      *          SET  P931-TRIP-INQUIRY-FUN   TO TRUE
      *          MOVE P08CA-EMP-NO(FUNC-SUB)  TO P931-TRIP-INQ-EMP-NO
      *          MOVE WS-QUAL-CODE(SUB6)      TO P931-TRIP-INQ-QUAL-CODE
      *          MOVE WS-SYSTEM-DATE          TO P931-TRIP-INQ-END-DATE
      *          MOVE WS-SYSTEM-TIME          TO P931-TRIP-INQ-END-TIME
      *          PERFORM P4004-CALC-BEG-DATE
      *          EXEC CICS LINK
      *               PROGRAM(P931-PGM)
      *               COMMAREA(P931-COMMAREA-PARMS)
      *               LENGTH(P931-LGTH)
      *               RESP(WS-RESPONSE)
      *          END-EXEC
      *          MOVE WS-RESPONSE             TO FILE-STATUS
      *          IF SUCCESS
      *             IF P931-TRIP-RET-ACCRUED <= WS-LSD-TRIPS(SUB6)
      *                SET DONE1              TO TRUE
      *                SET QUAL-MSG-YES       TO TRUE
      *             END-IF
      *          END-IF
      *       ELSE
      *          SET DONE1                    TO TRUE
      *       END-IF
      *    END-PERFORM.
      *
      *P4004-CALC-BEG-DATE.
      *
      *    MOVE ZEROS                     TO DATE-CONVERSION-PARMS
      *    SET PARM-SUBTRACT              TO TRUE
      *    MOVE WS-SYSTEM-DATE            TO PARM-PRI-DATE-GREG
      *    MOVE WS-SYSTEM-TIME            TO PARM-PRI-HRMN
      *    MOVE WS-LSD-INIT-DAYS(SUB6)    TO PARM-SEC-JULIAN-DAY
      *    EXEC CICS LINK
      *              PROGRAM(P903-PGM)
      *              COMMAREA(DATE-CONVERSION-PARMS)
      *              LENGTH(P903-LGTH)
      *              RESP(WS-RESPONSE)
      *    END-EXEC
      *    MOVE WS-RESPONSE               TO FILE-STATUS
      *    IF NOT SUCCESS
      *       MOVE 'P4004-1'              TO ERR-PARAGRAPH
      *       MOVE 'P903LINK'             TO ERR-KEY
      *       PERFORM P9999-GOT-PROBLEM
      *    END-IF
      *    MOVE PARM-RES-DATE-GREG        TO P931-TRIP-INQ-BEG-DATE
      *    MOVE PARM-RES-HRMN             TO P931-TRIP-INQ-BEG-TIME
      *      .
      *
      *P4005-CHECK-OTHER-CRAFTS.
      *
      *    PERFORM VARYING SUB5 FROM 1 BY 1
      *              UNTIL SUB5 > ARRAY-MAX
      *       IF P08CA-EMP-NO(SUB5) > SPACES
      *          MOVE SPACES                 TO WS-QUAL-FILE
      *          MOVE P08CA-EMP-NO(SUB5)     TO QUAL-EMP-NO
      *          MOVE WS-TEMP-QUAL           TO QUALIFICATION
      *          MOVE QUALEMP-KEY            TO QUALEMP
      *          EXEC CICS READ
      *                    DATASET(QUAL-FILE-VIA-QUALEMP)
      *                    INTO(WS-QUAL-FILE)
      *                    LENGTH(QUALEMP-RLGTH)
      *                    RIDFLD(QUALEMP)
      *                    KEYLENGTH(QUALEMP-KLGTH)
      *                    RESP(WS-RESPONSE)
      *          END-EXEC
      *          MOVE WS-RESPONSE            TO FILE-STATUS
      *          IF SUCCESS
      *             IF QUAL-DATE IS  > WS-SYSTEM-DATE
      *                SET WS-CALL-YES          TO TRUE
      *             END-IF
      *          END-IF
      *       END-IF
      *    END-PERFORM.
      *CNC0520-END
      *
      *
      ******************************************************************
      ************ PARAGRAPHS P5000 - P6000 COPIED FROM CP *************
      ******************************************************************
      *
       P5000-PREFILL-VCLL.
      *
           MOVE P08CA-PROFILE-KEY             TO TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           PERFORM P5110-IVR-PFKEY-EDITS

           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB                   > ARRAY-MAX
              IF  P08CA-EMP-NO(FUNC-SUB)       > SPACES
              AND SCR08-ST(FUNC-SUB)      NOT  = 'B8'
              AND NOT P08CA-ASGN-SET(FUNC-SUB)
              AND NOT P08CA-ASGN-IVR-CONTROL(FUNC-SUB)
                 MOVE SPACE             TO WS-VRUINFO-DUP-FL
      *          CHECK FOR DUPLICATE EMPLOYEE
                 IF FUNC-SUB > 1
                    PERFORM VARYING SUB1 FROM 1 BY 1
                      UNTIL SUB1 >= FUNC-SUB
                       IF P08CA-EMP-NO(FUNC-SUB) = P08CA-EMP-NO(SUB1)
                          SET WS-VRUINFO-DUP TO TRUE
                          MOVE FUNC-SUB      TO SUB1
                       END-IF
                    END-PERFORM
                 END-IF
                 IF NOT WS-VRUINFO-DUP
                    MOVE P08CA-ASGN-CC(FUNC-SUB) TO WS-CRAFT-CODE-CHECK
                    IF ENGINE-CRAFT
                       IF WS-IVR-CALL-PROF-EN     > SPACES
                          MOVE 'VCLL'            TO SCR08-FUNC(FUNC-SUB)
                       END-IF
                    ELSE
                       IF WS-IVR-CALL-PROF-TR     > SPACES
                          MOVE 'VCLL'            TO SCR08-FUNC(FUNC-SUB)
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-PERFORM
           MOVE -1                            TO SCR08-FUNC-CURSOR(1)
           IF SCR08-FUNC(1)                    = 'VCLL'
           OR SCR08-FUNC(2)                    = 'VCLL'
           OR SCR08-FUNC(3)                    = 'VCLL'
           OR SCR08-FUNC(4)                    = 'VCLL'
           OR SCR08-FUNC(5)                    = 'VCLL'
           OR SCR08-FUNC(6)                    = 'VCLL'
           OR SCR08-FUNC(7)                    = 'VCLL'
      *            'IVR CALL FUNCTION FILLED FOR ELIGIBLE EMPLOYEES'
              MOVE 'I591'                     TO MSGLOG-CODE
           ELSE
      *            'NO EMPLOYEES ELIGIBLE FOR IVR CALL'
              MOVE 'N255'                     TO MSGLOG-CODE
           END-IF
           PERFORM P9000-SEND-MAP-AND-RETURN
           .
      *
       P5100-PROCESS-IVR-CALL.
      *
           PERFORM P5110A-IVR-CALL-EDITS
           PERFORM P2100-PROCESS-CALL-FUNCTION
           PERFORM P5150-CREATE-UPDATE-TASK
           PERFORM P5160-CREATE-UPDATE-VRU-INFO
           PERFORM P5170-SETUP-P0ESCOMM
           PERFORM P5180-LINK-TO-0ES
           SET  P08CA-ASGN-IVR-CONTROL(FUNC-SUB) TO TRUE
           .
      *
       P5110-IVR-PFKEY-EDITS.
      *
           MOVE SPACES                        TO WS-IVR-CALL-PROF-EN
                                                 WS-IVR-CALL-PROF-TR
           SET  P08CA-IVR-CALL-NOT-ACTIVE     TO TRUE
           IF P08CA-SAVE-ALLOW-VCLL-FL    NOT  = 'N'
              PERFORM P5111-COMPANY-EDIT
              IF CNTL-OUTBND-IVR-CALL-ACTIVE
                 PERFORM P5112-SUB-DIST-EDIT
                 IF CNTL-2B-IVR-CALL-FL        = 'Y'
                    PERFORM P5113-IVR-CALL-PROFILE-EDIT
                 END-IF
              END-IF
           END-IF
           .
      *
       P5110A-IVR-CALL-EDITS.
      *
           MOVE SPACES                        TO WS-IVR-CALL-PROF-EN
                                                 WS-IVR-CALL-PROF-TR
           SET  P08CA-IVR-CALL-NOT-ACTIVE     TO TRUE
           IF P08CA-SAVE-ALLOW-VCLL-FL    NOT  = 'N'
              PERFORM P5111-COMPANY-EDIT
              IF CNTL-OUTBND-IVR-CALL-ACTIVE
                 PERFORM P5112-SUB-DIST-EDIT
                 IF CNTL-2B-IVR-CALL-FL        = 'Y'
                    PERFORM P5113-IVR-CALL-PROFILE-EDIT
                    PERFORM P5114-EMP-EDITS
                 END-IF
              END-IF
           END-IF
           .
      *
       P5111-COMPANY-EDIT.
      *
           MOVE SPACES                        TO WS-CNTL-FILE
           SET  COMPANY-TYPE-REC              TO TRUE
           MOVE CNTLKEY-AREA                  TO WORK-CNTLKEY
           PERFORM P8610-READ-CNTLFILE
           IF  SUCCESS
           AND COMPANY-TYPE-REC
           AND CNTL-OUTBND-IVR-CALL-ACTIVE
              CONTINUE
           ELSE
              MOVE SPACES                     TO WS-CNTL-FILE
           END-IF
           .
      *
       P5112-SUB-DIST-EDIT.
      *
           MOVE SPACES                        TO WS-CNTL-FILE
           SET  SUB-DIST-TYPE-2B-REC          TO TRUE
           MOVE SCR08-DIST                    TO CNTL-DIST
           MOVE SCR08-SUB-DIST                TO CNTL-SUB-DIST
           MOVE CNTLKEY-AREA                  TO WORK-CNTLKEY
           PERFORM P8610-READ-CNTLFILE
           IF  SUCCESS
           AND CNTL-2B-IVR-CALL-FL             = 'Y'
              MOVE CNTL-2B-IVR-CALL-PROF      TO WS-IVR-CALL-PROF-EN
                                                 WS-IVR-CALL-PROF-TR
           END-IF
           .
      *
       P5113-IVR-CALL-PROFILE-EDIT.
      *
           IF UFP-CALL
      *    FIND THE EN IVR CALL PROFILE ON THE POOL SETUP
              MOVE SPACES                     TO CNTLKEY-AREA
              SET  CREW-PROFILE-REC           TO TRUE
              MOVE TRCN-EN-FROM-DIST          TO CNTL-DIST-3A
              MOVE TRCN-EN-FROM-SDIST         TO CNTL-SUB-DIST-3A
              MOVE TRCN-EN-FROM-POOL          TO CNTL-POOL-CODE-3A
              MOVE 'F'                        TO CNTL-POOL-TYPE-3A
              MOVE CNTLKEY-AREA               TO WORK-CNTLKEY
              PERFORM P8610-READ-CNTLFILE
              IF SUCCESS
                 IF TRCN-EN-FROM-TERM          = '0'
                    IF CNTL-3A-HOME-IVR-PROF   > SPACES
                       MOVE CNTL-3A-HOME-IVR-PROF
                                              TO WS-IVR-CALL-PROF-EN
                    END-IF
                 ELSE
                    MOVE TRCN-EN-FROM-TERM    TO SUB4-ALPHA
                    IF CNTL-3A-AWAY-IVR-PROF(SUB4) > SPACES
                       MOVE CNTL-3A-AWAY-IVR-PROF(SUB4)
                                              TO WS-IVR-CALL-PROF-EN
                    END-IF
                 END-IF
              END-IF
      *    FIND THE TR IVR CALL PROFILE ON THE POOL SETUP
              IF TRCN-TR-FROM-DIST        NOT  = TRCN-EN-FROM-DIST
              OR TRCN-TR-FROM-SDIST       NOT  = TRCN-EN-FROM-SDIST
              OR TRCN-TR-FROM-POOL        NOT  = TRCN-EN-FROM-POOL
                 MOVE SPACES                  TO CNTLKEY-AREA
                 SET  CREW-PROFILE-REC        TO TRUE
                 MOVE TRCN-TR-FROM-DIST       TO CNTL-DIST-3A
                 MOVE TRCN-TR-FROM-SDIST      TO CNTL-SUB-DIST-3A
                 MOVE TRCN-TR-FROM-POOL       TO CNTL-POOL-CODE-3A
                 MOVE 'F'                     TO CNTL-POOL-TYPE-3A
                 MOVE CNTLKEY-AREA            TO WORK-CNTLKEY
                 PERFORM P8610-READ-CNTLFILE
              END-IF
              IF SUCCESS
                 IF TRCN-TR-FROM-TERM          = '0'
                    IF CNTL-3A-HOME-IVR-PROF   > SPACES
                       MOVE CNTL-3A-HOME-IVR-PROF
                                              TO WS-IVR-CALL-PROF-TR
                    END-IF
                 ELSE
                    MOVE TRCN-TR-FROM-TERM    TO SUB4-ALPHA
                    IF CNTL-3A-AWAY-IVR-PROF(SUB4) > SPACES
                       MOVE CNTL-3A-AWAY-IVR-PROF(SUB4)
                                              TO WS-IVR-CALL-PROF-TR
                    END-IF
                 END-IF
              END-IF
           ELSE
      * FIND THE IVR CALL PROFILE ON THE CREW PROFILE FIRST
              IF TRCN-IVR-CALL-PROF            > SPACES
                 MOVE TRCN-IVR-CALL-PROF      TO WS-IVR-CALL-PROF-EN
                                                 WS-IVR-CALL-PROF-TR
              END-IF
           END-IF

           MOVE SPACES                        TO WS-IVR-CALL-CMPLT-EN
                                                 WS-IVR-CALL-CMPLT-TR
           IF WS-IVR-CALL-PROF-EN              > SPACES
      *    CHECK IF THE EN IVR CALL PROFILE IS ACTIVE
              MOVE SPACES                     TO CNTLKEY-AREA
              SET  IVR-CALL-PROFILE-REC       TO TRUE
              MOVE WS-IVR-CALL-PROF-EN        TO CNTL-IVR-CALL-PROF
              MOVE CNTLKEY-AREA               TO WORK-CNTLKEY
              PERFORM P8610-READ-CNTLFILE
              IF  SUCCESS
              AND CNTL-IVR-CALL-ACTIVE
                 SET  P08CA-IVR-CALL-ACTIVE   TO TRUE
                 MOVE CNTL-IVR-CALL-CMPLT-FL  TO WS-IVR-CALL-CMPLT-EN
              ELSE
                 MOVE SPACES                  TO WS-IVR-CALL-PROF-EN
              END-IF
           END-IF
           IF WS-IVR-CALL-PROF-TR              > SPACES
      *    CHECK IF THE TR IVR CALL PROFILE IS ACTIVE
              IF WS-IVR-CALL-PROF-TR      NOT  = WS-IVR-CALL-PROF-EN
                 MOVE SPACES                  TO CNTLKEY-AREA
                 SET IVR-CALL-PROFILE-REC     TO TRUE
                 MOVE WS-IVR-CALL-PROF-TR     TO CNTL-IVR-CALL-PROF
                 MOVE CNTLKEY-AREA            TO WORK-CNTLKEY
                 PERFORM P8610-READ-CNTLFILE
              END-IF
              IF  SUCCESS
              AND CNTL-IVR-CALL-ACTIVE
                 SET  P08CA-IVR-CALL-ACTIVE   TO TRUE
                 MOVE CNTL-IVR-CALL-CMPLT-FL  TO WS-IVR-CALL-CMPLT-TR
              ELSE
                 MOVE SPACES                  TO WS-IVR-CALL-PROF-TR
              END-IF
           END-IF
           .
      *
       P5114-EMP-EDITS.
      *
           IF  P08CA-CALL-COMPLETE-FLAG = 'Y'
           AND P08CA-CALL-COMPLETE-TOPC = 'Y'
              MOVE -1        TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
              MOVE SPACES    TO SCR08-FUNC(FUNC-SUB)
      *       'VCLL NOT VALID WHEN ASSIGN ALREADY COMPLETED - USE CALL'
              MOVE 'V173'    TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF
      *#1503
           IF P08CA-EMP-NO(FUNC-SUB)       > ZEROES
              MOVE SPACES                     TO WS-MSTR
              MOVE P08CA-EMP-NO(FUNC-SUB)     TO MSTRNBRK
              PERFORM P8505-READ-MASTER-ONLY
      *C1150.2 - BEG
      ***  END-IF
      *C1150.2 - END

           MOVE SPACE                         TO WS-SHORT-CALL-REQ
      *    READ TELE VIA PS52
           MOVE SPACES                        TO PS52-COMMAREA-PARMS
           MOVE EMP-NBR OF WS-MSTR            TO PS52-EMP-NBR
           SET PS52-CMA-MODE                  TO TRUE
           SET PS52-DISPLAY-ONLY              TO TRUE
           MOVE WS-LOCAL-DATE-TIME            TO PS52-INPUT-DATE-TIME
           PERFORM P8800-LINK-TO-PS52
           IF NOT SUCCESS
              MOVE 'P5114-1'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF

           IF PS52-REQ-LEAD-TIME  > '0000'
              MOVE PS52-REQ-LEAD-TIME         TO WS-SHORT-CALL-REQ
              SET WS-SHORT-LEAD               TO TRUE
           END-IF
           IF PS52-REQ-CALL-TIME  > '0000'
              IF WS-SHORT-CALL-REQ   = SPACES
                 MOVE PS52-REQ-CALL-TIME      TO WS-SHORT-CALL-REQ
                 SET WS-SHORT-CALL            TO TRUE
              ELSE
                 IF PS52-REQ-CALL-TIME < WS-SHORT-CALL-REQ
                    MOVE PS52-REQ-CALL-TIME   TO WS-SHORT-CALL-REQ
                    SET WS-SHORT-CALL         TO TRUE
                 END-IF
              END-IF
           END-IF

      * #1529S
           IF YARD-CALL
              PERFORM P1010-TEST-OWNER
           END-IF
      *
      * 03/23/11 JES
      ***  IF YARDMASTER AND YARDMASTER JOB, MTOD IS IRRELEVANT
           MOVE SCR08-CC(FUNC-SUB) TO WS-CRAFT-CODE-CHECK
      *CNLD-246 B
      *    IF YARDMASTER-CRAFT AND
           IF (YARDMASTER-CRAFT OR YARDMASTER-TRAINEE) AND
      *CNLD-246 E
              P08CA-HOS-EXEMPT(FUNC-SUB)
              MOVE ZERO                TO EMP-MTOD
           END-IF

           SET DE-YYMMDD-FORMAT TO TRUE
           MOVE EMP-MTOD-DATE TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE2-DATE
           MOVE EMP-MTOD-TIME TO DE-COMPARE2-TIME

           SET DE-YYMMDD-FORMAT TO TRUE
           MOVE EMP-US-RSTD-DATE TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE3-DATE
           MOVE EMP-US-RSTD-TIME TO DE-COMPARE3-TIME

           SET DE-YYMMDD-FORMAT TO TRUE
           MOVE EMP-PERS-REST-DATE TO DE-YYMMDD
           PERFORM P8998-DATEEDIT
           MOVE DE-CCYYMMDD            TO DE-COMPARE4-DATE
           MOVE EMP-PERS-REST-TIME TO DE-COMPARE4-TIME

      *
      *C953-START - PERFORM TIMEZONE CONVERSION IF REQUIRED
      *
           IF DIST     OF WS-MSTR NOT = SCR08-DIST
           OR SUB-DIST OF WS-MSTR NOT = SCR08-SUB-DIST
              MOVE SPACES              TO WORK-CNTLKEY
              MOVE '02'                TO WK-CNTL-REC-TYPE
              MOVE DIST OF WS-MSTR     TO WK-CNTL-DIST
              MOVE SUB-DIST OF WS-MSTR TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P5114-A'        TO ERR-PARAGRAPH
                 MOVE CNTLKEY          TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              IF CNTL-TIME-ZONE NOT = PSTCA-TIME-ZONE
                 IF EMP-MTOD > '0000000000'
                    MOVE SPACES          TO TZ-PARAMETERS
                    MOVE CNTL-TIME-ZONE  TO TZ-IN-ZONE
                    MOVE EMP-MTOD        TO TZ-IN-DATE-TIME
                    MOVE PSTCA-TIME-ZONE TO TZ-OUT-ZONE
                    PERFORM P8996-TIMEZONE
                    IF TZ-INVALID-PARAMETERS
                       MOVE 'P5114-B'    TO ERR-PARAGRAPH
                       PERFORM P8996-TZERROR
                    END-IF
                    MOVE TZ-OUT-DATE-TIME-CENT TO DE-COMPARE2-DATE-TIME
                 END-IF
      *
                 IF EMP-US-RSTD > '0000000000'
                    MOVE SPACES        TO TZ-PARAMETERS
                    MOVE CNTL-TIME-ZONE TO TZ-IN-ZONE
                    MOVE EMP-US-RSTD   TO TZ-IN-DATE-TIME
                    MOVE PSTCA-TIME-ZONE TO TZ-OUT-ZONE
                    PERFORM P8996-TIMEZONE
                    IF TZ-INVALID-PARAMETERS
                       MOVE 'P5114-C'  TO ERR-PARAGRAPH
                       PERFORM P8996-TZERROR
                    END-IF
                    MOVE TZ-OUT-DATE-TIME-CENT TO DE-COMPARE3-DATE-TIME
                 END-IF
      *
                 IF EMP-PERS-REST > '0000000000'
                    MOVE SPACES        TO TZ-PARAMETERS
                    MOVE CNTL-TIME-ZONE TO TZ-IN-ZONE
                    MOVE EMP-PERS-REST TO TZ-IN-DATE-TIME
                    MOVE PSTCA-TIME-ZONE TO TZ-OUT-ZONE
                    PERFORM P8996-TIMEZONE
                    IF TZ-INVALID-PARAMETERS
                       MOVE 'P5114-D'  TO ERR-PARAGRAPH
                       PERFORM P8996-TZERROR
                    END-IF
                    MOVE TZ-OUT-DATE-TIME-CENT TO DE-COMPARE4-DATE-TIME
                 END-IF
              END-IF
           END-IF
      *C1150.2 - BEG
           END-IF
      *C1150.2 - END
      *C953-END
      *    IF SCR08-ST(FUNC-SUB) = 'NR'
      *C953IF P08CA-NOT-RESTED(FUNC-SUB)
              IF  P08CA-SAVE-CBCK-FLAG(FUNC-SUB) = 'Y'
              AND P08CA-EMP-NO(FUNC-SUB)       > ZEROES
      * #1529
              AND (WS-SHORT-LEAD OR WS-SHORT-CALL)
                 PERFORM P6100-DETERMINE-DIVN-FLAG

      *          FIND THE EARLIEST ORDER, ONDUTY, TAXI DATE/TIME
                 MOVE SCR08-OD-DATE(FUNC-SUB)  TO WS-CALL-DATE
                 MOVE SCR08-OD-TIME(FUNC-SUB)  TO WS-CALL-TIME
                 IF SCR08-ORDER-DATE < WS-CALL-DATE
                 OR SCR08-ORDER-TIME < WS-CALL-TIME
                    MOVE SCR08-ORDER-DATE      TO WS-CALL-DATE
                    MOVE SCR08-ORDER-TIME      TO WS-CALL-TIME
                 END-IF
                 IF SCR08-TAXI-TM(FUNC-SUB) > '0000'
                    MOVE SCR08-TAXI-TM(FUNC-SUB)
                                                   TO WS-SHORT-CALL-TIME
                    IF SCR08-TAXI-TM(FUNC-SUB) > WS-CALL-TIME
      *                SUBTRACT 1 FROM ORDER-DATE
                       SET PARM-SUBTRACT        TO TRUE
                       MOVE SCR08-ORDER-DATE    TO PARM-PRI-DATE-GREG
                       MOVE SCR08-ORDER-TIME    TO PARM-PRI-HRMN
                       MOVE 1                   TO PARM-SEC-DATE-GREG
                       PERFORM P9700-LINK-P903
                       IF NOT SUCCESS
                          MOVE 'P5114-2'        TO ERR-PARAGRAPH
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
                       MOVE PARM-RES-DATE-GREG  TO WS-SHORT-CALL-DATE
                    ELSE
                       MOVE WS-CALL-DATE        TO WS-SHORT-CALL-DATE
                    END-IF
                    IF WS-SHORT-CALL-DATE-TIME
                                           < WS-CALL-DATE-TIME-CENT
                       MOVE WS-SHORT-CALL-DATE-TIME
                                               TO WS-CALL-DATE-TIME-CENT
                    END-IF
                 END-IF
                 IF WS-SHORT-CALL-REQ > '0000'
                    MOVE ZEROES              TO DATE-CONVERSION-PARMS
                    SET PARM-SUBTRACT        TO TRUE
                    MOVE WS-CALL-DATE        TO PARM-PRI-DATE-GREG
                    MOVE WS-CALL-TIME        TO PARM-PRI-HRMN
                    MOVE WS-SHORT-CALL-REQ   TO PARM-SEC-HRMN
                    PERFORM P9700-LINK-P903
                    IF NOT SUCCESS
                       MOVE 'P5114-3'        TO ERR-PARAGRAPH
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                    MOVE PARM-RES-DATE-GREG  TO WS-SHORT-CALL-DATE
                    MOVE PARM-RES-GREG-CENT  TO WS-SHORT-CALL-CC
                    MOVE PARM-RES-HRMN       TO WS-SHORT-CALL-TIME
      *#1529
      *             IF EMP-PERS-REST   > WS-SHORT-CALL-DATE-TIME
                    IF DE-COMPARE4-DATE-TIME
                                          > WS-SHORT-CALL-DATE-TIME
                       PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                       MOVE -1        TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *              'USE OF IVR CALL NOT ALLOWED - EMP UNDER PERS REST'
                       MOVE 'U156'    TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF

                    MOVE CRAFT OF WS-MSTR    TO WS-CRAFT-CODE-CHECK
                    IF ENGINE-CRAFT
                       IF TRCN-EN-REST-REQ = ('C' OR 'B')
      *                   IF EMP-MTOD       > WS-SHORT-CALL-DATE-TIME
                          IF DE-COMPARE2-DATE-TIME
                                            > WS-SHORT-CALL-DATE-TIME
      *#1424
                             PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                             MOVE -1    TO SCR08-FUNC-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                      'USE OF IVR CALL NOT ALLOWED -
      *                       - EMPLOYEE UNDER UDR/MAND'
                             MOVE 'U154' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                       END-IF
                       IF TRCN-EN-REST-REQ = ('U' OR 'B')
      *                   IF EMP-US-RSTD       > WS-SHORT-CALL-DATE-TIME
                          IF DE-COMPARE3-DATE-TIME
                                            > WS-SHORT-CALL-DATE-TIME
      *#1424
                             PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                             MOVE -1    TO SCR08-FUNC-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                      'USE OF IVR CALL NOT ALLOWED -
      *                       - EMPLOYEE UNDER UDR/MAND'
                             MOVE 'U154' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                       END-IF
                    ELSE
                       IF TRCN-TR-REST-REQ = ('C' OR 'B')
      *                   IF EMP-MTOD       > WS-SHORT-CALL-DATE-TIME
                          IF DE-COMPARE2-DATE-TIME
                                            > WS-SHORT-CALL-DATE-TIME
      *#1424
                             PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                             MOVE -1    TO SCR08-FUNC-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                      'USE OF IVR CALL NOT ALLOWED -
      *                       - EMPLOYEE UNDER UDR/MAND'
                             MOVE 'U154' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                       END-IF
                       IF TRCN-TR-REST-REQ = ('U' OR 'B')
      *                   IF EMP-US-RSTD       > WS-SHORT-CALL-DATE-TIME
                          IF DE-COMPARE3-DATE-TIME
                                            > WS-SHORT-CALL-DATE-TIME
      *#1424
                             PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                             MOVE -1    TO SCR08-FUNC-CURSOR(FUNC-SUB)
                             MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                      'USE OF IVR CALL NOT ALLOWED -
      *                       - EMPLOYEE UNDER UDR/MAND'
                             MOVE 'U154' TO MSGLOG-CODE
                             PERFORM P9000-SEND-MAP-AND-RETURN
                          END-IF
                       END-IF
                    END-IF
                 END-IF
              ELSE
      *#1424
      *C953      PERFORM P5115-UPDT-VRUINFO-CNTL-FL
      *C953      MOVE -1       TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *C953      MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *       'USE OF IVR CALL NOT ALLOWED - EMPLOYEE UNDER UDR/MAND'
      *C953      MOVE 'U154'    TO MSGLOG-CODE
      *C953      PERFORM P9000-SEND-MAP-AND-RETURN
      *C953   END-IF
      *
      * 03/23/11 JES
      *C953ELSE
      *       IF EMP-PERS-REST   > WS-LOCAL-DATE-TIME-CENT
              IF DE-COMPARE4-DATE-TIME
                                 > WS-LOCAL-DATE-TIME-CENT
                 PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                 MOVE -1        TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *         'USE OF IVR CALL NOT ALLOWED - EMP UNDER PERS REST'
                 MOVE 'U156'    TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
              MOVE CRAFT OF WS-MSTR    TO WS-CRAFT-CODE-CHECK
              IF ENGINE-CRAFT
                 IF TRCN-EN-REST-REQ = ('C' OR 'B')
      *             IF EMP-MTOD  > WS-LOCAL-DATE-TIME-CENT
                    IF DE-COMPARE2-DATE-TIME
                                 > WS-LOCAL-DATE-TIME-CENT
                       PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                       MOVE -1          TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                'USE OF IVR CALL NOT ALLOWED -
      *                 - EMPLOYEE UNDER UDR/MAND'
                       MOVE 'U154' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
                 IF TRCN-EN-REST-REQ = ('U' OR 'B')
      *             IF EMP-US-RSTD   > WS-LOCAL-DATE-TIME-CENT
                    IF DE-COMPARE3-DATE-TIME
                                     > WS-LOCAL-DATE-TIME-CENT
                       PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                       MOVE -1          TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                'USE OF IVR CALL NOT ALLOWED -
      *                 - EMPLOYEE UNDER UDR/MAND'
                       MOVE 'U154' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
              ELSE
                 IF TRCN-TR-REST-REQ = ('C' OR 'B')
      *             IF EMP-MTOD       > WS-LOCAL-DATE-TIME-CENT
                    IF DE-COMPARE2-DATE-TIME
                                      > WS-LOCAL-DATE-TIME-CENT
                       PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                       MOVE -1          TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                'USE OF IVR CALL NOT ALLOWED -
      *                 - EMPLOYEE UNDER UDR/MAND'
                       MOVE 'U154' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
                 IF TRCN-TR-REST-REQ = ('U' OR 'B')
      *             IF EMP-US-RSTD    > WS-LOCAL-DATE-TIME-CENT
                    IF DE-COMPARE3-DATE-TIME
                                      > WS-LOCAL-DATE-TIME-CENT
                       PERFORM P5115-UPDT-VRUINFO-CNTL-FL
                       MOVE -1          TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *                'USE OF IVR CALL NOT ALLOWED -
      *                 - EMPLOYEE UNDER UDR/MAND'
                       MOVE 'U154' TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
              END-IF
           END-IF

      *    ENSURE EMPLOYEE IS AT HOME AND NOTIFIED
           IF P08CA-EMP-NO(FUNC-SUB)           > ZEROES
      *       IF NOT NORMAL
      *          PERFORM P1025-RESET-FUNC-CURSORS
      *          MOVE -1                 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *          MOVE REV-VIDEO          TO SCR08-FUNC-HI(FUNC-SUB)
      **              'IVR CALL NOT ALLOWED - EMPLOYEE STATUS IS XX'
      *          MOVE 'I592'             TO MSGLOG-CODE
      *          PERFORM P9000-SEND-MAP-AND-RETURN
      *       END-IF

              MOVE P08CA-PROFILE-KEY          TO TRCNKEY1
              PERFORM P8000-READ-TRCNKEY1
              IF UFP-CALL
                 MOVE SPACES                  TO WS-CNTL-FILE
                 SET POOL-TYPE-REC            TO TRUE
                 MOVE 'F'                     TO CNTL-POOL-TYPE
                 MOVE SCR08-CC(FUNC-SUB)      TO WS-CRAFT-CODE-CHECK
                 IF ENGINE-CRAFT
                    MOVE TRCN-EN-FROM-DIST    TO CNTL-DIST
                    MOVE TRCN-EN-FROM-SDIST   TO CNTL-SUB-DIST
                    MOVE TRCN-EN-FROM-POOL    TO CNTL-POOL-CODE
                 ELSE
                    MOVE TRCN-TR-FROM-DIST    TO CNTL-DIST
                    MOVE TRCN-TR-FROM-SDIST   TO CNTL-SUB-DIST
                    MOVE TRCN-TR-FROM-POOL    TO CNTL-POOL-CODE
                 END-IF
                 MOVE CNTLKEY-AREA            TO WORK-CNTLKEY
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE 'P5114-4'            TO ERR-PARAGRAPH
                    MOVE CNTLKEY              TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 IF ENGINE-CRAFT
                    IF TRCN-EN-FROM-TERM  NOT  > SPACES
                       PERFORM P1025-RESET-FUNC-CURSORS
                       MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO     TO SCR08-FUNC-HI(FUNC-SUB)
      *                     'NO TERMINAL SPECIFIED FOR ENGINEMAN'
                       MOVE 'N256'        TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 ELSE
                    IF TRCN-TR-FROM-TERM  NOT > SPACES
                       PERFORM P1025-RESET-FUNC-CURSORS
                       MOVE -1            TO SCR08-FUNC-CURSOR(FUNC-SUB)
                       MOVE REV-VIDEO     TO SCR08-FUNC-HI(FUNC-SUB)
      *                     'NO TERMINAL SPECIFIED FOR TRAINMAN'
                       MOVE 'N257'        TO MSGLOG-CODE
                       PERFORM P9000-SEND-MAP-AND-RETURN
                    END-IF
                 END-IF
              END-IF
           END-IF
      *
      *#1460 11/10/10
           IF P08CA-TASK-KEY > SPACES
              PERFORM P8700-READ-P08CA-TASK
              IF NOT SUCCESS
      *#1311
                 MOVE P08CA-TASK-KEY      TO TASK-LOCATION-KEY
                                             VRUINFO-TASK-KEY
                 PERFORM P9330-READ-VRUINFO
                 IF SUCCESS
                 AND TASK-USE-TOPC-AREA
                    MOVE -1               TO SCR08-FUNC-CURSOR(FUNC-SUB)
                    MOVE REV-VIDEO        TO SCR08-FUNC-HI(FUNC-SUB)
                    MOVE SPACES           TO SCR08-FUNC(FUNC-SUB)
      *        'VCLL NOT VALID WHEN ASSIGN ALREADY COMPLETED - USE CALL'
                    MOVE 'V173'           TO MSGLOG-CODE
                    PERFORM P9000-SEND-MAP-AND-RETURN
                 ELSE
                    MOVE SPACES           TO P08CA-TASK-KEY
                                             HOLD-TASK-KEY
                 END-IF
              ELSE
                 MOVE P08CA-PROFILE-KEY          TO TRCNKEY1
                 PERFORM P8000-READ-TRCNKEY1
                 IF TRCN-KEY1         NOT = TASK-CALL-PROFILE
                 OR TRCN-ORIGIN-STN   NOT = TASK-CALL-ORIGIN-STN
      *#1411,1460
                    PERFORM P8660-READ-TASK-UPD
                    MOVE TRCN-KEY1       TO TASK-CALL-PROFILE
                    MOVE TRCN-ORIGIN-STN TO TASK-CALL-ORIGIN-STN
                    MOVE TRCN-FNL-STN    TO TASK-CALL-FINAL-STN
                    IF TASK-TOPC-TRAIN-SYM > SPACES
                       MOVE TRCN-ORIGIN-STN TO TASK-TOPC-ORIGIN-STN
                       MOVE TRCN-FNL-STN TO TASK-CALL-TOPC-DEST
                    END-IF
                    PERFORM P8662-REWRITE-TASK
                 END-IF
              END-IF
      *       MOVE TASKTIME           TO HOLD-TASK-KEY
      **      READ/WRITE TOC DB2 RECORD
      *       INITIALIZE WS-TOC-STORAGE
      *       MOVE P08CA-TASK-KEY       TO TOC-TASK-KEY
      *       PERFORM PSQL-TOCSEL01
      *       IF SQL-SUCCESS
      *          MOVE HOLD-TASK-KEY     TO TOC-TASK-KEY
      *          PERFORM PSQL-TOCINS01
      *          MOVE P08CA-TASK-KEY    TO TOC-TASK-KEY
      *          PERFORM PSQL-TOCDEL01
      *       END-IF
      *       MOVE HOLD-TASK-KEY      TO P08CA-TASK-KEY
           END-IF

      *#1505
           IF P08CA-NO-PHONE-YES(FUNC-SUB)
              PERFORM P5115-UPDT-VRUINFO-CNTL-FL
              MOVE -1        TO SCR08-FUNC-CURSOR(FUNC-SUB)
              MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *       'EMPLOYEE HAS NO PHONE NUMBERS ON FILE - VCLL NOT VALID'
              MOVE 'E345'    TO MSGLOG-CODE
              PERFORM P9000-SEND-MAP-AND-RETURN
           END-IF

      *    PERFORM VARYING SUB2 FROM 1 BY 1
      *       UNTIL SUB2                       > ARRAY-MAX
      *       IF P08CA-EMP-NO(SUB2)            > SPACES
      *          PERFORM VARYING SUB1 FROM 1 BY 1
      *             UNTIL SUB1                 > ARRAY-MAX
      *             IF  P08CA-EMP-NO(SUB2)     = P08CA-EMP-NO(SUB1)
      *             AND SUB2              NOT  = SUB1
      *                PERFORM P1025-RESET-FUNC-CURSORS
      *                MOVE -1                TO SCR08-FUNC-CURSOR(SUB2)
      *                MOVE REV-VIDEO         TO SCR08-FUNC-HI(SUB2)
      *                                          SCR08-FUNC-HI(SUB1)
      **                   'DUPLICATE EMPLOYEES - RESOLVE THEN RESUBMIT'
      *                MOVE 'D112'            TO MSGLOG-CODE
      *                PERFORM P9000-SEND-MAP-AND-RETURN
      *             END-IF
      *          END-PERFORM
      *       END-IF
      *    END-PERFORM
           .
      *=================================================================
       P5115-UPDT-VRUINFO-CNTL-FL.
      *=================================================================
      *#1424
      *
           IF P08CA-TASK-KEY > SPACES
              MOVE SPACES                     TO VRUINFO-FILE
              MOVE P08CA-TASK-KEY             TO VRUINFO-TASK-KEY
              PERFORM P9310-READ-UPDATE-VRUINFO
              IF SUCCESS
                 MOVE FUNC-SUB  TO SUBY
                 PERFORM VARYING SUBY FROM FUNC-SUB BY 1
                    UNTIL SUBY > ARRAY-MAX
                    IF  EMP-UNDER-VRU-CONTROL (SUBY)
                    AND SCR08-ST (SUBY) NOT = 'B8'
                       MOVE SPACE TO VRUINFO-VRU-CONTROL-FLAG(SUBY)
                       IF TASK-TOPC-TRAIN-SYM NOT > SPACES
                          MOVE SPACE TO VRUINFO-REQUIRED-CC-FLAG(SUBY)
                       END-IF
                    END-IF
                 END-PERFORM
                 PERFORM P9320-REWRITE-VRUINFO
      *#1471, #1473
              ELSE
                 EXEC CICS UNLOCK
                           DATASET(VRU-INFO-FILE)
                           RESP(WS-RESPONSE)
                 END-EXEC
              END-IF
           END-IF
           .
      *
      *P5117-IVR-OUTAGE.
      *
      * DEFAULT BY USING SYSTEM DATE/TIME.
      *    MOVE WS-SYSTEM-TIME          TO PST-PS45CALL-CREW-TIME
      *    MOVE WS-SYSTEM-DATE          TO PST-PS45CALL-CREW-DATE
      *
      *    IF MSTR-EMP-PROTECT-CALL
      *       PERFORM P5119-PROTECT-CALL
      *       MOVE PARM-RES-DATE-GREG   TO PST-PS45CALL-CREW-DATE
      *       MOVE PARM-RES-HRMN        TO PST-PS45CALL-CREW-TIME
      *    ELSE
      *       IF MSTR2-CALL-TIME-OVERRIDES > SPACES
      *          IF MSTR2-CALL-OVRD-BEG <= WS-LOCAL-TIME AND
      *             MSTR2-CALL-OVRD-END >= WS-LOCAL-TIME
      *             PERFORM P5118-VERIFY-SHORT-CALL
      *             MOVE PARM-RES-DATE-GREG   TO PST-PS45CALL-CREW-DATE
      *             MOVE PARM-RES-HRMN        TO PST-PS45CALL-CREW-TIME
      *          END-IF
      *       END-IF
      *    END-IF
      *
      *    IF WS-FROM-IVR
      *       MOVE WS-FROM-IVR-ABEND-FLAG
      *                                TO PS45-FROM-IVR-ABEND-FLAG
      *       MOVE WS-FROM-IVR-INFO TO PS45-FROM-VRU-INFO
      *    END-IF
      *    SET PST-PS45IVR-NO-OUTAGE TO TRUE
      *
      *    EXEC CICS LINK
      *              PROGRAM(PS45-PGM)
      *              COMMAREA(WS-PS45-COMMAREA)
      *              LENGTH(PS45-LGTH)
      *              RESP(WS-RESPONSE)
      *    END-EXEC
      *
      *    MOVE WS-RESPONSE TO FILE-STATUS
      *    IF PS45-IVR-ABEND OR NOT SUCCESS
      *       SET WS-IVR-ABEND      TO TRUE
      *       MOVE TASKTIME  TO ERR-KEY
      *       MOVE 'P5117-2' TO ERR-PARAGRAPH
      *       IF PS45-IVR-ABEND
      *          SET WS-IVR-ABEND      TO TRUE
      *       END-IF
      *       PERFORM P9999-GOT-PROBLEM
      *    END-IF
      *
      * IF WE COME FROM MAX0EP, SET THE TASK-RECORD TO ORDER-VX AND
      * UPDATE THE VRUINFO-FILE RECORD WITH THE T6 ERROR CODE.
      * THEN RETURN TO P0EP THRU P9000-SEND.
      *    IF PST-PS45IVR-NO-OUTAGE
      *       CONTINUE
      *    ELSE
      *       PERFORM P1025-RESET-FUNC-CURSORS
      *       MOVE -1    TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *       MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *       MOVE 'SCHEDULED IVR OUTAGE ' TO
      *            SCR08-ERRORMSG
      *       SET WS-IVR-OUTAGE  TO TRUE
      *       IF PSTCA-FROM-PROGRAM = P0EP-PGM
      *          SET P08CA-ASGN-IVR-CONTROL(FUNC-SUB) TO TRUE
      *          PERFORM P5130-SET-VRUINFO-ERROR
      *          PERFORM P5120-SET-ORDER-VX
      *       END-IF
      *       PERFORM P9000-SEND-MAP-AND-RETURN
      *    END-IF.
      *
      *P5118-VERIFY-SHORT-CALL.
      *
      *----------------------------------------------------------------*
      *    CONVERT LOCAL TRAIN CALL DATE/TIME TO SYSTEM-TIME
      *----------------------------------------------------------------*
      *    MOVE SPACES              TO TZ-PARAMETERS
      *    MOVE PSTCA-TIME-ZONE     TO TZ-IN-ZONE
      *    MOVE SCR08-ORDER-DATE    TO TZ-IN-DATE
      *    MOVE SCR08-ORDER-TIME    TO TZ-IN-TIME
      *    MOVE TZ-SYSTEM-TIME-ZONE TO TZ-OUT-ZONE
      *    PERFORM P8996-TIMEZONE
      *    IF TZ-INVALID-PARAMETERS
      *       MOVE 'P5118-1'     TO ERR-PARAGRAPH
      *       PERFORM P8996-TZERROR
      *    END-IF
      *
      * EFF TIME WILL BE ON THE SYSTEM ON DUTY TIME MINUS
      * THE SC DURATION
      *
      *    MOVE ZEROS                TO DATE-CONVERSION-PARMS
      *    SET PARM-SUBTRACT         TO TRUE
      *    MOVE TZ-OUT-DATE          TO PARM-PRI-DATE-GREG
      *    MOVE TZ-OUT-TIME          TO PARM-PRI-HRMN
      *    MOVE MSTR2-CALL-OVRD-DUR  TO PARM-SEC-HRMN
      *
      *    PERFORM P9700-LINK-P903
      *    IF NOT SUCCESS
      *       MOVE 'P5118-2'            TO ERR-PARAGRAPH
      *       PERFORM P9999-GOT-PROBLEM
      *    END-IF
      *    .
      *
      *P5119-PROTECT-CALL.
      *
      *    MOVE SPACES                  TO WS-CNTL-FILE
      *    SET IVR-CALL-PROFILE-REC     TO TRUE
      *    MOVE IVR-POOL-CALL-PROFILE   TO CNTL-IVR-CALL-PROF
      *    MOVE CNTLKEY-AREA            TO CNTLKEY
      *    PERFORM P8610-READ-CNTLFILE
      *    IF NOT SUCCESS
      *       MOVE 'P5119-1'               TO ERR-PARAGRAPH
      *       MOVE CNTLKEY                 TO ERR-KEY
      *       PERFORM P9999-GOT-PROBLEM
      *    END-IF
      *
      *----------------------------------------------------------------*
      *    CONVERT LOCAL TRAIN CALL DATE/TIME TO SYSTEM-TIME
      *----------------------------------------------------------------*
      *    MOVE SPACES              TO TZ-PARAMETERS
      *    MOVE PSTCA-TIME-ZONE     TO TZ-IN-ZONE
      *    MOVE SCR08-ORDER-DATE    TO TZ-IN-DATE
      *    MOVE SCR08-ORDER-TIME    TO TZ-IN-TIME
      *    MOVE TZ-SYSTEM-TIME-ZONE TO TZ-OUT-ZONE
      *    PERFORM P8996-TIMEZONE
      *    IF TZ-INVALID-PARAMETERS
      *       MOVE 'P5119-2'     TO ERR-PARAGRAPH
      *       PERFORM P8996-TZERROR
      *    END-IF
      *
      * EFF TIME WILL BE ON THE SYSTEM ON DUTY TIME MINUS
      * THE PC DURATION
      *    MOVE ZEROES                  TO DATE-CONVERSION-PARMS
      *    SET PARM-SUBTRACT            TO TRUE
      *    MOVE TZ-OUT-DATE             TO PARM-PRI-DATE-GREG
      *    MOVE TZ-OUT-TIME             TO PARM-PRI-HRMN
      *    MOVE CNTL-IVR-CALL-WAIT-EXP  TO PARM-SEC-MN
      *    PERFORM P9700-LINK-P903
      *    IF NOT SUCCESS
      *       MOVE 'P5119-3' TO ERR-PARAGRAPH
      *       PERFORM P9999-GOT-PROBLEM
      *    END-IF
      *     .
      *
      *P5120-SET-ORDER-VX.
      *
      *    PERFORM P9300-READ-TASK-BY-STATION
      *    IF WS-TASK-FOUND
      *       MOVE TASK-LOCATION-KEY     TO TASKTIME
      *       PERFORM P8660-READ-TASK-UPD
      *       SET TASK-ORDER-VX          TO TRUE
      *       PERFORM P8666-CREATE-VX-LOG-REC
      *       MOVE SPACES TO TASK-VRU-COMMENT
      *       PERFORM P8662-REWRITE-TASK
      *    ELSE
      *
      * IF P08CA-TASK-KEY IS POPULATED, THEN A TASK WAS EXECUTED TO GET
      * INTO MAX08.  IF P9300 (ABOVE) IS NOT SUCCESSFUL, THEN A TASK WAS
      * EXECUTED FOLLOWED BY AN IMMEDIATE TRAIN SYMBOL AND/OR ORDER
      * DATE-TIME CHANGE ON PSTS08.  PASS P08CA-TASK-KEY TO MAX927 SO
      * THAT THE INITIAL TASK CAN BE DELETED.
      *
      *       PERFORM P5155-SETUP-AND-LINK-TO-927
      *    END-IF.
      *
      *P5130-SET-VRUINFO-ERROR.
      *
      *    MOVE SPACES                   TO VRUINFO-FILE
      *    MOVE TASK-TITAN-NO            TO VRUINFO-TITAN-NBR
      *    MOVE TASK-CREW-ORG            TO VRUINFO-CREW-ORG
      *    MOVE 'T6'                     TO WS-LOG-MSG-CD
      *    MOVE SCR08-CC(FUNC-SUB)       TO WS-LOG-MSG-CRAFT
      *
      *    PERFORM P9310-READ-UPDATE-VRUINFO
      *    IF SUCCESS
      *       PERFORM VARYING SUB1 FROM 1 BY 1 UNTIL
      *                          (SUB1 > VRUINFO-CC-MAX)
      *          IF VRUINFO-EMP-NBR(SUB1) = P08CA-EMP-NO(FUNC-SUB)
      *             MOVE SPACES    TO VRUINFO-IVR-CONTROL-FLAG(SUB1),
      *                               VRUINFO-CALL-STATUS-FLAG(SUB1)
      *             MOVE 'T6'      TO VRUINFO-IVR-MSG-CD(SUB1)
      *                               WS-LOG-MSG-CD
      *             MOVE VRUINFO-CC-MAX    TO SUB1
      *          END-IF
      *       END-PERFORM
      *       PERFORM P9320-REWRITE-VRUINFO
      *    ELSE
      *       EXEC CICS UNLOCK
      *                 DATASET(VRU-INFO-FILE)
      *                 RESP(WS-RESPONSE)
      *       END-EXEC
      *    END-IF
      *    .
      *
       P5150-CREATE-UPDATE-TASK.
      *
      *#1310
      *    FIRST READ VRUINFO TO SEE IF ANYONE HAS ALREADY VCLL'D
      *    IF SO, JUST UPDATE THE EXISTING TASK. NO NEED TO
      *    DELETE AND RE-ADD FOR TOPC.
      *
           MOVE SPACE                         TO WS-VRUINFO-FOUND-FLAG
           IF P08CA-TASK-KEY                > SPACES
              MOVE P08CA-TASK-KEY             TO VRUINFO-TASK-KEY
              PERFORM P9330-READ-VRUINFO
              IF SUCCESS
                 SET WS-VRUINFO-FOUND         TO TRUE
              END-IF
           END-IF

           PERFORM P9300-READ-TASK-BY-STATION
           IF WS-TASK-FOUND
           OR WS-VRUINFO-FOUND
              IF WS-VRUINFO-FOUND
                 MOVE P08CA-TASK-KEY  TO TASKTIME
                 PERFORM P8661-READ-TASK
                 IF NOT SUCCESS
                    MOVE SPACES       TO  P08CA-TASK-KEY
                    PERFORM P5155-SETUP-AND-LINK-TO-927
                    MOVE P08CA-TASK-KEY  TO TASK-LOCATION-KEY
      *             MOVE 'P5150-1'    TO ERR-PARAGRAPH
      *             MOVE TASKTIME     TO ERR-KEY
      *             PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              MOVE TASK-LOCATION-KEY          TO TASKTIME
              PERFORM P8660-READ-TASK-UPD
              IF NOT TASK-ORDER-VX
                 SET  TASK-VRU-CALL-INIT      TO TRUE
              END-IF
              MOVE SPACES                     TO TASK-VRU-COMMENT
              IF TASK-VRU-MESSAGE-CODE         = 'E3'
              OR TASK-VRU-MESSAGE-CODE         = 'E4'
                 MOVE SPACES                  TO TASK-VRU-MESSAGE-CODE
              END-IF
              MOVE 1                          TO J
      *C922
              MOVE SPACES                     TO TASK-INFO
              PERFORM VARYING SUB1 FROM 1 BY 1
                 UNTIL SUB1                    > ARRAY-MAX
                 MOVE SCR08-FUNC (SUB1)       TO WS-FUNCTION-CODE
                 IF IVR-CALL-FUNCTION
      *C922
                    IF SCR08-ST(SUB1) NOT = 'B0'
                       MOVE SCR08-CC(SUB1)       TO TASK-INFO (J:2)
                       COMPUTE J = J + 3
                    END-IF
                 END-IF
              END-PERFORM
              PERFORM P8662-REWRITE-TASK
              MOVE TASK-LOCATION-KEY          TO HOLD-TASK-KEY
      *C922   IF ANOTHER CRAFT WAS CALLED EARLIER THE
      *       AH-CALL-COMPLETE-FLAG WAS SET TO 'Y'. THIS FLAG MUST BE
      *       SET BACK TO SPACES SO THAT THE CALL SHEET LOGIC WILL BE
      *       PROCESSED FOR THE EMPLOYEE BEING CALLED IN THIS PASS.
              MOVE WS-AHIST-KEY           TO AH1KEY
              MOVE AH-FILE-VIA-K1         TO AH-DATASET
              PERFORM P8200-READ-AHIST
              IF AH-CALL-COMPLETE-FLAG     = 'Y'
                 PERFORM P8210-READ-AHIST-UPD
                 MOVE SPACES              TO AH-CALL-COMPLETE-FLAG
                                             P08CA-CALL-COMPLETE-FLAG
                 PERFORM P8220-REWRITE-AHIST
              END-IF
           ELSE
      * IF P08CA-TASK-KEY IS POPULATED, THEN A TASK WAS EXECUTED TO GET
      * INTO CNP08.  IF P9300 (ABOVE) IS NOT SUCCESSFUL, THEN A TASK WAS
      * EXECUTED FOLLOWED BY AN IMMEDIATE TRAIN SYMBOL AND/OR ORDER
      * DATE-TIME CHANGE ON PSTS08.  PASS P08CA-TASK-KEY TO CNP927 SO
      * THAT THE INITIAL TASK CAN BE DELETED.
      * 04/19 JES  CN #1254 - WE MUST MAINTAIN TOPC DATA
              IF P08CA-TASK-KEY                > SPACES
                 MOVE P08CA-TASK-KEY          TO TASKTIME
                 PERFORM P8661-READ-TASK
                 IF NOT SUCCESS
                    MOVE 'P5150-2'    TO ERR-PARAGRAPH
                    MOVE TASKTIME     TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 IF TASK-TOPC-TRAIN-SYM  > SPACES
                    MOVE SCR08-DIST           TO TASK-DIST
                    MOVE SCR08-SUB-DIST       TO TASK-SUB-DIST
                    MOVE SCR08-ORDER-DATE     TO EFF-DATE  OF WS-TASK
                                                 TASK-CALL-ORDER-DATE
                                                 TASK-TOPC-CALL-DATE
                    MOVE SCR08-ORDER-TIME     TO EFF-HR-MN OF WS-TASK
                                                 TASK-CALL-ORDER-TIME
                                                 TASK-TOPC-CALL-TIME
                    MOVE SCR08-ASGN           TO P927-TRAIN-SYM
                    MOVE SCR08-ASGN-TYPE      TO P927-TRAIN-CODE
                    MOVE P927-TRAIN           TO TASK-CALL-TRAIN2
                    IF NOT TASK-ORDER-VX
                       SET TASK-VRU-CALL-INIT    TO TRUE
                    END-IF
                    MOVE SPACES               TO TASK-VRU-COMMENT
                                                 TASK-INFO
                    IF TASK-VRU-MESSAGE-CODE   = 'E3'
                    OR TASK-VRU-MESSAGE-CODE   = 'E4'
                       MOVE SPACES            TO TASK-VRU-MESSAGE-CODE
                    END-IF
                    MOVE 1                    TO J
                    PERFORM VARYING SUB1 FROM 1 BY 1
                       UNTIL SUB1              > ARRAY-MAX
                       MOVE SCR08-FUNC (SUB1) TO WS-FUNCTION-CODE
                       IF IVR-CALL-FUNCTION
      *C922
                          IF SCR08-ST(SUB1) NOT = 'B0'
                             MOVE SCR08-CC(SUB1) TO TASK-INFO (J:2)
                             COMPUTE J = J + 3
                          END-IF
                       END-IF
                    END-PERFORM
      *             WRITE A NEW TASK WITH TOPC DATA STILL INTACT
                    PERFORM P8670-WRITE-TASK
                    MOVE TASKTIME             TO HOLD-TASK-KEY

      *             DELETE OLD TASK
                    MOVE P08CA-TASK-KEY       TO TASKTIME
                    PERFORM P8665-DELETE-TASK
      *             READ/WRITE TOC DB2 RECORD
                    INITIALIZE WS-TOC-STORAGE
                    MOVE P08CA-TASK-KEY       TO TOC-TASK-KEY
                    PERFORM PSQL-TOCSEL01
                    IF SQL-SUCCESS
                       MOVE HOLD-TASK-KEY     TO TOC-TASK-KEY
                       PERFORM PSQL-TOCINS01
                       MOVE P08CA-TASK-KEY    TO TOC-TASK-KEY
                       PERFORM PSQL-TOCDEL01
                    END-IF
      *C922   IF ANOTHER CRAFT WAS CALLED EARLIER THE
      *       AH-CALL-COMPLETE-FLAG WAS SET TO 'Y'. THIS FLAG MUST BE
      *       SET BACK TO SPACES SO THAT THE CALL SHEET LOGIC WILL BE
      *       PROCESSED FOR THE EMPLOYEE BEING CALLED IN THIS PASS.
                    IF P08CA-CALL-COMPLETE-FLAG = 'Y'
                       MOVE WS-AHIST-KEY     TO AH1KEY
                       MOVE AH-FILE-VIA-K1   TO AH-DATASET
                       PERFORM P8210-READ-AHIST-UPD
                       MOVE SPACES           TO AH-CALL-COMPLETE-FLAG
                                                P08CA-CALL-COMPLETE-FLAG
                       PERFORM P8220-REWRITE-AHIST
                    END-IF
      *#1306
                    MOVE HOLD-TASK-KEY        TO P08CA-TASK-KEY
                 ELSE
      *#1411
      *C899
      *             MOVE SPACES               TO P08CA-TASK-KEY
                    PERFORM P5155-SETUP-AND-LINK-TO-927
                 END-IF
              ELSE
                 PERFORM P5155-SETUP-AND-LINK-TO-927
              END-IF
           END-IF
           .
      *
       P5155-SETUP-AND-LINK-TO-927.
      *
           MOVE SPACES                        TO P927-COMMAREA-PARMS
           SET  P927-IVR-CALL-FUNCTION        TO TRUE
           MOVE PSTCA-TIME-ZONE               TO P927-TIME-ZONE
           MOVE SCR08-ORDER-DATE              TO P927-EFF-DATE
                                                 P927-CALL-DATE
           MOVE SCR08-ORDER-TIME              TO P927-EFF-TIME
                                                 P927-CALL-TIME
           MOVE SCR08-DIST                    TO P927-DIST
           MOVE SCR08-SUB-DIST                TO P927-SUB-DIST
           IF P08CA-TASK-KEY                   > SPACES
              MOVE P08CA-TASK-KEY             TO P927-TASK-KEY
              SET  P927-UPDATE-CALL           TO TRUE
           ELSE
              SET  P927-CREATE-CALL           TO TRUE
      *#1494
              SET  P927-CREATED-BY-IVRCALL    TO TRUE
           END-IF
           MOVE TRCN-ASGN-TYPE                TO P927-CALL-ASGN-TYPE
           MOVE SCR08-ORG-STATION             TO P927-CALL-ORG-STATION
           MOVE SCR08-ASGN                    TO P927-TRAIN-SYM
           MOVE SCR08-ASGN-TYPE               TO P927-TRAIN-CODE
           MOVE 'O'                           TO P927-CALL-TYPE
           MOVE TRCN-FORMAT-TYPE              TO P927-CALL-TRAIN-TYPE
           MOVE 1                             TO J
           PERFORM VARYING SUB1 FROM 1 BY 1
              UNTIL SUB1                       > ARRAY-MAX
              MOVE SCR08-FUNC (SUB1)          TO WS-FUNCTION-CODE
              IF IVR-CALL-FUNCTION
                 MOVE SCR08-CC(SUB1)          TO P927-CALL-INFO (J:2)
                 COMPUTE J = J + 3
              END-IF
           END-PERFORM
           MOVE 'N'                           TO TASK-TRAIN-DELAYED
           MOVE TRCN-TRAIN-ASGN               TO P927-TRCN-TRAIN-ASGN
           MOVE TRCN-FNL-STN                  TO P927-CALL-FNL-STATION
           MOVE TRCN-JOB-TYPE                 TO P927-CALL-JOB-TYPE
           IF P08CA-SAVE-CREW-RPT-LOCATION     > SPACES
             MOVE P08CA-SAVE-CREW-RPT-LOCATION TO P927-CREW-RPT-LOCATION
           END-IF
           IF P08CA-SAVE-ALLOW-VCLL-FL         > SPACES
              MOVE P08CA-SAVE-ALLOW-VCLL-FL   TO P927-ALLOW-VCLL-FL
           END-IF

      *?*  IF WS-FROM-IVR
      *?*     MOVE WS-FROM-IVR-ABEND-FLAG    TO P927-FROM-IVR-ABEND-FLAG
      *?*     MOVE WS-FROM-IVR-INFO           TO P927-FROM-VRU-INFO
      *?*  END-IF

           EXEC CICS LINK
                     PROGRAM (P927-PGM)
                     COMMAREA(P927-COMMAREA-PARMS)
                     LENGTH  (P927-LGTH)
                     RESP    (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS

           IF NOT SUCCESS
      *    OR P927-IVR-ABEND
              MOVE 'P5155-1'                  TO ERR-PARAGRAPH
              MOVE TASKTIME                   TO ERR-KEY
      *       IF P927-IVR-ABEND
      *          SET  WS-IVR-ABEND            TO TRUE
      *       END-IF
              PERFORM P9999-GOT-PROBLEM
           ELSE
      *       IF  P08CA-TASK-KEY               > SPACES
      *       AND P08CA-TASK-KEY           NOT = P927-TASK-KEY
                 MOVE P927-TASK-KEY           TO P08CA-TASK-KEY
      *       END-IF
              MOVE P927-TASK-KEY              TO HOLD-TASK-KEY

              IF P08CA-PRE-CALL-TOC-KEY > SPACES
                 INITIALIZE WS-TOC-STORAGE
                 MOVE P08CA-PRE-CALL-TOC-KEY  TO TOC-TASK-KEY
                 PERFORM PSQL-TOCSEL01
                 IF SQL-SUCCESS
                    MOVE HOLD-TASK-KEY        TO TOC-TASK-KEY
                    PERFORM PSQL-TOCINS01
                    MOVE P08CA-PRE-CALL-TOC-KEY TO TOC-TASK-KEY
                    PERFORM PSQL-TOCDEL01
                 END-IF
              END-IF
      *C922   WE ARE CREATING A NEW TASK FOR THIS IVR CALL. IF ANOTHER
      *       CRAFT WAS CALLED EARLIER THE AH-CALL-COMPLETE-FLAG WAS
      *       SET TO 'Y'. THIS FLAG MUST BE SET BACK TO SPACES SO THAT
      *       THE CALL SHEET LOGIC WILL BE PROCESSED FOR THE EMPLOYEE
      *       BEING CALLED IN THIS PASS.
              IF P08CA-CALL-COMPLETE-FLAG     = 'Y'
                 MOVE WS-AHIST-KEY           TO AH1KEY
                 MOVE AH-FILE-VIA-K1         TO AH-DATASET
                 PERFORM P8210-READ-AHIST-UPD
                 MOVE SPACES                 TO AH-CALL-COMPLETE-FLAG
                                                P08CA-CALL-COMPLETE-FLAG
                 PERFORM P8220-REWRITE-AHIST
              END-IF
      *#1475
              MOVE P08CA-TASK-KEY  TO TASKTIME
              PERFORM P8661-READ-TASK
           END-IF
           .
      *
       P5160-CREATE-UPDATE-VRU-INFO.
      *
           MOVE SPACES                        TO VRUINFO-FILE
           MOVE HOLD-TASK-KEY                 TO VRUINFO-TASK-KEY

           PERFORM P9330-READ-VRUINFO
           EVALUATE TRUE
              WHEN SUCCESS
                   PERFORM P5161-UPDATE-VRUINFO
              WHEN NO-RECORD-FND
                   PERFORM P5165-WRITE-VRUINFO
              WHEN OTHER
                   CONTINUE
           END-EVALUATE
           .
      *
       P5161-UPDATE-VRUINFO.
      *
      *    IF EMP ALREADY UNDER VRU CONTROL THEN THEY WERE
      *    VCLL'D DURING CREATION (P5165) ALONG WITH SOMEONE ELSE
      *    SO EVERYTHING IS SET (INCLUDING FULL-CREW FLAGS)
      *
           MOVE SPACE              TO WS-FULL-CREW-MQ-FL
           IF EMP-UNDER-VRU-CONTROL(FUNC-SUB)
              IF VRUINFO-FULL-CREW-VAL(FUNC-SUB) > SPACE
              AND WS-FULL-CREW-VAL-MQ(FUNC-SUB)  = 'N'
                 SET WS-FULL-CREW-NOT-MQ   TO TRUE
              END-IF
              PERFORM P9310-READ-UPDATE-VRUINFO
              PERFORM P5169-SET-REQUIRED-CRAFTS
              PERFORM P9320-REWRITE-VRUINFO
              PERFORM P5165A-UPDATE-AHM3
              PERFORM P5169B-CHECK-FOR-CALL-COMPLETE
           ELSE
              PERFORM P9310-READ-UPDATE-VRUINFO
      *       WE HAVE A NEW VCLL OR GROUP OF VCLLS/CALLS
              MOVE SPACES          TO WS-FULL-CREW-VAL-TABLE
              MOVE SCR08-FUNC(FUNC-SUB)   TO WS-FUNCTION-CODE
              MOVE SCR08-CC(FUNC-SUB)     TO VRUINFO-CRAFT    (FUNC-SUB)
              IF IVR-CALL-FUNCTION
              OR CALL-FUNCTION
                 MOVE P08CA-EMP-NO(FUNC-SUB)
                                          TO VRUINFO-EMP-NBR  (FUNC-SUB)
                 MOVE P08CA-DEC-KEY(FUNC-SUB)
                                       TO VRUINFO-DECISION-KEY(FUNC-SUB)
              END-IF
              IF IVR-CALL-FUNCTION
                 SET  EMP-UNDER-VRU-CONTROL(FUNC-SUB) TO TRUE
                 MOVE SPACES       TO VRUINFO-CALL-STATUS-FLAG(FUNC-SUB)
      *          IF SHORT CALL, SET VRUINFO STATUS TO VRU-SHORT-CALL
                 IF P08CA-SAVE-CBCK-FLAG(FUNC-SUB) = 'Y'
                    SET VRU-SHORT-CALLED(FUNC-SUB)  TO TRUE
                 END-IF
              ELSE
                 SET  CMA-CALL-SUCCESSFUL  (FUNC-SUB) TO TRUE
              END-IF
              MOVE SPACES                 TO WS-SAVE-FCLTY-CD
              MOVE FUNC-SUB               TO SUB1
              IF PS52-USE-PH-NBR-ON-FILE-FL NOT = 'Y'
                 PERFORM P5162-CHECK-FULL-CREW-FL
              END-IF
              IF WS-SAVE-FCLTY-CD > SPACES
                 MOVE VRUINFO-FULL-CREW-VAL(FUNC-SUB)
                                   TO WS-FULL-CREW-VAL-TBL(FUNC-SUB)
              END-IF
      *       NOW CHECK REST OF CREW FOR ALREADY CALLED OR ANOTHER NEW
      *       VCLL/CALL
              PERFORM VARYING SUB1 FROM 1 BY 1
                 UNTIL SUB1 > ARRAY-MAX
                 IF SUB1        NOT = FUNC-SUB
                    IF EMP-UNDER-VRU-CONTROL(SUB1)
                    OR VRUINFO-CALL-STATUS-FLAG(SUB1) > SPACE
      *                THIS EMP WAS PROCESSED ON A PREVIOUS PASS
                       CONTINUE
                    ELSE
      *#1461,#1462,#1468
                       IF P08CA-EMP-NO(SUB1)   > SPACES
                         MOVE SCR08-FUNC (SUB1)     TO WS-FUNCTION-CODE
                         IF IVR-CALL-FUNCTION
                            MOVE P08CA-EMP-NO(SUB1)
                                     TO VRUINFO-EMP-NBR(SUB1)
                            MOVE SCR08-CC(SUB1)
                                     TO VRUINFO-CRAFT(SUB1)
                            SET EMP-UNDER-VRU-CONTROL(SUB1) TO TRUE
                            MOVE SPACES
                                     TO VRUINFO-CALL-STATUS-FLAG(SUB1)
      *                     IF SHORT CALL, SET VRUINFO STATUS
      *                     TO VRU-SHORT-CALL
                            IF P08CA-SAVE-CBCK-FLAG(SUB1) = 'Y'
                               SET VRU-SHORT-CALLED(SUB1) TO TRUE
                            END-IF
                            MOVE SPACES        TO WS-SAVE-FCLTY-CD
      *                     READ TELE VIA PS52
                            MOVE SPACES        TO PS52-COMMAREA-PARMS
                            MOVE P08CA-EMP-NO(SUB1) TO PS52-EMP-NBR
                            SET PS52-CMA-MODE    TO TRUE
                            SET PS52-DISPLAY-ONLY   TO TRUE
                            MOVE WS-LOCAL-DATE-TIME
                                                 TO PS52-INPUT-DATE-TIME
                            PERFORM P8800-LINK-TO-PS52
                            IF SUCCESS
                            AND PS52-USE-PH-NBR-ON-FILE-FL = 'Y'
                               CONTINUE
                            ELSE
                               PERFORM P5162-CHECK-FULL-CREW-FL
                            END-IF
                            IF WS-SAVE-FCLTY-CD > SPACES
                               MOVE VRUINFO-FULL-CREW-VAL(SUB1)
                                     TO WS-FULL-CREW-VAL-TBL(SUB1)
                            END-IF
                         ELSE
                            MOVE SCR08-CC(SUB1)
                                     TO VRUINFO-CRAFT(SUB1)
                            IF P08CA-EMP-NO(SUB1)       > SPACES
                               MOVE P08CA-EMP-NO(SUB1)
                                     TO VRUINFO-EMP-NBR(SUB1)
                            END-IF
                            IF CALL-FUNCTION
                            OR VACATE-FUNCTION
                               SET CMA-CALL-SUCCESSFUL(SUB1)  TO TRUE
                            END-IF
                         END-IF
                         MOVE P08CA-DEC-KEY(SUB1)
                                           TO VRUINFO-DECISION-KEY(SUB1)
                       END-IF
                    END-IF
                 END-IF
              END-PERFORM
      *   LOOK FOR DUPLICATE EMP IN ANOTHER CRAFT AND BLANK OUT
              PERFORM VARYING SUB1 FROM 1 BY 1
                 UNTIL SUB1               > ARRAY-MAX
                 IF  P08CA-EMP-NO(SUB1)   > SPACES
                 AND VRUINFO-CRAFT(SUB1)  > SPACES
                 AND SUB1             NOT = FUNC-SUB
                 AND P08CA-EMP-NO(SUB1)   = P08CA-EMP-NO(FUNC-SUB)
                    MOVE SPACES  TO VRUINFO-EMP-NBR         (SUB1)
                                    VRUINFO-VRU-CONTROL-FLAG(SUB1)
                                    VRUINFO-DECISION-KEY    (SUB1)
                                    VRUINFO-VRU-MSG-CD      (SUB1)
                                    VRUINFO-FULL-CREW-VAL   (SUB1)
                                    VRUINFO-FULL-CREW-GRP   (SUB1)
                 END-IF
              END-PERFORM
      *   SET OTHER EMPS, BUT NOT DUPLICATE EMPLOYEE
              PERFORM VARYING SUB1 FROM 1 BY 1
                 UNTIL SUB1               > ARRAY-MAX
                 IF  P08CA-EMP-NO(SUB1)   > SPACES
                 AND VRUINFO-CRAFT(SUB1)  > SPACES
                 AND SUB1             NOT = FUNC-SUB
                 AND P08CA-EMP-NO(SUB1)
                                      NOT  = P08CA-EMP-NO(FUNC-SUB)
                    MOVE P08CA-EMP-NO(SUB1)
                                         TO VRUINFO-EMP-NBR(SUB1)
                 END-IF
              END-PERFORM
      *   IF FULL-CREW-ACCEPT, DECIDE WHO DOES NOT MQ
              IF WS-FULL-CREW-VAL-TABLE > SPACES
                 PERFORM VARYING SUB1 FROM 1 BY 1
                    UNTIL SUB1               > ARRAY-MAX
                    IF  VRUINFO-FULL-CREW-GRP(SUB1) > SPACE
                    AND VRUINFO-FULL-CREW-GRP(SUB1) > WS-HIGHEST-GRP
                       MOVE VRUINFO-FULL-CREW-GRP(SUB1)
                                             TO WS-HIGHEST-GRP
                    END-IF
                 END-PERFORM
                 IF WS-HIGHEST-GRP NOT > SPACE
                    MOVE ZERO        TO WS-HIGHEST-GRP-NUM
                 END-IF
                 ADD 1 TO WS-HIGHEST-GRP-NUM
                 PERFORM VARYING SUB1 FROM 1 BY 1
                    UNTIL SUB1               > ARRAY-MAX
                    IF  WS-FULL-CREW-VAL-TBL(SUB1) > SPACE
                    AND WS-FULL-CREW-VAL-MQ (SUB1) = SPACE
                       MOVE WS-HIGHEST-GRP
                               TO VRUINFO-FULL-CREW-GRP(SUB1)
      *                CHECK THE REST FOR = FULL-CREW VAL (FACILITY)
                       IF SUB1 < 7
                          COMPUTE SUB3 = SUB1 + 1
                          PERFORM VARYING SUB2 FROM SUB3 BY 1
                             UNTIL SUB2 > ARRAY-MAX
                             IF  WS-FULL-CREW-VAL-TBL(SUB2)
                               = WS-FULL-CREW-VAL-TBL(SUB1)
                                MOVE 'N' TO WS-FULL-CREW-VAL-MQ(SUB2)
                                MOVE VRUINFO-FULL-CREW-GRP(SUB1)
                                  TO VRUINFO-FULL-CREW-GRP(SUB2)
                             END-IF
                          END-PERFORM
                       END-IF
                       ADD 1 TO WS-HIGHEST-GRP-NUM
                    END-IF
                 END-PERFORM
              END-IF
              PERFORM P5169-SET-REQUIRED-CRAFTS

      *#1310
              IF WS-AHIST-KEY > SPACES
                 MOVE WS-AHIST-KEY       TO VRUINFO-AHIST-KEY
              END-IF

              PERFORM P9320-REWRITE-VRUINFO

              PERFORM P5165A-UPDATE-AHM3

              PERFORM P5169B-CHECK-FOR-CALL-COMPLETE
           END-IF
           .
      *
       P5162-CHECK-FULL-CREW-FL.
      *
           MOVE SPACES                   TO WS-SAVE-FCLTY-CD
           INITIALIZE WS-LVE-TABLE
           MOVE P08CA-EMP-NO(SUB1)       TO LVE-EMP-NBR
           PERFORM PSQL-LVESEL01
           IF SQL-SUCCESS
              IF LVE-FCLTY-CD             > SPACES
                 INITIALIZE WS-LVP-TABLE
                 MOVE LVE-LDG-STN        TO LVP-LDG-STN
                 MOVE LVE-FCLTY-CD       TO LVP-FCLTY-CD
                 PERFORM PSQL-LVPSEL08
                 IF SQL-SUCCESS
                    IF LVP-FULL-CREW-ACCPT-FL = 'Y'
                       MOVE LVP-FCLTY-CD TO WS-SAVE-FCLTY-CD
                       PERFORM P5163-FIND-FCLTY-VAL
                    END-IF
                 END-IF
              END-IF
           END-IF
           .
      *
       P5163-FIND-FCLTY-VAL.
      *
           MOVE ZEROES                     TO WS-FCLTY-VAL
      *    FIRST SEARCH ALL EXISTING FACILITY VALUES
           PERFORM VARYING SUBY FROM 1 BY 1
              UNTIL SUBY > ARRAY-MAX
              IF SUBY NOT = SUB1
                 IF VRUINFO-FULL-CREW-VAL(SUBY) > SPACE
                    IF VRUINFO-FULL-CREW-VAL(SUBY) >  WS-FCLTY-VAL-X
                       MOVE VRUINFO-FULL-CREW-VAL(SUBY)
                                                     TO WS-FCLTY-VAL-X
                    END-IF
      *             WHAT IS THE FACILITY CODE
                    INITIALIZE WS-LVE-TABLE
                    MOVE P08CA-EMP-NO(SUBY)   TO LVE-EMP-NBR
                    PERFORM PSQL-LVESEL01
                    IF SQL-SUCCESS
                       IF LVE-FCLTY-CD = WS-SAVE-FCLTY-CD
                          MOVE VRUINFO-FULL-CREW-VAL(SUBY)
                            TO VRUINFO-FULL-CREW-VAL(SUB1)
                          MOVE ARRAY-MAX      TO SUBY
                       END-IF
                    END-IF
                 END-IF
              END-IF
           END-PERFORM
      *    IF NO EXISTING FACILITY CODES, ADD 1 FOR VALUE
           IF VRUINFO-FULL-CREW-VAL(SUB1) NOT > SPACE
              ADD 1 TO WS-FCLTY-VAL
              MOVE WS-FCLTY-VAL-X
                               TO VRUINFO-FULL-CREW-VAL(SUB1)
           END-IF
           .
      *
       P5165-WRITE-VRUINFO.
      *
      *    WE ARE HERE FOR THE FIRST VCLL ON THE 08 SCREEN FOR THIS PASS
      *    BUT WE ARE PROCESSING ALL CREW TO BUILD VRUINFO
      *
           MOVE SPACES                        TO VRUINFO-FILE
           MOVE HOLD-TASK-KEY                 TO VRUINFO-TASK-KEY
           MOVE HOLD-TASK-KEY(1:14)           TO VRUINFO-EFF-DTTM-CE

           PERFORM VARYING SUB1 FROM 1 BY 1
              UNTIL SUB1                    > ARRAY-MAX
              IF SCR08-CC(SUB1) > SPACES
                 MOVE SCR08-CC(SUB1)         TO VRUINFO-CRAFT  (SUB1)
              END-IF
              MOVE SPACE                     TO WS-VRUINFO-DUP-FL
              IF P08CA-EMP-NO(SUB1) > SPACES
              AND SUB1 > 1
      *#1461,#1462,#1468
      *          LOOK FOR DUPLICATE EMP IN ANOTHER CRAFT
                 PERFORM P5166-CHECK-VRUINFO-DUPS
              END-IF
              IF WS-VRUINFO-DUP
              OR P08CA-EMP-NO(SUB1) NOT > SPACES
                 MOVE SPACES                 TO SCR08-FUNC (SUB1)
              ELSE
                MOVE SCR08-FUNC (SUB1)       TO WS-FUNCTION-CODE
                IF IVR-CALL-FUNCTION
                   MOVE P08CA-EMP-NO(SUB1)   TO VRUINFO-EMP-NBR(SUB1)
                   MOVE SCR08-CC(SUB1)       TO VRUINFO-CRAFT  (SUB1)
      *COURTESY - BEG
      **** NON-REQ'D CRAFTS SET TO UNDER-VRU-CNTL WHEN ALREADY CALLED
      **** SUCCESSFULLY AND IN B0 STATUS. NEED TO VALIDATE BEFORE SET
      **** TO UNDER-VRU-CONTROL IN CASES WHEN OTHER CRAFTS ARE BEING
      **** VCLL'D SUBSEQENT TIMES FOLLOWING AN IVR XFER/RELEASE AND
      **** WE ARE HERE NOT FOR THE FIRST VCLL PASS...
      ***          SET EMP-UNDER-VRU-CONTROL(SUB1) TO TRUE
                   IF (P08CA-ASGN-SET(SUB1)
                   AND SCR08-ST(SUB1) = 'B0')
                      MOVE SPACE TO VRUINFO-VRU-CONTROL-FLAG(SUB1)
                   ELSE
                      SET EMP-UNDER-VRU-CONTROL(SUB1) TO TRUE
                   END-IF
      *COURTESY - END
                   MOVE ZEROES               TO WS-FCLTY-VAL
      *            READ TELE VIA PS52
                   MOVE SPACES                   TO PS52-COMMAREA-PARMS
                   MOVE P08CA-EMP-NO(SUB1)            TO PS52-EMP-NBR
                   SET PS52-CMA-MODE               TO TRUE
                   SET PS52-DISPLAY-ONLY              TO TRUE
                   MOVE WS-LOCAL-DATE-TIME
                                          TO PS52-INPUT-DATE-TIME
                   PERFORM P8800-LINK-TO-PS52
                   IF  SUCCESS
                   AND PS52-USE-PH-NBR-ON-FILE-FL = 'Y'
                      CONTINUE
                   ELSE
                      PERFORM P5167-CHECK-FULL-CREW-FL
                   END-IF
                   IF WS-FCLTY-VAL > 0
                     MOVE WS-FCLTY-VAL-X TO VRUINFO-FULL-CREW-VAL(SUB1)
                                            WS-FULL-CREW-VAL-TBL (SUB1)
                     MOVE WS-FCLTY-VAL-X TO VRUINFO-FULL-CREW-GRP(SUB1)
                   END-IF
                   MOVE P08CA-DEC-KEY(SUB1)
                                          TO VRUINFO-DECISION-KEY(SUB1)
      *            IF SHORT CALL, SET VRUINFO STATUS TO VRU-SHORT-CALL
                   IF P08CA-SAVE-CBCK-FLAG(SUB1) = 'Y'
                      SET VRU-SHORT-CALLED(SUB1)  TO TRUE
                   END-IF
                ELSE
                   IF P08CA-EMP-NO(SUB1)         > SPACES
                      IF CALL-FUNCTION
                         MOVE P08CA-EMP-NO(SUB1)
                                                TO VRUINFO-EMP-NBR(SUB1)
                         MOVE SCR08-CC(SUB1)      TO VRUINFO-CRAFT(SUB1)
                         SET  CMA-CALL-SUCCESSFUL(SUB1)   TO TRUE
                         MOVE P08CA-DEC-KEY(SUB1)
                                           TO VRUINFO-DECISION-KEY(SUB1)
      *               ELSE
      *                  LOOK FOR DUPLICATE EMP IN ANOTHER CRAFT
      *                  MOVE SPACE               TO WS-VRUINFO-DUP-FL
      *                  PERFORM P5166-CHECK-VRUINFO-DUPS
      *                  IF WS-VRUINFO-DUP
      *                     CONTINUE
      *                  ELSE
      *                     MOVE P08CA-EMP-NO(SUB1)
      *                                         TO VRUINFO-EMP-NBR(SUB1)
      *                     MOVE SCR08-CC(SUB1)   TO VRUINFO-CRAFT(SUB1)
      *                  END-IF
                      END-IF
                   END-IF
                   IF VACATE-FUNCTION
                      MOVE SCR08-CC(SUB1)         TO VRUINFO-CRAFT(SUB1)
                      SET  CMA-CALL-SUCCESSFUL(SUB1)   TO TRUE
                   END-IF
                END-IF
                MOVE SCR08-DIST                 TO VRUINFO-XFER-DD(SUB1)
                MOVE SCR08-SUB-DIST             TO VRUINFO-XFER-SD(SUB1)
              END-IF
           END-PERFORM

      *    IF FULL-CREW-ACCEPT, DECIDE WHO DOES NOT MQ
           IF WS-FULL-CREW-VAL-TABLE > SPACES
              PERFORM VARYING SUB1 FROM 1 BY 1
                 UNTIL SUB1  > ARRAY-MAX
                 IF  WS-FULL-CREW-VAL-TBL(SUB1) > SPACE
                 AND WS-FULL-CREW-VAL-MQ (SUB1) = SPACE
                 AND SUB1 < 7
      *             CHECK THE REST FOR = FULL-CREW VAL (FACILITY)
                    COMPUTE SUB3 = SUB1 + 1
                    PERFORM VARYING SUB2 FROM SUB3 BY 1
                       UNTIL SUB2 > ARRAY-MAX
                       IF  WS-FULL-CREW-VAL-TBL(SUB2)
                         = WS-FULL-CREW-VAL-TBL(SUB1)
                          MOVE 'N' TO WS-FULL-CREW-VAL-MQ(SUB2)
                       END-IF
                    END-PERFORM
                 END-IF
              END-PERFORM
           END-IF

           MOVE WS-AHIST-KEY                  TO VRUINFO-AHIST-KEY

           PERFORM P5169-SET-REQUIRED-CRAFTS

           EXEC CICS WRITE
                     DATASET(VRU-INFO-FILE)
                     FROM   (VRUINFO-FILE)
                     LENGTH (VRU-INFO-TERM-RLGTH)
                     RIDFLD (VRUINFOKEY)
                     RESP   (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                 TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P5165-1'                TO ERR-PARAGRAPH
              MOVE VRUINFOKEY               TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE SCR08-FUNC(FUNC-SUB)        TO WS-FUNCTION-CODE
           PERFORM P5165A-UPDATE-AHM3
           PERFORM P5169B-CHECK-FOR-CALL-COMPLETE
           .
      *
       P5165A-UPDATE-AHM3.
      *
           MOVE WS-AHIST-KEY                TO AHM-AHIST-KEY
           IF AHM-DIST        NOT = SCR08-DIST
           OR AHM-SUB-DIST    NOT = SCR08-SUB-DIST
              MOVE SPACES                TO WORK-CNTLKEY
              MOVE '02'                  TO WK-CNTL-REC-TYPE
              MOVE AHM-DIST              TO WK-CNTL-DIST
              MOVE AHM-SUB-DIST          TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P6165A'           TO ERR-PARAGRAPH
                 MOVE CNTLKEY            TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE SPACES                TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE        TO TZ-OUT-ZONE
              MOVE PSTCA-TIME-ZONE       TO TZ-IN-ZONE
              MOVE WS-CALL-DATE-TIME     TO TZ-IN-DATE-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '000025'           TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME      TO AHM-EMP-OD-DATE-TIME
           ELSE
              MOVE SCR08-ORDER-DATE      TO AHM-EFF-DATE
              MOVE SCR08-ORDER-TIME      TO AHMK1-EFF-TIME
              MOVE WS-CALL-DATE-TIME     TO AHM-EMP-OD-DATE-TIME
           END-IF
           SET AHM-EMPLOYEE-RECORD-3        TO TRUE
           SET CT-IND                       TO 1
           SEARCH CRAFT-CODE-TABLE VARYING CT-IND
              AT END CONTINUE
                 MOVE '99'                  TO AHM-CRAFT-SEQ
              WHEN CT-CRAFT-CODE(CT-IND) = SCR08-CC(FUNC-SUB)
                 MOVE CT-CRAFT-SEQ(CT-IND)
                                            TO AHM-CRAFT-SEQ
      *    MOVE WS-CALL-DATE-TIME           TO AHM-EMP-OD-DATE-TIME
           MOVE AHM-KEY                     TO AHMKEY
           PERFORM P8810-READ-AHM
           IF SUCCESS
              PERFORM P8820-READ-AHM-UPDATE
              MOVE VRUINFO-TASK-KEY         TO AHM3-VRUINFO-TASK-KEY
              PERFORM P8830-REWRITE-AHM
           ELSE
              MOVE SPACES                TO AHIST-EMPLOYEE-DATA-3
              MOVE VRUINFO-TASK-KEY      TO AHM3-VRUINFO-TASK-KEY
              PERFORM P8835-WRITE-AHM
           END-IF
           .
      *
       P5166-CHECK-VRUINFO-DUPS.
      *
           PERFORM VARYING SUB2 FROM 1 BY 1
              UNTIL SUB2 >= SUB1
              IF P08CA-EMP-NO(SUB1) = P08CA-EMP-NO(SUB2)
                 SET WS-VRUINFO-DUP      TO TRUE
                 MOVE SUB1               TO SUB2
              END-IF
           END-PERFORM
           .
      *
       P5167-CHECK-FULL-CREW-FL.
      *
           INITIALIZE WS-LVE-TABLE
           MOVE P08CA-EMP-NO(SUB1)       TO LVE-EMP-NBR
           PERFORM PSQL-LVESEL01
           IF SQL-SUCCESS
              IF LVE-FCLTY-CD             > SPACES
                 INITIALIZE WS-LVP-TABLE
                 MOVE LVE-LDG-STN        TO LVP-LDG-STN
                 MOVE LVE-FCLTY-CD       TO LVP-FCLTY-CD
                 PERFORM PSQL-LVPSEL08
                 IF SQL-SUCCESS
                    IF LVP-FULL-CREW-ACCPT-FL = 'Y'
                       PERFORM P5168-FIND-FCLTY-VAL
                 END-IF
              END-IF
           END-IF
           .
      *
       P5168-FIND-FCLTY-VAL.
      *
           PERFORM VARYING SUBY FROM 1 BY 1
              UNTIL SUBY > ARRAY-MAX
              IF WS-FCLTY-CD(SUBY) = SPACES
                 MOVE LVP-FCLTY-CD TO WS-FCLTY-CD(SUBY)
                 MOVE SUBY         TO WS-FCLTY-VAL
                 MOVE ARRAY-MAX    TO SUBY
              ELSE
                 IF LVP-FCLTY-CD = WS-FCLTY-CD(SUBY)
                    MOVE SUBY      TO WS-FCLTY-VAL
                    MOVE ARRAY-MAX TO SUBY
                 END-IF
              END-IF
           END-PERFORM
           .
      *
       P5169-SET-REQUIRED-CRAFTS.
      *
           IF TASK-TOPC-TRAIN-SYM > SPACES
              PERFORM VARYING POS-SUB         FROM 1 BY 1
                 UNTIL POS-SUB                   > WS-POS-MAX
                 IF TASK-CALL-TOPC-POS(POS-SUB) <= SPACES
                    MOVE WS-POS-MAX             TO POS-SUB
                    MOVE SPACES                 TO WS-TOPC-POS
                 ELSE
                    MOVE TASK-CALL-TOPC-POS(POS-SUB)
                                                TO WS-TOPC-POS
                    PERFORM P6140-CAPITALIZE-CRAFT
                    IF WS-TOPC-POS = 'PI'
      *                WE ARE SETTING THE CRAFT WE ARE PROCESSING THE
      *                VCLL FOR TO REQUIRED FOR PI - BEST GUESS WE HAVE
      *                RIGHT NOW.
                       SET VRU-REQUIRED-CRAFT(FUNC-SUB) TO TRUE
                    ELSE
                       PERFORM VARYING SUB1 FROM 1 BY 1
                          UNTIL SUB1            > ARRAY-MAX
                          IF WS-TOPC-POS     = VRUINFO-CRAFT(SUB1)
      *C922
                             IF VRUINFO-EMP-NBR(SUB1) > SPACES
                                MOVE SPACES                TO WS-MSTR
                                MOVE VRUINFO-EMP-NBR(SUB1) TO MSTRNBRK
                                PERFORM P8505-READ-MASTER-ONLY
                                IF SUCCESS
                                   IF LAYOFF-CODE NOT = 'B0'
                                      SET VRU-REQUIRED-CRAFT(SUB1)
                                                          TO TRUE
                                      MOVE ARRAY-MAX      TO SUB1
      *C922
                                   ELSE
                                      MOVE SPACES         TO
                                          VRUINFO-VRU-CONTROL-FLAG(SUB1)
                                   END-IF
                                END-IF
                             ELSE
                                SET VRU-REQUIRED-CRAFT(SUB1) TO TRUE
                                MOVE ARRAY-MAX      TO SUB1
                             END-IF
                          END-IF
                       END-PERFORM
                    END-IF
                 END-IF
              END-PERFORM
      *       ANY ADDITIONAL CRAFTS OUTSIDE OF WHAT TOPC SENDS US NEEDS
      *       TO BE SET TO REQUIRED - FUNC-SUB = THE LINE BEING VCLL'D.
              SET VRU-REQUIRED-CRAFT(FUNC-SUB) TO TRUE
           ELSE
              IF YARD-CALL OR LOCAL-CALL
                 PERFORM VARYING SUB1 FROM 1 BY 1
                    UNTIL SUB1                  > ARRAY-MAX
                    IF P08CA-EMP-NO(SUB1) > SPACES
                    OR P08CA-ASGN-IS-VCNY(SUB1)
                    OR P08CA-ASGN-IS-BOTH(SUB1)
                       SET VRU-REQUIRED-CRAFT(SUB1) TO TRUE
                    END-IF
                 END-PERFORM
              ELSE
                 PERFORM VARYING SUB1 FROM 1 BY 1
                    UNTIL SUB1            > ARRAY-MAX
                    MOVE SCR08-FUNC (SUB1)   TO WS-FUNCTION-CODE
                    IF  IVR-CALL-FUNCTION
                    OR  CALL-FUNCTION
      *C922
                       IF SCR08-ST(SUB1) NOT = 'B0'
                          SET VRU-REQUIRED-CRAFT(SUB1) TO TRUE
      *C922
                       ELSE
                          MOVE SPACES TO VRUINFO-VRU-CONTROL-FLAG(SUB1)
                       END-IF
                    END-IF
                 END-PERFORM
              END-IF
           END-IF

      *    ELSE
      *       MOVE SPACES                   TO WS-CNTL-FILE
      *       SET POOL-TYPE-REC             TO TRUE
      *       MOVE 'F'                      TO CNTL-POOL-TYPE
      *       IF TRCN-EN-FROM-DIST           > SPACES
      *          MOVE TRCN-EN-FROM-DIST     TO CNTL-DIST
      *          MOVE TRCN-EN-FROM-SDIST    TO CNTL-SUB-DIST
      *          MOVE TRCN-EN-FROM-POOL     TO CNTL-POOL-CODE
      *       ELSE
      *          MOVE TRCN-TR-FROM-DIST     TO CNTL-DIST
      *          MOVE TRCN-TR-FROM-SDIST    TO CNTL-SUB-DIST
      *          MOVE TRCN-TR-FROM-POOL     TO CNTL-POOL-CODE
      *       END-IF
      *       MOVE CNTLKEY-AREA             TO WORK-CNTLKEY
      *       PERFORM P8610-READ-CNTLFILE
      *       IF NOT SUCCESS
      *          MOVE 'P5169-1'             TO ERR-PARAGRAPH
      *          MOVE CNTLKEY               TO ERR-KEY
      *          PERFORM P9999-GOT-PROBLEM
      *       END-IF
      *       MOVE CNTL-POOL-EN-CRAFT       TO WS-CRAFT-REQUIRED-FL(1)
      *       MOVE CNTL-POOL-FI-CRAFT       TO WS-CRAFT-REQUIRED-FL(2)
      *       MOVE CNTL-POOL-CO-CRAFT       TO WS-CRAFT-REQUIRED-FL(3)
      *       MOVE CNTL-POOL-B1-CRAFT       TO WS-CRAFT-REQUIRED-FL(4)
      *       MOVE CNTL-POOL-B2-CRAFT       TO WS-CRAFT-REQUIRED-FL(5)
      *       MOVE CNTL-POOL-SE-CRAFT       TO WS-CRAFT-REQUIRED-FL(6)
      *       MOVE CNTL-POOL-BG-CRAFT       TO WS-CRAFT-REQUIRED-FL(7)
      *       MOVE CNTL-POOL-AC-CRAFT       TO WS-CRAFT-REQUIRED-FL(8)
      *       MOVE SPACES                   TO WS-CRAFT-REQUIRED-FL(9)
      *                                        WS-CRAFT-REQUIRED-FL(10)

      **   FOLLOWING CRAFTS CORRESPOND TO CRAFTS ON POOL CONTROL TABLE

      *       MOVE 'EN'                     TO WS-CRAFT-CODE(1)
      *       MOVE 'FI'                     TO WS-CRAFT-CODE(2)
      *       MOVE 'CO'                     TO WS-CRAFT-CODE(3)
      *       MOVE 'B1'                     TO WS-CRAFT-CODE(4)
      *       MOVE 'B2'                     TO WS-CRAFT-CODE(5)
      *       MOVE 'SE'                     TO WS-CRAFT-CODE(6)
      *       MOVE 'BG'                     TO WS-CRAFT-CODE(7)
      *       MOVE 'AC'                     TO WS-CRAFT-CODE(8)
      *       MOVE SPACES                   TO WS-CRAFT-CODE(9)
      *                                        WS-CRAFT-CODE(10)

      *       PERFORM VARYING SUB1 FROM 1 BY 1
      *          UNTIL SUB1                  > ARRAY-MAX
      *          IF VRUINFO-CRAFT(SUB1)      > SPACES
      *             PERFORM VARYING SUB2 FROM 1 BY 1
      *                UNTIL SUB2               > CRAFT-ARRAY-MAX
      *                IF WS-CRAFT-CODE(SUB2)   = VRUINFO-CRAFT(SUB1)
      *                   IF WS-CRAFT-REQUIRED(SUB2)
      *                      SET VRU-REQUIRED-CRAFT(SUB1) TO TRUE
      *                   END-IF
      *                   MOVE CRAFT-ARRAY-MAX TO SUB2
      *                END-IF
      *             END-PERFORM
      *          END-IF
      *       END-PERFORM
      *    END-IF
           .
      *=================================================================
       P5169B-CHECK-FOR-CALL-COMPLETE.
      *=================================================================
      *    ONLY LOOKING FOR IVR SHORT CALLS OR CD-CALLS
      *    WITH NO OTHER REGULAR IVR-CALLS
           MOVE P08CA-TASK-KEY             TO VRUINFO-TASK-KEY
           PERFORM P9330-READ-VRUINFO
           IF SUCCESS
              MOVE +0               TO CNT-REQUIRED-CRAFT
                                       CNT-SHORT-CALLED
                                       CNT-VRU-UNSUCCESSFUL
                                       CNT-CMA-NOT-CALLED
                                       CNT-CALL-SUCCESS
                                       CNT-AHM
              PERFORM VARYING VRUINFO-CC-SUB FROM 1 BY 1
                 UNTIL VRUINFO-CC-SUB > VRUINFO-CC-MAX
                 IF VRU-REQUIRED-CRAFT(VRUINFO-CC-SUB)
                    ADD +1      TO CNT-REQUIRED-CRAFT
                 END-IF
                 IF VRU-SHORT-CALLED(VRUINFO-CC-SUB)
                          ADD +1      TO CNT-SHORT-CALLED
                 END-IF
                 IF CMA-CALL-SUCCESSFUL(VRUINFO-CC-SUB)
                 OR VRU-CALL-SUCCESSFUL(VRUINFO-CC-SUB)
                          ADD +1      TO CNT-CALL-SUCCESS
                 END-IF
                 IF VRU-CALL-UNSUCCESSFUL(VRUINFO-CC-SUB)
                    ADD +1      TO CNT-VRU-UNSUCCESSFUL
                 END-IF
                 IF VRU-REQUIRED-CRAFT(VRUINFO-CC-SUB)
                    IF NOT EMP-UNDER-VRU-CONTROL(VRUINFO-CC-SUB)
                    AND NO-CALL-ATTMPT-MADE(VRUINFO-CC-SUB)
                       ADD +1   TO CNT-CMA-NOT-CALLED
                    END-IF
                 END-IF
              END-PERFORM

              IF CNT-REQUIRED-CRAFT = (CNT-SHORT-CALLED
                                    +  CNT-CALL-SUCCESS)
              AND CNT-CMA-NOT-CALLED NOT > +0
      *          ONLY WANT TO DO CALL SHEET IF THIS IS THE LAST CREW
      *          MEMBER BEING PROCESSED
                 MOVE SPACES               TO AHM-KEY
                 MOVE WS-AHIST-KEY   TO AHM-AHIST-KEY
                 SET AHM-EMPLOYEE-RECORD TO TRUE
                 MOVE AHM-KEY        TO AHMKEY
                 MOVE AHM-FILE       TO AHM-DATASET
                 EXEC CICS STARTBR
                           DATASET(AHM-DATASET)
                           RIDFLD(AHMKEY)
                           GTEQ
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE    TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P5169B-1'  TO ERR-PARAGRAPH
                    MOVE AHMKEY      TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE SPACE          TO WS-AHM-DONE-FLAG
                 PERFORM UNTIL WS-AHM-DONE
                    EXEC CICS READNEXT
                              DATASET(AHM-DATASET)
                              INTO(WS-AHIST-MISC)
                              LENGTH(AHM-RLGTH)
                              RIDFLD(AHMKEY)
                              KEYLENGTH(AHM-KLGTH)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE TO FILE-STATUS
                    IF SUCCESS
                       IF AHM-AHIST-KEY = WS-AHIST-KEY
                          AND AHM-EMPLOYEE-RECORD
                          ADD +1              TO CNT-AHM
                       ELSE
                          SET WS-AHM-DONE TO TRUE
                       END-IF
                    ELSE
                       SET WS-AHM-DONE TO TRUE
                    END-IF
                 END-PERFORM
                 EXEC CICS ENDBR
                           DATASET(AHM-DATASET)
                           RESP(WS-RESPONSE)
                 END-EXEC

                 IF CNT-SHORT-CALLED + CNT-CALL-SUCCESS
                                     <= CNT-AHM
                    MOVE SPACES               TO P926-COMMAREA-PARMS
                    SET P926-CALL-SHEET-FUNCTION TO TRUE
                    MOVE P08CA-PROFILE-KEY    TO P926-ASGN-PROFILE-KEY
                    MOVE WS-AHIST-KEY         TO P926-ASGN-HIST-KEY
                    MOVE P08CA-TASK-KEY       TO P926-TASK-KEY
                    MOVE PSTCA-TIME-ZONE      TO P926-TIME-ZONE
                    EXEC CICS LINK
                              PROGRAM(P926-PGM)
                              COMMAREA(P926-COMMAREA-PARMS)
                              LENGTH(P926-LGTH)
                              RESP(WS-RESPONSE)
                    END-EXEC
      * #1499
                    PERFORM P5190-PRINT-CALL-SHEET
                 END-IF
              END-IF
           END-IF
           .
      *=================================================================
       P5170-SETUP-P0ESCOMM.
      *=================================================================
      *#1310
           IF WS-VRUINFO-FOUND
           OR P08CA-TASK-KEY > SPACES
              MOVE P08CA-TASK-KEY          TO TASKTIME
              PERFORM P8661-READ-TASK
              IF NOT SUCCESS
                 MOVE 'P5170-1'    TO ERR-PARAGRAPH
                 MOVE TASKTIME     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
              PERFORM P9300-READ-TASK-BY-STATION
              IF NOT WS-TASK-FOUND
                 MOVE -1                  TO SCR08-FUNC-CURSOR(FUNC-SUB)
                 MOVE REV-VIDEO           TO SCR08-FUNC-HI(FUNC-SUB)
      *            'NO TASK RECORD FOUND'
                 MOVE 'N246'              TO MSGLOG-CODE
                 PERFORM P9000-SEND-MAP-AND-RETURN
              END-IF
           END-IF
           MOVE SPACES                      TO P0ES-COMMAREA-PARMS
           SET  P0ES-CALL-TO-SERVICE        TO TRUE
           SET  P0ES-FIRST-TIME-CALL        TO TRUE
           MOVE P08CA-EMP-NO(FUNC-SUB)      TO P0ES-EMP-NBR
           MOVE HOLD-TASK-KEY               TO P0ES-TASK-KEY
           MOVE '0000'                      TO P0ES-ZEROES
           MOVE SCR08-CC(FUNC-SUB)          TO WS-CRAFT-CODE-CHECK
           IF ENGINE-CRAFT
              MOVE WS-IVR-CALL-PROF-EN      TO P0ES-CALL-PROFILE
           ELSE
              MOVE WS-IVR-CALL-PROF-TR      TO P0ES-CALL-PROFILE
           END-IF
           MOVE WS-SHORT-CALL-REQ           TO P0ES-SHORT-CALL-REQ
           MOVE P08CA-RESUB-FLAG(FUNC-SUB)  TO P0ES-RESUB-FLAG
           IF WS-FULL-CREW-NOT-MQ
              SET P0ES-FULL-CREW-NOT-MQ     TO TRUE
           END-IF
      *CNC0579 - BEG
           IF P08CA-DEC-RPT-LOCATION(FUNC-SUB) > SPACES
              MOVE P08CA-DEC-RPT-LOCATION(FUNC-SUB)
                                            TO P0ES-VCNY-RPT-LOCATION
           ELSE
              MOVE SPACES                   TO P0ES-VCNY-RPT-LOCATION
           END-IF
      *CNC0579 - END
      * WHEN THIS IS A FIRST TIME AUTOMATED IVR CALL, THE IEC EFF TIME
      * WILL BE THE CALL TIME, NOT THE CURRENT TIME
      *    IF PSTCA-FROM-PROGRAM             = P0EP-PGM
      *       SET  P0ES-AUTOMATED-IVR-CALL  TO TRUE
      *    END-IF
      * 0EP DETERMINES SINGLE THREAD.  0ES WILL SET THE TASK TO WT ST
      *    IF P08CA-SINGLE-THREAD(FUNC-SUB)
      *       SET P0ES-SINGLE-THREAD        TO TRUE
      *    ELSE
      *       MOVE SPACES                   TO P0ES-SINGLE-THREAD-FL
      *    END-IF
      *
      *    MOVE TASK-RUN-LONG-TRAIN         TO P0ES-RUN-LONG-TRAIN
      *    INSPECT SCR08-NAME(FUNC-SUB) REPLACING
      *            ALL LOW-VALUES BY SPACES
      *    EVALUATE TRUE
      *       WHEN SCR08-NAME(FUNC-SUB)(17:10) = SPACES
      *            MOVE SPACES              TO P0ES-MAX-HR-REMAIN
      *       WHEN SCR08-NAME(FUNC-SUB)(22:1)  = '"'
      *            STRING SCR08-NAME(FUNC-SUB)(17:2),
      *                   SCR08-NAME(FUNC-SUB)(20:2)
      *                 DELIMITED BY SIZE INTO P0ES-MAX-HR-REMAIN
      *       WHEN SCR08-NAME(FUNC-SUB)(17:10) = 'MAXED OUT '
      *            MOVE '0000' TO P0ES-MAX-HR-REMAIN
      *       WHEN SCR08-NAME(FUNC-SUB)(17:10) = '??????????'
      *            MOVE '????' TO P0ES-MAX-HR-REMAIN
      *       WHEN OTHER
      *            MOVE '????' TO P0ES-MAX-HR-REMAIN
      *    END-EVALUATE
           .
      *
       P5180-LINK-TO-0ES.
      *
      *?*  IF WS-FROM-IVR
      *?*     MOVE WS-FROM-IVR-ABEND-FLAG   TO P0ES-FROM-IVR-ABEND-FLAG
      *?*     MOVE WS-FROM-IVR-INFO         TO P0ES-FROM-VRU-INFO
      *?*  END-IF

           EXEC CICS LINK
                     PROGRAM (P0ES-PGM)
                     COMMAREA(P0ES-COMMAREA-PARMS)
                     LENGTH  (P0ES-LGTH)
                     RESP    (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                 TO FILE-STATUS
           IF P0ES-IVR-ABEND
           OR NOT SUCCESS
              MOVE 'P5180-1'                TO ERR-PARAGRAPH
              MOVE 'P0ESLINK'               TO ERR-KEY
              IF P0ES-IVR-ABEND
                 SET  WS-IVR-ABEND          TO TRUE
              END-IF
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      * #1499
      *=================================================================
       P5190-PRINT-CALL-SHEET.
      *=================================================================
           MOVE P08CA-PROFILE-KEY        TO TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           MOVE SPACES               TO WORK-CNTLKEY
                                        P906-COMMAREA-PARMS
      *
      *    BUILD KEY FOR PRINTER ROUTING CONTROL RECORD
      *
           MOVE '80'                     TO WK-CNTL-REC-TYPE
           IF TRCN-EN-FROM-AREA > SPACES
              MOVE TRCN-EN-FROM-DIST     TO WK-CNTL-DIST
              MOVE TRCN-EN-FROM-SDIST    TO WK-CNTL-SUB-DIST
              MOVE TRCN-EN-FROM-POOL     TO WK-CNTL-POOL
              MOVE TRCN-EN-FROM-TERM     TO WK-CNTL-I-O
           ELSE
              IF TRCN-TR-FROM-AREA > SPACES
                 MOVE TRCN-TR-FROM-DIST  TO WK-CNTL-DIST
                 MOVE TRCN-TR-FROM-SDIST TO WK-CNTL-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL  TO WK-CNTL-POOL
                 MOVE TRCN-TR-FROM-TERM  TO WK-CNTL-I-O
              ELSE
                 MOVE P926-AH-DIST       TO WK-CNTL-DIST
                 MOVE P926-AH-SUB-DIST   TO WK-CNTL-SUB-DIST
                 MOVE P926-AH-POOL       TO WK-CNTL-POOL
                 IF P926-AH-POOL = JOB-DEF-LOCAL-POOL
                    MOVE SPACE           TO WK-CNTL-I-O
                 ELSE
                    MOVE '0'             TO WK-CNTL-I-O
                 END-IF
              END-IF
           END-IF
           MOVE WK-CNTL-POOL             TO WS-CNTL-POOL
           MOVE WK-CNTL-I-O              TO WS-CNTL-I-O
           MOVE 'C'                      TO WK-CNTL-TYPE
      *
      *    LOCATE "CICS PRINTER" DESTINATIONS
      *
           MOVE '00'                     TO WK-CNTL-HOST-SEQ
           MOVE WORK-CNTLKEY             TO CNTLKEY
           PERFORM P8610-READ-CNTLFILE
           IF SUCCESS AND CNTL-HOST-PRNTR-ACTIVE
      *CNC0555 - BEG
              MOVE CNTL-HOST-PRNTR-FL       TO WS-CNTL-PRNTR-FL
      *CNC0555 - END
              MOVE 'P1'                     TO WK-CNTL-HOST-SEQ
              MOVE WORK-CNTLKEY             TO CNTLKEY
              PERFORM P8610-READ-CNTLFILE
              IF SUCCESS
                 MOVE CNTL-HOST-ADDR-ARRAY TO P906-PRINTER-ARRAY
              END-IF
           END-IF
           IF P906-PRINTER-ARRAY NOT > SPACES
              MOVE SPACES               TO CNTLKEY-AREA
              MOVE '02'                 TO CNTL-REC-TYPE
              MOVE AHK1-DIST            TO CNTL-DIST
              MOVE AHK1-SUB-DIST        TO CNTL-SUB-DIST
              MOVE CNTLKEY-AREA         TO WORK-CNTLKEY
              PERFORM P8610-READ-CNTLFILE
              IF SUCCESS
                 MOVE CNTL-DEFAULT-PR-CLASS TO P906-PRINTER-ID
              END-IF
           END-IF
      *
      *     CALL SUB-ROUTINE TO PRINT REPORT
      *
           IF SUCCESS
      *CNC0555 - BEG
              MOVE P906-PRINTER(1)         TO WS-PRINTER-ID
              IF  WS-CNTL-PRNTR-FL          = 'Y'
              AND WS-INVALID-PRNTR-ID
                 CONTINUE
              ELSE
      *CNC0555 - END
                 MOVE P726-PGM             TO P906-PROGRAM-ID
                 MOVE WS-AHIST-KEY         TO JCL-AH-KEY
                 MOVE PSTCA-SUB            TO JCL-LANG-SUB
                 MOVE JCL-INPUT-CARD       TO P906-PARM-CARD-1
                 SET P906-MULT-OUTPUT      TO TRUE
                 EXEC CICS LINK
                           PROGRAM(P906-PGM)
                           COMMAREA(P906-COMMAREA-PARMS)
                           LENGTH(P906-LGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS
                    IF P906-PRINTER-ERROR
      *             NO-DEFAULT-PRINTER
                       SET ERROR-FND        TO TRUE
                    END-IF
                    IF P906-JCL-ERROR
      *               NO-JCL-CNTL-MSG
                       SET ERROR-FND        TO TRUE
                    END-IF
                 END-IF
      *CNC0555 - BEG
              END-IF
      *CNC0555 - END
           END-IF
      *
           IF SUCCESS
              MOVE '00'                  TO WK-CNTL-HOST-SEQ
              MOVE WORK-CNTLKEY          TO CNTLKEY
              PERFORM P8610-READ-CNTLFILE
              IF SUCCESS AND CNTL-HOST-EMAIL-ACTIVE
                 PERFORM P5191-FORMAT-EMAIL
                 PERFORM P5192-LINK-TO-930
              END-IF
           END-IF
           .
      *=================================================================
       P5191-FORMAT-EMAIL.
      *=================================================================
           MOVE P08CA-PROFILE-KEY        TO TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           MOVE TRCN-FNL-STN          TO LN2-STATION1
           MOVE 26                    TO CTXT-UNF-FIELD-LEN
           MOVE TRCN-DESCRIPTION      TO CTXT-UNF-FIELD
           PERFORM P8994-CENTER-TEXT
           MOVE CTXT-FOR-FIELD        TO LN1-TYPE

           STRING WS-SYS-YR '/'
                  WS-SYS-MO '/'
                  WS-SYS-DY ' '
                  WS-SYS-HR ':'
                  WS-SYS-MN
                  DELIMITED BY SIZE
                  INTO LN1-SYS-DATE

           MOVE AH-DEP-STATION     TO LN1-STATION
           MOVE AHK1-TRAIN-SYM     TO LN2-TRAIN
           MOVE AHK1-TRAIN-CODE    TO LN2-CODE
           STRING AHK1-EFF-YR '/'
                  AHK1-EFF-MO '/'
                  AHK1-EFF-DY
                  DELIMITED BY SIZE
                  INTO LN2-DATE
           STRING AHK1-EFF-HR ':'
                  AHK1-EFF-MN
                  DELIMITED BY SIZE
                  INTO LN2-TIME
      *
      *       BUILD LINE3 IF TRAIN IS TIED-UP
      *
           IF AH-TIE-UP-DATE-TIME > SPACES
              STRING AH-TU-YR '/'
                     AH-TU-MO '/'
                     AH-TU-DY
                     DELIMITED BY SIZE
                     INTO LN3-DATE
              MOVE AH-TU-TIME         TO LN3-TIME
              MOVE AH-FINAL-STATION   TO LN3-STATION
           ELSE
              MOVE SPACES             TO LN3-DATE
                                         LN3-TIME
                                         LN3-STATION
           END-IF
           MOVE AH-CALL-COMMENTS   TO LN7-COMMENTS
           MOVE ZEROS                TO SUB1
           MOVE SPACES               TO AHM-KEY
           MOVE AH-KEY-1             TO AHM-AHIST-KEY
           SET AHM-EMPLOYEE-RECORD   TO TRUE
           MOVE AHM-KEY              TO AHMKEY
           MOVE AHM-FILE             TO AHM-DATASET
           EXEC CICS STARTBR
                     DATASET(AHM-DATASET)
                     RIDFLD(AHMKEY)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE          TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P5191-1'         TO ERR-PARAGRAPH
              MOVE AHMKEY            TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE SPACE                TO WS-AHM-DONE-FLAG
           PERFORM UNTIL WS-AHM-DONE
              EXEC CICS READNEXT
                        DATASET(AHM-DATASET)
                        INTO(WS-AHIST-MISC)
                        LENGTH(AHM-RLGTH)
                        RIDFLD(AHMKEY)
                        KEYLENGTH(AHM-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF SUCCESS
                 IF AHM-AHIST-KEY = AH-KEY-1
                    AND AHM-EMPLOYEE-RECORD
                    IF AHM-EMP-REL-BEF-RPT
                       OR AHM-EMP-REL-AFT-RPT
                       OR AHM-EMP-REL-AFT-WRK
                       CONTINUE
                    ELSE
                       ADD 1 TO SUB1
                       IF SUB1 NOT GREATER ARRAY-SIZE
                          SET CT-IND TO 1
                          SEARCH CRAFT-CODE-TABLE VARYING CT-IND
                             AT END CONTINUE
                             MOVE '??????????' TO LN4-CRAFT(SUB1)
                            WHEN CT-CRAFT-CODE(CT-IND) = AHM-CRAFT-CODE
                             MOVE CT-CRAFT-DESC(CT-IND)
                                TO LN4-CRAFT(SUB1)
                          END-SEARCH
                          IF AHM-VACANT-TURN
                            IF PSTCA-SUB = 2
                              MOVE '<< TOUR VACANT >>'
                                          TO LN4-NAME(SUB1)
                            ELSE
                              MOVE '<< VACANT TURN >>'
                                          TO LN4-NAME(SUB1)
                            END-IF
                          ELSE
                             MOVE AHM-EMP-OD-TIME
                                          TO LN4-ODT-TIME(SUB1)
                             MOVE AHM-EMPLOYEE-NUMBER TO MSTRNBRK
                             EXEC CICS READ
                                       DATASET(MSTR-VIA-EMP-NBR)
                                       INTO(WS-MSTR)
                                       LENGTH(MSTRENBR-RLGTH)
                                       RIDFLD(MSTRNBRK)
                                       KEYLENGTH(MSTRENBR-KLGTH)
                                       RESP(WS-RESPONSE)
                             END-EXEC
                             MOVE WS-RESPONSE       TO FILE-STATUS
                             IF NOT SUCCESS
                                MOVE 'P5191-2'      TO ERR-PARAGRAPH
                                MOVE MSTRNBRK       TO ERR-KEY
                                PERFORM P9999-GOT-PROBLEM
                             END-IF
                             MOVE EMP-NAME          TO LN4-NAME(SUB1)
                             IF EMP-PREV-DUTY > ZEROES
                                MOVE EMP-PREV-DUTY  TO LN4-PD(SUB1)
                             ELSE
                                MOVE SPACES         TO LN4-PD(SUB1)
                             END-IF
                          END-IF
                       ELSE
                          SET WS-AHM-DONE TO TRUE
                    END-IF
                 ELSE
                    SET WS-AHM-DONE TO TRUE
                 END-IF
              ELSE
                 SET WS-AHM-DONE TO TRUE
                 IF NOT (NO-RECORD-FND OR END-OF-FILE)
                    MOVE 'P5191-3'      TO ERR-PARAGRAPH
                    MOVE AHMKEY         TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-PERFORM
           EXEC CICS ENDBR
                     DATASET(AHM-DATASET)
                     RESP(WS-RESPONSE)
           END-EXEC

           MOVE SPACES               TO AHM-KEY
           MOVE AH-KEY-1             TO AHM-AHIST-KEY
           SET AHM-ENGINE-RECORD     TO TRUE
           MOVE 01                   TO AHM-ENGINE-KEY-SEQUENCE
           MOVE AHM-KEY              TO AHMKEY
           MOVE AHM-FILE             TO AHM-DATASET
           EXEC CICS READ
                     DATASET(AHM-DATASET)
                     INTO(WS-AHIST-MISC)
                     LENGTH(AHM-RLGTH)
                     RIDFLD(AHMKEY)
                     KEYLENGTH(AHM-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           IF NOT SUCCESS
              MOVE 'P5191-4'         TO ERR-PARAGRAPH
              MOVE AHMKEY            TO ERR-KEY
              GO TO P9999-GOT-PROBLEM
           END-IF

           IF SUCCESS
              PERFORM VARYING SUB1 FROM 1 BY 1
                  UNTIL SUB1 > 13
                     IF AHM-ENGINE-ID(SUB1) > SPACES
                        IF SUB1 <= 6
                           MOVE AHM-ENGINE-ID(SUB1)
                                        TO LN5-ENG1(SUB1)
                        ELSE
                           MOVE AHM-ENGINE-ID(SUB1)
                                        TO LN5-ENG2(SUB1 - 6)
                        END-IF
                     END-IF
              END-PERFORM
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P5191-5' TO ERR-PARAGRAPH
                 MOVE AHMKEY    TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
           .
      *=================================================================
       P5192-LINK-TO-930.
      *=================================================================
           MOVE SPACES                     TO P930-COMMAREA
           MOVE AHK1-DIST                  TO P930-DIST
           MOVE AHK1-SUB-DIST              TO P930-SUB-DIST
           MOVE WS-CNTL-POOL               TO P930-POOL
           MOVE WS-CNTL-I-O                TO P930-I-O
           SET P930-CALL-SHEET             TO TRUE
           MOVE WS-CALL-SHEET-LINE-1       TO P930-DATA-LINE(1)
           MOVE SPACES                     TO P930-DATA-LINE(2)
           MOVE WS-CALL-SHEET-LINE-2       TO P930-DATA-LINE(3)
           MOVE SPACES                     TO P930-DATA-LINE(4)
           MOVE WS-CALL-SHEET-LINE-3       TO P930-DATA-LINE(5)
           MOVE SPACES                     TO P930-DATA-LINE(6)
           MOVE LINE4(1)                   TO P930-DATA-LINE(7)
           MOVE LINE4(2)                   TO P930-DATA-LINE(8)
           MOVE LINE4(3)                   TO P930-DATA-LINE(9)
           MOVE LINE4(4)                   TO P930-DATA-LINE(10)
           MOVE LINE4(5)                   TO P930-DATA-LINE(11)
           MOVE LINE4(6)                   TO P930-DATA-LINE(12)
           MOVE LINE4(7)                   TO P930-DATA-LINE(13)
           MOVE SPACES                     TO P930-DATA-LINE(14)
           MOVE WS-CALL-SHEET-LINE-5       TO P930-DATA-LINE(15)
           MOVE WS-CALL-SHEET-LINE-6       TO P930-DATA-LINE(16)
           MOVE SPACES                     TO P930-DATA-LINE(17)
           MOVE WS-CALL-SHEET-LINE-7       TO P930-DATA-LINE(18)
           EXEC CICS LINK
                     PROGRAM (P930-PGM)
                     COMMAREA(P930-COMMAREA)
                     LENGTH  (P930-LGTH)
                     RESP    (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P5192-1'               TO ERR-PARAGRAPH
              MOVE 'P930LINK'              TO ERR-KEY
              MOVE 'LINK TO 930 FAILED'    TO ERR-SENTENCE
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P5200-SAVE-ASGN-KEY.
      *
           MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                     TO WS-HOLD-IVR-CANCEL-ASGN-KEY
           IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
              MOVE P08CA-ASGN-KEY-XB(FUNC-SUB)(2:12)
                                     TO WS-HOLD-IVR-CANCEL-ASGN-KEY
           END-IF
           .
      *
       P5210-PROCESS-IVR-CANCEL.
      *
           IF (YARD-CALL OR LOCAL-CALL)
              IF LOCAL-CALL
      * C899
                 MOVE P08CA-JSKEY1(FUNC-SUB) TO JSKEY1
                 EXEC CICS READ
                           DATASET(JS-VIA-JSKEY1)
                           INTO(WS-JOB-SCHEDULE)
                           LENGTH(JSKEY1-RLGTH)
                           RIDFLD(JSKEY1)
                           KEYLENGTH(JSKEY1-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE          TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE JSKEY1            TO WORK-JS-KEY1
                    IF WK-JSK1-ASGN-DAY-NUM > 1
                       SUBTRACT 1        FROM WK-JSK1-ASGN-DAY-NUM
                    ELSE
                       MOVE 7              TO WK-JSK1-ASGN-DAY-NUM
                    END-IF
      * C899
                    MOVE 0001             TO WK-JSK1-ASGN-START-TIME-NUM
                    MOVE WORK-JS-KEY1      TO JSKEY1
                    EXEC CICS READ
                              DATASET(JS-VIA-JSKEY1)
                              INTO(WS-JOB-SCHEDULE)
                              LENGTH(JSKEY1-RLGTH)
                              RIDFLD(JSKEY1)
                              KEYLENGTH(JSKEY1-KLGTH)
                              GTEQ
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE       TO FILE-STATUS
                    IF SUCCESS
                       AND JSK1-ASGN-DIST = WK-JSK1-ASGN-DIST
                       AND JSK1-ASGN-SUB-DIST = WK-JSK1-ASGN-SUB-DIST
                       AND JSK1-ASSIGNMENT = WK-JSK1-ASSIGNMENT
                       AND JSK1-EXP-DATE = WK-JSK1-EXP-DATE
                       AND JSK1-ASGN-DAY-NUM = WK-JSK1-ASGN-DAY-NUM
      *                AND JSK1-ASGN-START-TIME NOT > WS-SCH-END-TIME
                       MOVE JS-KEY1        TO P08CA-JSKEY1(FUNC-SUB)
                    END-IF
                 END-IF
                 PERFORM P2951-CALC-ERT
                 SET  WS-LOCAL-ERT-SAVED TO TRUE
                 MOVE WS-HR-MN           TO WS-SAVE-LOCAL-ERT-HR-MN
              END-IF
              PERFORM P9300-READ-TASK-BY-STATION
              IF WS-TASK-FOUND
                 MOVE TASK-LOCATION-KEY    TO VRUINFO-TASK-KEY
                 PERFORM P9330-READ-VRUINFO
                 IF SUCCESS
                    MOVE VRUINFO-AHIST-KEY TO WS-AHIST-KEY
                 END-IF
              END-IF
              MOVE SPACES                  TO P922-COMMAREA-PARMS
              SET P922-CANCEL-FUNCTION     TO TRUE
              SET P922-IVR-CANCEL          TO TRUE
              SET P922-CANCEL-BUST         TO TRUE
      *       MOVE TRCN-KEY3               TO P922-AJ-PARM
      *       MOVE SCR08-CC(FUNC-SUB)      TO P922-AJ-CC
              MOVE WS-HOLD-IVR-CANCEL-ASGN-KEY
                                           TO P922-AJ-PARM
      * #1490
              MOVE SCR08-OD-DATE(FUNC-SUB) TO P922-JOB-OD-DATE
                                              P922-CAN-DATE
              MOVE SCR08-OD-TIME(FUNC-SUB) TO P922-JOB-OD-TIME
                                              P922-CAN-TIME
              MOVE SCR08-ASGN              TO P922-CANCEL-TRAIN
              MOVE SCR08-CC(FUNC-SUB)      TO P922-CANCEL-TRAIN-CC
              MOVE WS-AHIST-KEY            TO P922-AHIST-KEY
              MOVE SCR08-ORDER-DATE        TO P922-ASGN-CAN-DATE
              MOVE SCR08-ORDER-TIME        TO P922-ASGN-CAN-TIME
              MOVE PSTCA-TIME-ZONE         TO P922-TIME-ZONE
      *
      *       IF WS-FROM-IVR
      *          MOVE WS-FROM-IVR-ABEND-FLAG
      *                                   TO P922-FROM-IVR-ABEND-FLAG
      *          MOVE WS-FROM-IVR-INFO TO P922-FROM-VRU-INFO
      *       END-IF
      *
              EXEC CICS LINK
                   PROGRAM(P922-PGM)
                   COMMAREA(P922-COMMAREA-PARMS)
                   LENGTH(P922-LGTH)
                   RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
      *       IF P922-IVR-ABEND OR NOT SUCCESS
                 MOVE 'P5210-1' TO ERR-PARAGRAPH
      *          IF P922-IVR-ABEND
      *             SET WS-IVR-ABEND   TO TRUE
      *          END-IF
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
              MOVE SPACES              TO P916-COMMAREA-PARMS
              SET P916-CANCEL-FUNCTION TO TRUE
              IF CALL-FUNCTION
                 SET P916-IVR-CMC-CALL TO TRUE
                 MOVE WS-AHM-KEY       TO AHMKEY
                                          AHM-KEY
                 EXEC CICS READ
                           DATASET(AHM-DATASET)
                           INTO(WS-AHIST-MISC)
                           LENGTH(AHM-RLGTH)
                           RIDFLD(AHMKEY)
                           KEYLENGTH(AHM-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE      TO FILE-STATUS
                 IF SUCCESS
                    MOVE AHM-SCHEDULE-KEY   TO WS-HOLD-SCHED-KEY
                 END-IF
              END-IF
              SET P916-IVR-CANCEL      TO TRUE
              MOVE SCR08-ASGN          TO P916-TRAIN(1:8)
              MOVE SCR08-ASGN-TYPE     TO P916-TRAIN(9:2)
              MOVE WS-HOLD-IVR-CANCEL-ASGN-KEY
                                       TO P916-TURN-PARM
              SET P916-CANCEL-BUST     TO TRUE
      * #1490
              MOVE SCR08-OD-DATE(FUNC-SUB)
                                       TO P916-CAN-DATE
              MOVE SCR08-OD-TIME(FUNC-SUB)
                                       TO P916-CAN-TIME
              MOVE SCR08-ORDER-DATE    TO P916-ASGN-CAN-DATE
              MOVE SCR08-ORDER-TIME    TO P916-ASGN-CAN-TIME
      *       MOVE SCR08-CO-FLAG       TO P916-CAN-CO-ONLY-FLAG
              MOVE PSTCA-TIME-ZONE     TO P916-TIME-ZONE
      *
      *       IF WS-FROM-IVR
      *          MOVE WS-FROM-IVR-ABEND-FLAG
      *                                   TO P916-FROM-IVR-ABEND-FLAG
      *          MOVE WS-FROM-IVR-INFO TO P916-FROM-VRU-INFO
      *       END-IF
      *
              EXEC CICS LINK
                   PROGRAM(P916-PGM)
                   COMMAREA(P916-COMMAREA-PARMS)
                   LENGTH(P916-LGTH)
                   RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
      *       IF P916-IVR-ABEND OR NOT SUCCESS
                 MOVE 'P5210-2' TO ERR-PARAGRAPH
      *          IF P916-IVR-ABEND
      *             SET WS-IVR-ABEND   TO TRUE
      *          END-IF
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
      *
           MOVE +0               TO CNT-UNDER-VRU-CONTROL
                                    CNT-CMA-NOT-CALLED
                                    CNT-VRU-UNSUCCESSFUL
           PERFORM P9300-READ-TASK-BY-STATION
           IF WS-TASK-FOUND
              MOVE TASK-LOCATION-KEY    TO VRUINFO-TASK-KEY
              PERFORM P9310-READ-UPDATE-VRUINFO
              IF SUCCESS
                 IF CALL-FUNCTION
                 OR VACATE-FUNCTION
                    SET  CMA-CALL-SUCCESSFUL(FUNC-SUB)   TO TRUE
                    MOVE SPACES TO VRUINFO-VRU-CONTROL-FLAG (FUNC-SUB)
                                   VRUINFO-VRU-MSG-CD       (FUNC-SUB)
                                   VRUINFO-FULL-CREW-VAL    (FUNC-SUB)
                                   VRUINFO-FULL-CREW-GRP    (FUNC-SUB)
                 ELSE
                    MOVE SPACES TO VRUINFO-EMP-NBR          (FUNC-SUB)
                                   VRUINFO-VRU-CONTROL-FLAG (FUNC-SUB)
                                   VRUINFO-CALL-STATUS-FLAG (FUNC-SUB)
                                   VRUINFO-VRU-MSG-CD       (FUNC-SUB)
                                   VRUINFO-FULL-CREW-VAL    (FUNC-SUB)
                                   VRUINFO-FULL-CREW-GRP    (FUNC-SUB)
                                   VRUINFO-DECISION-KEY     (FUNC-SUB)
                                   VRUINFO-DECISION-KEY     (FUNC-SUB)
      *#1494 #1498
      *C899 REVERSAL OF 1494
      *             IF TASK-CREATED-BY-IVRCALL
      *                MOVE SPACES TO
      *                            VRUINFO-REQUIRED-CC-FLAG (FUNC-SUB)
      *             END-IF
                 END-IF
                 PERFORM P9320-REWRITE-VRUINFO

      *          SPIN THRU VRUINFO TO SEE IF TASK-STATUS CHANGE NEEDED
                 SET WS-VRUINFO-DELETE-OK TO TRUE
                 PERFORM VARYING VRUINFO-CC-SUB FROM 1 BY 1
                           UNTIL VRUINFO-CC-SUB > VRUINFO-CC-MAX
      *             IF THIS IS A CALL OR VACATE,
      *             DO NOT COUNT THE ONE BEING IVR-CANCELLED
                    IF VRUINFO-CC-SUB = FUNC-SUB
                    AND (CALL-FUNCTION OR VACATE-FUNCTION)
                       CONTINUE
                    ELSE
                       IF EMP-UNDER-VRU-CONTROL (VRUINFO-CC-SUB)
                          ADD +1      TO CNT-UNDER-VRU-CONTROL
                       END-IF
                       IF VRUINFO-CRAFT(VRUINFO-CC-SUB) > SPACES
                          IF VRU-CALL-UNSUCCESSFUL(VRUINFO-CC-SUB)
                             ADD +1   TO CNT-VRU-UNSUCCESSFUL
                          END-IF
                          IF VRU-REQUIRED-CRAFT(VRUINFO-CC-SUB)
                            IF NOT EMP-UNDER-VRU-CONTROL(VRUINFO-CC-SUB)
                            AND NO-CALL-ATTMPT-MADE(VRUINFO-CC-SUB)
                              ADD +1   TO CNT-CMA-NOT-CALLED
                            END-IF
                          END-IF
                       END-IF
                    END-IF

                    IF VRUINFO-EMP-NBR(VRUINFO-CC-SUB) > SPACES
                       IF VRU-REQUIRED-CRAFT(VRUINFO-CC-SUB)
                          SET WS-VRUINFO-DELETE-NOT
                                                 TO TRUE
                       END-IF
                    END-IF
                 END-PERFORM
                 IF WS-VRUINFO-DELETE-OK
                    EXEC CICS DELETE
                              DATASET(VRU-INFO-FILE)
                              RIDFLD (VRUINFOKEY)
                              RESP   (WS-RESPONSE)
                    END-EXEC
                 END-IF
      *
                 IF  CNT-UNDER-VRU-CONTROL    > +0
                 AND CNT-VRU-UNSUCCESSFUL NOT > +0
                    MOVE TASK-LOCATION-KEY TO TASKTIME
                    PERFORM P8660-READ-TASK-UPD
                    SET TASK-VRU-CALL-INIT TO TRUE
                    PERFORM P8662-REWRITE-TASK
                 END-IF
      *
                 IF CNT-UNDER-VRU-CONTROL > +0
                 OR CNT-VRU-UNSUCCESSFUL  > +0
                    CONTINUE
                 ELSE
      *             ANY EMPS NOT PROCESSED BY VRU OR CMA,
      *             SET TASK BACK TO "ORDER - VRU FINISHED"
      *             OTHERWISE DELETE THE TASK RECORD
                    IF YARD-CALL
                       MOVE TASK-LOCATION-KEY TO TASKTIME
                       PERFORM P8665-DELETE-TASK
                       MOVE SPACES            TO P08CA-TASK-KEY
                    ELSE
                       MOVE TASK-LOCATION-KEY TO TASKTIME
                       PERFORM P8661-READ-TASK
                       IF NOT SUCCESS
                          MOVE 'P5210-3' TO ERR-PARAGRAPH
                          MOVE TASKTIME TO ERR-KEY
                          PERFORM P9999-GOT-PROBLEM
                       END-IF
      *                IF NOT TOPC AND ALL REQUIRED CRAFTS HAVE BEEN
      *                CALLED, THEN DELETE THE TASK
                       IF TASK-TOPC-TRAIN-SYM NOT > SPACES
                          IF CNT-CMA-NOT-CALLED NOT > +0
      *#1494
                             IF TASK-CREATED-BY-IVRCALL
                                MOVE TASK-LOCATION-KEY TO TASKTIME
                                PERFORM P8665-DELETE-TASK
                             ELSE
                                MOVE TASK-LOCATION-KEY TO TASKTIME
                                PERFORM P8660-READ-TASK-UPD
                                IF SUCCESS
                                   MOVE SPACE      TO TASK-VRU-FLAG
                                                      TASK-VRU-CALL-FLAG
                                END-IF
                                PERFORM P8662-REWRITE-TASK
                             END-IF
                          ELSE
                             MOVE TASK-LOCATION-KEY TO TASKTIME
                             PERFORM P8660-READ-TASK-UPD
                             IF SUCCESS
                                MOVE SPACE         TO TASK-VRU-FLAG
                                                      TASK-VRU-CALL-FLAG
                                IF IVR-CALL-FUNCTION
                                   SET TASK-VRU           TO TRUE
                                   IF NOT TASK-ORDER-VX
                                      SET TASK-VRU-CALL-INIT TO TRUE
                                   END-IF
                                END-IF
                                PERFORM P8662-REWRITE-TASK
                             ELSE
                                EXEC CICS UNLOCK
                                          DATASET(TASK-VIA-EFF-TIME)
                                          RESP(WS-RESPONSE)
                                END-EXEC
                             END-IF
                          END-IF
                       ELSE
                          MOVE TASK-LOCATION-KEY TO TASKTIME
                          PERFORM P8660-READ-TASK-UPD
                          IF SUCCESS
      *                      IF CNT-CMA-NOT-CALLED > +0
                                MOVE SPACE       TO TASK-VRU-FLAG
                                                    TASK-VRU-CALL-FLAG
      *                      END-IF
                             IF IVR-CALL-FUNCTION
                                SET TASK-VRU           TO TRUE
                                IF NOT TASK-ORDER-VX
                                   SET TASK-VRU-CALL-INIT TO TRUE
                                END-IF
                             END-IF
                             PERFORM P8662-REWRITE-TASK
                          ELSE
                             EXEC CICS UNLOCK
                                       DATASET(TASK-VIA-EFF-TIME)
                                       RESP(WS-RESPONSE)
                             END-EXEC
                          END-IF
                       END-IF
                    END-IF
                 END-IF
      *#1471, #1473
              ELSE
                 EXEC CICS UNLOCK
                           DATASET(VRU-INFO-FILE)
                           RESP(WS-RESPONSE)
                 END-EXEC
              END-IF
           END-IF
      *
           IF REJECT-TURN
           OR DROP-TURN
           OR REJECT-EMPLOYEE-FUNCTION
           OR LAYOFF-ON-CALL
              MOVE DEFAULT-ATTR        TO SCR08-FUNC-HI   (FUNC-SUB)
                                          SCR08-NAME-HI   (FUNC-SUB)
                                          SCR08-CC-HI     (FUNC-SUB)
                                          SCR08-ST-HI     (FUNC-SUB)
                                          SCR08-ECC-HI    (FUNC-SUB)
                                          SCR08-OD-DATE-HI(FUNC-SUB)
                                          SCR08-OD-TIME-HI(FUNC-SUB)
                                          SCR08-TAXI-TM-HI(FUNC-SUB)
              MOVE MDT                 TO SCR08-FUNC-ATTR (FUNC-SUB)
                                          SCR08-NAME-ATTR (FUNC-SUB)
      *#991                               SCR08-CC-ATTR   (FUNC-SUB)
                                          SCR08-ST-ATTR   (FUNC-SUB)
                                          SCR08-ECC-ATTR  (FUNC-SUB)
                                          SCR08-OD-DATE-ATTR(FUNC-SUB)
                                          SCR08-OD-TIME-ATTR(FUNC-SUB)
                                          SCR08-TAXI-TM-ATTR(FUNC-SUB)
              IF P08CA-ASGN-COLOR(FUNC-SUB) > SPACE
                 MOVE P08CA-ASGN-COLOR(FUNC-SUB)
                                      TO SCR08-ST-COL     (FUNC-SUB)
                                         SCR08-ECC-COL    (FUNC-SUB)
                                         SCR08-MTOD-COL   (FUNC-SUB)
                                         SCR08-MTOD-PD-COL(FUNC-SUB)
                                         SCR08-HOME-COL   (FUNC-SUB)
                                         SCR08-USHR-COL   (FUNC-SUB)
                                         SCR08-USPD-COL   (FUNC-SUB)
                                         SCR08-PERS-COL   (FUNC-SUB)
              END-IF
              MOVE SPACES             TO P08CA-ASGN-STAT-CODE(FUNC-SUB)
              IF (YARD-CALL OR LOCAL-CALL)
                 CONTINUE
              ELSE
                 IF P916-TURN-PREFIX = 'MU'
                    SET P08CA-ASGN-MU(FUNC-SUB) TO TRUE
                 END-IF
              END-IF
           END-IF
           IF LAYOFF-ON-CALL
              SET P08CA-ASGN-IS-VCNY(FUNC-SUB)
                                       TO TRUE
           END-IF
           .
      *
      *P6000-EDIT-IVR-FUNCTIONS.
      *
      *    MOVE SPACES                     TO CNTLKEY-AREA
      *    MOVE SPACES                     TO WS-CNTL-FILE
      *    SET SUB-DIST-TYPE-REC           TO TRUE
      *    MOVE PSTCA-DIST                 TO CNTL-DIST
      *    MOVE PSTCA-SUB-DIST             TO CNTL-SUB-DIST
      *
      *    PERFORM P8610-READ-CNTLFILE
      *
      *    IF NOT SUCCESS
      *       MOVE 'P6000-1'               TO ERR-PARAGRAPH
      *       MOVE CNTLKEY                 TO ERR-KEY
      *       PERFORM P9999-GOT-PROBLEM
      *    END-IF
      *-----------------------------------------------------------------
      * C414 - DON'T ALLOW CDS-SERVICE WITH VCLL CALL IF US-DOMICILED
      *-----------------------------------------------------------------
      *
      *    IF TRCN-CDS-SERVICE AND IVR-CALL-FUNCTION
      *       IF CNTL-US-DOMICILED
      *          MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *          MOVE REV-VIDEO    TO SCR08-FUNC-HI(FUNC-SUB)
      *          STRING 'VCLL NOT VALID FOR CDS TRAIN/ASSIGNMENT '
      *                 'PROFILE '
      *                 DELIMITED BY SIZE
      *             INTO SCR08-ERRORMSG
      *          PERFORM P9000-SEND-MAP-AND-RETURN
      *       END-IF
      *    END-IF
      *
      *-----------------------------------------------------------------
      * C414 - VCDS FUNCTION - MUST HAVE TRCN-CD-SERVICE-FLAG = Y
      *                        MUST BE US DOMICILED
      * ----------------------------------------------------------------
      *    IF IVR-VCDS-FUNCTION
      *       IF  TRCN-CDS-SERVICE
      *       AND TRCN-CDS-RTE-CODE > SPACES
      *       AND CNTL-US-DOMICILED
      *           CONTINUE
      *       ELSE
      *           SET ERRORS-FOUND  TO TRUE
      *           MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *           MOVE REV-VIDEO    TO SCR08-FUNC-HI(FUNC-SUB)
      *           MOVE 'VCDS FUNCTION NOT VALID FOR CONDITIONS'
      *                             TO SCR08-ERRORMSG
      *           MOVE ARRAY-MAX    TO FUNC-SUB
      *           PERFORM P9000-SEND-MAP-AND-RETURN
      *       END-IF
      *    END-IF
      *
      *-----------------------------------------------------------------
      * C414 - VCTS FUNCTION - MUST HAVE TRCN-TCS-FLAG = Y
      *                        MUST NOT BE US DOMICILED
      * ----------------------------------------------------------------
      *    IF IVR-VCTS-FUNCTION
      *       IF  TRCN-TCS-SERVICE
      *       AND NOT CNTL-US-DOMICILED
      *           CONTINUE
      *       ELSE
      *           SET ERRORS-FOUND TO TRUE
      *           MOVE -1 TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *           MOVE REV-VIDEO TO SCR08-FUNC-HI(FUNC-SUB)
      *           MOVE 'VCTS FUNCTION NOT VALID FOR CONDITIONS'
      *              TO SCR08-ERRORMSG
      *           MOVE ARRAY-MAX TO FUNC-SUB
      *           PERFORM P9000-SEND-MAP-AND-RETURN
      *       END-IF
      *    END-IF
      *-----------------------------------------------------------------
      * C414 - VCLL FUNCTION FOR TCS SERVICE NEED TO PUT OUT MESSAGE TO
      *        CONFIRM THE VCLL
      * ----------------------------------------------------------------
      *    IF  TRCN-TCS-SERVICE
      *    AND IVR-CALL-FUNCTION
      *        IF PFKEY2
      *           CONTINUE
      *        ELSE
      *           PERFORM P1025-RESET-FUNC-CURSORS
      *           MOVE -1         TO SCR08-FUNC-CURSOR(FUNC-SUB)
      *           MOVE REV-VIDEO  TO SCR08-FUNC-HI(FUNC-SUB)
      *           STRING 'TCS TRAIN, ENTER ''VCTS'' IF SHARING '
      *                  'VEHICLE, OR PF2 TO CONFIRM ''VCLL'''
      *                   DELIMITED BY SIZE
      *                        INTO SCR08-ERRORMSG
      *           END-STRING
      *           PERFORM P9000-SEND-MAP-AND-RETURN
      *        END-IF
      *    END-IF
      *    .
      *CNLD-244 #2 B
      *================================================================
       P6040-GET-PREP-TIME.
      *================================================================
      * GET THE PREP TIME, IF ANY TO USE TO CALCUATE ON-DUTY TIME
           MOVE WS-TRCN-FILE       TO WS-TRCN-FILE-HOLD
           MOVE P08CA-PROFILE-KEY  TO TRCNKEY1
           PERFORM P8001-READ-TRCNKEY1-ONLY
           IF SUCCESS
              MOVE TRCN-JOB-TYPE   TO WS-JOB-TYPE
      *08/01/23 RJA B CNC0600 CNLD-270
              MOVE TRCN-INIT-DH-TIME TO WS-TRCN-INIT-DH-TIME
      *08/01/23 RJA E CNC0600 CNLD-270
           ELSE
              MOVE SPACES          TO WS-JOB-TYPE
      *08/01/23 RJA B CNC0600 CNLD-270
                                      WS-TRCN-INIT-DH-TIME
      *08/01/23 RJA E CNC0600 CNLD-270
           END-IF
           MOVE WS-TRCN-FILE-HOLD  TO WS-TRCN-FILE
           PERFORM P6050-FIND-PREP-TIME
           IF WS-TBL-PREP-TIME > ZEROES
              SET PARM-SUBTRACT       TO TRUE
      *08/01/23 RJA B CNC0600 CNLD-270  (TO HANDLE SETBACK TASK EFF TM)
      *       MOVE SCR08-ORDER-DATE   TO PARM-PRI-DATE-GREG
      *       MOVE SCR08-ORDER-TIME   TO PARM-PRI-HRMN
              MOVE WS-CALL-DATE       TO PARM-PRI-DATE-GREG
              MOVE WS-CALL-TIME       TO PARM-PRI-HRMN
      *08/01/23 RJA E CNC0600 CNLD-270
              MOVE WS-TBL-PREP-TIME   TO PARM-SEC-HRMN
              PERFORM P9700-LINK-P903
              IF NOT SUCCESS
                 MOVE 'P6040-1'      TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE PARM-RES-DATE-GREG TO WS-CALC-OD-DATE
              MOVE PARM-RES-HRMN      TO WS-CALC-OD-TIME
           ELSE
              IF WS-TBL-PREP-TIME = ZEROES
      *08/01/23 RJA B CNC0600 CNLD-270  (TO HANDLE SETBACK TASK EFF TM)
      *          MOVE SCR08-ORDER-DATE   TO WS-CALC-OD-DATE
      *          MOVE SCR08-ORDER-TIME   TO WS-CALC-OD-TIME
                 MOVE WS-CALL-DATE       TO WS-CALC-OD-DATE
                 MOVE WS-CALL-TIME       TO WS-CALC-OD-TIME
      *08/01/23 RJA E CNC0600 CNLD-270
              END-IF
           END-IF.
      *================================================================
       P6050-FIND-PREP-TIME.
      *================================================================
           MOVE SPACES                 TO WORK-CNTLKEY
           MOVE SPACES                 TO WS-CNTL-FILE
           MOVE '19'                   TO WK-CNTL-REC-TYPE
           MOVE SCR08-DIST             TO WK-CNTL-DIST
           MOVE SCR08-SUB-DIST         TO WK-CNTL-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NO-RECORD-FND
              MOVE '**'                TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
      *       READ DIST WITH ** VALUE
                 MOVE '**'             TO WK-CNTL-DIST
                 PERFORM P8610-READ-CNTLFILE
                 IF NOT SUCCESS
                    MOVE ZEROS TO WS-TBL-PREP-TIME
                 ELSE
                    PERFORM P6060-LOOK-UP-JOB-TYPE
                 END-IF
              ELSE
                 PERFORM P6060-LOOK-UP-JOB-TYPE
              END-IF
           ELSE
              IF NOT SUCCESS
                 MOVE ZEROS TO WS-TBL-PREP-TIME
              ELSE
                 PERFORM P6060-LOOK-UP-JOB-TYPE
              END-IF
           END-IF.
      *================================================================
       P6060-LOOK-UP-JOB-TYPE.
      *================================================================
      *THE VARIABLE JT IS ADJUSTED TO NO OF ROWS IN MAOX(CNP0DX) SCRN
      *
           SET JOB-TYPE-NOT-FOUND TO TRUE
           PERFORM VARYING JT FROM 1 BY 1
                   UNTIL JT > 36
                      OR JOB-TYPE-FOUND
               IF WS-JOB-TYPE = CNTL-PREP-JOB-TYPE(JT)
                  SET JOB-TYPE-FOUND TO TRUE
                  IF CNTL-PREP-PREP-TIME(JT) > SPACES
                     MOVE CNTL-PREP-PREP-TIME(JT) TO WS-TBL-PREP-TIME
                  ELSE
                     MOVE ZERO TO WS-TBL-PREP-TIME
               ELSE
                  CONTINUE
               END-IF
           END-PERFORM
      *INCLUDE READ TO CHECK FOR JOB TYPE '**'
           IF JOB-TYPE-NOT-FOUND
              PERFORM VARYING JT FROM 1 BY 1
                      UNTIL JT > 36
                         OR JOB-TYPE-FOUND
                  IF CNTL-PREP-JOB-TYPE(JT) = '**'
                     SET JOB-TYPE-FOUND TO TRUE
                     IF CNTL-PREP-PREP-TIME(JT) > SPACES
                        MOVE CNTL-PREP-PREP-TIME(JT) TO WS-TBL-PREP-TIME
                     ELSE
                        MOVE ZERO TO WS-TBL-PREP-TIME
                     END-IF
                  END-IF
              END-PERFORM
           END-IF
           IF JOB-TYPE-NOT-FOUND
              MOVE ZERO TO WS-TBL-PREP-TIME
           END-IF.
      *CNLD-244 #2 E

      *08/01/23 RJA B CNC0600 CNLD-270
      **CNLD-244 #2 B - SXG1
      **================================================================
      * P6070-CALC-PREP-TIME.
      **================================================================
      *     IF WS-PREP-OD-DATE NOT > SPACES
      *       AND WS-CAN-WRR-NEW
      *         MOVE ZEROES TO DATE-CONVERSION-PARMS
      *         PERFORM P6040-GET-PREP-TIME
      ** DONT MOVE SPACES, CALCULATE ORDERTIME MINUS PREP TIME.
      *         MOVE WS-CALC-OD-DATE    TO WS-PREP-OD-DATE
      *         MOVE WS-CALC-OD-TIME    TO WS-PREP-OD-TIME
      *     END-IF
      *     PERFORM VARYING FUNC-SUB FROM 1 BY 1
      *        UNTIL FUNC-SUB > ARRAY-MAX
      *         IF SCR08-CC(FUNC-SUB) > SPACES
      *           IF WS-PREP-OD-DATE > SPACES
      *            AND SCR08-OD-DATE(FUNC-SUB) NOT > SPACES
      *            AND WS-CAN-WRR-NEW
      *                MOVE WS-PREP-OD-DATE TO
      *                            SCR08-OD-DATE(FUNC-SUB)
      *                MOVE WS-PREP-OD-TIME TO
      *                            SCR08-OD-TIME(FUNC-SUB)
      *           END-IF
      *         END-IF
      *     END-PERFORM.
      **CNLD-244 #2 E - SXG1
      *08/01/23 RJA E CNC0600 CNLD-270
      *================================================================
       P6100-DETERMINE-DIVN-FLAG.
      *================================================================
           MOVE SPACES                TO WORK-CNTLKEY
           MOVE '01'                  TO WK-CNTL-REC-TYPE
           MOVE DIST OF WS-MSTR       TO WK-CNTL-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P6100-1'          TO ERR-PARAGRAPH
              MOVE CNTLKEY            TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           IF CNTL-WESTERN-DIVN
              SET WS-WESTERN-DIVN      TO TRUE
           ELSE
              MOVE SPACES              TO WS-WESTERN-DIVN-FLAG
           END-IF
      *CNC0484 JES
      *    UNDO THE WESTERN-DIVN-FLAG FOR GT(4) AND WC(2) DIVISIONS
           IF CNTL-GT-DIVN OR CNTL-WC-DIVN
      *CNC0436K JES 06/25/10
           OR DIST OF WS-MSTR = '38'
              MOVE SPACES              TO WS-WESTERN-DIVN-FLAG
           END-IF
           .
      ******************************************************************
      * THIS PARAGRAPH CONVERTS LOWER CASE CRAFTS TO UPPER CASE. CRAFTS
      * IN THE TASK RECORD LOADED BY TOPC ARE USUALLY IN LOWER CASE.
      *                                                          CW1296
      *****************************************************************
       P6140-CAPITALIZE-CRAFT.
      *
           PERFORM VARYING POS-CRAFT-SUB    FROM 1 BY 1
              UNTIL POS-CRAFT-SUB              > LENGTH OF WS-TOPC-POS
              IF WS-TOPC-POS-ENTRY(POS-CRAFT-SUB)
                                               < 'A'
                 MOVE ZERO                    TO WS-CAPITALIZE-NUM
                 MOVE WS-TOPC-POS-ENTRY(POS-CRAFT-SUB)
                                              TO WS-CAPITALIZE-BYTE
                 ADD 64                       TO WS-CAPITALIZE-NUM
                 MOVE WS-CAPITALIZE-BYTE
                   TO WS-TOPC-POS-ENTRY(POS-CRAFT-SUB)
              END-IF
           END-PERFORM
           .
      *
       P6500-FIND-ASGN-CLASS.
      *
           MOVE SPACES                       TO WS-ASGN-MERG-CLASS
                                                WORK-CNTLKEY
           MOVE P08CA-ASGN-KEY(FUNC-SUB)     TO WS-MERG-KEY
           IF UFP-ASGN
              MOVE '3A'                      TO WK-CNTL-REC-TYPE
              MOVE WS-MERG-DIST              TO WK-CNTL-DIST
              MOVE WS-MERG-SUB               TO WK-CNTL-SUB-DIST
              MOVE WS-MERG-POOL              TO WK-CNTL-POOL
              MOVE 'F'                       TO WK-CNTL-POOL-TYPE
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P6500-1'       TO ERR-PARAGRAPH
                 MOVE CNTLKEY         TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              ELSE
                 MOVE CNTL-POOL-MERGER-CLASS TO WS-ASGN-MERG-CLASS
              END-IF
           ELSE
              IF AJ-ASGN
                 MOVE WS-TRCN-FILE           TO SAVE-TRCN-FILE
                 MOVE SPACES                 TO TRCN-KEY3
                 MOVE WS-MERG-DIST           TO TRCN-DIST3
                 MOVE WS-MERG-SUB            TO TRCN-SDIST3
                 MOVE WS-MERG-REST           TO TRCN-ASSIGNMENT
                 MOVE TRCN-KEY3              TO TRCNKEY3
                 PERFORM P7900-READ-TRCNKEY3
                 MOVE TRCN-MERGER-CLASS      TO WS-ASGN-MERG-CLASS
                 MOVE SAVE-TRCN-FILE         TO WS-TRCN-FILE
              END-IF
           END-IF.
      *
       P7000-WRITE-TSQUEUE.
      *
      *
      *      WRITE MAP TSQUEUE
      *
           EXEC CICS ASSIGN
                EXTDS(WS-CICS-EXTDS-CODE)
           END-EXEC
      *
           IF SCREEN-HAS-EXT-ATTR
              EXEC CICS SEND STRFIELD
                        FROM(WS-STRFIELD)
                        LENGTH(WS-STRFIELD-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE           TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P7000-1'          TO ERR-PARAGRAPH
                 MOVE 'SEND STRFIELD'    TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
      *
           MOVE LENGTH OF WS-BUFFER-DATA TO WS-BUFFER-LGTH
           EXEC CICS RECEIVE BUFFER
                     INTO(WS-BUFFER-DATA)
                     LENGTH(WS-BUFFER-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF NOT SUCCESS AND NOT EOC
              MOVE 'P7000-2'             TO ERR-PARAGRAPH
              MOVE 'RECEIVE BUFFER'      TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE EIBCPOSN                 TO WS-BUFFER-CURSOR


           MOVE LENGTH OF WS-BUFFER-AREA TO P08TSQ-QLGTH
           MOVE EIBTRMID                 TO P08TSQ-MAP-TERM-ID
           EXEC CICS WRITEQ TS
                     QUEUE(P08TSQ-MAP-QUEUE-ID)
                     FROM(WS-BUFFER-AREA)
                     LENGTH(P08TSQ-QLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P7000-3'             TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE EIBTRMID TO P08TSQ-CA-TERM-ID
           EXEC CICS WRITEQ TS
                     QUEUE(P08TSQ-CA-QUEUE-ID)
                     FROM(PSTCOMM-AREA)
                     LENGTH(P08-COMM-LGTH)
                     ITEM(P08TSQ-QUEUE-ITEM)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P7000-4'             TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P7010-READ-TSQUEUE.
      *
      *              READ THE MAPS TSQUEUE
      *
           MOVE LENGTH OF WS-BUFFER-AREA TO P08TSQ-QLGTH
           MOVE EIBTRMID                 TO P08TSQ-MAP-TERM-ID
           EXEC CICS READQ TS
                     QUEUE(P08TSQ-MAP-QUEUE-ID)
                     INTO(WS-BUFFER-AREA)
                     LENGTH(P08TSQ-QLGTH)
                     ITEM(P08TSQ-QUEUE-ITEM)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE              TO FILE-STATUS
           IF SUCCESS
              SET SEND-BUFFER            TO TRUE
           ELSE
              SET CREATE-SCREEN          TO TRUE
              MOVE LOW-VALUES            TO PSTS08
           END-IF
           MOVE EIBTRMID TO P08TSQ-CA-TERM-ID
           EXEC CICS READQ TS
                     QUEUE(P08TSQ-CA-QUEUE-ID)
                     INTO(PSTCOMM-AREA)
                     LENGTH(P08-COMM-LGTH)
                     ITEM(P08TSQ-QUEUE-ITEM)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE SPACES TO PSTCOMM-AREA
           END-IF
           PERFORM P7020-DELETE-TSQUEUE.
      *
       P7020-DELETE-TSQUEUE.
      *
           MOVE EIBTRMID TO P08TSQ-MAP-TERM-ID
           EXEC CICS DELETEQ TS
                     QUEUE(P08TSQ-MAP-QUEUE-ID)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE EIBTRMID TO P08TSQ-CA-TERM-ID
           EXEC CICS DELETEQ TS
                     QUEUE(P08TSQ-CA-QUEUE-ID)
                     RESP(WS-RESPONSE)
           END-EXEC.
      *
       P7900-READ-TRCNKEY3.
      *
           EXEC CICS READ
                     DATASET(TRAIN-CN-VIA-DSD-ASGN)
                     INTO(WS-TRCN-FILE)
                     LENGTH(TRAINCN-DSD-RLGTH)
                     RIDFLD(TRCNKEY3)
                     KEYLENGTH(TRAINCN-DSD-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P7900-1' TO ERR-PARAGRAPH
              MOVE TRCNKEY3  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P8000-READ-TRCNKEY1.
      *
           EXEC CICS READ
                     DATASET(TRAIN-CN-VIA-TRCNKEY1)
                     INTO(WS-TRCN-FILE)
                     LENGTH(TRAINCN-RLGTH)
                     RIDFLD(TRCNKEY1)
                     KEYLENGTH(TRAINCN-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8000-1' TO ERR-PARAGRAPH
              MOVE TRCNKEY1  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE SPACES       TO WS-SAVE-ALT-EN-TK-PROFILE
                                WS-SAVE-ALT-TR-TK-PROFILE
                                WS-SAVE-ALT-EN-AWAY-FL
                                WS-SAVE-ALT-TR-AWAY-FL
      *CNC0544-BEG
                                WS-SAVE-ALT-SOURCE-FLAG
      *CNC0544-END
           IF  TRCN-CHECK-TOPC-STA-FLAG = 'Y'
               PERFORM P8999-GET-ALT-CREW-SOURCE
           END-IF.
      *CNC0520-BEG
      *
       P8001-READ-TRCNKEY1-ONLY.
      *
           EXEC CICS READ
                     DATASET(TRAIN-CN-VIA-TRCNKEY1)
                     INTO(WS-TRCN-FILE)
                     LENGTH(TRAINCN-RLGTH)
                     RIDFLD(TRCNKEY1)
                     KEYLENGTH(TRAINCN-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8001-1' TO ERR-PARAGRAPH
              MOVE TRCNKEY1  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *CNC0520-END
      *
       P8010-GET-NEXT-YARD-PROFILE.
      *
           MOVE ' ' TO PROFILE-FOUND-CODE
           MOVE WK-TRCNKEY2 TO TRCNKEY2
           EXEC CICS STARTBR
                     DATASET(TRAIN-CN-VIA-ORG-ASGN)
                     RIDFLD(TRCNKEY2)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF SUCCESS
              MOVE '0' TO WS-DONE-CODE
              PERFORM UNTIL DONE
                 EXEC CICS READNEXT
                           DATASET(TRAIN-CN-VIA-ORG-ASGN)
                           INTO(WS-TRCN-FILE)
                           LENGTH(TRAINCN-ORG-RLGTH)
                           RIDFLD(TRCNKEY2)
                           KEYLENGTH(TRAINCN-ORG-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS
                    IF TRCN-KEY2 = WK-TRCNKEY2
                       AND PFKEY12
                       CONTINUE
                    ELSE
                       MOVE TRCN-ASSIGNMENT   TO JOB-DEF-CHECK
                       IF TRCN-YARD-REC
                          AND NOT JOB-DEF-RELIEF-ASGN
                          SET DONE TO TRUE
                       END-IF
                    END-IF
                 ELSE
                    SET DONE TO TRUE
                 END-IF
              END-PERFORM
              MOVE WS-RESPONSE TO FILE-STATUS
              IF SUCCESS
                 IF TRCN-ORIGIN-STN = WK-TRCN-ORG-STATION
                    AND (PFKEY12 OR TRCN-TRAIN-ASGN = SCR08-ASGN)
                    IF TRCN-YARD-REC
                       SET PROFILE-FOUND TO TRUE
                    ELSE
                       SET PROFILE-NOT-YARD-JOB TO TRUE
                    END-IF
                 END-IF
              ELSE
                 IF NOT (NO-RECORD-FND OR END-OF-FILE)
                    MOVE 'P8010-1'    TO ERR-PARAGRAPH
                    MOVE TRCNKEY2     TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
              EXEC CICS ENDBR
                        DATASET(TRAIN-CN-VIA-ORG-ASGN)
                        RESP(WS-RESPONSE)
              END-EXEC
           ELSE
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P8010-2'    TO ERR-PARAGRAPH
                 MOVE TRCNKEY2     TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P8020-GET-ASGN-EMPS.
      *
           MOVE ZEROS  TO ASGN-OWNER
                          ASGN-TEMPORARY-EMP
                          ASGN-ON-DUTY-EMP
           IF DAILY-MARK-YARD
              AND WK-ASGN-JOB-TYPE = 'A'
              AND NOT JSK2-ASGN-SPAREBOARD
              MOVE WK-ASGN-DIST               TO SWASSGN-K-DISTRICT
              MOVE WK-ASGN-SUB-DIST           TO SWASSGN-K-SUB-DIST
              MOVE WK-ASGN-ASSIGN             TO SWASSGN-K-ASSIGN
              MOVE P08CA-CALL-DAY-OF-WEEK-NUM TO SWASSGN-K-DAY
              MOVE SWASSGN-KEY                TO SWJOBKEY
              EXEC CICS READ
                        DATASET(SWASSGN-VIA-ASSIGNMENT)
                        INTO(WS-SWASSGN-FILE)
                        LENGTH(SWASSIGN-RLGTH)
                        RIDFLD(SWJOBKEY)
                        KEYLENGTH(SWASSIGN-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
                 IF NOT NO-RECORD-FND
                    MOVE 'P8020-1' TO ERR-PARAGRAPH
                    MOVE SWJOBKEY  TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              ELSE
                 IF WS-CALL-DATE = SWASSGN-DATE
                    AND CALLER-CONFIRMED
                    MOVE SWASSGN-EMP-NO TO ASGN-OWNER
                 END-IF
              END-IF
           END-IF
           IF NOT HAVE-ASGN-OWNER
              PERFORM PXXXX-JOB-OWNER
              IF ASGN-EMP-NO > ZERO
                 MOVE ASGN-EMP-NO TO ASGN-OWNER
              END-IF
              PERFORM PXXXX-LATEST-TEMP
              IF ASGN-EMP-NO > ZERO
                 MOVE ASGN-EMP-NO TO ASGN-TEMPORARY-EMP
              END-IF
           END-IF
           PERFORM PXXXX-ON-DUTY-EMP
           IF ASGN-EMP-NO > ZERO
              MOVE ASGN-EMP-NO TO ASGN-ON-DUTY-EMP
           END-IF.
      *
       P8030-DELETE-MU-ASGN.
      *
      *    THIS PARAGRAPH WILL DELETE ANY ASSIGNMENTS THAT WERE
      *    'MADE UP' DURING THIS TRANSACTION BUT NOT USED AS LONG
      *    AS THAT ASSIGNMENT HAS NOT BEEN CALLED AND IF MARRIED
      *    TO ANOTHER, THEIR PARTNER(S) HAVE NOT BEEN CALLED
      *
           PERFORM P8060-RELEASE-TRACKING
           IF UFP-CALL
              MOVE P08CA-PROFILE-KEY     TO TRCNKEY1
              PERFORM P8000-READ-TRCNKEY1
              IF TRCN-EN-FROM-DIST > SPACES
                 MOVE SPACES             TO WORK-CNTLKEY
                 MOVE TRCN-EN-FROM-DIST  TO WK-CNTL-DIST
                 MOVE TRCN-EN-FROM-SDIST TO WK-CNTL-SUB-DIST
                 MOVE TRCN-EN-FROM-POOL  TO WK-CNTL-POOL
                 PERFORM P0370-SET-EN-MARRIED-FLAGS
              END-IF
              IF TRCN-TR-FROM-DIST > SPACES
                 MOVE SPACES             TO WORK-CNTLKEY
                 MOVE TRCN-TR-FROM-DIST  TO WK-CNTL-DIST
                 MOVE TRCN-TR-FROM-SDIST TO WK-CNTL-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL  TO WK-CNTL-POOL
                 PERFORM P0380-SET-TR-MARRIED-FLAGS
              END-IF
           END-IF
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              IF P08CA-ASGN-KEY(FUNC-SUB)    > SPACES OR
                 P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
                 IF P08CA-ASGN-MU(FUNC-SUB)
                    IF UFP-CALL
      *C1019 - BEG
                       MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN
                       PERFORM P8600-READ-UFPTURN
                       IF  SUCCESS
                       AND OUT-OF-TOWN
                           CONTINUE
                       ELSE
      *C1019 - END
      *C1195 - BEG
                          IF TEMPORARY-TURN
      *C1195 - END
                          MOVE SPACES                TO WORK-CNTLKEY
                          IF P08CA-ASGN-CC(FUNC-SUB)
                             = ('EN' OR 'SE' OR 'FI' OR 'ET')
                             MOVE TRCN-EN-FROM-DIST  TO WK-CNTL-DIST
                             MOVE TRCN-EN-FROM-SDIST TO WK-CNTL-SUB-DIST
                             MOVE TRCN-EN-FROM-POOL  TO WK-CNTL-POOL
                             IF NOT (P08CA-NO-SCHED(FUNC-SUB)
      *CNC0499 - 11/21/16 - BEG
                                OR P08CA-SCHED-BIDPACK(FUNC-SUB)
      *CNC0499 - 11/21/16 - END
                                OR P08CA-SCHED-COMPLETE(FUNC-SUB))
                                IF P08CA-SCHED-ALT(FUNC-SUB)
      *CNC0499 - 02/17/17 - BEG
                                OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
      *CNC0499 - 02/17/17 - END
                                   MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                                        TO WK-CNTL-DIST
                                   MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                                   MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                                        TO WK-CNTL-POOL
                                ELSE
                                   MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                                        TO WK-CNTL-DIST
                                   MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                                   MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                                        TO WK-CNTL-POOL
                                END-IF
                             END-IF
                             PERFORM P0370-SET-EN-MARRIED-FLAGS
                          ELSE
                             MOVE TRCN-TR-FROM-DIST  TO WK-CNTL-DIST
                             MOVE TRCN-TR-FROM-SDIST TO WK-CNTL-SUB-DIST
                             MOVE TRCN-TR-FROM-POOL  TO WK-CNTL-POOL
                             IF NOT (P08CA-NO-SCHED(FUNC-SUB)
      *CNC0499 - 11/21/16 - BEG
                                OR P08CA-SCHED-BIDPACK(FUNC-SUB)
      *CNC0499 - 11/21/16 - END
                                OR P08CA-SCHED-COMPLETE(FUNC-SUB))
                                IF P08CA-SCHED-ALT(FUNC-SUB)
      *CNC0499 - 02/17/17 - BEG
                                OR P08CA-SCHED-ALT-BIDPACK(FUNC-SUB)
      *CNC0499 - 02/17/17 - END
                                   MOVE P08CA-SCHD-DIST-ALT(FUNC-SUB)
                                                        TO WK-CNTL-DIST
                                   MOVE P08CA-SCHD-SDIST-ALT(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                                   MOVE P08CA-SCHD-POOL-ALT(FUNC-SUB)
                                                        TO WK-CNTL-POOL
                                ELSE
                                   MOVE P08CA-SCHD-DIST(FUNC-SUB)
                                                        TO WK-CNTL-DIST
                                   MOVE P08CA-SCHD-SDIST(FUNC-SUB)
                                                     TO WK-CNTL-SUB-DIST
                                   MOVE P08CA-SCHD-POOL(FUNC-SUB)
                                                        TO WK-CNTL-POOL
                                END-IF
                             END-IF
                             PERFORM P0380-SET-TR-MARRIED-FLAGS
                          END-IF
                          MOVE P08CA-ASGN-CC(FUNC-SUB) TO
                                                      SCR08-CC(FUNC-SUB)
                          PERFORM P0390-SETUP-ASSOC-CRAFTS
                          IF ASSOCIATED-OPT-TURN
                             OR WS-ASSOCIATED-CRAFT-ARRAY NOT > SPACES
                             PERFORM P8040-PROCESS-DELETE
                          ELSE
                             IF NOT ASSOCIATED-TURN
                                MOVE ' ' TO ERRORS-FOUND-CODE
                                PERFORM VARYING CRAFT-SUB FROM 1 BY 1
                                   UNTIL CRAFT-SUB > CRAFT-ARRAY-MAX
                                   IF WS-ASSOC-CRAFT(CRAFT-SUB) > SPACE
                                      PERFORM VARYING SUB2 FROM 1 BY 1
                                         UNTIL SUB2 > ARRAY-MAX
                                         IF P08CA-ASGN-CC(SUB2)
                                            = WS-ASSOC-CRAFT(CRAFT-SUB)
                                            IF P08CA-ASGN-SET(SUB2)
                                               MOVE ARRAY-MAX TO SUB2
                                               MOVE CRAFT-ARRAY-MAX
                                                  TO CRAFT-SUB
                                               SET ERRORS-FOUND TO TRUE
                                            END-IF
                                         END-IF
                                      END-PERFORM
                                   END-IF
                                END-PERFORM
                                IF NOT ERRORS-FOUND
                                   PERFORM P8040-PROCESS-DELETE
                                END-IF
                             END-IF
                          END-IF
      *C1195 - BEG
                          END-IF
      *C1195 - END
      *C1019 - BEG
                       END-IF
      *C1019 - END
                    ELSE
                       PERFORM P8040-PROCESS-DELETE
                    END-IF
                 END-IF
              END-IF
           END-PERFORM.
      *
       P8040-PROCESS-DELETE.
      *
           IF UFP-CALL
              MOVE SPACES                   TO P915-COMMAREA-PARMS
              SET P915-DELETE-FUNCTION      TO TRUE
              MOVE P08CA-ASGN-KEY(FUNC-SUB) TO P915-TURN-PARM
              EXEC CICS LINK
                        PROGRAM(P915-PGM)
                        COMMAREA(P915-COMMAREA-PARMS)
                        LENGTH(P915-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P8040-1'             TO ERR-PARAGRAPH
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
              MOVE P08CA-ASGN-KEY(FUNC-SUB) TO AJJOBKEY
              PERFORM P8600-READ-AJJOBKEY
              IF SUCCESS
                 IF NOT AJ-JOB-ON-DUTY
                    MOVE SPACES                   TO P921-COMMAREA-PARMS
                    SET P921-DELETE-FUNCTION      TO TRUE
                    MOVE P08CA-ASGN-KEY(FUNC-SUB) TO P921-AJ-PARM
                    MOVE SCR08-OD-DATE(FUNC-SUB)  TO P921-EFF-DATE
                    MOVE SCR08-OD-TIME(FUNC-SUB)  TO P921-EFF-TIME
                    IF P921-EFF-DATE-TIME     NOT  > '0000000000'
                       MOVE WS-PRESENT-TIME       TO P921-EFF-DATE-TIME
                    END-IF
                    MOVE PSTCA-TIME-ZONE          TO P921-TIME-ZONE
                    EXEC CICS LINK
                              PROGRAM(P921-PGM)
                              COMMAREA(P921-COMMAREA-PARMS)
                              LENGTH(P921-LGTH)
                              RESP(WS-RESPONSE)
                    END-EXEC
                    MOVE WS-RESPONSE              TO FILE-STATUS
                    IF NOT SUCCESS
                       MOVE 'P8040-2'             TO ERR-PARAGRAPH
                       PERFORM P9999-GOT-PROBLEM
                    END-IF
                 END-IF
              ELSE
                 IF NOT NO-RECORD-FND
                    MOVE 'P8040-3'          TO ERR-PARAGRAPH
                    MOVE AJJOBKEY           TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-IF.
      *
       P8050-GET-TIME-ZONE.
      *
           MOVE SPACES                TO WORK-CNTLKEY
           MOVE '02'                  TO WK-CNTL-REC-TYPE
           MOVE SCR08-DIST            TO WK-CNTL-DIST
                                         PSTCA-DIST
           MOVE SCR08-SUB-DIST        TO WK-CNTL-SUB-DIST
                                         PSTCA-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P8050-1'       TO ERR-PARAGRAPH
              MOVE CNTLKEY         TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
      *CNLD-244 #2 B - RPV1
           MOVE CNTL-CAN-WRR-FLAG  TO WS-CAN-WRR-FLAG
      *CNLD-265-B
           MOVE CNTL-US-DOM        TO WS-US-DOM-FL
      *CNLD-265-E
      *CNLD-244 #2 E - RPV1
           MOVE CNTL-TIME-ZONE     TO PSTCA-TIME-ZONE.
      *
       P8060-RELEASE-TRACKING.
      *
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              IF P08CA-ASGN-KEY(FUNC-SUB) > SPACES
                 IF  NOT P08CA-ASGN-SET(FUNC-SUB)
                 AND NOT P08CA-ASGN-IVR(FUNC-SUB)
      *C1100 - BEG
                    INITIALIZE ASGN-EMP-NO
                    IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
                       MOVE P08CA-ASGN-ID(FUNC-SUB) TO JOB-DEF-CHECK
                       IF JOB-DEF-LOCAL-ASGN OR JOB-DEF-YARD-ASGN
                          MOVE 'A'                   TO WK-ASGN-JOB-TYPE
                       ELSE
                          MOVE 'U'                   TO WK-ASGN-JOB-TYPE
                       END-IF
                       MOVE P08CA-ASGN-KEY-XB(FUNC-SUB)(2:12)
                                            TO WK-ASGN-ASSIGNMENT
                    ELSE
                       MOVE P08CA-ASGN-TYP(FUNC-SUB) TO WK-ASGN-JOB-TYPE
                       MOVE P08CA-ASGN-KEY(FUNC-SUB)
                                            TO WK-ASGN-ASSIGNMENT
                    END-IF
                    PERFORM PXXXX-ON-DUTY-EMP
                    IF ASGN-EMP-NO > ZERO
                       CONTINUE
                    ELSE
      *C1100 - END
                       PERFORM P8070-UPDATE-TRACKING
                    END-IF
                 END-IF
              END-IF
           END-PERFORM.
      *
       P8070-UPDATE-TRACKING.
      *
           MOVE SPACES                      TO P938-COMMAREA-PARMS
           SET P938-CANCEL-FUNCTION         TO TRUE
      *MET 06/08/2006
           IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
              MOVE P08CA-ASGN-KEY-XB(FUNC-SUB)(2:12)
                                            TO P938-ASGN-PARM
           ELSE
              MOVE P08CA-ASGN-KEY(FUNC-SUB) TO P938-ASGN-PARM
           END-IF
           MOVE P08CA-ORDER-DATE-TIME       TO P938-EFF-DATE-TIME
           MOVE PSTCA-TIME-ZONE             TO P938-TIME-ZONE
           IF YARD-CALL OR LOCAL-CALL
              SET P938-ASGN-AJ              TO TRUE
              SET P938-ASGN-IS-HOME         TO TRUE
              SET P938-CANCEL-IN-TOWN       TO TRUE
              SET AJ-ASGN                   TO TRUE
              PERFORM P6500-FIND-ASGN-CLASS
              MOVE WS-ASGN-MERG-CLASS       TO P938-ASGN-MERG-CLASS
           ELSE
              SET P938-ASGN-UFP             TO TRUE
              MOVE P08CA-ASGN-KEY(FUNC-SUB) TO UFPTURN
              SET UFP-ASGN                  TO TRUE
              PERFORM P6500-FIND-ASGN-CLASS
              MOVE WS-ASGN-MERG-CLASS       TO P938-ASGN-MERG-CLASS
              PERFORM P8600-READ-UFPTURN
              IF SUCCESS
                 IF DIST IN WS-UFP = DIST2
                    AND SUB-DIST IN WS-UFP = SUB-DIST2
                    AND POOL-NAME IN WS-UFP = POOL-NAME2
                    AND IN-TOWN
                    SET P938-ASGN-IS-HOME   TO TRUE
                    SET P938-CANCEL-IN-TOWN TO TRUE
                 END-IF
              ELSE
                 IF NO-RECORD-FND
                    SET P938-ASGN-IS-HOME   TO TRUE
                 ELSE
                    MOVE 'P8070-1'          TO ERR-PARAGRAPH
                    MOVE UFPTURN            TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              END-IF
           END-IF
           IF P938-ASGN-IS-HOME
              EXEC CICS LINK
                        PROGRAM(P938-PGM)
                        COMMAREA(P938-COMMAREA-PARMS)
                        LENGTH(P938-LGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE              TO FILE-STATUS
              IF NOT SUCCESS
                 MOVE 'P8070-2'             TO ERR-PARAGRAPH
                 MOVE 'P938LINK'            TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P8080-INITIATE-TRACKING.
      *
           MOVE SPACES                      TO P938-COMMAREA-PARMS
           SET P938-INITIATE-FUNCTION       TO TRUE
           MOVE TRCN-EN-REST-REQ            TO P938-INIT-EN-REST-REQ
           MOVE TRCN-TR-REST-REQ            TO P938-INIT-TR-REST-REQ
           IF YARD-CALL OR LOCAL-CALL
              SET P938-ASGN-AJ              TO TRUE
           ELSE
              SET P938-ASGN-UFP             TO TRUE
           END-IF
           IF P08CA-ASGN-KEY-XB(FUNC-SUB) > SPACES
              MOVE P08CA-ASGN-KEY-XB(FUNC-SUB)(2:12)
                                            TO P938-ASGN-PARM
           ELSE
              MOVE P08CA-ASGN-KEY(FUNC-SUB) TO P938-ASGN-PARM
           END-IF
           MOVE SCR08-ORDER-DATE            TO P938-EFF-DATE
           MOVE SCR08-ORDER-TIME            TO P938-EFF-TIME
           MOVE PSTCA-TIME-ZONE             TO P938-TIME-ZONE
           IF YARD-CALL
              MOVE SCR08-ASGN               TO P938-INIT-TRAIN
           ELSE
              STRING SCR08-ASGN
                     SCR08-ASGN-TYPE
                     DELIMITED BY SIZE
                     INTO P938-INIT-TRAIN
           END-IF
           MOVE P08CA-TRK-REASON(FUNC-SUB)  TO P938-INIT-REASON
           IF P938-INIT-RJH
              MOVE P08CA-EMP-NO(FUNC-SUB)   TO P938-INIT-EMP-NO
              IF P08CA-ASGN-IS-VCNY(FUNC-SUB) OR
                 P08CA-ASGN-IS-BOTH(FUNC-SUB)
                 SET P938-INIT-VCNY-FILL    TO TRUE
              ELSE
                 SET P938-INIT-REG-MAN      TO TRUE
              END-IF
           ELSE
              MOVE P08CA-REG-EMP-NO(FUNC-SUB) TO P938-INIT-EMP-NO
              SET P938-INIT-REG-MAN         TO TRUE
           END-IF
           EXEC CICS LINK
                     PROGRAM(P938-PGM)
                     COMMAREA(P938-COMMAREA-PARMS)
                     LENGTH(P938-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                 TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8080-1'                TO ERR-PARAGRAPH
              MOVE 'P938LINK'               TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P8090-LINK-942-SEN-ANAL.
      *
           EXEC CICS LINK
                     PROGRAM(P942-PGM)
                     COMMAREA(P942-COMMAREA-PARMS)
                     LENGTH(P942-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE     TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8090-1'    TO ERR-PARAGRAPH
              MOVE 'P942LINK'   TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
      ******************************************************************
       P8100-READ-TKCR.
      *                                                         CW0297
      ******************************************************************
      *
           EXEC CICS READ
                     DATASET(TKCR-FILE-VIA-TKCRKEY)
                     INTO(WS-TKCR-FILE)
                     LENGTH(TKCRFILE-RLGTH)
                     RIDFLD(TKCRKEY)
                     KEYLENGTH(TKCRFILE-KLGTH)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P8020-1'       TO ERR-PARAGRAPH
                 MOVE TKCRKEY         TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P8200-READ-AHIST.
           EXEC CICS READ
                     DATASET(AH-DATASET)
                     INTO(WS-AHIST)
                     LENGTH(AH1-RLGTH)
                     RIDFLD(AH1KEY)
                     KEYLENGTH(AH1-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS.
      *
       P8210-READ-AHIST-UPD.
           EXEC CICS READ
                     UPDATE
                     DATASET(AH-DATASET)
                     INTO(WS-AHIST)
                     LENGTH(AH1-RLGTH)
                     RIDFLD(AH1KEY)
                     KEYLENGTH(AH1-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS.
      *
       P8220-REWRITE-AHIST.
      *
           EXEC CICS REWRITE
                     DATASET(AH-DATASET)
                     FROM(WS-AHIST)
                     LENGTH(AH1-RLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8220-1'                  TO ERR-PARAGRAPH
              MOVE AH1KEY                     TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *CNC0562 - BEG
      *
       P8250-READ-AHM.
      *
           EXEC CICS READ
                     DATASET(AHM-DATASET)
                     INTO(WS-AHIST-MISC)
                     LENGTH(AHM-RLGTH)
                     RIDFLD(AHMKEY)
                     KEYLENGTH(AHM-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE           TO FILE-STATUS
           .
      *CNC0562 - END
      *
       P8300-READ-JOB-HIST.
      *
           EXEC CICS READ
                     DATASET(JHIST-VIA-JOB)
                     INTO(WS-JOB-HIST)
                     LENGTH(JHISTJOB-RLGTH)
                     RIDFLD(JHISTJOB)
                     KEYLENGTH(JHISTJOB-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS.
      *
       P8310-WRITE-JOB-HIST.
      *
           EXEC CICS WRITE
                     DATASET(JHIST-VIA-JOB)
                     FROM(WS-JOB-HIST)
                     LENGTH(JHISTJOB-RLGTH)
                     RIDFLD(JHISTJOB)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS.
      *
       P8500-READ-MASTER.
      *
           IF NOT VACATE-FUNCTION
              EXEC CICS READ
                        DATASET(MSTR-VIA-EMP-NBR)
                        INTO(WS-MSTR)
                        LENGTH(MSTRENBR-RLGTH)
                        RIDFLD(MSTRNBRK)
                        KEYLENGTH(MSTRENBR-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF SUCCESS
                 PERFORM P8510-READ-MASTER-JOBS
              ELSE
                 MOVE 'P8500' TO ERR-PARAGRAPH
                 MOVE MSTRNBRK TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           ELSE
      *C1010-BEG
      *       MOVE SPACES          TO WS-MSTR
              IF P08CA-ASGN-NO-VCNY(FUNC-SUB)
                 EXEC CICS READ
                           DATASET(MSTR-VIA-EMP-NBR)
                           INTO(WS-MSTR)
                           LENGTH(MSTRENBR-RLGTH)
                           RIDFLD(MSTRNBRK)
                           KEYLENGTH(MSTRENBR-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE  TO FILE-STATUS
                 IF SUCCESS
                    PERFORM P8510-READ-MASTER-JOBS
                 ELSE
                    MOVE 'P8500-2' TO ERR-PARAGRAPH
                    MOVE MSTRNBRK  TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
              ELSE
                 MOVE SPACES       TO WS-MSTR
              END-IF
      *C1010-END
           END-IF.
      *
       P8505-READ-MASTER-ONLY.
      *
           EXEC CICS READ
                     DATASET(MSTR-VIA-EMP-NBR)
                     INTO(WS-MSTR)
                     LENGTH(MSTRENBR-RLGTH)
                     RIDFLD(MSTRNBRK)
                     KEYLENGTH(MSTRENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8505-1'  TO ERR-PARAGRAPH
              MOVE MSTRNBRK   TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P8510-READ-MASTER-JOBS.
      *
           MOVE SPACES                 TO WS-ASGN-FILE
           MOVE EMP-NBR OF WS-MSTR     TO WK-ASGN-EMP-NO
      *CNC0534 - BEG
      *    PERFORM PXXXX-JOB-OWNED
           PERFORM PXXXX-JOB-OWNED1
      *CNC0534 - END
           MOVE ASGN-JOB-TYPE          TO NORMAL-ASGNMT-FLAG
           MOVE ASGN-ASSIGNMENT        TO NORMAL-ASGNMT
           MOVE SPACES                 TO WS-ASGN-FILE
      *C983-BEG
           MOVE EMP-NBR OF WS-MSTR     TO ASGN-EMP-NO
      *C983-END
           PERFORM PXXXX-LATEST-TEMP-JOB
           MOVE ASGN-JOB-TYPE          TO TEMPORARY-ASGNMT-FLAG
           MOVE SPACES                 TO TEMP-ASGN-XB-AUG-FLAG
           IF ASGN-JOB-TYPE = 'X'
              AND AUGMENTED-TO-EXTRA-BOARD
              SET TEMP-ASGN-XB-AUG    TO TRUE
           END-IF
           MOVE ASGN-ASSIGNMENT        TO TEMPORARY-ASGNMT
           MOVE SPACE                  TO WS-ASGN-FILE
      *C983-BEG
           MOVE EMP-NBR OF WS-MSTR     TO ASGN-EMP-NO
      *C983-END
           PERFORM PXXXX-JOB-ON-DUTY
           MOVE ASGN-JOB-TYPE          TO ON-DUTY-ASGNMT-FLAG
           MOVE ASGN-ASSIGNMENT        TO ON-DUTY-ASGNMT
           MOVE ASGN-ON-DUTY-DATE-TIME TO ON-DUTY-OUT-TOWN-CODE.
      *C983-BEG
           EXEC SQL INCLUDE HOMEAWAY END-EXEC.
      *C983-END
      *
       P8520-READ-MASTER3.
      *
           EXEC CICS READ
                     DATASET(MSTR3-VIA-EMP-NBR)
                     INTO(WS-MSTR3)
                     LENGTH(MSTR3ENBR-RLGTH)
                     RIDFLD(MSTR3NBRK)
                     KEYLENGTH(MSTR3ENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT (SUCCESS OR NO-RECORD-FND)
              MOVE 'P8520-1'                  TO ERR-PARAGRAPH
              MOVE MSTR3NBRK                  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
      *CNC0600-B
           ELSE
              SET WS-MSTR3-REC-FOUND          TO TRUE
      *CNC0600-E
           END-IF
           .
      *
       P8530-READ-TELE-UPDATE.
      *
           EXEC CICS READ
                     UPDATE
                     DATASET(TELE-VIA-EMP-NBR)
                     INTO(WS-TELE-FILE)
                     LENGTH(TELEENBR-RLGTH)
                     RIDFLD(TELENBRK)
                     KEYLENGTH(TELEENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT (SUCCESS OR NO-RECORD-FND)
              MOVE 'P8530-1'                  TO ERR-PARAGRAPH
              MOVE TELENBRK                   TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P8540-REWRITE-TELE.
      *
           EXEC CICS REWRITE
                     DATASET(TELE-VIA-EMP-NBR)
                     FROM(WS-TELE-FILE)
                     LENGTH(TELEENBR-RLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8540-1'                  TO ERR-PARAGRAPH
              MOVE TELENBRK                   TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P8550-WRITE-TELE.
      *
           EXEC CICS WRITE
                     DATASET(TELE-VIA-EMP-NBR)
                     FROM(WS-TELE-FILE)
                     LENGTH(TELEENBR-RLGTH)
                     RIDFLD(TELENBRK)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8550-1'                  TO ERR-PARAGRAPH
              MOVE MSTR3NBRK                  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P8560-READ-TELE.
      *
           EXEC CICS READ
                     DATASET(TELE-VIA-EMP-NBR)
                     INTO(WS-TELE-FILE)
                     LENGTH(TELEENBR-RLGTH)
                     RIDFLD(TELENBRK)
                     KEYLENGTH(TELEENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT (SUCCESS OR NO-RECORD-FND)
              MOVE 'P8560-1'                  TO ERR-PARAGRAPH
              MOVE TELENBRK                   TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P8600-READ-UFPTURN.
      *
           EXEC CICS READ
                     DATASET(UFP-VIA-TURN-NBR)
                     INTO(WS-UFP)
                     LENGTH(UFPTURN-RLGTH)
                     RIDFLD(UFPTURN)
                     KEYLENGTH(UFPTURN-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS.
      *
       P8600-READ-AJJOBKEY.
      *
           EXEC CICS READ
                     DATASET(AJ-VIA-JNAME-JCRAFT)
                     INTO(WS-ASGNED-JOBS)
                     LENGTH(AJNAMECR-RLGTH)
                     RIDFLD(AJJOBKEY)
                     KEYLENGTH(AJNAMECR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS.
      *
       P8610-READ-CNTLFILE.
      *
           MOVE WORK-CNTLKEY TO CNTLKEY
           EXEC CICS READ
                     DATASET(CNTL-FILE-VIA-CNTLKEY)
                     INTO(WS-CNTL-FILE)
                     LENGTH(CNTLFILE-RLGTH)
                     RIDFLD(CNTLKEY)
                     KEYLENGTH(CNTLFILE-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS.
      *
       P8620-READ-SENKEY2.
      *
           EXEC CICS READ
                     DATASET(SENFILE-VIA-EMP-NO)
                     INTO(WS-SENIORITY)
                     LENGTH(SENENBR-RLGTH)
                     RIDFLD(SENKEY2)
                     KEYLENGTH(SENENBR-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE           TO FILE-STATUS.
      *
       P8630-READ-DECISION.
      *
           EXEC CICS READ
                     DATASET(DEC-TABLE-VIA-DECKEY)
                     INTO(WORK-DEC-TABLE)
                     LENGTH(DECTABLE-RLGTH)
                     RIDFLD(DECKEY)
                     KEYLENGTH(DECTABLE-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              IF NOT (NO-RECORD-FND OR END-OF-FILE)
                 MOVE 'P8630-1' TO ERR-PARAGRAPH
                 MOVE DECKEY    TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF.
      *
       P8640-REWRITE-UFPTURN.
      *
           EXEC CICS REWRITE
                     DATASET(UFP-VIA-TURN-NBR)
                     FROM(WS-UFP)
                     LENGTH(UFPTURN-RLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8640-1'    TO ERR-PARAGRAPH
              MOVE UFPTURN-AREA TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
           IF UFP-POS-DATE-TIME(1:2) < '90' AND
              UFP-POS-DATE-TIME(3:2) > '00'
              MOVE WS-CNTL-FILE                 TO HOLD-ZAP-REC
              MOVE SPACES                       TO WS-CNTL-FILE
              SET POOL-TYPE-REC                 TO TRUE
              MOVE 'F'                          TO CNTL-POOL-TYPE
              MOVE DIST OF UFPPOS-AREA          TO CNTL-DIST
              MOVE SUB-DIST OF UFPPOS-AREA      TO CNTL-SUB-DIST
              MOVE POOL-NAME OF UFPPOS-AREA     TO CNTL-POOL-CODE
              MOVE CNTLKEY-AREA                 TO CNTLKEY
              EXEC CICS READ
                        DATASET(CNTL-FILE-VIA-CNTLKEY)
                        INTO(WS-CNTL-FILE)
                        LENGTH(CNTLFILE-RLGTH)
                        RIDFLD(CNTLKEY)
                        KEYLENGTH(CNTLFILE-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE TO FILE-STATUS
              IF SUCCESS
                 MOVE CNTL-POOL-ZAP-FLAG        TO WS-ZAP-FLAG
              ELSE
                 MOVE SPACE                     TO WS-ZAP-FLAG
              END-IF
              MOVE HOLD-ZAP-REC                 TO WS-CNTL-FILE
              IF OK-TO-ZAP
                 MOVE SPACES                    TO P916-COMMAREA-PARMS
                 SET P916-ZAP-FUNCTION          TO TRUE
                 MOVE DIST OF UFPPOS-AREA       TO P916-TURN-DIST
                 MOVE SUB-DIST OF UFPPOS-AREA   TO P916-TURN-SUB-DIST
                 MOVE POOL-NAME OF UFPPOS-AREA  TO P916-TURN-POOL
                 EXEC CICS LINK
                      PROGRAM(P916-PGM)
                      COMMAREA(P916-COMMAREA-PARMS)
                      LENGTH(P916-LGTH)
                      RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P8640-2' TO ERR-PARAGRAPH
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 MOVE SPACE        TO WS-ZAP-FLAG
              END-IF
              SET SUCCESS          TO TRUE
           END-IF.
      *
      *
       P8650-READ-UFPTURN-UPDATE.
      *
           EXEC CICS READ
                     UPDATE
                     DATASET(UFP-VIA-TURN-NBR)
                     INTO(WS-UFP)
                     LENGTH(UFPTURN-RLGTH)
                     RIDFLD(UFPTURN)
                     KEYLENGTH(UFPTURN-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS.
      *
       P8655-READNXT-UFPTURN.
      *
           EXEC CICS READ
                     GTEQ
                     DATASET(UFP-VIA-TURN-NBR)
                     INTO(WS-UFP)
                     LENGTH(UFPTURN-RLGTH)
                     RIDFLD(UFPTURN)
                     KEYLENGTH(UFPTURN-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS.
      *
       P8660-READ-TASK-UPD.
      *
           EXEC CICS READ
                     UPDATE
                     DATASET(TASK-VIA-EFF-TIME)
                     INTO(WS-TASK)
                     LENGTH(TASKEFTM-RLGTH)
                     RIDFLD(TASKTIME)
                     KEYLENGTH(TASKEFTM-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE     TO FILE-STATUS.
           IF NOT SUCCESS
              MOVE 'P8660-1'    TO ERR-PARAGRAPH
              MOVE TASKTIME     TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P8661-READ-TASK.
      *
           EXEC CICS READ
                     DATASET(TASK-VIA-EFF-TIME)
                     INTO(WS-TASK)
                     LENGTH(TASKEFTM-RLGTH)
                     RIDFLD(TASKTIME)
                     KEYLENGTH(TASKEFTM-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE     TO FILE-STATUS
           .
      *
       P8662-REWRITE-TASK.
      *
           EXEC CICS REWRITE
                     DATASET(TASK-VIA-EFF-TIME)
                     FROM(WS-TASK)
                     LENGTH(TASKEFTM-RLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8662-1'    TO ERR-PARAGRAPH
              MOVE TASKTIME     TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P8665-DELETE-TASK.
      *
           EXEC CICS DELETE
                     DATASET(TASK-VIA-EFF-TIME)
                     RIDFLD(TASK-EFF-TIME-KEY)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE     TO FILE-STATUS
           .
      *
       P8670-WRITE-TASK.
      *
      *    WRITE THE TASK RECORD, IF DUPLICATE FOUND INCREMENT
      *    TIE BREAKER AND ATTEMPT ANOTHER WRITE. IF AUTOGEN ORDER
      *    OR AUTOGEN PLANNED THEN DUPLICATES NOT ALLOWED.
      *
           PERFORM VARYING EFF-TIE FROM 1 BY 1 UNTIL EFF-TIE > 98
      *C1029-BEG
               MOVE TASK-DIST       TO TASK-DIST-KEY5
               MOVE TASK-SUB-DIST   TO TASK-SUB-DIST-KEY5
               MOVE EFFECTIVE-DATE-TIME-CENT
                                    TO TASK-EFF-DATE-TIME-CENT-KEY5
               MOVE TASK-TYPE       TO TASK-TYPE-KEY5
      *C1029-END
               MOVE TASK-LOCATION-KEY         TO TASKTIME
               EXEC CICS WRITE
                         DATASET(TASK-VIA-EFF-TIME)
                         FROM(WS-TASK)
                         LENGTH(TASKEFTM-RLGTH)
                         RIDFLD(TASKTIME)
                         RESP(WS-RESPONSE)
               END-EXEC
               MOVE WS-RESPONSE               TO FILE-STATUS
               IF NOT SUCCESS
                  IF DUP-KEY-ERR AND EFF-TIE < 98
                     CONTINUE
                  ELSE
                     MOVE 'P8200-1'        TO ERR-PARAGRAPH
                     MOVE TASKTIME         TO ERR-KEY
                     PERFORM P9999-GOT-PROBLEM
                  END-IF
               ELSE
                  MOVE TASK-LOCATION-KEY      TO P927-TASK-KEY
                  MOVE 98                     TO EFF-TIE
               END-IF
           END-PERFORM.
      *
       P8700-READ-P08CA-TASK.
      *
           MOVE P08CA-TASK-KEY    TO TASK-EFF-TIME-KEY
           EXEC CICS READ
                     DATASET(TASK-VIA-EFF-TIME)
                     INTO(WS-TASK)
                     LENGTH(TASKEFTM-RLGTH)
                     RIDFLD(TASK-EFF-TIME-KEY)
                     KEYLENGTH(TASKEFTM-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              IF NO-RECORD-FND
                 MOVE SPACES    TO WS-TASK
              ELSE
                 MOVE 'P8700-1' TO ERR-PARAGRAPH
                 MOVE TASKTIME  TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
           END-IF
           IF P08CA-SETBACK-CALL
              SET TZ-IN-SYSTEM-ZONE           TO TRUE
              MOVE EFFECTIVE-DATE-TIME        TO TZ-IN-DATE-TIME
              MOVE TASK-TIME-ZONE             TO TZ-OUT-ZONE
              PERFORM P8996-TIMEZONE
              MOVE TZ-OUT-DATE                TO WS-TASK-DATE
              MOVE TZ-OUT-TIME                TO WS-TASK-TIME
           END-IF
           .
      *=======================================================
       P8750-WRITE-TOPC-VRUINFO.
      *=======================================================
           MOVE SPACES                      TO VRUINFO-FILE
           MOVE 'TOPC'                      TO WS-TOPC-VRUINFO-KEY1
           MOVE TASK-TOPC-DB-TRAIN-ID       TO WS-TOPC-VRUINFO-KEY2
           MOVE TASK-TOPC-ROUTE-SEQ-NUMB    TO WS-TOPC-VRUINFO-KEY3
           MOVE TASK-TOPC-CREW-ID           TO WS-TOPC-VRUINFO-KEY4
           MOVE EIBTRMID                    TO WS-TOPC-VRUINFO-KEY5
           MOVE WS-SYSTEM-CENT              TO VRUINFO-EFF-CE
           MOVE WS-SYSTEM-DATE              TO VRUINFO-EFF-DATE
           MOVE WS-SYSTEM-TIME              TO VRUINFO-EFF-TIME
           MOVE ZEROES                      TO VRUINFO-EFF-TIE
           MOVE WS-TOPC-VRUINFO-KEY         TO VRUINFO-TASK-KEY
                                               VRUINFOKEY

           EXEC CICS WRITE
                     DATASET(VRU-INFO-FILE)
                     FROM   (VRUINFO-FILE)
                     LENGTH (VRU-INFO-TERM-RLGTH)
                     RIDFLD (VRUINFOKEY)
                     RESP   (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                 TO FILE-STATUS
           IF  NOT SUCCESS
           AND NOT DUP-KEY-ERR
              MOVE 'P8750-1'                TO ERR-PARAGRAPH
              MOVE VRUINFOKEY               TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *=======================================================
       P8760-DELETE-TOPC-VRUINFO.
      *=======================================================
           MOVE SPACES                      TO VRUINFO-FILE
           MOVE 'TOPC'                      TO WS-TOPC-VRUINFO-KEY1
           MOVE TASK-TOPC-DB-TRAIN-ID       TO WS-TOPC-VRUINFO-KEY2
           MOVE TASK-TOPC-ROUTE-SEQ-NUMB    TO WS-TOPC-VRUINFO-KEY3
           MOVE TASK-TOPC-CREW-ID           TO WS-TOPC-VRUINFO-KEY4
           MOVE EIBTRMID                    TO WS-TOPC-VRUINFO-KEY5
           MOVE WS-TOPC-VRUINFO-KEY         TO VRUINFO-TASK-KEY
                                               VRUINFOKEY
           EXEC CICS DELETE
                     DATASET(VRU-INFO-FILE)
                     RIDFLD (VRUINFOKEY)
                     RESP   (WS-RESPONSE)
           END-EXEC

           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF  NOT SUCCESS
           AND NOT NO-RECORD-FND
              MOVE 'P8760-1'                  TO ERR-PARAGRAPH
              MOVE VRUINFOKEY                 TO ERR-KEY
              MOVE SPACES                     TO ERR-SENTENCE
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *=======================================================
       P8770-READ-TOPC-VRUINFO.
      *=======================================================
           MOVE SPACES                      TO VRUINFO-FILE
           MOVE 'TOPC'                      TO WS-TOPC-VRUINFO-KEY1
           MOVE TASK-TOPC-DB-TRAIN-ID       TO WS-TOPC-VRUINFO-KEY2
           MOVE TASK-TOPC-ROUTE-SEQ-NUMB    TO WS-TOPC-VRUINFO-KEY3
           MOVE TASK-TOPC-CREW-ID           TO WS-TOPC-VRUINFO-KEY4
           MOVE EIBTRMID                    TO WS-TOPC-VRUINFO-KEY5
           MOVE WS-TOPC-VRUINFO-KEY         TO VRUINFO-TASK-KEY
                                               VRUINFOKEY

           EXEC CICS READ
                     DATASET  (VRU-INFO-FILE)
                     INTO     (VRUINFO-FILE)
                     LENGTH   (VRU-INFO-TERM-RLGTH)
                     RIDFLD   (VRUINFOKEY)
                     KEYLENGTH(VRU-INFO-TERM-KLGTH)
                     RESP     (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                 TO FILE-STATUS
           .
      *
       P8800-LINK-TO-PS52.
      *
           EXEC CICS LINK
                     PROGRAM(PS52-PGM)
                     COMMAREA(PS52-COMMAREA-PARMS)
                     LENGTH(PS52-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE        TO FILE-STATUS
           .
      *=======================================================
       P8810-READ-AHM.
      *=======================================================
            EXEC CICS READ
                      DATASET   (AHM-FILE)
                      INTO      (WS-AHIST-MISC)
                      LENGTH    (AHM-RLGTH)
                      RIDFLD    (AHMKEY)
                      KEYLENGTH (AHM-KLGTH)
                      RESP      (WS-RESPONSE)
            END-EXEC
            MOVE WS-RESPONSE            TO FILE-STATUS
            .
      *===================================================
       P8820-READ-AHM-UPDATE.
      *===================================================
            EXEC CICS READ
                      UPDATE
                      DATASET   (AHM-FILE)
                      INTO      (WS-AHIST-MISC)
                      LENGTH    (AHM-RLGTH)
                      RIDFLD    (AHMKEY)
                      KEYLENGTH (AHM-KLGTH)
                      RESP      (WS-RESPONSE)
            END-EXEC
            MOVE WS-RESPONSE            TO FILE-STATUS
            IF NOT SUCCESS
               MOVE 'P8820-1'           TO ERR-PARAGRAPH
               MOVE AHMKEY              TO ERR-KEY
               PERFORM P9999-GOT-PROBLEM
            END-IF
            .
      *===================================================
       P8830-REWRITE-AHM.
      *===================================================
            EXEC CICS REWRITE
                      DATASET   (AHM-FILE)
                      FROM      (WS-AHIST-MISC)
                      LENGTH    (AHM-RLGTH)
                      RESP      (WS-RESPONSE)
            END-EXEC
            MOVE WS-RESPONSE            TO FILE-STATUS
            IF NOT SUCCESS
               MOVE 'P8830-1'           TO ERR-PARAGRAPH
               MOVE AHMKEY              TO ERR-KEY
               PERFORM P9999-GOT-PROBLEM
            END-IF
            .
      *===================================================
       P8835-WRITE-AHM.
      *===================================================
            EXEC CICS WRITE
                      DATASET   (AHM-FILE)
                      FROM      (WS-AHIST-MISC)
                      LENGTH    (AHM-RLGTH)
                      RIDFLD    (AHMKEY)
                      RESP      (WS-RESPONSE)
            END-EXEC
            MOVE WS-RESPONSE            TO FILE-STATUS
            IF NOT SUCCESS
               MOVE 'P8835-1'           TO ERR-PARAGRAPH
               MOVE AHMKEY              TO ERR-KEY
               PERFORM P9999-GOT-PROBLEM
            END-IF
            .
      *
       P8900-WRITE-HISTORY.
      *
           MOVE WORK-HIST-TIME        TO P943-CLOCK-TIME
           IF P943-EFF-DATE-TIME NOT > SPACES
              MOVE WS-LOCAL-DATE-TIME TO P943-EFF-DATE-TIME
           END-IF
           MOVE WORK-HIST-TIMEX       TO P943-CLOCK-TIME
           SET P943-EMPLOYEE-FUNCTION TO TRUE

           EXEC CICS ASSIGN
                     USERID(P943-USERID)
           END-EXEC

           EXEC CICS LINK
                     PROGRAM(P943-PGM)
                     COMMAREA(P943-COMMAREA-PARMS)
                     LENGTH(P943-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC

           MOVE WS-RESPONSE           TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P8900'            TO ERR-PARAGRAPH
              MOVE 'P943'             TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
      ****************************************************************
      *  CONVERT WS-LOCAL-DATE-TIME  FROM PSTCA-TIME-ZONE
      *  TO CNTL-TIME-ZONE, PRIOR TO WRITING HISTORY RECORD.
      *  ONLY IF  HIST DIST & SUB-DIST ARE  NOT = TO PSTCA DIST & SUB-
      ****************************************************************
      *
       P8994-CONVERT-HIST-TIMEZONE.
      *
           MOVE SPACES                   TO WORK-CNTLKEY
           MOVE '02'                     TO WK-CNTL-REC-TYPE
           MOVE P943-DIST                TO WK-CNTL-DIST
           MOVE P943-SDIST               TO WK-CNTL-SUB-DIST
           PERFORM P8610-READ-CNTLFILE
           IF NOT SUCCESS
              MOVE 'P8994'   TO ERR-PARAGRAPH
              MOVE CNTLKEY   TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           MOVE SPACES                   TO TZ-PARAMETERS
           MOVE CNTL-TIME-ZONE           TO TZ-OUT-ZONE
           MOVE WS-LOCAL-DATE-TIME       TO TZ-IN-DATE-TIME
           MOVE PSTCA-TIME-ZONE          TO TZ-IN-ZONE
           PERFORM P8996-TIMEZONE
           IF TZ-INVALID-PARAMETERS
              MOVE 'P8994H'              TO ERR-PARAGRAPH
              PERFORM P8996-TZERROR
           END-IF
           MOVE TZ-OUT-DATE-TIME         TO P943-EFF-DATE-TIME
           MOVE PSTCA-TIME-ZONE          TO P943-EMP-TIME-ZONE.
      *
       COPY TIMEZONE.
      *
       COPY TZERROR.
      *
       COPY CNTRTXT.
      *
       COPY BIFEDIT.
      *
       COPY DATEEDIT.
      *
       COPY TIMEEDIT.
      *
      *CNC0520-BEG
       COPY CHEKCRFT.
      *CNC0520-END
      *
       PXXXX-JOB-OWNER.
      *
           MOVE WORK-ASGNKEY1 TO ASGNKEY1
           SET ASGN-OWNER-REC TO TRUE
           MOVE ZERO          TO ASGN-DATE-TIME
           MOVE ASGNKEY1      TO ASGNJOB
           EXEC CICS READ
                     DATASET(ASGN-VIA-ASGNJOB)
                     INTO(ASGN-AREA)
                     LENGTH(ASGNJOB-RLGTH)
                     RIDFLD(ASGNJOB)
                     KEYLENGTH(ASGNJOB-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE ZEROS TO ASGN-EMP-NO
           END-IF.
      *
       PXXXX-LATEST-TEMP.
      *
           MOVE SPACES        TO WS-SAVE-ASGN-FILE
           MOVE WORK-ASGNKEY1 TO ASGNKEY1
           SET ASGN-TEMP-REC  TO TRUE
           MOVE ZERO          TO ASGN-DATE-TIME
           MOVE ASGNKEY1      TO ASGNJOB
           EXEC CICS STARTBR
                     DATASET(ASGN-VIA-ASGNJOB)
                     RIDFLD(ASGNJOB)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF SUCCESS
              MOVE 'N' TO WS-ASGN-DONE-CODE
              PERFORM UNTIL ASGN-DONE
                 EXEC CICS READNEXT
                           DATASET(ASGN-VIA-ASGNJOB)
                           INTO(ASGN-AREA)
                           LENGTH(ASGNJOB-RLGTH)
                           RIDFLD(ASGNJOB)
                           KEYLENGTH(ASGNJOB-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS
                    IF WK-ASGN-DIST = ASGN-DIST
                       AND WK-ASGN-SUB-DIST = ASGN-SUB-DIST
                       AND WK-ASGN-ASSIGN = ASGN-AJ-JOB
                           OF ASGN-ASSIGNMENT
                       AND ASGN-TEMP-REC
                       MOVE ASGN-AREA TO WS-SAVE-ASGN-FILE
                    ELSE
                       SET ASGN-DONE TO TRUE
                    END-IF
                 ELSE
                    SET ASGN-DONE TO TRUE
                 END-IF
              END-PERFORM
              EXEC CICS ENDBR
                        DATASET(ASGN-VIA-ASGNJOB)
                        RESP(WS-RESPONSE)
              END-EXEC
           END-IF
           IF WS-SAVE-ASGN-FILE > SPACE
              MOVE WS-SAVE-ASGN-FILE TO ASGN-AREA
           ELSE
              MOVE ZEROS TO ASGN-EMP-NO
           END-IF.
      *
       PXXXX-ON-DUTY-EMP.
      *
           MOVE WORK-ASGNKEY1   TO ASGNKEY1
           SET ASGN-ON-DUTY-REC TO TRUE
           MOVE ZERO            TO ASGN-DATE-TIME
           MOVE ASGNKEY1        TO ASGNJOB
           EXEC CICS READ
                     DATASET(ASGN-VIA-ASGNJOB)
                     INTO(ASGN-AREA)
                     LENGTH(ASGNJOB-RLGTH)
                     RIDFLD(ASGNJOB)
                     KEYLENGTH(ASGNJOB-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE ZEROS TO ASGN-EMP-NO
           END-IF.
      *CNC0534 - BEG
       PXXXX-JOB-OWNED.
      * THIS PARAGRAPH WAS ADDED TO WORK PROPERLY WITH THE HOMEAWAY
      * COPYBOOK WHICH BUILDS THE KEY DIRECTLY INTO THE ASGN FILE KEY.
      *
           MOVE '1'                       TO ASGN-EMP-NO-REC-TYPE
           MOVE ZEROES                    TO ASGN-EMP-DATE-TIME
           MOVE ASGNKEY2                  TO ASGNEMP
           EXEC CICS READ
                     DATASET  (ASGN-VIA-ASGNEMP)
                     INTO     (WS-ASGN-FILE)
                     LENGTH   (ASGNEMP-RLGTH)
                     RIDFLD   (ASGNEMP)
                     KEYLENGTH(ASGNEMP-KLGTH)
                     RESP     (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE               TO FILE-STATUS
           IF NOT SUCCESS
              MOVE SPACES                 TO WS-ASGN-FILE
           END-IF
           .
      *
       PXXXX-JOB-OWNED1.
      *CNC0534 - END
      * THIS PARAGRAPH WAS RENAMED AND IS USED EVERYWHERE BUT IN THE
      * HOMEAWAY COPYBOOK.
      *
           MOVE WORK-ASGNKEY2 TO ASGNKEY2
           MOVE '1'           TO ASGN-EMP-NO-REC-TYPE
           MOVE ZERO          TO ASGN-EMP-DATE-TIME
           MOVE ASGNKEY2      TO ASGNEMP
           EXEC CICS READ
                     DATASET(ASGN-VIA-ASGNEMP)
                     INTO(WS-ASGN-FILE)
                     LENGTH(ASGNEMP-RLGTH)
                     RIDFLD(ASGNEMP)
                     KEYLENGTH(ASGNEMP-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE SPACES TO WS-ASGN-FILE
           END-IF.
      *
       PXXXX-LATEST-TEMP-JOB.
      *
      *C983 MOVE WORK-ASGNKEY2 TO ASGNKEY2
           MOVE '2'           TO ASGN-EMP-NO-REC-TYPE
           MOVE ZERO          TO ASGN-EMP-DATE-TIME
           MOVE ASGNKEY2      TO ASGNEMP
           MOVE SPACES        TO WS-ASGN-FILE
                                 WS-SAVE-ASGN-FILE
           EXEC CICS STARTBR
                     DATASET(ASGN-VIA-ASGNEMP)
                     RIDFLD(ASGNEMP)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF SUCCESS
              MOVE 'N' TO WS-ASGN-DONE-CODE
              PERFORM UNTIL ASGN-DONE
                 EXEC CICS READNEXT
                           DATASET(ASGN-VIA-ASGNEMP)
                           INTO(ASGN-AREA)
                           LENGTH(ASGNEMP-RLGTH)
                           RIDFLD(ASGNEMP)
                           KEYLENGTH(ASGNEMP-KLGTH)
                           RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE TO FILE-STATUS
                 IF SUCCESS
                    IF ASGN-EMP-NO = WK-ASGN-EMP-NO
                       AND ASGN-EMP-NO-REC-TYPE = '2'
                       MOVE ASGN-AREA TO WS-SAVE-ASGN-FILE
                    ELSE
                       SET ASGN-DONE TO TRUE
                    END-IF
                 ELSE
                    SET ASGN-DONE TO TRUE
                 END-IF
              END-PERFORM
              EXEC CICS ENDBR
                        DATASET(ASGN-VIA-ASGNEMP)
                        RESP(WS-RESPONSE)
              END-EXEC
           END-IF
           IF WS-SAVE-ASGN-FILE > SPACES
              MOVE WS-SAVE-ASGN-FILE TO WS-ASGN-FILE
           ELSE
              MOVE SPACES TO WS-ASGN-FILE
           END-IF.
      *
       PXXXX-JOB-ON-DUTY.
      *
      *C983 MOVE WORK-ASGNKEY2 TO ASGNKEY2
           MOVE '3' TO ASGN-EMP-NO-REC-TYPE
           MOVE ZERO TO ASGN-EMP-DATE-TIME
           MOVE ASGNKEY2 TO ASGNEMP
           EXEC CICS READ
                     DATASET(ASGN-VIA-ASGNEMP)
                     INTO(ASGN-AREA)
                     LENGTH(ASGNEMP-RLGTH)
                     RIDFLD(ASGNEMP)
                     KEYLENGTH(ASGNEMP-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE SPACES TO WS-ASGN-FILE
           END-IF.
      *
       P8999-GET-ALT-CREW-SOURCE.
      *
      *    FIRST CHECK FOR EN DATA:
      *
           MOVE SPACES                     TO     WS-CNTL-FILE
           SET  ALT-CREW-PROFILE-REC       TO     TRUE
           MOVE TRCN-ORIGIN-STN            TO     CNTL-81-ORIGIN-STN
           MOVE TRCN-TRAIN-ASGN            TO     CNTL-81-PROFILE
           PERFORM P8700-READ-P08CA-TASK
           MOVE TASK-TOPC-EN-STA           TO     CNTL-81-TOPC-STN-ID

           MOVE CNTLKEY-AREA               TO     CNTLKEY
      *
           EXEC CICS READ
                     DATASET(CNTL-FILE-VIA-CNTLKEY)
                     INTO(WS-CNTL-FILE)
                     LENGTH(CNTLFILE-RLGTH)
                     RIDFLD(CNTLKEY)
                     KEYLENGTH(CNTLFILE-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC.
           MOVE WS-RESPONSE                TO     FILE-STATUS.
           IF  NOT SUCCESS
               NEXT SENTENCE
           ELSE
               IF                          NOT    ALT-CREW-PROFILE-REC
               OR TRCN-ORIGIN-STN          NOT =  CNTL-81-ORIGIN-STN
               OR TRCN-TRAIN-ASGN          NOT =  CNTL-81-PROFILE
               OR TASK-TOPC-EN-STA         NOT =  CNTL-81-TOPC-STN-ID
                   NEXT SENTENCE
               ELSE
      *C1166 - BEG
                   MOVE TRCN-EN-FROM-DIST      TO WS-SV-EN-FROM-DIST
                   MOVE TRCN-EN-FROM-SDIST     TO WS-SV-EN-FROM-SDIST
                   MOVE TRCN-EN-FROM-POOL      TO WS-SV-EN-FROM-POOL
      *C1166 - END
                   MOVE CNTL-81-ALT-EN-DIST    TO TRCN-EN-FROM-DIST
                   MOVE CNTL-81-ALT-EN-SDIST   TO TRCN-EN-FROM-SDIST
                   MOVE CNTL-81-ALT-EN-POOL    TO TRCN-EN-FROM-POOL
                   MOVE CNTL-81-ALT-EN-TERM    TO TRCN-EN-FROM-TERM
                   MOVE CNTL-81-ALT-EN-PROFILE TO TRCN-EN-SCH-PROFILE
                   MOVE CNTL-81-ALT-EN-TK-PROFILE TO
                                            WS-SAVE-ALT-EN-TK-PROFILE
                   MOVE CNTL-81-ALT-EN-AWAY-FL TO
                                            WS-SAVE-ALT-EN-AWAY-FL
                   IF WS-SAVE-ALT-EN-AWAY-FL <= SPACES
                      SET WS-SAVE-ALT-EN-AWAY-NO  TO TRUE
                   END-IF
      *CNC0544-BEG
                   SET EN-FROM-ALT-SOURCE      TO TRUE
                   MOVE CNTL-81-ALT-EST-RUN-TM TO WS-SAVE-ALT-EST-RUN-TM
      *CNC0544-END
               END-IF
           END-IF.
      *
      *
      *    NOW CHECK FOR TR DATA:
      *
           MOVE SPACES                     TO     WS-CNTL-FILE.
           SET  ALT-CREW-PROFILE-REC       TO     TRUE.
           MOVE TRCN-ORIGIN-STN            TO     CNTL-81-ORIGIN-STN.
           MOVE TRCN-TRAIN-ASGN            TO     CNTL-81-PROFILE.
           PERFORM P8700-READ-P08CA-TASK
           MOVE TASK-TOPC-TR-STA           TO     CNTL-81-TOPC-STN-ID

           MOVE CNTLKEY-AREA               TO     CNTLKEY.
      *
           EXEC CICS READ
                     DATASET(CNTL-FILE-VIA-CNTLKEY)
                     INTO(WS-CNTL-FILE)
                     LENGTH(CNTLFILE-RLGTH)
                     RIDFLD(CNTLKEY)
                     KEYLENGTH(CNTLFILE-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC.
           MOVE WS-RESPONSE                TO     FILE-STATUS.
           IF  NOT SUCCESS
               NEXT SENTENCE
           ELSE
               IF                          NOT    ALT-CREW-PROFILE-REC
               OR TRCN-ORIGIN-STN          NOT =  CNTL-81-ORIGIN-STN
               OR TRCN-TRAIN-ASGN          NOT =  CNTL-81-PROFILE
               OR TASK-TOPC-TR-STA         NOT =  CNTL-81-TOPC-STN-ID
                   NEXT SENTENCE
               ELSE
      *C1166 - BEG
                   MOVE TRCN-TR-FROM-DIST      TO WS-SV-TR-FROM-DIST
                   MOVE TRCN-TR-FROM-SDIST     TO WS-SV-TR-FROM-SDIST
                   MOVE TRCN-TR-FROM-POOL      TO WS-SV-TR-FROM-POOL
      *C1166 - END
                   MOVE CNTL-81-ALT-TR-DIST    TO TRCN-TR-FROM-DIST
                   MOVE CNTL-81-ALT-TR-SDIST   TO TRCN-TR-FROM-SDIST
                   MOVE CNTL-81-ALT-TR-POOL    TO TRCN-TR-FROM-POOL
                   MOVE CNTL-81-ALT-TR-TERM    TO TRCN-TR-FROM-TERM
                   MOVE CNTL-81-ALT-TR-PROFILE TO TRCN-TR-SCH-PROFILE
                   MOVE CNTL-81-ALT-TR-TK-PROFILE TO
                                            WS-SAVE-ALT-TR-TK-PROFILE
                   MOVE CNTL-81-ALT-TR-AWAY-FL TO
                                            WS-SAVE-ALT-TR-AWAY-FL
                   IF WS-SAVE-ALT-TR-AWAY-FL <= SPACES
                      SET WS-SAVE-ALT-TR-AWAY-NO  TO TRUE
                   END-IF
      *CNC0544-BEG
                   IF EN-FROM-ALT-SOURCE
                      SET BOTH-FROM-ALT-SOURCE TO TRUE
                   ELSE
                      SET TR-FROM-ALT-SOURCE   TO TRUE
                      MOVE CNTL-81-ALT-EST-RUN-TM
                                               TO WS-SAVE-ALT-EST-RUN-TM
                   END-IF
      *CNC0544-END
               END-IF
           END-IF.
      *
       P9000-SEND-MAP-AND-RETURN.
      *
           PERFORM P9040-CHECK-FOR-QUICK-TIES
           IF MSGLOG-CODE > SPACES
              PERFORM P9030-GET-MESSAGE
              MOVE MSGLOG-MESSAGE-AREA        TO SCR08-ERRORMSG
              IF MSGLOG-CODE                   = 'I592'
                 MOVE LAYOFF-CODE             TO SCR08-ERRORMSG(43:2)
      *          IVR CALL NOT ALLOWED - EMPLOYEE STATUS IS XX
              END-IF
      *CNLD-230-B
              IF MSGLOG-CODE                   = 'E373'
                                                 OR 'E374'
                                                 OR 'E375'
                                                 OR 'E378'
                                                 OR 'E379'
                                                 OR 'E380'
      *CNLD-257-DXC-B
                                                 OR 'E382'
                                                 OR 'E383'
      *CNLD-257-DXC-E
                 MOVE WS-RFR-MSG              TO SCR08-ERRORMSG(05:4)
      *          'ERT=XXXX <<MESSAGE>>'
              END-IF
      *CNLD-230-E
           END-IF

           MOVE P08-MAP-VERSION(PSTCA-SUB) TO P08-MAP
           IF CREATE-SCREEN
              PERFORM P9500-WRITE-TSQUEUE
              PERFORM P9010-SEND-PHYSICAL-MAP
           ELSE
              IF CONTINUE-SCREEN
                 MOVE LOW-VALUES           TO P08-TSQ-DATA
                 MOVE PSTS08 TO P08-TSQ-DATA
                 PERFORM P9550-REWRITE-TSQUEUE
                 PERFORM P9020-SEND-DATAONLY-MAP
              ELSE
                 PERFORM P9035-SEND-BUFFER
                 IF WS-PRE-CALL-WITH-TOC
                    MOVE -1 TO SCR08-FUNC-CURSOR(1)
                    PERFORM P9020-SEND-DATAONLY-MAP
                 END-IF
              END-IF
           END-IF

           EXEC CICS RETURN
                     TRANSID(P08-TRAN)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(P08-COMM-LGTH)
           END-EXEC.
      *
       P9010-SEND-PHYSICAL-MAP.
      *
           EXEC CICS SEND MAP(P08-MAP)
                          MAPSET(P08-SET)
                          FROM(PSTS08)
                          ALARM
                          ERASE
                          CURSOR
                          FREEKB
                          RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9010-1'   TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9020-SEND-DATAONLY-MAP.
      *
           EXEC CICS SEND MAP(P08-MAP)
                          MAPSET(P08-SET)
                          FROM(PSTS08)
                          DATAONLY
                          ALARM
                          CURSOR
                          FREEKB
                          RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9020-1' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9030-GET-MESSAGE.
      *
           MOVE PSTCA-SUB TO MSGLOG-SUB-CODE
           EXEC CICS READ
                     DATASET(MSGLOG-VIA-CODE)
                     INTO(MSGLOG-AREA)
                     LENGTH(MSGLOG-RLGTH)
                     RIDFLD(MSGLOG-KEY)
                     KEYLENGTH(MSGLOG-KLGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              IF PSTCA-SUB = 1
                 MOVE 'NO MESSAGE ON FILE' TO MSGLOG-MESSAGE
              ELSE
                 MOVE 'AUCUN MESSAGE'      TO MSGLOG-MESSAGE
              END-IF
           END-IF
           MOVE MSGLOG-CODE     TO MSGLOG-MSG-CODE
           MOVE '-'             TO MSGLOG-MSG-SEP
           MOVE MSGLOG-SUB-CODE TO MSGLOG-MSG-SUB-CODE.
      *
       P9035-SEND-BUFFER.
      *
           EXEC CICS SEND
                     FROM(WS-BUFFER-DATA)
                     LENGTH(WS-BUFFER-LGTH)
                     ERASE
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE       TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9035-1'      TO ERR-PARAGRAPH
              MOVE 'SEND BUFFER'  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           EXEC CICS SEND
                     CONTROL
                     CURSOR(WS-BUFFER-CURSOR)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE       TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9035-2'      TO ERR-PARAGRAPH
              MOVE 'SEND CURSOR'  TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9040-CHECK-FOR-QUICK-TIES.
      *
           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              IF P08CA-EMP-NO(FUNC-SUB) > '000000000' AND
                 (SCR08-FUNC(FUNC-SUB) NOT > SPACES OR
                  SCR08-FUNC(FUNC-SUB) = 'CBCK')
                 MOVE SPACES                     TO P980-COMMAREA-PARMS
                 SET P980-QUICKTIE-RESTRICT-FUNC TO TRUE
                 MOVE P08CA-EMP-NO(FUNC-SUB)     TO P980-EMP-NO
                 EXEC CICS LINK
                          PROGRAM(P980-PGM)
                          COMMAREA(P980-COMMAREA-PARMS)
                          LENGTH(P980-LGTH)
                          RESP(WS-RESPONSE)
                 END-EXEC
                 MOVE WS-RESPONSE               TO FILE-STATUS
                 IF NOT SUCCESS
                    MOVE 'P9040-1'              TO ERR-PARAGRAPH
                    MOVE 'LINK980'              TO ERR-KEY
                    PERFORM P9999-GOT-PROBLEM
                 END-IF
                 IF P980-QUICKTIE-RESTRICTED
                    IF SCR08-FUNC(FUNC-SUB) = 'CBCK'
                       STRING 'SHORT LEAD/CALL REQ: TYPE "CBCK" '
                              'IN FUNC-PRESS ENTER FOR CALLBACK '
                              DELIMITED BY SIZE
                              INTO SCR08-PHONE(FUNC-SUB)
                    END-IF
                    MOVE 'QTIE'             TO SCR08-FUNC(FUNC-SUB)
                 END-IF
              END-IF
           END-PERFORM.
      *=================================================================
       P9050-RESET-ATTRIBUTES.
      *=================================================================
           IF YARD-CALL
              MOVE AUTOSKIP-MDT TO SCR08-ASGN-TYPE-ATTR
                                   SCR08-CALL-COMPLETE-ATTR
              MOVE SPACES       TO SCR08-SIDE-TRIP-HDR1
                                   SCR08-SIDE-TRIP-HDR2
                                   SCR08-SIDE-TRIP-HDR3
      *CNC0520-BEG
              MOVE SPACES       TO SCR08-ROUTE-DSGN-H1
                                   SCR08-ROUTE-DSGN-H2
                                   SCR08-ROUTE-DSGN-H3
      *CNC0520-END
           ELSE
              MOVE AUTOSKIP-MDT TO SCR08-ORG-STATION-ATTR
                                   SCR08-ASGN-ATTR
                                   SCR08-ASGN-TYPE-ATTR
           END-IF

           MOVE AUTOSKIP-MDT    TO SCR08-ORDER-DATE-ATTR
                                   SCR08-ORDER-TIME-ATTR
                                   SCR08-SIDE-TRIP-ATTR
      *CNC0520-BEG
           PERFORM P9051-RESET-ATTRIBUTES
      *CNC0520-END

           PERFORM VARYING FUNC-SUB FROM 1 BY 1
              UNTIL FUNC-SUB > ARRAY-MAX
              IF SCR08-CC(FUNC-SUB) NOT > SPACES
                 SET P08CA-ASGN-SET(FUNC-SUB) TO TRUE
                 MOVE AUTOSKIP-MDT TO SCR08-FUNC-ATTR(FUNC-SUB)
                                      SCR08-NAME-ATTR(FUNC-SUB)
                                      SCR08-ST-ATTR(FUNC-SUB)
                                      SCR08-OD-DATE-ATTR(FUNC-SUB)
                                      SCR08-OD-TIME-ATTR(FUNC-SUB)
                                      SCR08-TAXI-TM-ATTR(FUNC-SUB)
              ELSE
                 MOVE MDT          TO SCR08-NAME-ATTR(FUNC-SUB)
                 IF P08CA-ASGN-SET(FUNC-SUB)
                    PERFORM P1020-SET-ASGN-CALL-ATTR
                 END-IF
              END-IF
           END-PERFORM.
      *CNC0520-BEG
      *=================================================================
       P9051-RESET-ATTRIBUTES.
      *=================================================================
           SET EMP-NOT-CALLED           TO TRUE
           PERFORM VARYING SUB7 FROM 1 BY 1
                     UNTIL SUB7 > ARRAY-MAX
             IF P08CA-EMP-NO(SUB7) > SPACES
                MOVE SPACES             TO WS-MSTR
                MOVE P08CA-EMP-NO(SUB7) TO MSTRNBRK
                PERFORM P8505-READ-MASTER-ONLY
                IF SUCCESS
                   IF LAYOFF-CODE = 'B0'
                      SET EMP-CALLED    TO TRUE
                   END-IF
                END-IF
             END-IF
           END-PERFORM
           IF EMP-CALLED
              MOVE AUTOSKIP-MDT         TO SCR08-ROUTE-DSGN-ATTR
           END-IF
           .
      *CNC0520-END
      *=================================================================
       P9100-SETUP-SCR03.
      *=================================================================
           EXEC CICS XCTL
                     PROGRAM(P03-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9100' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9110-SETUP-SCR08S.
      *
           EXEC CICS XCTL
                     PROGRAM(P08S-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9110' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9120-SETUP-SCR08C.
      *
           IF P08CA-TASK-KEY > SPACES
              MOVE P08CA-TASK-KEY TO WK-CCA-TASK-KEY
           END-IF
           MOVE P08CA-PROFILE-KEY TO WK-CCA-PROFILE-KEY
                                     TRCNKEY1
           PERFORM P8000-READ-TRCNKEY1
           MOVE SPACES TO AH-KEY-1
           IF (YARD-CALL OR LOCAL-CALL)
              MOVE TRCN-DIST                  TO AHK1-DIST
              MOVE TRCN-SDIST                 TO AHK1-SUB-DIST
              IF LOCAL-CALL
                 MOVE JOB-DEF-LOCAL-POOL      TO AHK1-POOL
                 MOVE SCR08-ASGN              TO AHK1-TRAIN-SYM
                 MOVE SCR08-ASGN-TYPE         TO AHK1-TRAIN-CODE
              ELSE
                 MOVE JOB-DEF-YARD-POOL       TO AHK1-POOL
                 MOVE SCR08-ASGN              TO AHK1-ASSIGNMENT
              END-IF
           ELSE
              IF TRCN-EN-FROM-DIST > SPACES
                 MOVE TRCN-EN-FROM-DIST       TO AHK1-DIST
                 MOVE TRCN-EN-FROM-SDIST      TO AHK1-SUB-DIST
                 MOVE TRCN-EN-FROM-POOL       TO AHK1-POOL
              ELSE
                 MOVE TRCN-TR-FROM-DIST       TO AHK1-DIST
                 MOVE TRCN-TR-FROM-SDIST      TO AHK1-SUB-DIST
                 MOVE TRCN-TR-FROM-POOL       TO AHK1-POOL
              END-IF
              MOVE SCR08-ASGN                 TO AHK1-TRAIN-SYM
              MOVE SCR08-ASGN-TYPE            TO AHK1-TRAIN-CODE
           END-IF
      *----------------------------------------------------------------*
      *                CONVERT TO CNTL-TIME-ZONE                       *
      *----------------------------------------------------------------*
           IF AHK1-DIST                NOT = SCR08-DIST
           OR AHK1-SUB-DIST            NOT = SCR08-SUB-DIST
              MOVE SPACES              TO WORK-CNTLKEY
              MOVE '02'                TO WK-CNTL-REC-TYPE
              MOVE AHK1-DIST           TO WK-CNTL-DIST
              MOVE AHK1-SUB-DIST       TO WK-CNTL-SUB-DIST
              PERFORM P8610-READ-CNTLFILE
              IF NOT SUCCESS
                 MOVE 'P9120-1'    TO ERR-PARAGRAPH
                 MOVE CNTLKEY      TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              END-IF
              MOVE SPACES              TO TZ-PARAMETERS
              MOVE CNTL-TIME-ZONE      TO TZ-OUT-ZONE
              MOVE PSTCA-TIME-ZONE     TO TZ-IN-ZONE
              MOVE SCR08-ORDER-DATE    TO TZ-IN-DATE
              MOVE SCR08-ORDER-TIME    TO TZ-IN-TIME
              PERFORM P8996-TIMEZONE
              IF TZ-INVALID-PARAMETERS
                 MOVE '9120TZ'     TO ERR-PARAGRAPH
                 PERFORM P8996-TZERROR
              END-IF
              MOVE TZ-OUT-DATE-TIME    TO AHK1-EFF-DATE-TIME
           ELSE
              MOVE SCR08-ORDER-DATE    TO AHK1-EFF-DATE
              MOVE SCR08-ORDER-TIME    TO AHK1-EFF-TIME
           END-IF
      *
           MOVE EIBTRMID               TO P08-TSQ-TERM
           EXEC CICS DELETEQ TS
                     QUEUE(P08-TSQ-ID)
                     RESP(WS-RESPONSE)
           END-EXEC
      *
           IF P08CA-TASK-KEY > SPACES
              PERFORM P8700-READ-P08CA-TASK
              IF     SUCCESS
              AND TASK-USE-TOPC-AREA
                 PERFORM P8760-DELETE-TOPC-VRUINFO
              END-IF
           END-IF
      *
           MOVE AH-KEY-1                      TO WK-CCA-ASGN-HIST-KEY
           MOVE WK-CCA-ASGN-HIST-KEY          TO P08CCA-ASGN-HIST-KEY
           MOVE WK-CCA-TASK-KEY               TO P08CCA-TASK-KEY
           MOVE WK-CCA-PROFILE-KEY            TO P08CCA-PROFILE-KEY
           EXEC CICS XCTL
                     PROGRAM(P08C-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9120-2' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9125-SETUP-SCR08C-PF11.
      *
           MOVE WK-CCA-TASK-KEY               TO P08CCA-TASK-KEY
           EXEC CICS XCTL
                     PROGRAM(P08C-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9125-1' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *CNC0520-BEG
      *
       P9126-SETUP-SCR08F-PF6.
      *
           MOVE SCR08-DIST         TO P08FCA-PROF-DIST
           MOVE SCR08-SUB-DIST     TO P08FCA-PROF-SUB-DIST
           MOVE TRCN-ASGN-TYPE     TO P08FCA-PROF-TYPE
           MOVE SCR08-ORG-STATION  TO P08FCA-ORIGIN
           MOVE SCR08-PROFILE      TO P08FCA-TRAIN-PROFILE
           MOVE SCR08-ROUTE-DSGN   TO P08FCA-ROUTE-DESN1
           EXEC CICS XCTL
                     PROGRAM(P08F-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9126-1' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *CNC0520-END
      *
       P9130-SETUP-SCR03A.
      *
           EXEC CICS XCTL
                     PROGRAM(P03A-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9130' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9140-SETUP-SCR04S.
      *
           EXEC CICS XCTL
                     PROGRAM(P04S-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9140' TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *=================================================================
       P9150-SETUP-SCR997.
      *=================================================================
           MOVE SPACES                        TO PSTCA-VARIABLE-AREA
           MOVE P08-PGM                       TO P997CA-FROM-PROGRAM
           SET  P997CA-MSTR-BY-NAME           TO TRUE
           MOVE MSTR-VIA-EMP-NAME             TO P997CA-FILE
           MOVE MSTRENAM-RLGTH                TO P997CA-RLGTH
           MOVE MSTRENAM-KLGTH                TO P997CA-KLGTH
           MOVE SCR08-NAME(FUNC-SUB)          TO P997CA-PASS-KEY
           EXEC CICS XCTL
                     PROGRAM(P997-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9150-1'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9300-READ-TASK-BY-STATION.
      *
           MOVE SPACES                        TO WS-TASK
           MOVE SCR08-ORG-STATION             TO TASK-CALL-ORIGIN-STN
           MOVE SCR08-ORDER-DATE              TO DE-YYMMDD
           SET  DE-YYMMDD-FORMAT              TO TRUE
           PERFORM P8998-DATEEDIT
           MOVE DE-YYMMDD-CE                  TO TASK-CALL-ORDER-CE
           MOVE SCR08-ORDER-DATE              TO TASK-CALL-ORDER-DATE
           MOVE SCR08-ORDER-TIME              TO TASK-CALL-ORDER-TIME
           MOVE SCR08-ASGN                    TO TASK-CALL-TRAIN2 (1:8)
           MOVE SCR08-ASGN-TYPE               TO TASK-CALL-TRAIN2 (9:2)

           MOVE TASK-STATION-KEY              TO TASKSTNKEY
           MOVE SPACE                         TO WS-TASK-FOUND-FLAG
           SET TASK-NOT-DONE                  TO TRUE
           EXEC CICS STARTBR
                     DATASET(TASK-VIA-STATION)
                     RIDFLD(TASKSTNKEY)
                     GTEQ
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              IF NOT (NO-RECORD-FND      OR END-OF-FILE)
                 MOVE 'P9300-1'               TO ERR-PARAGRAPH
                 MOVE TASKSTNKEY              TO ERR-KEY
                 PERFORM P9999-GOT-PROBLEM
              ELSE
                 SET TASK-DONE                TO TRUE
              END-IF
           END-IF
           PERFORM UNTIL TASK-DONE
              EXEC CICS READNEXT
                        DATASET(TASK-VIA-STATION)
                        INTO(WS-TASK)
                        LENGTH(TASKSTN-RLGTH)
                        RIDFLD(TASKSTNKEY)
                        KEYLENGTH(TASKSTN-KLGTH)
                        RESP(WS-RESPONSE)
              END-EXEC
              MOVE WS-RESPONSE            TO FILE-STATUS
              IF SUCCESS
                 IF TASK-CALL
                    IF TASK-CALL-ORIGIN-STN = SCR08-ORG-STATION AND
                       TASK-CALL-ORDER-DATE = SCR08-ORDER-DATE AND
                       TASK-CALL-ORDER-TIME = SCR08-ORDER-TIME AND
                       TASK-CALL-TRAIN2 (1:8) = SCR08-ASGN   AND
                       TASK-CALL-TRAIN2 (9:2) = SCR08-ASGN-TYPE AND
                       TASK-DIST         = SCR08-DIST        AND
                       TASK-SUB-DIST     = SCR08-SUB-DIST
                       SET TASK-DONE   TO TRUE
                       SET WS-TASK-FOUND TO TRUE
                    ELSE
                       IF TASK-CALL-ORIGIN-STN = SCR08-ORG-STATION AND
                          TASK-CALL-ORDER-DATE = SCR08-ORDER-DATE AND
                          TASK-CALL-ORDER-TIME = SCR08-ORDER-TIME AND
                          TASK-CALL-TRAIN2 (1:8) = SCR08-ASGN   AND
                          TASK-CALL-TRAIN2 (9:2) = SCR08-ASGN-TYPE
                          CONTINUE
                       ELSE
                          SET TASK-DONE TO TRUE
                       END-IF
                    END-IF
                 END-IF
              ELSE
                 SET TASK-DONE   TO TRUE
              END-IF
           END-PERFORM
           EXEC CICS ENDBR
                     DATASET(TASK-VIA-STATION)
                     RESP(WS-RESPONSE)
           END-EXEC
           .
      *
       P9310-READ-UPDATE-VRUINFO.
      *
           MOVE VRUINFO-KEY-AREA              TO VRUINFOKEY
           EXEC CICS READ
                     UPDATE
                     DATASET  (VRU-INFO-FILE)
                     INTO     (VRUINFO-FILE)
                     LENGTH   (VRU-INFO-TERM-RLGTH)
                     RIDFLD   (VRUINFOKEY)
                     KEYLENGTH(VRU-INFO-TERM-KLGTH)
                     RESP     (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF  NOT SUCCESS
           AND NOT NO-RECORD-FND
              MOVE 'P9310-1'                  TO ERR-PARAGRAPH
              MOVE VRUINFOKEY                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P9320-REWRITE-VRUINFO.
      *
           EXEC CICS REWRITE
                     DATASET(VRU-INFO-FILE)
                     FROM   (VRUINFO-FILE)
                     LENGTH (VRU-INFO-TERM-RLGTH)
                     RESP   (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9320-1'                  TO ERR-PARAGRAPH
              MOVE VRUINFOKEY                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
       P9330-READ-VRUINFO.
      *
           MOVE VRUINFO-KEY-AREA              TO VRUINFOKEY
           EXEC CICS READ
                     DATASET  (VRU-INFO-FILE)
                     INTO     (VRUINFO-FILE)
                     LENGTH   (VRU-INFO-TERM-RLGTH)
                     RIDFLD   (VRUINFOKEY)
                     KEYLENGTH(VRU-INFO-TERM-KLGTH)
                     RESP     (WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF  NOT SUCCESS
           AND NOT NO-RECORD-FND
              MOVE 'P9330-1'                  TO ERR-PARAGRAPH
              MOVE VRUINFOKEY                 TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF
           .
      *
      *P9340-DELETE-VRUINFO.
      *
      *    EXEC CICS DELETE
      *              DATASET(VRU-INFO-FILE)
      *              RIDFLD (VRUINFOKEY)
      *              RESP   (WS-RESPONSE)
      *    END-EXEC
      *
      *    MOVE WS-RESPONSE                   TO FILE-STATUS
      *    IF  NOT SUCCESS
      *    AND NOT NO-RECORD-FND
      *       MOVE 'P9340-1'                  TO ERR-PARAGRAPH
      *       MOVE VRUINFOKEY                 TO ERR-KEY
      *       MOVE SPACES                     TO ERR-SENTENCE
      *       PERFORM P9999-GOT-PROBLEM
      *    END-IF
      *    .
      *=================================================================
       P9500-WRITE-TSQUEUE.
      *=================================================================
           MOVE EIBTRMID                      TO P08-TSQ-TERM
           EXEC CICS DELETEQ TS
                     QUEUE(P08-TSQ-ID)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
      *    MOVE SPACES                        TO P08-TSQ-DATA
           MOVE LOW-VALUES                    TO P08-TSQ-DATA
           MOVE PSTS08                        TO P08-TSQ-DATA
           MOVE PSTCOMM-AREA                  TO P08-TSQ-PSTCOMM-AREA
           MOVE P08CA-SCREEN-COMMAREA         TO P08-TSQ-SCREEN-AREA
           MOVE P08CA-SAVE-COMMAREA           TO P08-TSQ-SAVE-AREA
           EXEC CICS WRITEQ TS
                     QUEUE(P08-TSQ-ID)
                     FROM(P08-TSQ-AREA)
                     LENGTH(P08-TSQ-LGTH)
                     ITEM(P08-TSQ-ITEM)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9500-1'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *=================================================================
       P9550-REWRITE-TSQUEUE.
      *=================================================================
           MOVE EIBTRMID                      TO P08-TSQ-TERM
           MOVE PSTCOMM-AREA                  TO P08-TSQ-PSTCOMM-AREA
           MOVE P08CA-SCREEN-COMMAREA         TO P08-TSQ-SCREEN-AREA
           MOVE P08CA-SAVE-COMMAREA           TO P08-TSQ-SAVE-AREA
           EXEC CICS WRITEQ TS
                     QUEUE(P08-TSQ-ID)
                     FROM(P08-TSQ-AREA)
                     LENGTH(P08-TSQ-LGTH)
                     ITEM(P08-TSQ-ITEM)
                     REWRITE
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9550-1'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *=================================================================
       P9600-READ-TSQUEUE.
      *=================================================================
           MOVE EIBTRMID                      TO P08-TSQ-TERM
           EXEC CICS READQ TS
                     QUEUE(P08-TSQ-ID)
                     INTO(P08-TSQ-AREA)
                     LENGTH(P08-TSQ-LGTH)
                     ITEM(P08-TSQ-ITEM)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9600-1'                  TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *C983-BEG
      *=================================================================
       P9650-DELETE-HANGING-LVE.
      *=================================================================
           IF P08CA-EMP-NO(FUNC-SUB) >              SPACES
              MOVE P08CA-EMP-NO(FUNC-SUB) TO MSTRNBRK
              PERFORM P8505-READ-MASTER-ONLY
              PERFORM P8511-EMP-HOME-AWAY-CHECK
      *
      *     ROAD EMPLOYEES ARE TO BE CONSIDERED AWAY FROM HOME WHEN
      *     THEY'RE IN A WORKING STATUS OR IF THEY HAVE AN ON-DUTY ASGN.
      *     IF AN EMPLOYEE HAS AN ON-DUTY RECORD THAT'S AN ASSIGNED JOB,
      *     THEY'RE ALSO AWAY FROM HOME (THIS INDICATES THEY'VE BEEN
      *     DEADHEADED TO THE JOB, BUT HAVEN'T BEEN CALLED ON DUTY YET).
      *
              IF WS-EMP-AT-HOME
                 IF CURR-ASGN-UFP
                 AND (WORKING OR ON-DUTY-ASGNMT > SPACES)
                    SET WS-EMP-AT-AWAY              TO TRUE
                 END-IF
                 IF ON-DUTY-AJ
                 AND NOT WORKING
                    SET WS-EMP-AT-AWAY              TO TRUE
                 END-IF
              END-IF
      *       DELETE LVE IF EMP AT HOME
              IF NOT WS-EMP-AT-AWAY
                 INITIALIZE WS-LVE-TABLE
                 MOVE P08CA-EMP-NO(FUNC-SUB) TO LVE-EMP-NBR
                 PERFORM PSQL-LVEDEL03
      *C1019 - BEG
      *          DELETE ASSOCIATED AFHT TELEPHONE INFORMATION
                 MOVE SPACES                 TO WS-TELE-FILE
                 MOVE P08CA-EMP-NO(FUNC-SUB) TO TELENBRK
                                                TELE-EMP-NBR
                 PERFORM P8560-READ-TELE
                 IF SUCCESS
                    IF TELE-USE-PH-NBR-ON-FILE-FL = 'Y'
                       PERFORM P8530-READ-TELE-UPDATE
                       MOVE SPACES         TO TELE-USE-PH-NBR-ON-FILE-FL
                                              TELE-TEMP-AREA-CD
                                              TELE-TEMP-PREFIX
                                              TELE-TEMP-SUFFIX
                                              TELE-TEMP-ACCESS-PIN
                                              TELE-TEMP-COMMENT
                                              TELE-TEMP-DEVICE-TYPE
                                              TELE-TEMP-EXP-DATE-TIME
                       PERFORM P8540-REWRITE-TELE
                    END-IF
                 END-IF
      *C1019 - END
              END-IF
           END-IF
           .
      *C983-END
      *=================================================================
       P9700-LINK-P903.
      *=================================================================
           EXEC CICS LINK
                     PROGRAM(P903-PGM)
                     COMMAREA(DATE-CONVERSION-PARMS)
                     LENGTH(P903-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE       TO FILE-STATUS
           .
      *=================================================================
       P9800-SETUP-SCR998.
      *=================================================================
           MOVE SPACES            TO P998COMM-AREA
           MOVE P08-PGM           TO P998CA-FROM-PROGRAM
           MOVE P08-MAP           TO P998CA-SCREEN-ID
           MOVE EIBCPOSN          TO P998CA-CURSOR-POS
           EXEC CICS XCTL
                     PROGRAM(P998-PGM)
                     COMMAREA(PSTCOMM-AREA)
                     LENGTH(PSTCOMM-LGTH)
                     RESP(WS-RESPONSE)
           END-EXEC
           MOVE WS-RESPONSE       TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9800'        TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9810-PROCESS-OFFSET.
      *
           MOVE PSTCA-DT-OS-FUN       TO PARM-CONV-TYPE
           MOVE PSTCA-DT-OS-DAYS      TO PARM-SEC-JULIAN-DAY
           MOVE PSTCA-DT-OS-HRMN      TO PARM-SEC-HRMN
           PERFORM P9700-LINK-P903
           IF NOT SUCCESS
              MOVE 'P9810-1'          TO ERR-PARAGRAPH
              MOVE 'P903'             TO ERR-KEY
              PERFORM P9999-GOT-PROBLEM
           END-IF.
      *
       P9990-CLEAR-SCREEN.
      *
           EXEC CICS SEND CONTROL
                          ERASE
                          FREEKB
           END-EXEC
           EXEC CICS RETURN END-EXEC.
      *
       P9993-CALL-PS94-PROGRAM.
      *
           EXEC CICS LINK
                     PROGRAM  (PS94-PGM)
                     COMMAREA (PS94-COMMAREA-PARMS)
                     LENGTH   (PS94-LGTH)
                     RESP     (WS-RESPONSE)
           END-EXEC

           MOVE WS-RESPONSE                   TO FILE-STATUS
           IF NOT SUCCESS
              MOVE 'P9993-S94'                TO ERR-PARAGRAPH
              PERFORM P9999-GOT-PROBLEM
           ELSE
              MOVE PS94-FILE-STATUS           TO FILE-STATUS
           END-IF

           IF PS94-ERROR-ENCOUNTERED
              MOVE PS94-COMMAREA-PARMS(1:PSTCOMM-LGTH)
                        TO DFHCOMMAREA(1:PSTCOMM-LGTH)
              EXEC CICS RETURN END-EXEC
           END-IF.
      *
       X9999-GOBACK.
           GOBACK.
      *
      ******************************************************************
           EXEC SQL INCLUDE GOTPROB  END-EXEC.
      ******************************************************************
           EXEC SQL INCLUDE TOCINS01 END-EXEC.
           EXEC SQL INCLUDE TOCDEL01 END-EXEC.
           EXEC SQL INCLUDE TOCSEL01 END-EXEC.
           EXEC SQL INCLUDE TOCSHARE END-EXEC.

           EXEC SQL INCLUDE IERSEL07 END-EXEC.
           EXEC SQL INCLUDE IERSEL16 END-EXEC.
           EXEC SQL INCLUDE IERSHARE END-EXEC.

           EXEC SQL INCLUDE IEPSEL03 END-EXEC.
           EXEC SQL INCLUDE IEPSHARE END-EXEC.

           EXEC SQL INCLUDE LVPSEL01 END-EXEC.
           EXEC SQL INCLUDE LVPSEL08 END-EXEC.
           EXEC SQL INCLUDE LVPSHARE END-EXEC.

           EXEC SQL INCLUDE LVESEL01 END-EXEC.
      *C983-BEG
           EXEC SQL INCLUDE LVEDEL03 END-EXEC.
           EXEC SQL INCLUDE LVESHARE END-EXEC.
      *C983-END

           EXEC SQL INCLUDE HSTCUR02 END-EXEC.
           EXEC SQL INCLUDE HSTSHARE END-EXEC.
      *CNC0520-BEG
           EXEC SQL INCLUDE LSPSEL04 END-EXEC.
           EXEC SQL INCLUDE LSPSHARE END-EXEC.
           EXEC SQL INCLUDE LSDCUR02 END-EXEC.
           EXEC SQL INCLUDE LSDSHARE END-EXEC.
           EXEC SQL INCLUDE TRRSHARE END-EXEC.
           EXEC SQL INCLUDE TRRCUR06 END-EXEC.
      *CNC0520-END
